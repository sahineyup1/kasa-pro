module.exports=[75055,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(15618),e=a.i(87532),f=a.i(38784),g=a.i(67900),h=a.i(24569),i=a.i(81560),j=a.i(77156),k=a.i(84505),l=a.i(96221),m=a.i(4720),n=a.i(91119),o=a.i(99570),p=a.i(66718),q=a.i(6015),r=a.i(68114),s=a.i(29258),t=a.i(70430),u=a.i(80701),v=a.i(29246),w=a.i(14574);let x=[{value:22,label:"22% - Standart"},{value:9.5,label:"9.5% - Indirimli"},{value:5,label:"5% - Kitap"},{value:0,label:"0% - Muaf"}],y=[{value:"draft",label:"Taslak"},{value:"pending",label:"Beklemede"},{value:"approved",label:"Onaylandi"},{value:"cancelled",label:"Iptal"}],z=[{value:"unpaid",label:"Odenmedi"},{value:"partial",label:"Kismi Odeme"},{value:"paid",label:"Odendi"}];function A({open:a,onOpenChange:e,invoice:f,onSave:g}){let h=!!f,[j,k]=(0,c.useState)(""),[l,m]=(0,c.useState)(""),[n,q]=(0,c.useState)(""),[r,A]=(0,c.useState)(""),[B,C]=(0,c.useState)(""),[D,E]=(0,c.useState)("pending"),[F,G]=(0,c.useState)("unpaid"),[H,I]=(0,c.useState)(""),[J,K]=(0,c.useState)([]),[L,M]=(0,c.useState)(!1),[N,O]=(0,c.useState)([]);(0,c.useEffect)(()=>{let a=(0,s.subscribeToData)("suppliers",a=>{if(a){let b=Object.entries(a).map(([a,b])=>({id:a,name:b.name||b.companyName||"",taxNumber:b.taxNumber||b.ddvNumber||""})).filter(a=>a.name);b.sort((a,b)=>a.name.localeCompare(b.name)),O(b)}});return()=>a()},[]),(0,c.useEffect)(()=>{if(a){let a=new Date().toISOString().split("T")[0],b=new Date(Date.now()+2592e6).toISOString().split("T")[0];f?(k(f.invoiceNo||""),m(f.date||a),q(f.dueDate||b),A(f.supplierId||""),C(f.supplierDdvNo||""),E(f.status||"pending"),G(f.paymentStatus||"unpaid"),I(f.notes||""),K(f.items?.map((a,b)=>({id:a.id||`item-${b}`,description:a.description||"",quantity:a.quantity||1,unitPrice:a.unitPrice||0,ddvRate:a.ddvRate||22,ddvAmount:a.ddvAmount||0,total:a.total||0}))||[])):(k(""),m(a),q(b),A(""),C(""),E("pending"),G("unpaid"),I(""),K([P()]))}},[a,f]),(0,c.useEffect)(()=>{if(r){let a=N.find(a=>a.id===r);a?.taxNumber&&C(a.taxNumber)}},[r,N]);let P=()=>({id:`item-${Date.now()}`,description:"",quantity:1,unitPrice:0,ddvRate:22,ddvAmount:0,total:0}),Q=(a,b,c)=>{K(J.map(d=>{if(d.id!==a)return d;let e={...d,[b]:c},f=e.quantity*e.unitPrice;return e.ddvAmount=f*(e.ddvRate/100),e.total=f+e.ddvAmount,e}))},R=J.reduce((a,b)=>a+b.quantity*b.unitPrice,0),S=J.reduce((a,b)=>a+b.ddvAmount,0),T=R+S,U=async()=>{if(!j.trim())return void alert("Lutfen fatura numarasi girin!");if(0===J.length||J.every(a=>!a.description))return void alert("Lutfen en az bir kalem ekleyin!");M(!0);try{let a=N.find(a=>a.id===r),b={invoiceNo:j.trim(),date:l,dueDate:n||null,supplierId:r||null,supplier:a?.name||"",supplierDdvNo:B.trim(),status:D,paymentStatus:F,items:J.filter(a=>a.description).map(a=>({description:a.description,quantity:a.quantity,unitPrice:a.unitPrice,ddvRate:a.ddvRate,ddvAmount:a.ddvAmount,total:a.total})),subtotal:R,vatAmount:S,total:T,notes:H.trim(),currency:"EUR",updatedAt:new Date().toISOString()};h&&f?.id?await (0,s.updateData)(`purchase_invoices/${f.id}`,b):(b.createdAt=new Date().toISOString(),await (0,s.pushData)("purchase_invoices",b)),e(!1),g?.()}catch(a){console.error("Save error:",a),alert("Kaydetme hatasi: "+a.message)}finally{M(!1)}};return(0,b.jsx)(w.Dialog,{open:a,onOpenChange:e,children:(0,b.jsxs)(w.DialogContent,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[(0,b.jsx)(w.DialogHeader,{children:(0,b.jsx)(w.DialogTitle,{className:"text-xl font-semibold",children:h?"Alis Faturasi Duzenle":"Yeni Alis Faturasi"})}),(0,b.jsxs)("div",{className:"grid gap-6 py-4",children:[(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)("h3",{className:"text-sm font-medium text-muted-foreground border-b pb-2",children:"Fatura Bilgileri"}),(0,b.jsxs)("div",{className:"grid grid-cols-4 gap-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(t.Label,{htmlFor:"invoiceNo",children:"Fatura No *"}),(0,b.jsx)(p.Input,{id:"invoiceNo",value:j,onChange:a=>k(a.target.value),placeholder:"Orn: FAT-2024-001"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(t.Label,{htmlFor:"invoiceDate",children:"Fatura Tarihi *"}),(0,b.jsx)(p.Input,{id:"invoiceDate",type:"date",value:l,onChange:a=>m(a.target.value)})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(t.Label,{htmlFor:"dueDate",children:"Vade Tarihi"}),(0,b.jsx)(p.Input,{id:"dueDate",type:"date",value:n,onChange:a=>q(a.target.value)})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(t.Label,{htmlFor:"status",children:"Durum"}),(0,b.jsxs)(u.Select,{value:D,onValueChange:E,children:[(0,b.jsx)(u.SelectTrigger,{children:(0,b.jsx)(u.SelectValue,{placeholder:"Durum secin"})}),(0,b.jsx)(u.SelectContent,{children:y.map(a=>(0,b.jsx)(u.SelectItem,{value:a.value,children:a.label},a.value))})]})]})]})]}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)("h3",{className:"text-sm font-medium text-muted-foreground border-b pb-2",children:"Tedarikci Bilgileri"}),(0,b.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(t.Label,{htmlFor:"supplier",children:"Tedarikci"}),(0,b.jsxs)(u.Select,{value:r,onValueChange:A,children:[(0,b.jsx)(u.SelectTrigger,{children:(0,b.jsx)(u.SelectValue,{placeholder:"Tedarikci secin"})}),(0,b.jsx)(u.SelectContent,{children:N.map(a=>(0,b.jsx)(u.SelectItem,{value:a.id,children:a.name},a.id))})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(t.Label,{htmlFor:"supplierDdvNo",children:"Tedarikci DDV No"}),(0,b.jsx)(p.Input,{id:"supplierDdvNo",value:B,onChange:a=>C(a.target.value),placeholder:"SI12345678"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(t.Label,{htmlFor:"paymentStatus",children:"Odeme Durumu"}),(0,b.jsxs)(u.Select,{value:F,onValueChange:G,children:[(0,b.jsx)(u.SelectTrigger,{children:(0,b.jsx)(u.SelectValue,{placeholder:"Odeme durumu secin"})}),(0,b.jsx)(u.SelectContent,{children:z.map(a=>(0,b.jsx)(u.SelectItem,{value:a.value,children:a.label},a.value))})]})]})]})]}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between border-b pb-2",children:[(0,b.jsx)("h3",{className:"text-sm font-medium text-muted-foreground",children:"Fatura Kalemleri"}),(0,b.jsxs)(o.Button,{type:"button",variant:"outline",size:"sm",onClick:()=>{K([...J,P()])},children:[(0,b.jsx)(d.Plus,{className:"h-4 w-4 mr-1"}),"Kalem Ekle"]})]}),(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsxs)("div",{className:"grid grid-cols-12 gap-2 text-xs font-medium text-muted-foreground px-1",children:[(0,b.jsx)("div",{className:"col-span-4",children:"Aciklama"}),(0,b.jsx)("div",{className:"col-span-1",children:"Miktar"}),(0,b.jsx)("div",{className:"col-span-2",children:"Birim Fiyat"}),(0,b.jsx)("div",{className:"col-span-2",children:"DDV %"}),(0,b.jsx)("div",{className:"col-span-2 text-right",children:"Toplam"}),(0,b.jsx)("div",{className:"col-span-1"})]}),J.map(a=>(0,b.jsxs)("div",{className:"grid grid-cols-12 gap-2 items-center",children:[(0,b.jsx)("div",{className:"col-span-4",children:(0,b.jsx)(p.Input,{value:a.description,onChange:b=>Q(a.id,"description",b.target.value),placeholder:"Urun/hizmet aciklamasi"})}),(0,b.jsx)("div",{className:"col-span-1",children:(0,b.jsx)(p.Input,{type:"number",value:a.quantity,onChange:b=>Q(a.id,"quantity",parseFloat(b.target.value)||0),min:"0",step:"1"})}),(0,b.jsx)("div",{className:"col-span-2",children:(0,b.jsx)(p.Input,{type:"number",value:a.unitPrice,onChange:b=>Q(a.id,"unitPrice",parseFloat(b.target.value)||0),min:"0",step:"0.01"})}),(0,b.jsx)("div",{className:"col-span-2",children:(0,b.jsxs)(u.Select,{value:String(a.ddvRate),onValueChange:b=>Q(a.id,"ddvRate",parseFloat(b)),children:[(0,b.jsx)(u.SelectTrigger,{children:(0,b.jsx)(u.SelectValue,{})}),(0,b.jsx)(u.SelectContent,{children:x.map(a=>(0,b.jsx)(u.SelectItem,{value:String(a.value),children:a.label},a.value))})]})}),(0,b.jsxs)("div",{className:"col-span-2 text-right font-mono font-semibold",children:[a.total.toFixed(2)," EUR"]}),(0,b.jsx)("div",{className:"col-span-1 flex justify-end",children:(0,b.jsx)(o.Button,{type:"button",variant:"ghost",size:"icon",className:"h-8 w-8 text-destructive",onClick:()=>{var b;return b=a.id,void(J.length>1&&K(J.filter(a=>a.id!==b)))},disabled:1===J.length,children:(0,b.jsx)(i.Trash2,{className:"h-4 w-4"})})})]},a.id))]}),(0,b.jsxs)("div",{className:"border-t pt-4 space-y-2",children:[(0,b.jsxs)("div",{className:"flex justify-end gap-8 text-sm",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Ara Toplam:"}),(0,b.jsxs)("span",{className:"font-mono w-24 text-right",children:[R.toFixed(2)," EUR"]})]}),(0,b.jsxs)("div",{className:"flex justify-end gap-8 text-sm",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"DDV Toplam:"}),(0,b.jsxs)("span",{className:"font-mono w-24 text-right",children:[S.toFixed(2)," EUR"]})]}),(0,b.jsxs)("div",{className:"flex justify-end gap-8 text-lg font-semibold",children:[(0,b.jsx)("span",{children:"Genel Toplam:"}),(0,b.jsxs)("span",{className:"font-mono w-24 text-right text-primary",children:[T.toFixed(2)," EUR"]})]})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(t.Label,{htmlFor:"notes",children:"Notlar"}),(0,b.jsx)(v.Textarea,{id:"notes",value:H,onChange:a=>I(a.target.value),placeholder:"Ek notlar, referanslar...",rows:2})]})]}),(0,b.jsxs)(w.DialogFooter,{children:[(0,b.jsx)(o.Button,{variant:"outline",onClick:()=>e(!1),disabled:L,children:"Iptal"}),(0,b.jsx)(o.Button,{onClick:U,disabled:L,children:L?"Kaydediliyor...":"Kaydet"})]})]})})}let B={draft:{label:"Taslak",color:"bg-gray-100 text-gray-700"},pending:{label:"Beklemede",color:"bg-yellow-100 text-yellow-700"},approved:{label:"Onaylandı",color:"bg-emerald-100 text-emerald-700"},cancelled:{label:"İptal",color:"bg-red-100 text-red-700"}},C={unpaid:{label:"Ödenmedi",color:"bg-red-100 text-red-700"},partial:{label:"Kısmi Ödeme",color:"bg-yellow-100 text-yellow-700"},paid:{label:"Ödendi",color:"bg-emerald-100 text-emerald-700"}};function D(){let[a,t]=(0,c.useState)([]),[u,v]=(0,c.useState)(!0),[w,x]=(0,c.useState)(""),[y,z]=(0,c.useState)("all"),[D,E]=(0,c.useState)(!1),[F,G]=(0,c.useState)(null);(0,c.useEffect)(()=>{let a=(0,s.subscribeToData)("purchase_invoices",a=>{if(a){let b=Object.entries(a).map(([a,b])=>({id:a,...b}));b.sort((a,b)=>new Date(b.date).getTime()-new Date(a.date).getTime()),t(b)}else t([]);v(!1)});return()=>a()},[]);let H=a.filter(a=>{let b=a.invoiceNo?.toLowerCase().includes(w.toLowerCase())||a.supplier?.toLowerCase().includes(w.toLowerCase()),c="all"===y||a.status===y;return b&&c}),I={total:a.length,totalAmount:a.reduce((a,b)=>a+(b.total||0),0),unpaid:a.filter(a=>"unpaid"===a.paymentStatus).length,unpaidAmount:a.filter(a=>"unpaid"===a.paymentStatus).reduce((a,b)=>a+(b.total||0),0)},J=a=>{G(a),E(!0)},K=async a=>{if(confirm(`"${a.invoiceNo}" faturasini silmek istediginize emin misiniz?`))try{await (0,s.removeData)(`purchase_invoices/${a.id}`)}catch(a){alert("Silme hatasi: "+a.message)}};return u?(0,b.jsxs)("div",{className:"flex items-center justify-center h-96",children:[(0,b.jsx)(l.Loader2,{className:"h-8 w-8 animate-spin text-primary"}),(0,b.jsx)("span",{className:"ml-2 text-muted-foreground",children:"Yükleniyor..."})]}):(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-3xl font-bold tracking-tight",children:"Alış Faturaları"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"Tedarikçilerden alınan faturalar"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsxs)(o.Button,{variant:"outline",size:"sm",children:[(0,b.jsx)(k.Download,{className:"h-4 w-4 mr-2"}),"Excel"]}),(0,b.jsxs)(o.Button,{size:"sm",onClick:()=>{G(null),E(!0)},children:[(0,b.jsx)(d.Plus,{className:"h-4 w-4 mr-2"}),"Yeni Fatura"]})]})]}),(0,b.jsxs)("div",{className:"grid gap-4 md:grid-cols-4",children:[(0,b.jsxs)(n.Card,{children:[(0,b.jsxs)(n.CardHeader,{className:"flex flex-row items-center justify-between pb-2",children:[(0,b.jsx)(n.CardTitle,{className:"text-sm font-medium text-muted-foreground",children:"Toplam Fatura"}),(0,b.jsx)(m.FileText,{className:"h-4 w-4 text-muted-foreground"})]}),(0,b.jsx)(n.CardContent,{children:(0,b.jsx)("div",{className:"text-2xl font-bold",children:I.total})})]}),(0,b.jsxs)(n.Card,{children:[(0,b.jsxs)(n.CardHeader,{className:"flex flex-row items-center justify-between pb-2",children:[(0,b.jsx)(n.CardTitle,{className:"text-sm font-medium text-muted-foreground",children:"Toplam Tutar"}),(0,b.jsx)(g.Building2,{className:"h-4 w-4 text-muted-foreground"})]}),(0,b.jsx)(n.CardContent,{children:(0,b.jsx)("div",{className:"text-2xl font-bold text-primary",children:(0,r.formatCurrency)(I.totalAmount)})})]}),(0,b.jsxs)(n.Card,{children:[(0,b.jsxs)(n.CardHeader,{className:"flex flex-row items-center justify-between pb-2",children:[(0,b.jsx)(n.CardTitle,{className:"text-sm font-medium text-muted-foreground",children:"Ödenmemiş"}),(0,b.jsx)("div",{className:"h-2 w-2 rounded-full bg-red-500"})]}),(0,b.jsx)(n.CardContent,{children:(0,b.jsx)("div",{className:"text-2xl font-bold text-red-600",children:I.unpaid})})]}),(0,b.jsxs)(n.Card,{children:[(0,b.jsxs)(n.CardHeader,{className:"flex flex-row items-center justify-between pb-2",children:[(0,b.jsx)(n.CardTitle,{className:"text-sm font-medium text-muted-foreground",children:"Ödenmemiş Tutar"}),(0,b.jsx)(f.ShoppingCart,{className:"h-4 w-4 text-muted-foreground"})]}),(0,b.jsx)(n.CardContent,{children:(0,b.jsx)("div",{className:"text-2xl font-bold text-red-600",children:(0,r.formatCurrency)(I.unpaidAmount)})})]})]}),(0,b.jsx)(n.Card,{children:(0,b.jsx)(n.CardContent,{className:"pt-6",children:(0,b.jsx)("div",{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:(0,b.jsxs)("div",{className:"flex flex-1 gap-4",children:[(0,b.jsxs)("div",{className:"relative flex-1 max-w-sm",children:[(0,b.jsx)(e.Search,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),(0,b.jsx)(p.Input,{type:"search",placeholder:"Fatura no veya tedarikçi ara...",value:w,onChange:a=>x(a.target.value),className:"pl-9"})]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)(o.Button,{variant:"all"===y?"default":"outline",size:"sm",onClick:()=>z("all"),children:"Tümü"}),Object.entries(B).map(([a,{label:c}])=>(0,b.jsx)(o.Button,{variant:y===a?"default":"outline",size:"sm",onClick:()=>z(a),children:c},a))]})]})})})}),(0,b.jsx)(n.Card,{children:(0,b.jsx)(n.CardContent,{className:"pt-6",children:(0,b.jsxs)(q.Table,{children:[(0,b.jsx)(q.TableHeader,{children:(0,b.jsxs)(q.TableRow,{children:[(0,b.jsx)(q.TableHead,{children:"Fatura No"}),(0,b.jsx)(q.TableHead,{children:"Tarih"}),(0,b.jsx)(q.TableHead,{children:"Tedarikçi"}),(0,b.jsx)(q.TableHead,{className:"text-right",children:"Ara Toplam"}),(0,b.jsx)(q.TableHead,{className:"text-right",children:"KDV"}),(0,b.jsx)(q.TableHead,{className:"text-right",children:"Toplam"}),(0,b.jsx)(q.TableHead,{children:"Durum"}),(0,b.jsx)(q.TableHead,{children:"Ödeme"}),(0,b.jsx)(q.TableHead,{className:"w-[100px]",children:"İşlem"})]})}),(0,b.jsx)(q.TableBody,{children:0===H.length?(0,b.jsx)(q.TableRow,{children:(0,b.jsxs)(q.TableCell,{colSpan:9,className:"text-center py-12",children:[(0,b.jsx)(f.ShoppingCart,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),(0,b.jsx)("h3",{className:"text-lg font-medium",children:"Fatura bulunamadı"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"Henüz alış faturası eklenmemiş veya arama kriterlerine uygun sonuç yok."})]})}):H.map(a=>(0,b.jsxs)(q.TableRow,{children:[(0,b.jsx)(q.TableCell,{className:"font-medium font-mono",children:a.invoiceNo}),(0,b.jsx)(q.TableCell,{children:(0,r.formatDate)(a.date)}),(0,b.jsx)(q.TableCell,{children:a.supplier||"-"}),(0,b.jsx)(q.TableCell,{className:"text-right font-mono",children:(0,r.formatCurrency)(a.subtotal||0)}),(0,b.jsx)(q.TableCell,{className:"text-right font-mono text-muted-foreground",children:(0,r.formatCurrency)(a.vatAmount||0)}),(0,b.jsx)(q.TableCell,{className:"text-right font-mono font-medium",children:(0,r.formatCurrency)(a.total||0)}),(0,b.jsx)(q.TableCell,{children:(0,b.jsx)("span",{className:`inline-flex items-center rounded-full px-2 py-1 text-xs font-medium ${B[a.status]?.color||"bg-gray-100"}`,children:B[a.status]?.label||a.status})}),(0,b.jsx)(q.TableCell,{children:(0,b.jsx)("span",{className:`inline-flex items-center rounded-full px-2 py-1 text-xs font-medium ${C[a.paymentStatus]?.color||"bg-gray-100"}`,children:C[a.paymentStatus]?.label||a.paymentStatus})}),(0,b.jsx)(q.TableCell,{children:(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[(0,b.jsx)(o.Button,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>J(a),children:(0,b.jsx)(j.Eye,{className:"h-4 w-4"})}),(0,b.jsx)(o.Button,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>J(a),children:(0,b.jsx)(h.Edit,{className:"h-4 w-4"})}),(0,b.jsx)(o.Button,{variant:"ghost",size:"icon",className:"h-8 w-8 text-destructive",onClick:()=>K(a),children:(0,b.jsx)(i.Trash2,{className:"h-4 w-4"})})]})})]},a.id))})]})})}),(0,b.jsx)(A,{open:D,onOpenChange:E,invoice:F})]})}a.s(["default",()=>D],75055)}];

//# sourceMappingURL=src_app_dashboard_purchase-invoices_page_tsx_05c30034._.js.map