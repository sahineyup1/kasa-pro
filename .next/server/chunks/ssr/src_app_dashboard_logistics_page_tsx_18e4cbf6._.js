module.exports=[54650,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(99570),e=a.i(66718),f=a.i(15055),g=a.i(80701),h=a.i(75083),i=a.i(6015),j=a.i(35732),k=a.i(29258),l=a.i(69520),m=a.i(17755),n=a.i(87532),o=a.i(84505),p=a.i(77156),q=a.i(92759),r=a.i(10227),s=a.i(83497),t=a.i(41710),u=a.i(38784),v=a.i(11300),w=a.i(4720),x=a.i(16201),y=a.i(70106);let z=(0,y.default)("arrow-right",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]),A=(0,y.default)("box",[["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]]);var B=a.i(14574),C=a.i(29246),D=a.i(70430),E=a.i(41675),F=a.i(46842),G=a.i(96221),H=a.i(336),I=a.i(67900),J=a.i(48464);function K({open:a,onOpenChange:f,selectedItems:h,onSuccess:j}){let[l,m]=(0,c.useState)([]),[n,o]=(0,c.useState)([]),[p,q]=(0,c.useState)([]),[s,t]=(0,c.useState)(!1),[u,v]=(0,c.useState)(!1),[w,x]=(0,c.useState)(new Date().toISOString().split("T")[0]),[y,z]=(0,c.useState)(""),[A,K]=(0,c.useState)(""),[L,M]=(0,c.useState)(""),[N,O]=(0,c.useState)([]);(0,c.useEffect)(()=>{if(!a)return;t(!0);let b=(0,k.subscribeToRTDB)("employees",a=>{m((a||[]).filter(a=>{let b=a.role?.roleId?.toLowerCase()||"";return b.includes("driver")||b.includes("sofor")}))}),c=(0,k.subscribeToRTDB)("branches",a=>{o(a||[])}),d=(0,k.subscribeToRTDB)("products",a=>{q(a||[]),t(!1)});return()=>{b(),c(),d()}},[a]),(0,c.useEffect)(()=>{if(!a||0===h.length)return;let b=[];h.forEach(a=>{a.items.forEach(c=>{let d=p.find(a=>a.id===c.productId),e=d?.costPrice||d?.purchasePrice||d?.pricing?.costPrice||d?.pricing?.purchasePrice||0,f=c.quantity||0;b.push({productId:c.productId||"",productName:c.productName||"-",quantity:f,unit:c.unit||"Adet",costPrice:e,totalCost:f*e,targetBranch:a.sourceId||a.source,sourceType:"request"===a.type?"Talep":"order"===a.type?"Siparis":"Eksik Liste"})})}),O(b)},[a,h,p]),(0,c.useEffect)(()=>{a||(x(new Date().toISOString().split("T")[0]),z(""),K(""),M(""),O([]))},[a]);let P=(0,c.useMemo)(()=>N.reduce((a,b)=>a+b.totalCost,0),[N]),Q=a=>{let b=n.find(b=>b.id===a);return b?.name||a},R=async()=>{if(!y)return void alert("Lutfen surucu seciniz");if(!A.trim())return void alert("Lutfen arac plakasi giriniz");if(0===N.length)return void alert("Transfer edilecek urun bulunmuyor");v(!0);try{let a,b=new Date,c=b.toISOString(),d=`${b.getFullYear()}${String(b.getMonth()+1).padStart(2,"0")}${String(b.getDate()).padStart(2,"0")}`,e=`${String(b.getHours()).padStart(2,"0")}${String(b.getMinutes()).padStart(2,"0")}${String(b.getSeconds()).padStart(2,"0")}`,g={};N.forEach(a=>{g[a.targetBranch]||(g[a.targetBranch]=[]),g[a.targetBranch].push(a)});let i=(a=l.find(a=>a.id===y))?`${a.firstName||""} ${a.lastName||""}`.trim():"",m=0;for(let[a,b]of Object.entries(g)){let f=`TRF-${d}${e}-${m+1}`,g=`IRS-${d}${e}-${m+1}`,h=b.reduce((a,b)=>a+b.totalCost,0),j={transferNumber:f,transferDate:w,fromBranch:"MERKEZ_DEPO",fromBranchName:"Merkez Depo",toBranch:a,toBranchName:Q(a),items:b.map(a=>({productId:a.productId,productName:a.productName,quantity:a.quantity,unit:a.unit,costPrice:a.costPrice,totalCost:a.totalCost})),totalCost:h,status:"pending",createdAt:c,createdBy:"admin",createdByName:"Admin",notes:L},l=await (0,k.pushData)("stock_transfers",j),n={waybillNumber:g,relatedTransferId:l,sourceLocation:{id:"MERKEZ_DEPO",branchName:"Merkez Depo"},targetLocation:{id:a,branchName:Q(a)},driverId:y,driverName:i,vehicle:A,items:b.map(a=>({productId:a.productId,productName:a.productName,quantity:a.quantity,unit:a.unit})),status:"ready_to_dispatch",createdAt:c,createdBy:"admin"};await (0,k.pushData)("internal_waybills",n),m++}for(let a of h){let b="request"===a.type?"stock_requests":"order"===a.type?"orders":"missing_lists";await (0,k.updateData)(`${b}/${a.id}`,{status:"in_transfer",transferredAt:c})}alert(`${m} transfer ve irsaliye basariyla olusturuldu!`),f(!1),j?.()}catch(a){console.error("Transfer error:",a),alert("Transfer olusturma hatasi: "+a.message)}finally{v(!1)}};return(0,b.jsx)(B.Dialog,{open:a,onOpenChange:f,children:(0,b.jsxs)(B.DialogContent,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[(0,b.jsx)(B.DialogHeader,{children:(0,b.jsxs)(B.DialogTitle,{className:"flex items-center gap-2",children:[(0,b.jsx)(r.Truck,{className:"h-5 w-5"}),"Toplu Transfer + Irsaliye Olustur"]})}),(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)(D.Label,{className:"flex items-center gap-1 mb-2",children:[(0,b.jsx)(I.Building2,{className:"h-4 w-4"}),"Kaynak"]}),(0,b.jsx)("div",{className:"px-3 py-2 bg-gray-100 rounded-md text-sm font-medium",children:"Merkez Depo"})]}),(0,b.jsxs)("div",{children:[(0,b.jsxs)(D.Label,{className:"flex items-center gap-1 mb-2",children:[(0,b.jsx)(E.Calendar,{className:"h-4 w-4"}),"Transfer Tarihi"]}),(0,b.jsx)(e.Input,{type:"date",value:w,onChange:a=>x(a.target.value)})]}),(0,b.jsxs)("div",{children:[(0,b.jsxs)(D.Label,{className:"flex items-center gap-1 mb-2",children:[(0,b.jsx)(F.User,{className:"h-4 w-4"}),"Surucu *"]}),(0,b.jsxs)(g.Select,{value:y,onValueChange:z,children:[(0,b.jsx)(g.SelectTrigger,{children:(0,b.jsx)(g.SelectValue,{placeholder:"Surucu sec..."})}),(0,b.jsx)(g.SelectContent,{children:l.map(a=>(0,b.jsxs)(g.SelectItem,{value:a.id,children:[a.firstName," ",a.lastName]},a.id))})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsxs)(D.Label,{className:"flex items-center gap-1 mb-2",children:[(0,b.jsx)(J.Car,{className:"h-4 w-4"}),"Arac Plakasi *"]}),(0,b.jsx)(e.Input,{placeholder:"Orn: SI-123-AB",value:A,onChange:a=>K(a.target.value.toUpperCase())})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsxs)(D.Label,{className:"mb-2 block",children:["Transfer Edilecek Urunler (",N.length,")"]}),(0,b.jsx)("div",{className:"border rounded-lg max-h-[300px] overflow-y-auto",children:(0,b.jsxs)(i.Table,{children:[(0,b.jsx)(i.TableHeader,{children:(0,b.jsxs)(i.TableRow,{children:[(0,b.jsx)(i.TableHead,{children:"Urun Adi"}),(0,b.jsx)(i.TableHead,{children:"Hedef Sube"}),(0,b.jsx)(i.TableHead,{className:"text-right w-[100px]",children:"Miktar"}),(0,b.jsx)(i.TableHead,{className:"w-[60px]",children:"Birim"}),(0,b.jsx)(i.TableHead,{className:"text-right w-[120px]",children:"Maliyet (€)"}),(0,b.jsx)(i.TableHead,{className:"text-right w-[120px]",children:"Toplam (€)"}),(0,b.jsx)(i.TableHead,{className:"w-[80px]",children:"Kaynak"})]})}),(0,b.jsx)(i.TableBody,{children:s?(0,b.jsx)(i.TableRow,{children:(0,b.jsx)(i.TableCell,{colSpan:7,className:"text-center py-8 text-gray-500",children:"Yukleniyor..."})}):0===N.length?(0,b.jsx)(i.TableRow,{children:(0,b.jsx)(i.TableCell,{colSpan:7,className:"text-center py-8 text-gray-500",children:"Transfer edilecek urun yok"})}):N.map((a,c)=>(0,b.jsxs)(i.TableRow,{children:[(0,b.jsx)(i.TableCell,{className:"font-medium",children:a.productName}),(0,b.jsx)(i.TableCell,{children:Q(a.targetBranch)}),(0,b.jsx)(i.TableCell,{className:"text-right",children:(0,b.jsx)(e.Input,{type:"number",value:a.quantity,onChange:a=>{var b;let d;return b=Number(a.target.value),void((d=[...N])[c].quantity=b,d[c].totalCost=b*d[c].costPrice,O(d))},className:"w-20 h-8 text-right",min:0})}),(0,b.jsx)(i.TableCell,{children:a.unit}),(0,b.jsx)(i.TableCell,{className:"text-right",children:(0,b.jsx)(e.Input,{type:"number",value:a.costPrice,onChange:a=>{var b;let d;return b=Number(a.target.value),void((d=[...N])[c].costPrice=b,d[c].totalCost=d[c].quantity*b,O(d))},className:"w-24 h-8 text-right",min:0,step:.01})}),(0,b.jsxs)(i.TableCell,{className:"text-right font-medium text-green-600",children:["€",a.totalCost.toFixed(2)]}),(0,b.jsx)(i.TableCell,{className:"text-xs text-gray-500",children:a.sourceType})]},c))})]})})]}),(0,b.jsxs)("div",{className:"flex items-center justify-end gap-2 text-lg font-semibold",children:[(0,b.jsx)(H.Euro,{className:"h-5 w-5 text-green-600"}),(0,b.jsx)("span",{children:"Toplam Maliyet:"}),(0,b.jsxs)("span",{className:"text-green-600",children:["€",P.toFixed(2)]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(D.Label,{htmlFor:"notes",children:"Notlar"}),(0,b.jsx)(C.Textarea,{id:"notes",placeholder:"Opsiyonel notlar...",value:L,onChange:a=>M(a.target.value),rows:2})]}),(0,b.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,b.jsx)(d.Button,{variant:"outline",onClick:()=>f(!1),children:"Iptal"}),(0,b.jsxs)(d.Button,{onClick:R,disabled:u||s,children:[u&&(0,b.jsx)(G.Loader2,{className:"h-4 w-4 mr-2 animate-spin"}),"Transfer + Irsaliye Olustur"]})]})]})]})})}let L=(0,y.default)("eraser",[["path",{d:"M21 21H8a2 2 0 0 1-1.42-.587l-3.994-3.999a2 2 0 0 1 0-2.828l10-10a2 2 0 0 1 2.829 0l5.999 6a2 2 0 0 1 0 2.828L12.834 21",key:"g5wo59"}],["path",{d:"m5.082 11.09 8.828 8.828",key:"1wx5vj"}]]),M=(0,y.default)("pen-tool",[["path",{d:"M15.707 21.293a1 1 0 0 1-1.414 0l-1.586-1.586a1 1 0 0 1 0-1.414l5.586-5.586a1 1 0 0 1 1.414 0l1.586 1.586a1 1 0 0 1 0 1.414z",key:"nt11vn"}],["path",{d:"m18 13-1.375-6.874a1 1 0 0 0-.746-.776L3.235 2.028a1 1 0 0 0-1.207 1.207L5.35 15.879a1 1 0 0 0 .776.746L13 18",key:"15qc1e"}],["path",{d:"m2.3 2.3 7.286 7.286",key:"1wuzzi"}],["circle",{cx:"11",cy:"11",r:"2",key:"xmgehs"}]]);var N=a.i(73570);function O({onClear:a}){let e=(0,c.useRef)(null),[f,g]=(0,c.useState)(!1),[h,i]=(0,c.useState)(!1),j=(0,c.useCallback)(a=>{let b=e.current;if(!b)return null;let c=b.getBoundingClientRect();return"touches"in a?{x:a.touches[0].clientX-c.left,y:a.touches[0].clientY-c.top}:{x:a.clientX-c.left,y:a.clientY-c.top}},[]),k=(0,c.useCallback)(a=>{let b=j(a);if(!b)return;let c=e.current,d=c?.getContext("2d");d&&(d.beginPath(),d.moveTo(b.x,b.y),g(!0),i(!0))},[j]),l=(0,c.useCallback)(a=>{if(!f)return;let b=j(a);if(!b)return;let c=e.current,d=c?.getContext("2d");d&&(d.lineTo(b.x,b.y),d.strokeStyle="#000",d.lineWidth=2,d.lineCap="round",d.lineJoin="round",d.stroke())},[f,j]),m=(0,c.useCallback)(()=>{g(!1)},[]),n=(0,c.useCallback)(()=>{let b=e.current,c=b?.getContext("2d");c&&b&&(c.clearRect(0,0,b.width,b.height),i(!1),a?.())},[a]),o=(0,c.useCallback)(()=>{let a=e.current;return a&&h?a.toDataURL("image/png"):null},[h]);return(0,c.useEffect)(()=>{window.__signaturePad={clear:n,getBase64:o,hasSignature:()=>h}},[n,o,h]),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)("div",{className:"border-2 border-dashed rounded-lg bg-white relative",children:[(0,b.jsx)("canvas",{ref:e,width:400,height:150,className:"w-full h-[150px] cursor-crosshair touch-none",onMouseDown:k,onMouseMove:l,onMouseUp:m,onMouseLeave:m,onTouchStart:k,onTouchMove:l,onTouchEnd:m}),!h&&(0,b.jsxs)("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none text-gray-400",children:[(0,b.jsx)(M,{className:"h-6 w-6 mr-2"}),(0,b.jsx)("span",{children:"Imza icin buraya cizin"})]})]}),(0,b.jsxs)(d.Button,{type:"button",variant:"outline",size:"sm",onClick:n,className:"w-full",children:[(0,b.jsx)(L,{className:"h-4 w-4 mr-2"}),"Imzayi Temizle"]})]})}function P({open:a,onOpenChange:f,waybill:g,onSuccess:h}){let[j,l]=(0,c.useState)(!1),[m,n]=(0,c.useState)(""),[o,p]=(0,c.useState)({});if((0,c.useEffect)(()=>{if(a&&g?.items){let a={};g.items.forEach((b,c)=>{a[`${b.productId||c}`]=b.quantity||0}),p(a),n("")}},[a,g]),!g)return null;let q=(a,b)=>(o[a]||0)-b,t=()=>g.items?.some((a,b)=>0!==q(`${a.productId||b}`,a.quantity||0))||!1,u=async()=>{let a=window.__signaturePad;if(!a?.hasSignature())return void alert("Lutfen teslim almadan once imza atiniz");if(!t()||confirm("Teslim alinan miktarlarda fark var. Yine de devam etmek istiyor musunuz?")){l(!0);try{let b=a.getBase64(),c=new Date().toISOString(),d=g.items?.map((a,b)=>{let c=`${a.productId||b}`;return{productId:a.productId,productName:a.productName,expectedQuantity:a.quantity||0,receivedQuantity:o[c]||0,difference:q(c,a.quantity||0),unit:a.unit}})||[];await (0,k.updateData)(`internal_waybills/${g.id}`,{status:"delivered",deliveredAt:c,deliveredBy:"admin",deliveredByName:"Admin",signatureData:b,deliveryNotes:m,receivedItems:d,hasDiscrepancy:t()}),g.relatedTransferId&&await (0,k.updateData)(`stock_transfers/${g.relatedTransferId}`,{status:"completed",completedAt:c}),f(!1),h?.()}catch(a){console.error("Delivery error:",a),alert("Teslim alma hatasi: "+a.message)}finally{l(!1)}}};return(0,b.jsx)(B.Dialog,{open:a,onOpenChange:f,children:(0,b.jsxs)(B.DialogContent,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[(0,b.jsx)(B.DialogHeader,{children:(0,b.jsxs)(B.DialogTitle,{className:"flex items-center gap-2",children:[(0,b.jsx)(s.Package,{className:"h-5 w-5"}),"Irsaliye Teslim Al"]})}),(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4 p-4 bg-gray-50 rounded-lg",children:[(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)(D.Label,{className:"text-xs text-gray-500",children:"Irsaliye No"}),(0,b.jsx)("p",{className:"font-mono font-medium",children:g.waybillNumber||"-"})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)(D.Label,{className:"text-xs text-gray-500",children:"Kaynak Sube"}),(0,b.jsxs)("p",{className:"flex items-center gap-1 text-sm",children:[(0,b.jsx)(I.Building2,{className:"h-4 w-4 text-gray-400"}),g.sourceLocation?.branchName||"-"]})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)(D.Label,{className:"text-xs text-gray-500",children:"Hedef Sube"}),(0,b.jsxs)("p",{className:"flex items-center gap-1 text-sm",children:[(0,b.jsx)(I.Building2,{className:"h-4 w-4 text-gray-400"}),g.targetLocation?.branchName||"-"]})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)(D.Label,{className:"text-xs text-gray-500",children:"Surucu"}),(0,b.jsxs)("p",{className:"flex items-center gap-1 text-sm",children:[(0,b.jsx)(F.User,{className:"h-4 w-4 text-gray-400"}),g.driverName||"-"]})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)(D.Label,{className:"text-xs text-gray-500",children:"Arac"}),(0,b.jsxs)("p",{className:"flex items-center gap-1 text-sm",children:[(0,b.jsx)(r.Truck,{className:"h-4 w-4 text-gray-400"}),g.vehicle||"-"]})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(D.Label,{className:"mb-2 block",children:"Teslim Alinacak Urunler"}),(0,b.jsx)("div",{className:"border rounded-lg",children:(0,b.jsxs)(i.Table,{children:[(0,b.jsx)(i.TableHeader,{children:(0,b.jsxs)(i.TableRow,{children:[(0,b.jsx)(i.TableHead,{children:"Urun Adi"}),(0,b.jsx)(i.TableHead,{className:"text-right w-[100px]",children:"Beklenen"}),(0,b.jsx)(i.TableHead,{className:"text-right w-[120px]",children:"Teslim Alinan"}),(0,b.jsx)(i.TableHead,{className:"w-[60px]",children:"Birim"}),(0,b.jsx)(i.TableHead,{className:"text-right w-[80px]",children:"Fark"})]})}),(0,b.jsx)(i.TableBody,{children:g.items&&g.items.length>0?g.items.map((a,c)=>{let d=`${a.productId||c}`,f=a.quantity||0,g=q(d,f);return(0,b.jsxs)(i.TableRow,{children:[(0,b.jsx)(i.TableCell,{className:"font-medium",children:a.productName||"-"}),(0,b.jsx)(i.TableCell,{className:"text-right",children:f}),(0,b.jsx)(i.TableCell,{className:"text-right",children:(0,b.jsx)(e.Input,{type:"number",value:o[d]||0,onChange:a=>{var b;return b=Number(a.target.value),void p(a=>({...a,[d]:b}))},className:"w-24 h-8 text-right",min:0})}),(0,b.jsx)(i.TableCell,{children:a.unit||"Adet"}),(0,b.jsx)(i.TableCell,{className:`text-right font-medium ${0===g?"text-gray-900":g>0?"text-green-600":"text-red-600"}`,children:0===g?"0":g>0?`+${g}`:g})]},d)}):(0,b.jsx)(i.TableRow,{children:(0,b.jsx)(i.TableCell,{colSpan:5,className:"text-center py-4 text-gray-500",children:"Urun bulunmuyor"})})})]})}),t()&&(0,b.jsxs)("div",{className:"mt-2 flex items-center gap-2 text-amber-600 text-sm",children:[(0,b.jsx)(N.AlertTriangle,{className:"h-4 w-4"}),(0,b.jsx)("span",{children:"Miktarlarda farklilik tespit edildi"})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsxs)(D.Label,{className:"mb-2 block flex items-center gap-2",children:[(0,b.jsx)(M,{className:"h-4 w-4"}),"Dijital Imza *"]}),(0,b.jsx)(O,{})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(D.Label,{htmlFor:"deliveryNotes",children:"Teslimat Notlari"}),(0,b.jsx)(C.Textarea,{id:"deliveryNotes",placeholder:"Opsiyonel notlar...",value:m,onChange:a=>n(a.target.value),rows:2})]}),(0,b.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,b.jsx)(d.Button,{variant:"outline",onClick:()=>f(!1),children:"Iptal"}),(0,b.jsxs)(d.Button,{onClick:u,disabled:j,className:"bg-green-600 hover:bg-green-700",children:[j?(0,b.jsx)(G.Loader2,{className:"h-4 w-4 mr-2 animate-spin"}):(0,b.jsx)(x.CheckCircle,{className:"h-4 w-4 mr-2"}),"Teslim Al"]})]})]})]})})}function Q({status:a}){return(0,b.jsx)("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${{pending:"bg-amber-100 text-amber-800",approved:"bg-blue-100 text-blue-800",confirmed:"bg-blue-100 text-blue-800",preparing:"bg-purple-100 text-purple-800",ready:"bg-cyan-100 text-cyan-800",sent:"bg-blue-100 text-blue-800",in_transit:"bg-cyan-100 text-cyan-800",delivered:"bg-green-100 text-green-800",completed:"bg-green-100 text-green-800",draft:"bg-gray-100 text-gray-800",ready_to_dispatch:"bg-amber-100 text-amber-800",cancelled:"bg-red-100 text-red-800",rejected:"bg-red-100 text-red-800"}[a]||"bg-gray-100 text-gray-600"}`,children:{pending:"Beklemede",approved:"Onaylandi",confirmed:"Onaylandi",preparing:"Hazirlaniyor",ready:"Hazir",sent:"Gonderildi",in_transit:"Yolda",delivered:"Teslim Edildi",completed:"Tamamlandi",draft:"Taslak",ready_to_dispatch:"Sevke Hazir",cancelled:"Iptal",rejected:"Reddedildi"}[a]||a})}function R({type:a}){let c={request:{icon:(0,b.jsx)(s.Package,{className:"h-3 w-3 mr-1"}),label:"Talep",className:"bg-blue-50 text-blue-700"},order:{icon:(0,b.jsx)(u.ShoppingCart,{className:"h-3 w-3 mr-1"}),label:"Siparis",className:"bg-purple-50 text-purple-700"},missing:{icon:(0,b.jsx)(v.ClipboardList,{className:"h-3 w-3 mr-1"}),label:"Eksik Liste",className:"bg-amber-50 text-amber-700"}}[a]||{icon:null,label:a,className:"bg-gray-50 text-gray-700"};return(0,b.jsxs)("span",{className:`inline-flex items-center px-2 py-0.5 rounded text-xs font-medium ${c.className}`,children:[c.icon,c.label]})}function S({icon:a,title:c,value:d,color:e="gray"}){return(0,b.jsx)("div",{className:`rounded-lg p-4 ${{blue:"bg-blue-50",green:"bg-green-50",red:"bg-red-50",amber:"bg-amber-50",purple:"bg-purple-50",gray:"bg-gray-50",cyan:"bg-cyan-50"}[e]}`,children:(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:`p-2 rounded-lg ${{blue:"bg-blue-100 text-blue-600",green:"bg-green-100 text-green-600",red:"bg-red-100 text-red-600",amber:"bg-amber-100 text-amber-600",purple:"bg-purple-100 text-purple-600",gray:"bg-gray-100 text-gray-600",cyan:"bg-cyan-100 text-cyan-600"}[e]}`,children:a}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-gray-600",children:c}),(0,b.jsx)("p",{className:`text-xl font-semibold ${{blue:"text-blue-600",green:"text-green-600",red:"text-red-600",amber:"text-amber-600",purple:"text-purple-600",gray:"text-gray-900",cyan:"text-cyan-600"}[e]}`,children:d})]})]})})}function T(){let[a,v]=(0,c.useState)("incoming"),[y,B]=(0,c.useState)([]),[C,D]=(0,c.useState)([]),[E,F]=(0,c.useState)([]),[G,H]=(0,c.useState)([]),[I,J]=(0,c.useState)([]),[L,M]=(0,c.useState)(!0),[N,O]=(0,c.useState)(""),[T,U]=(0,c.useState)("all"),[V,W]=(0,c.useState)("all"),[X,Y]=(0,c.useState)(new Set),[Z,$]=(0,c.useState)(!1),[_,aa]=(0,c.useState)(!1),[ab,ac]=(0,c.useState)(null),[ad,ae]=(0,c.useState)([]);(0,c.useEffect)(()=>{M(!0);let a=(0,k.subscribeToRTDB)("stock_requests",a=>{B((a||[]).filter(a=>["pending","approved"].includes(a.status||"")))}),b=(0,k.subscribeToRTDB)("orders",a=>{D((a||[]).filter(a=>["pending","confirmed","preparing"].includes(a.status||"")))}),c=(0,k.subscribeToRTDB)("missing_lists",a=>{F((a||[]).filter(a=>["pending","sent"].includes(a.status||"")))}),d=(0,k.subscribeToRTDB)("stock_transfers",a=>{H(a||[])}),e=(0,k.subscribeToRTDB)("internal_waybills",a=>{J(a||[]),M(!1)});return()=>{a(),b(),c(),d(),e()}},[]);let af=(0,c.useMemo)(()=>{let a=[];return y.forEach(b=>{a.push({id:b.id,type:"request",number:b.requestNumber||"-",date:b.requestDate||"",source:b.branchName||"-",sourceId:b.branchId,itemCount:b.items?.length||0,totalAmount:b.totalAmount||0,status:b.status||"pending",items:b.items||[],originalData:b})}),C.forEach(b=>{a.push({id:b.id,type:"order",number:b.orderNo||"-",date:b.orderDate||b.id,source:b.customerName||"-",sourceId:b.customerId,itemCount:b.items?.length||0,totalAmount:b.total||0,status:b.status||"pending",items:b.items||[],originalData:b})}),E.forEach(b=>{a.push({id:b.id,type:"missing",number:b.listNo||"-",date:b.createdAt||"",source:b.branchName||b.branchId||"-",sourceId:b.branchId,itemCount:b.items?.length||0,totalAmount:0,status:b.status||"pending",items:b.items||[],originalData:b})}),a.sort((a,b)=>new Date(b.date).getTime()-new Date(a.date).getTime())},[y,C,E]),ag=(0,c.useMemo)(()=>af.filter(a=>{let b=!N||a.number.toLowerCase().includes(N.toLowerCase())||a.source.toLowerCase().includes(N.toLowerCase()),c="all"===T||a.type===T,d="all"===V||a.status===V;return b&&c&&d}),[af,N,T,V]),ah=(0,c.useMemo)(()=>G.map(a=>{let b=I.find(b=>b.relatedTransferId===a.id);return{transfer:a,waybill:b}}).sort((a,b)=>new Date(b.transfer.createdAt||"").getTime()-new Date(a.transfer.createdAt||"").getTime()),[G,I]),ai=(0,c.useMemo)(()=>({totalRequests:y.length,totalOrders:C.filter(a=>["pending","confirmed"].includes(a.status||"")).length,totalPending:af.filter(a=>"pending"===a.status).length,inTransit:I.filter(a=>"in_transit"===a.status).length,delivered:I.filter(a=>"delivered"===a.status).length}),[y,C,af,I]),aj=()=>{M(!0),setTimeout(()=>M(!1),500)},ak=async a=>{if(confirm(`"${a.number}" kalemini onaylamak istediginize emin misiniz?`))try{let b="request"===a.type?"stock_requests":"order"===a.type?"orders":"missing_lists";await (0,k.updateData)(`${b}/${a.id}`,{status:"approved",approvedAt:new Date().toISOString(),approvedBy:"admin"})}catch(a){console.error("Approve error:",a),alert("Onaylama hatasi: "+a.message)}},al=async a=>{if(confirm(`"${a.waybillNumber}" irsaliyesini sevk etmek istediginize emin misiniz?`))try{await (0,k.updateData)(`internal_waybills/${a.id}`,{status:"in_transit",dispatchedAt:new Date().toISOString(),dispatchedBy:"admin"})}catch(a){console.error("Dispatch error:",a),alert("Sevk hatasi: "+a.message)}};return(0,b.jsxs)("div",{className:"h-full flex flex-col bg-gray-50",children:[(0,b.jsx)("div",{className:"bg-white border-b px-4 lg:px-8 py-4 lg:py-6",children:(0,b.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-xl lg:text-2xl font-semibold text-gray-900",children:"Lojistik Merkezi"}),(0,b.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:"Gelen talepler, transferler ve sevkiyat yonetimi"})]}),(0,b.jsx)("div",{className:"flex items-center gap-2",children:(0,b.jsxs)(d.Button,{variant:"outline",size:"sm",onClick:aj,disabled:L,children:[(0,b.jsx)(l.RefreshCw,{className:`h-4 w-4 mr-2 ${L?"animate-spin":""}`}),(0,b.jsx)("span",{className:"hidden sm:inline",children:"Yenile"})]})})]})}),(0,b.jsx)("div",{className:"flex-1 overflow-auto p-4 lg:p-8",children:(0,b.jsxs)(h.Tabs,{value:a,onValueChange:v,className:"w-full",children:[(0,b.jsxs)(h.TabsList,{className:"grid w-full grid-cols-3 mb-6",children:[(0,b.jsxs)(h.TabsTrigger,{value:"incoming",className:"text-xs sm:text-sm",children:[(0,b.jsx)(s.Package,{className:"h-4 w-4 mr-1 sm:mr-2"}),(0,b.jsx)("span",{className:"hidden sm:inline",children:"Gelen"})," Talepler"]}),(0,b.jsxs)(h.TabsTrigger,{value:"transfer",className:"text-xs sm:text-sm",children:[(0,b.jsx)(r.Truck,{className:"h-4 w-4 mr-1 sm:mr-2"}),(0,b.jsx)("span",{className:"hidden sm:inline",children:"Transfer"})," Olustur"]}),(0,b.jsxs)(h.TabsTrigger,{value:"history",className:"text-xs sm:text-sm",children:[(0,b.jsx)(w.FileText,{className:"h-4 w-4 mr-1 sm:mr-2"}),"Sevkiyat ",(0,b.jsx)("span",{className:"hidden sm:inline",children:"Gecmisi"})]})]}),(0,b.jsxs)(h.TabsContent,{value:"incoming",className:"space-y-4",children:[(0,b.jsxs)("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,b.jsx)(S,{icon:(0,b.jsx)(s.Package,{className:"h-5 w-5"}),title:"Sube Talepleri",value:ai.totalRequests,color:"blue"}),(0,b.jsx)(S,{icon:(0,b.jsx)(u.ShoppingCart,{className:"h-5 w-5"}),title:"Musteri Siparisleri",value:ai.totalOrders,color:"purple"}),(0,b.jsx)(S,{icon:(0,b.jsx)(t.Clock,{className:"h-5 w-5"}),title:"Bekleyen",value:ai.totalPending,color:"amber"}),(0,b.jsx)(S,{icon:(0,b.jsx)(r.Truck,{className:"h-5 w-5"}),title:"Yolda",value:ai.inTransit,color:"cyan"})]}),(0,b.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex flex-col sm:flex-row gap-3 w-full sm:w-auto",children:[(0,b.jsxs)("div",{className:"relative flex-1 sm:w-64",children:[(0,b.jsx)(n.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"}),(0,b.jsx)(e.Input,{placeholder:"No veya kaynak ara...",value:N,onChange:a=>O(a.target.value),className:"pl-10"})]}),(0,b.jsxs)(g.Select,{value:T,onValueChange:U,children:[(0,b.jsx)(g.SelectTrigger,{className:"w-full sm:w-[150px]",children:(0,b.jsx)(g.SelectValue,{placeholder:"Tip"})}),(0,b.jsxs)(g.SelectContent,{children:[(0,b.jsx)(g.SelectItem,{value:"all",children:"Tum tipler"}),(0,b.jsx)(g.SelectItem,{value:"request",children:"Sube Talepleri"}),(0,b.jsx)(g.SelectItem,{value:"order",children:"Musteri Siparisleri"}),(0,b.jsx)(g.SelectItem,{value:"missing",children:"Eksik Listeleri"})]})]}),(0,b.jsxs)(g.Select,{value:V,onValueChange:W,children:[(0,b.jsx)(g.SelectTrigger,{className:"w-full sm:w-[150px]",children:(0,b.jsx)(g.SelectValue,{placeholder:"Durum"})}),(0,b.jsxs)(g.SelectContent,{children:[(0,b.jsx)(g.SelectItem,{value:"all",children:"Tum durumlar"}),(0,b.jsx)(g.SelectItem,{value:"pending",children:"Beklemede"}),(0,b.jsx)(g.SelectItem,{value:"approved",children:"Onaylandi"}),(0,b.jsx)(g.SelectItem,{value:"preparing",children:"Hazirlaniyor"})]})]})]}),(0,b.jsxs)(d.Button,{onClick:()=>{0===X.size?alert("Transfer olusturmak icin en az bir kalem seciniz"):(ae(ag.filter(a=>X.has(a.id))),$(!0))},disabled:0===X.size,children:[(0,b.jsx)(r.Truck,{className:"h-4 w-4 mr-2"}),"Transfer Olustur (",X.size,")"]})]}),(0,b.jsx)("div",{className:"bg-white rounded-lg border",children:(0,b.jsxs)(i.Table,{children:[(0,b.jsx)(i.TableHeader,{children:(0,b.jsxs)(i.TableRow,{children:[(0,b.jsx)(i.TableHead,{className:"w-[50px]",children:(0,b.jsx)(f.Checkbox,{checked:ag.length>0&&X.size===ag.length,onCheckedChange:a=>{a?Y(new Set(ag.map(a=>a.id))):Y(new Set)}})}),(0,b.jsx)(i.TableHead,{children:"Tip"}),(0,b.jsx)(i.TableHead,{children:"No"}),(0,b.jsx)(i.TableHead,{children:"Tarih"}),(0,b.jsx)(i.TableHead,{children:"Kaynak"}),(0,b.jsx)(i.TableHead,{className:"text-right",children:"Urun"}),(0,b.jsx)(i.TableHead,{className:"text-right hidden sm:table-cell",children:"Toplam"}),(0,b.jsx)(i.TableHead,{children:"Durum"}),(0,b.jsx)(i.TableHead,{className:"w-[100px]"})]})}),(0,b.jsx)(i.TableBody,{children:L?(0,b.jsx)(i.TableRow,{children:(0,b.jsx)(i.TableCell,{colSpan:9,className:"text-center py-8 text-gray-500",children:"Yukleniyor..."})}):0===ag.length?(0,b.jsx)(i.TableRow,{children:(0,b.jsx)(i.TableCell,{colSpan:9,className:"text-center py-8 text-gray-500",children:"Gelen talep bulunamadi"})}):ag.slice(0,50).map(a=>(0,b.jsxs)(i.TableRow,{children:[(0,b.jsx)(i.TableCell,{children:(0,b.jsx)(f.Checkbox,{checked:X.has(a.id),onCheckedChange:b=>{var c,d;let e;return c=a.id,d=!!b,e=new Set(X),void(d?e.add(c):e.delete(c),Y(e))}})}),(0,b.jsx)(i.TableCell,{children:(0,b.jsx)(R,{type:a.type})}),(0,b.jsx)(i.TableCell,{className:"font-mono font-medium",children:a.number}),(0,b.jsx)(i.TableCell,{children:a.date?.split("T")[0]||"-"}),(0,b.jsx)(i.TableCell,{className:"font-medium",children:a.source}),(0,b.jsx)(i.TableCell,{className:"text-right",children:a.itemCount}),(0,b.jsx)(i.TableCell,{className:"text-right font-medium hidden sm:table-cell",children:a.totalAmount>0?`€${a.totalAmount.toFixed(2)}`:"-"}),(0,b.jsx)(i.TableCell,{children:(0,b.jsx)(Q,{status:a.status})}),(0,b.jsx)(i.TableCell,{children:(0,b.jsxs)(j.DropdownMenu,{children:[(0,b.jsx)(j.DropdownMenuTrigger,{asChild:!0,children:(0,b.jsx)(d.Button,{variant:"ghost",size:"icon",className:"h-8 w-8",children:(0,b.jsx)(m.MoreHorizontal,{className:"h-4 w-4"})})}),(0,b.jsxs)(j.DropdownMenuContent,{align:"end",children:[(0,b.jsxs)(j.DropdownMenuItem,{children:[(0,b.jsx)(p.Eye,{className:"h-4 w-4 mr-2"}),"Goruntule"]}),"pending"===a.status&&(0,b.jsxs)(j.DropdownMenuItem,{onClick:()=>ak(a),children:[(0,b.jsx)(x.CheckCircle,{className:"h-4 w-4 mr-2"}),"Onayla"]})]})]})})]},a.id))})]})})]}),(0,b.jsx)(h.TabsContent,{value:"transfer",className:"space-y-4",children:(0,b.jsxs)("div",{className:"bg-white rounded-lg border p-8 text-center",children:[(0,b.jsx)(r.Truck,{className:"h-16 w-16 mx-auto text-gray-300 mb-4"}),(0,b.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Transfer Olustur"}),(0,b.jsx)("p",{className:"text-gray-500 mb-4",children:"Transfer olusturmak icin Gelen Talepler sekmesinden kalemleri secin ve Transfer Olustur butonuna tiklayin."}),(0,b.jsxs)(d.Button,{onClick:()=>v("incoming"),children:[(0,b.jsx)(z,{className:"h-4 w-4 mr-2"}),"Gelen Taleplere Git"]})]})}),(0,b.jsxs)(h.TabsContent,{value:"history",className:"space-y-4",children:[(0,b.jsxs)("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,b.jsx)(S,{icon:(0,b.jsx)(w.FileText,{className:"h-5 w-5"}),title:"Toplam Transfer",value:G.length,color:"blue"}),(0,b.jsx)(S,{icon:(0,b.jsx)(t.Clock,{className:"h-5 w-5"}),title:"Taslak",value:I.filter(a=>"draft"===a.status).length,color:"gray"}),(0,b.jsx)(S,{icon:(0,b.jsx)(r.Truck,{className:"h-5 w-5"}),title:"Yolda",value:ai.inTransit,color:"cyan"}),(0,b.jsx)(S,{icon:(0,b.jsx)(x.CheckCircle,{className:"h-5 w-5"}),title:"Teslim Edildi",value:ai.delivered,color:"green"})]}),(0,b.jsx)("div",{className:"bg-white rounded-lg border",children:(0,b.jsxs)(i.Table,{children:[(0,b.jsx)(i.TableHeader,{children:(0,b.jsxs)(i.TableRow,{children:[(0,b.jsx)(i.TableHead,{children:"Transfer No"}),(0,b.jsx)(i.TableHead,{children:"Tarih"}),(0,b.jsx)(i.TableHead,{children:"Kaynak"}),(0,b.jsx)(i.TableHead,{children:"Hedef"}),(0,b.jsx)(i.TableHead,{className:"text-right",children:"Urun"}),(0,b.jsx)(i.TableHead,{children:"Durum"}),(0,b.jsx)(i.TableHead,{className:"hidden lg:table-cell",children:"Olusturan"}),(0,b.jsx)(i.TableHead,{className:"w-[120px]"})]})}),(0,b.jsx)(i.TableBody,{children:L?(0,b.jsx)(i.TableRow,{children:(0,b.jsx)(i.TableCell,{colSpan:8,className:"text-center py-8 text-gray-500",children:"Yukleniyor..."})}):0===ah.length?(0,b.jsx)(i.TableRow,{children:(0,b.jsx)(i.TableCell,{colSpan:8,className:"text-center py-8 text-gray-500",children:"Sevkiyat kaydi bulunamadi"})}):ah.slice(0,50).map(({transfer:a,waybill:c})=>(0,b.jsxs)(i.TableRow,{children:[(0,b.jsx)(i.TableCell,{className:"font-mono font-medium",children:a.transferNumber||"-"}),(0,b.jsx)(i.TableCell,{children:a.createdAt?.split("T")[0]||"-"}),(0,b.jsx)(i.TableCell,{children:a.fromBranchName||a.fromBranch||"Merkez"}),(0,b.jsx)(i.TableCell,{children:a.toBranchName||a.toBranch||"-"}),(0,b.jsx)(i.TableCell,{className:"text-right",children:a.items?.length||0}),(0,b.jsx)(i.TableCell,{children:(0,b.jsx)(Q,{status:c?.status||a.status||"pending"})}),(0,b.jsx)(i.TableCell,{className:"hidden lg:table-cell",children:a.createdByName||"-"}),(0,b.jsx)(i.TableCell,{children:(0,b.jsxs)(j.DropdownMenu,{children:[(0,b.jsx)(j.DropdownMenuTrigger,{asChild:!0,children:(0,b.jsx)(d.Button,{variant:"ghost",size:"icon",className:"h-8 w-8",children:(0,b.jsx)(m.MoreHorizontal,{className:"h-4 w-4"})})}),(0,b.jsxs)(j.DropdownMenuContent,{align:"end",children:[(0,b.jsxs)(j.DropdownMenuItem,{children:[(0,b.jsx)(p.Eye,{className:"h-4 w-4 mr-2"}),"Detay"]}),c&&"ready_to_dispatch"===c.status&&(0,b.jsxs)(j.DropdownMenuItem,{onClick:()=>al(c),children:[(0,b.jsx)(q.Send,{className:"h-4 w-4 mr-2"}),"Sevk Et"]}),c&&"in_transit"===c.status&&(0,b.jsxs)(j.DropdownMenuItem,{onClick:()=>{ac(c),aa(!0)},children:[(0,b.jsx)(A,{className:"h-4 w-4 mr-2"}),"Teslim Al"]}),c?.pdfUrl&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(j.DropdownMenuSeparator,{}),(0,b.jsxs)(j.DropdownMenuItem,{children:[(0,b.jsx)(o.Download,{className:"h-4 w-4 mr-2"}),"PDF Indir"]})]})]})]})})]},a.id))})]})})]})]})}),(0,b.jsx)(K,{open:Z,onOpenChange:$,selectedItems:ad,onSuccess:()=>{Y(new Set),aj()}}),(0,b.jsx)(P,{open:_,onOpenChange:aa,waybill:ab,onSuccess:aj})]})}a.s(["default",()=>T],54650)}];

//# sourceMappingURL=src_app_dashboard_logistics_page_tsx_18e4cbf6._.js.map