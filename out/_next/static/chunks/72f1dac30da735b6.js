(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,43413,e=>{"use strict";var a=e.i(43476),t=e.i(71645),s=e.i(7233),l=e.i(55436),i=e.i(1928),r=e.i(7486),n=e.i(88511),c=e.i(27612),d=e.i(86536),o=e.i(40160),u=e.i(31278),m=e.i(78583),x=e.i(16715),h=e.i(23945),p=e.i(3281),j=e.i(75254);let g=(0,j.default)("file-code",[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 12.5 8 15l2 2.5",key:"1tg20x"}],["path",{d:"m14 12.5 2 2.5-2 2.5",key:"yinavb"}]]);var f=e.i(94918);let N=(0,j.default)("upload",[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]]);var v=e.i(15288),b=e.i(19455),y=e.i(93479),C=e.i(67489),S=e.i(84774),T=e.i(55146),w=e.i(75157),D=e.i(69457),I=e.i(10204),k=e.i(24687),F=e.i(76639),A=e.i(46696);let P=[{value:22,label:"22% - Standart"},{value:9.5,label:"9.5% - Indirimli"},{value:5,label:"5% - Kitap"},{value:0,label:"0% - Muaf"}],_=[{value:"draft",label:"Taslak"},{value:"pending",label:"Beklemede"},{value:"approved",label:"Onaylandi"},{value:"cancelled",label:"Iptal"}],L=[{value:"unpaid",label:"Odenmedi"},{value:"partial",label:"Kismi Odeme"},{value:"paid",label:"Odendi"}];function R({open:e,onOpenChange:l,invoice:i,onSave:r}){let n=!!i,[d,o]=(0,t.useState)(""),[u,m]=(0,t.useState)(""),[x,p]=(0,t.useState)(""),[j,g]=(0,t.useState)(""),[f,N]=(0,t.useState)(""),[v,S]=(0,t.useState)(""),[T,w]=(0,t.useState)("pending"),[R,E]=(0,t.useState)("unpaid"),[M,B]=(0,t.useState)(""),[H,O]=(0,t.useState)([]),[V,U]=(0,t.useState)(!1),[K,z]=(0,t.useState)([]),[q,G]=(0,t.useState)([]);(0,t.useEffect)(()=>{let e=(0,D.subscribeToRTDB)("partners",e=>{if(e){let a=e.filter(e=>e.basic?.type==="supplier"||"supplier"===e.type).map(e=>({id:e.id||e._id,name:e.basic?.name||e.name||e.companyName||"",taxNumber:e.tax?.taxId||e.financial?.vatNumber||e.taxNumber||e.ddvNumber||""})).filter(e=>e.name);a.sort((e,a)=>e.name.localeCompare(a.name)),z(a)}}),a=(0,D.subscribeToBranches)(e=>{G(e||[])});return()=>{e(),a()}},[]),(0,t.useEffect)(()=>{if(e){let e=new Date().toISOString().split("T")[0],a=new Date(Date.now()+2592e6).toISOString().split("T")[0];i?(o(i.invoiceNo||i.invoice_number||""),m(i.date||i.invoice_date||e),p(i.dueDate||i.due_date||a),g(i.branchId||i.branch_id||""),N(i.supplierId||i.supplier_id||""),S(i.supplierDdvNo||""),w(i.status||"pending"),E(i.paymentStatus||"unpaid"),B(i.notes||""),O(i.items?.map((e,a)=>({id:e.id||`item-${a}`,description:e.description||e.name||"",quantity:e.quantity||1,unitPrice:e.unitPrice||e.unit_price||0,ddvRate:e.ddvRate||e.tax_rate||22,ddvAmount:e.ddvAmount||e.tax_amount||0,total:e.total||e.line_total||0}))||[])):(o(""),m(e),p(a),g(""),N(""),S(""),w("pending"),E("unpaid"),B(""),O([$()]))}},[e,i]),(0,t.useEffect)(()=>{if(f){let e=K.find(e=>e.id===f);e?.taxNumber&&S(e.taxNumber)}},[f,K]);let $=()=>({id:`item-${Date.now()}`,description:"",quantity:1,unitPrice:0,ddvRate:22,ddvAmount:0,total:0}),X=(e,a,t)=>{O(H.map(s=>{if(s.id!==e)return s;let l={...s,[a]:t},i=l.quantity*l.unitPrice;return l.ddvAmount=i*(l.ddvRate/100),l.total=i+l.ddvAmount,l}))},Z=H.reduce((e,a)=>e+a.quantity*a.unitPrice,0),Q=H.reduce((e,a)=>e+a.ddvAmount,0),Y=Z+Q,W=async()=>{if(!d.trim())return void A.toast.error("Lutfen fatura numarasi girin!");if(!j)return void A.toast.error("Lutfen sube secin!");if(0===H.length||H.every(e=>!e.description))return void A.toast.error("Lutfen en az bir kalem ekleyin!");U(!0);try{let e=K.find(e=>e.id===f),a={invoice_number:d.trim(),invoiceNo:d.trim(),type:"purchase",invoice_date:u,date:u,due_date:x||null,dueDate:x||null,branch_id:j,branchId:j,supplier_id:f||null,supplierId:f||null,supplier_name:e?.name||"",supplier:e?.name||"",supplierDdvNo:v.trim(),status:T,paymentStatus:R,items:H.filter(e=>e.description).map(e=>({name:e.description,description:e.description,quantity:e.quantity,unit_price:e.unitPrice,unitPrice:e.unitPrice,tax_rate:e.ddvRate,ddvRate:e.ddvRate,tax_base:e.quantity*e.unitPrice,tax_amount:e.ddvAmount,ddvAmount:e.ddvAmount,line_total:e.total,total:e.total})),subtotal:Z,total_tax:Q,vatAmount:Q,grand_total:Y,total:Y,total_paid:"paid"===R?Y:0,remaining_amount:"paid"===R?0:Y,notes:M.trim(),currency:"EUR",updatedAt:new Date().toISOString()};n&&i?.id?(await (0,D.updateFirestoreData)("purchases",i.id,a),A.toast.success("Fatura guncellendi")):(a.createdAt=new Date().toISOString(),a.created_at=new Date().toISOString(),await (0,D.addFirestoreData)("purchases",a),A.toast.success("Fatura olusturuldu")),l(!1),r?.()}catch(e){console.error("Save error:",e),A.toast.error("Kaydetme hatasi: "+e.message)}finally{U(!1)}};return(0,a.jsx)(F.Dialog,{open:e,onOpenChange:l,children:(0,a.jsxs)(F.DialogContent,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[(0,a.jsx)(F.DialogHeader,{children:(0,a.jsx)(F.DialogTitle,{className:"text-xl font-semibold",children:n?"Alis Faturasi Duzenle":"Yeni Alis Faturasi"})}),(0,a.jsxs)("div",{className:"grid gap-6 py-4",children:[(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h3",{className:"text-sm font-medium text-muted-foreground border-b pb-2",children:"Fatura Bilgileri"}),(0,a.jsxs)("div",{className:"grid grid-cols-5 gap-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(I.Label,{htmlFor:"branchId",children:"Sube *"}),(0,a.jsxs)(C.Select,{value:j,onValueChange:g,children:[(0,a.jsxs)(C.SelectTrigger,{children:[(0,a.jsx)(h.Store,{className:"h-4 w-4 mr-2"}),(0,a.jsx)(C.SelectValue,{placeholder:"Sube secin"})]}),(0,a.jsx)(C.SelectContent,{children:q.filter(e=>!1!==e.isActive).map(e=>(0,a.jsx)(C.SelectItem,{value:e.id,children:e.name},e.id))})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(I.Label,{htmlFor:"invoiceNo",children:"Fatura No *"}),(0,a.jsx)(y.Input,{id:"invoiceNo",value:d,onChange:e=>o(e.target.value),placeholder:"Orn: ALI-2024-001"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(I.Label,{htmlFor:"invoiceDate",children:"Fatura Tarihi *"}),(0,a.jsx)(y.Input,{id:"invoiceDate",type:"date",value:u,onChange:e=>m(e.target.value)})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(I.Label,{htmlFor:"dueDate",children:"Vade Tarihi"}),(0,a.jsx)(y.Input,{id:"dueDate",type:"date",value:x,onChange:e=>p(e.target.value)})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(I.Label,{htmlFor:"status",children:"Durum"}),(0,a.jsxs)(C.Select,{value:T,onValueChange:w,children:[(0,a.jsx)(C.SelectTrigger,{children:(0,a.jsx)(C.SelectValue,{placeholder:"Durum secin"})}),(0,a.jsx)(C.SelectContent,{children:_.map(e=>(0,a.jsx)(C.SelectItem,{value:e.value,children:e.label},e.value))})]})]})]})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h3",{className:"text-sm font-medium text-muted-foreground border-b pb-2",children:"Tedarikci Bilgileri"}),(0,a.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(I.Label,{htmlFor:"supplier",children:"Tedarikci"}),(0,a.jsxs)(C.Select,{value:f,onValueChange:N,children:[(0,a.jsx)(C.SelectTrigger,{children:(0,a.jsx)(C.SelectValue,{placeholder:"Tedarikci secin"})}),(0,a.jsx)(C.SelectContent,{children:K.map(e=>(0,a.jsx)(C.SelectItem,{value:e.id,children:e.name},e.id))})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(I.Label,{htmlFor:"supplierDdvNo",children:"Tedarikci DDV No"}),(0,a.jsx)(y.Input,{id:"supplierDdvNo",value:v,onChange:e=>S(e.target.value),placeholder:"SI12345678"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(I.Label,{htmlFor:"paymentStatus",children:"Odeme Durumu"}),(0,a.jsxs)(C.Select,{value:R,onValueChange:E,children:[(0,a.jsx)(C.SelectTrigger,{children:(0,a.jsx)(C.SelectValue,{placeholder:"Odeme durumu secin"})}),(0,a.jsx)(C.SelectContent,{children:L.map(e=>(0,a.jsx)(C.SelectItem,{value:e.value,children:e.label},e.value))})]})]})]})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between border-b pb-2",children:[(0,a.jsx)("h3",{className:"text-sm font-medium text-muted-foreground",children:"Fatura Kalemleri"}),(0,a.jsxs)(b.Button,{type:"button",variant:"outline",size:"sm",onClick:()=>{O([...H,$()])},children:[(0,a.jsx)(s.Plus,{className:"h-4 w-4 mr-1"}),"Kalem Ekle"]})]}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"grid grid-cols-12 gap-2 text-xs font-medium text-muted-foreground px-1",children:[(0,a.jsx)("div",{className:"col-span-4",children:"Aciklama"}),(0,a.jsx)("div",{className:"col-span-1",children:"Miktar"}),(0,a.jsx)("div",{className:"col-span-2",children:"Birim Fiyat"}),(0,a.jsx)("div",{className:"col-span-2",children:"DDV %"}),(0,a.jsx)("div",{className:"col-span-2 text-right",children:"Toplam"}),(0,a.jsx)("div",{className:"col-span-1"})]}),H.map(e=>(0,a.jsxs)("div",{className:"grid grid-cols-12 gap-2 items-center",children:[(0,a.jsx)("div",{className:"col-span-4",children:(0,a.jsx)(y.Input,{value:e.description,onChange:a=>X(e.id,"description",a.target.value),placeholder:"Urun/hizmet aciklamasi"})}),(0,a.jsx)("div",{className:"col-span-1",children:(0,a.jsx)(y.Input,{type:"number",value:e.quantity,onChange:a=>X(e.id,"quantity",parseFloat(a.target.value)||0),min:"0",step:"1"})}),(0,a.jsx)("div",{className:"col-span-2",children:(0,a.jsx)(y.Input,{type:"number",value:e.unitPrice,onChange:a=>X(e.id,"unitPrice",parseFloat(a.target.value)||0),min:"0",step:"0.01"})}),(0,a.jsx)("div",{className:"col-span-2",children:(0,a.jsxs)(C.Select,{value:String(e.ddvRate),onValueChange:a=>X(e.id,"ddvRate",parseFloat(a)),children:[(0,a.jsx)(C.SelectTrigger,{children:(0,a.jsx)(C.SelectValue,{})}),(0,a.jsx)(C.SelectContent,{children:P.map(e=>(0,a.jsx)(C.SelectItem,{value:String(e.value),children:e.label},e.value))})]})}),(0,a.jsxs)("div",{className:"col-span-2 text-right font-mono font-semibold",children:[e.total.toFixed(2)," EUR"]}),(0,a.jsx)("div",{className:"col-span-1 flex justify-end",children:(0,a.jsx)(b.Button,{type:"button",variant:"ghost",size:"icon",className:"h-8 w-8 text-destructive",onClick:()=>{var a;return a=e.id,void(H.length>1&&O(H.filter(e=>e.id!==a)))},disabled:1===H.length,children:(0,a.jsx)(c.Trash2,{className:"h-4 w-4"})})})]},e.id))]}),(0,a.jsxs)("div",{className:"border-t pt-4 space-y-2",children:[(0,a.jsxs)("div",{className:"flex justify-end gap-8 text-sm",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Ara Toplam:"}),(0,a.jsxs)("span",{className:"font-mono w-24 text-right",children:[Z.toFixed(2)," EUR"]})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-8 text-sm",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"DDV Toplam:"}),(0,a.jsxs)("span",{className:"font-mono w-24 text-right",children:[Q.toFixed(2)," EUR"]})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-8 text-lg font-semibold",children:[(0,a.jsx)("span",{children:"Genel Toplam:"}),(0,a.jsxs)("span",{className:"font-mono w-24 text-right text-primary",children:[Y.toFixed(2)," EUR"]})]})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(I.Label,{htmlFor:"notes",children:"Notlar"}),(0,a.jsx)(k.Textarea,{id:"notes",value:M,onChange:e=>B(e.target.value),placeholder:"Ek notlar, referanslar...",rows:2})]})]}),(0,a.jsxs)(F.DialogFooter,{children:[(0,a.jsx)(b.Button,{variant:"outline",onClick:()=>l(!1),disabled:V,children:"Iptal"}),(0,a.jsx)(b.Button,{onClick:W,disabled:V,children:V?"Kaydediliyor...":"Kaydet"})]})]})})}var E=e.i(69638),M=e.i(73884),B=e.i(78894),H=e.i(15788),O=e.i(88844),V=e.i(68148);let U={eslog:{name:"eSLOG 2.0 (Slovenya)",country:"SI"},ebinterface:{name:"ebInterface (Avusturya)",country:"AT"},xrechnung:{name:"XRechnung (Almanya)",country:"DE"},zugferd:{name:"ZUGFeRD (Almanya)",country:"DE"},"ubl-tr":{name:"UBL-TR (Turkiye)",country:"TR"},ubl:{name:"UBL 2.1",country:"EU"}};function K({open:e,onOpenChange:s,onSuccess:l}){let[i,n]=(0,t.useState)("upload"),[c,d]=(0,t.useState)(null),[o,u]=(0,t.useState)(null),[p,j]=(0,t.useState)(!1),[g,f]=(0,t.useState)(!1),[T,w]=(0,t.useState)(""),[k,P]=(0,t.useState)(""),[_,L]=(0,t.useState)(0),[R,K]=(0,t.useState)(0),[q,G]=(0,t.useState)([]),[$,X]=(0,t.useState)([]),[Z,Q]=(0,t.useState)([]);(0,t.useEffect)(()=>{let e=(0,D.subscribeToRTDB)("partners",e=>{if(e){let a=e.filter(e=>e.basic?.type==="supplier"||"supplier"===e.type).map(e=>({id:e.id||e._id,name:e.basic?.name||e.name||e.companyName||"",taxId:e.tax?.taxId||e.financial?.vatNumber||e.taxNumber||""})).filter(e=>e.name);a.sort((e,a)=>e.name.localeCompare(a.name)),G(a)}}),a=(0,D.subscribeToBranches)(e=>{X(e||[])}),t=(0,D.subscribeToRTDB)("products",e=>{e&&Q(e.map(e=>({id:e.id||e._id,name:e.name||e.productName||"",code:e.code||e.sku||"",barcode:e.barcode||"",supplierMappings:e.supplierMappings||{}})))});return()=>{e(),a(),t()}},[]),(0,t.useEffect)(()=>{e||(n("upload"),d(null),u(null),w(""),P(""),L(0),K(0))},[e]);let Y=(0,t.useCallback)(async e=>{let a=new DOMParser().parseFromString(e,"text/xml");if(a.querySelector("parsererror"))throw Error("Gecersiz XML dosyasi");let t=a.documentElement,s=t.tagName.toLowerCase(),l=t.getAttribute("xmlns")||"",i="unknown";l.includes("eslog")||l.includes("gzs.si")?i="eslog":l.includes("ebinterface")?i="ebinterface":l.includes("ubl")&&l.includes("Invoice")?i=s.includes("tr")?"ubl-tr":"ubl":l.includes("CrossIndustryInvoice")||l.includes("zugferd")?i="zugferd":(s.includes("invoice")||s.includes("rechnung"))&&(i="xrechnung");let r=e=>{for(let t of e){let e=a.querySelector(t);if(e?.textContent)return e.textContent.trim()}return""},n=e=>parseFloat(r(e).replace(",","."))||0,c=r(["InvoiceNumber","ID","cbc\\:ID","InvoiceId","Racun","RacunStevilka","Invoice > ID","Invoice ID","DocumentNumber"])||`IMP-${Date.now()}`,d=r(["InvoiceDate","IssueDate","cbc\\:IssueDate","DatumRacuna","DatumIzdaje","Invoice > IssueDate","DocumentDate"])||new Date().toISOString().split("T")[0],o=r(["DueDate","PaymentDueDate","cbc\\:DueDate","DatumValute","Payment > DueDate"]),u=r(["Currency","DocumentCurrencyCode","cbc\\:DocumentCurrencyCode","Valuta"])||"EUR",m=r(["SellerParty Name","AccountingSupplierParty PartyName Name","cac\\:AccountingSupplierParty cac\\:Party cac\\:PartyName cbc\\:Name","Supplier Name","Dobavitelj Naziv","SupplierParty Name","Biller Name","PayeeParty Name"]),x=r(["SellerParty TaxNumber","AccountingSupplierParty PartyTaxScheme CompanyID","cac\\:AccountingSupplierParty cac\\:PartyTaxScheme cbc\\:CompanyID","Supplier VATNumber","Dobavitelj IDzaDDV","SupplierParty VATNumber","Biller VATIdentificationNumber"]),h=a.querySelectorAll("InvoiceLine, cac\\:InvoiceLine, Postavka, LineItem, Item, Line"),p=[],j=0;h.forEach(e=>{var a;let t=a=>{for(let t of a){let a=e.querySelector(t);if(a?.textContent)return a.textContent.trim()}return""},s=e=>parseFloat(t(e).replace(",","."))||0,l=t(["Item Name","cbc\\:Name","Description","cbc\\:Description","Naziv","ItemName","ProductName","Opis"])||`Kalem ${j+1}`,i=t(["SellersItemIdentification ID","cac\\:SellersItemIdentification cbc\\:ID","SupplierCode","ItemCode","Sifra","SKU"]),r=s(["InvoicedQuantity","cbc\\:InvoicedQuantity","Quantity","Kolicina","Qty","Amount"])||1,n=t(["InvoicedQuantity unitCode","cbc\\:InvoicedQuantity","UnitCode","Enota","Unit"])||"KOM",c=s(["Price PriceAmount","cac\\:Price cbc\\:PriceAmount","UnitPrice","Cena","NetPrice"]),d=s(["TaxCategory Percent","cac\\:TaxCategory cbc\\:Percent","VATRate","DDVStopnja","TaxPercent"])||22,o=s(["LineExtensionAmount","cbc\\:LineExtensionAmount","Amount","Znesek","TotalAmount"])||r*c,u=d/100*o;p.push({id:`item-${j}`,supplierCode:i,description:l,quantity:r,unit:{C62:"KOM",EA:"KOM",PCE:"KOM",KGM:"KG",LTR:"LT",MTR:"M",MTK:"M2",H87:"KOM"}[(a=n).toUpperCase()]||a,unitPrice:c,taxRate:d,taxAmount:u,lineTotal:o+u,matchStatus:"unmatched"}),j++}),0===p.length&&p.push({id:"item-0",description:"Manuel giris gerekli",quantity:1,unit:"KOM",unitPrice:0,taxRate:22,taxAmount:0,lineTotal:0,matchStatus:"unmatched"});let g=n(["TaxExclusiveAmount","cbc\\:TaxExclusiveAmount","LegalMonetaryTotal TaxExclusiveAmount","Subtotal","NetAmount","ZnesekBrezDDV"])||p.reduce((e,a)=>e+a.unitPrice*a.quantity,0),f=n(["TaxAmount","cbc\\:TaxAmount","TaxTotal TaxAmount","VATAmount","DDVZnesek"])||p.reduce((e,a)=>e+a.taxAmount,0),N=n(["PayableAmount","cbc\\:PayableAmount","LegalMonetaryTotal PayableAmount","TaxInclusiveAmount","GrandTotal","Total","SkupajZDDV"])||g+f;return{format:i,invoiceNumber:c,invoiceDate:z(d),dueDate:o?z(o):void 0,currency:u,supplier:{name:m,taxId:x},items:p,subtotal:g,totalTax:f,grandTotal:N}},[]),W=async e=>{let a=e.target.files?.[0];if(a){if(!a.name.toLowerCase().endsWith(".xml"))return void A.toast.error("Lutfen bir XML dosyasi secin");d(a),j(!0);try{let e=await a.text(),t=await Y(e);if(t.supplier.taxId){let e=q.find(e=>e.taxId?.replace(/[^a-zA-Z0-9]/g,"")===t.supplier.taxId?.replace(/[^a-zA-Z0-9]/g,""));e&&P(e.id)}let s=t.items.map(e=>J(e,Z,k));t.items=s,u(t),n("review"),A.toast.success(`XML basariyla okundu: ${t.items.length} kalem`)}catch(e){console.error("XML parse error:",e),A.toast.error("XML dosyasi okunamadi: "+e.message)}finally{j(!1)}}},J=(e,a,t)=>{if(e.supplierCode&&t){let s=a.find(a=>a.supplierMappings?.[t]?.code===e.supplierCode);if(s)return{...e,matchedProductId:s.id,matchedProductName:s.name,matchStatus:"matched"}}let s=e.description.toLowerCase(),l=a.find(e=>e.name.toLowerCase().includes(s)||s.includes(e.name.toLowerCase()));return l?{...e,matchedProductId:l.id,matchedProductName:l.name,matchStatus:"suggested"}:e};(0,t.useEffect)(()=>{if(o&&k){let e=o.items.map(e=>J(e,Z,k));u({...o,items:e})}},[k]);let ee=(o?.grandTotal||0)+_+R,ea=o?.items.filter(e=>"matched"===e.matchStatus).length||0,et=o?.items.filter(e=>"suggested"===e.matchStatus).length||0,es=o?.items.filter(e=>"unmatched"===e.matchStatus).length||0,el=o?Math.round(ea/o.items.length*100):0,ei=async()=>{if(!o||!T)return void A.toast.error("Lutfen sube secin");f(!0);try{let e=q.find(e=>e.id===k),a={invoice_number:o.invoiceNumber,invoiceNo:o.invoiceNumber,type:"purchase",invoice_date:o.invoiceDate,date:o.invoiceDate,due_date:o.dueDate||null,dueDate:o.dueDate||null,branch_id:T,branchId:T,supplier_id:k||null,supplierId:k||null,supplier_name:e?.name||o.supplier.name,supplier:e?.name||o.supplier.name,currency:o.currency,items:o.items.map(e=>({product_id:e.matchedProductId||null,productId:e.matchedProductId||null,name:e.description,description:e.description,supplier_code:e.supplierCode||null,quantity:e.quantity,unit:e.unit,unit_price:e.unitPrice,unitPrice:e.unitPrice,tax_rate:e.taxRate,ddvRate:e.taxRate,tax_amount:e.taxAmount,ddvAmount:e.taxAmount,line_total:e.lineTotal,total:e.lineTotal})),subtotal:o.subtotal,total_tax:o.totalTax,vatAmount:o.totalTax,transport_cost:_,customs_cost:R,total_expense:_+R,grand_total:ee,total:ee,status:"pending",paymentStatus:"unpaid",importSource:`XML - ${U[o.format]?.name||o.format}`,matchingStats:{totalItems:o.items.length,matchedItems:ea,matchPercentage:el},notes:`XML import: ${c?.name}`,createdAt:new Date().toISOString(),created_at:new Date().toISOString()};await (0,D.addFirestoreData)("purchases",a),A.toast.success("Fatura basariyla eklendi"),s(!1),l?.()}catch(e){console.error("Save error:",e),A.toast.error("Kaydetme hatasi: "+e.message)}finally{f(!1)}};return(0,a.jsx)(F.Dialog,{open:e,onOpenChange:s,children:(0,a.jsxs)(F.DialogContent,{className:"max-w-5xl max-h-[90vh] overflow-y-auto",children:[(0,a.jsx)(F.DialogHeader,{children:(0,a.jsxs)(F.DialogTitle,{className:"text-xl font-semibold flex items-center gap-2",children:[(0,a.jsx)(m.FileText,{className:"h-5 w-5"}),"XML Fatura Iceri Aktar"]})}),"upload"===i&&(0,a.jsxs)("div",{className:"space-y-6 py-4",children:[(0,a.jsxs)(v.Card,{children:[(0,a.jsx)(v.CardHeader,{children:(0,a.jsx)(v.CardTitle,{className:"text-sm",children:"Desteklenen Formatlar"})}),(0,a.jsx)(v.CardContent,{children:(0,a.jsx)("div",{className:"grid grid-cols-3 gap-2 text-sm",children:Object.entries(U).map(([e,t])=>(0,a.jsxs)("div",{className:"flex items-center gap-2 text-muted-foreground",children:[(0,a.jsx)(E.CheckCircle,{className:"h-3 w-3 text-green-500"}),t.name]},e))})})]}),(0,a.jsxs)("div",{className:"border-2 border-dashed rounded-lg p-8 text-center",children:[(0,a.jsx)(N,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),(0,a.jsx)("p",{className:"text-lg font-medium mb-2",children:"XML Dosyasi Secin"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground mb-4",children:"e-Fatura XML dosyasini yukleyin"}),(0,a.jsx)(y.Input,{type:"file",accept:".xml",onChange:W,className:"max-w-xs mx-auto",disabled:p}),p&&(0,a.jsxs)("div",{className:"mt-4 flex items-center justify-center gap-2",children:[(0,a.jsx)(x.RefreshCw,{className:"h-4 w-4 animate-spin"}),(0,a.jsx)("span",{children:"XML okunuyor..."})]})]})]}),"review"===i&&o&&(0,a.jsxs)("div",{className:"space-y-4 py-4",children:[(0,a.jsxs)(v.Card,{children:[(0,a.jsx)(v.CardHeader,{className:"pb-2",children:(0,a.jsx)(v.CardTitle,{className:"text-sm",children:"Fatura Bilgileri"})}),(0,a.jsx)(v.CardContent,{children:(0,a.jsxs)("div",{className:"grid grid-cols-4 gap-4 text-sm",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Format:"}),(0,a.jsx)("p",{className:"font-medium",children:U[o.format]?.name||o.format})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Fatura No:"}),(0,a.jsx)("p",{className:"font-medium",children:o.invoiceNumber})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Tarih:"}),(0,a.jsx)("p",{className:"font-medium",children:o.invoiceDate})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Tedarikci:"}),(0,a.jsx)("p",{className:"font-medium",children:o.supplier.name||"-"}),o.supplier.taxId&&(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:o.supplier.taxId})]})]})})]}),(0,a.jsx)(v.Card,{children:(0,a.jsx)(v.CardContent,{className:"pt-4",children:(0,a.jsxs)("div",{className:"flex items-center gap-6",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,a.jsx)("span",{className:"text-sm",children:"Urun Eslestirme"}),(0,a.jsxs)("span",{className:"text-sm font-medium",children:[el,"%"]})]}),(0,a.jsx)(V.Progress,{value:el,className:"h-2"})]}),(0,a.jsxs)("div",{className:"flex gap-4 text-sm",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(E.CheckCircle,{className:"h-4 w-4 text-green-500"}),(0,a.jsxs)("span",{children:[ea," Eslesti"]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(B.AlertTriangle,{className:"h-4 w-4 text-yellow-500"}),(0,a.jsxs)("span",{children:[et," Oneri"]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(M.XCircle,{className:"h-4 w-4 text-red-500"}),(0,a.jsxs)("span",{children:[es," Eslesmedi"]})]})]})]})})}),(0,a.jsxs)(v.Card,{children:[(0,a.jsx)(v.CardHeader,{className:"pb-2",children:(0,a.jsxs)(v.CardTitle,{className:"text-sm",children:["Fatura Kalemleri (",o.items.length,")"]})}),(0,a.jsx)(v.CardContent,{children:(0,a.jsx)("div",{className:"max-h-[300px] overflow-y-auto",children:(0,a.jsxs)(S.Table,{children:[(0,a.jsx)(S.TableHeader,{children:(0,a.jsxs)(S.TableRow,{children:[(0,a.jsx)(S.TableHead,{className:"w-[30px]"}),(0,a.jsx)(S.TableHead,{children:"Tedarikci Kodu"}),(0,a.jsx)(S.TableHead,{children:"Aciklama"}),(0,a.jsx)(S.TableHead,{className:"text-right",children:"Miktar"}),(0,a.jsx)(S.TableHead,{children:"Birim"}),(0,a.jsx)(S.TableHead,{className:"text-right",children:"Fiyat"}),(0,a.jsx)(S.TableHead,{className:"text-right",children:"KDV %"}),(0,a.jsx)(S.TableHead,{className:"text-right",children:"Toplam"}),(0,a.jsx)(S.TableHead,{children:"Eslesen Urun"})]})}),(0,a.jsx)(S.TableBody,{children:o.items.map(e=>(0,a.jsxs)(S.TableRow,{className:"matched"===e.matchStatus?"bg-green-50":"suggested"===e.matchStatus?"bg-yellow-50":"bg-red-50",children:[(0,a.jsxs)(S.TableCell,{children:["matched"===e.matchStatus&&(0,a.jsx)(E.CheckCircle,{className:"h-4 w-4 text-green-500"}),"suggested"===e.matchStatus&&(0,a.jsx)(B.AlertTriangle,{className:"h-4 w-4 text-yellow-500"}),"unmatched"===e.matchStatus&&(0,a.jsx)(M.XCircle,{className:"h-4 w-4 text-red-500"})]}),(0,a.jsx)(S.TableCell,{className:"font-mono text-xs",children:e.supplierCode||"-"}),(0,a.jsx)(S.TableCell,{className:"max-w-[200px] truncate",children:e.description}),(0,a.jsx)(S.TableCell,{className:"text-right",children:e.quantity}),(0,a.jsx)(S.TableCell,{children:e.unit}),(0,a.jsx)(S.TableCell,{className:"text-right font-mono",children:e.unitPrice.toFixed(2)}),(0,a.jsxs)(S.TableCell,{className:"text-right",children:[e.taxRate,"%"]}),(0,a.jsx)(S.TableCell,{className:"text-right font-mono font-medium",children:e.lineTotal.toFixed(2)}),(0,a.jsx)(S.TableCell,{children:(0,a.jsxs)(C.Select,{value:e.matchedProductId||"",onValueChange:a=>((e,a)=>{if(!o)return;let t=Z.find(e=>e.id===a),s=o.items.map(s=>s.id!==e?s:{...s,matchedProductId:a,matchedProductName:t?.name||"",matchStatus:"matched"});u({...o,items:s})})(e.id,a),children:[(0,a.jsx)(C.SelectTrigger,{className:"h-8 text-xs",children:(0,a.jsx)(C.SelectValue,{placeholder:"Urun sec..."})}),(0,a.jsxs)(C.SelectContent,{children:[(0,a.jsx)(C.SelectItem,{value:"",children:"-- Secim yok --"}),Z.map(e=>(0,a.jsx)(C.SelectItem,{value:e.id,children:e.name},e.id))]})]})})]},e.id))})]})})})]}),(0,a.jsx)("div",{className:"flex justify-end",children:(0,a.jsxs)("div",{className:"w-64 space-y-1 text-sm",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Ara Toplam:"}),(0,a.jsxs)("span",{className:"font-mono",children:[o.subtotal.toFixed(2)," ",o.currency]})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"KDV:"}),(0,a.jsxs)("span",{className:"font-mono",children:[o.totalTax.toFixed(2)," ",o.currency]})]}),(0,a.jsxs)("div",{className:"flex justify-between font-medium border-t pt-1",children:[(0,a.jsx)("span",{children:"Genel Toplam:"}),(0,a.jsxs)("span",{className:"font-mono",children:[o.grandTotal.toFixed(2)," ",o.currency]})]})]})}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)(b.Button,{variant:"outline",onClick:()=>n("upload"),children:"Geri"}),(0,a.jsx)(b.Button,{onClick:()=>n("configure"),children:"Devam"})]})]}),"configure"===i&&o&&(0,a.jsxs)("div",{className:"space-y-6 py-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(I.Label,{children:"Sube *"}),(0,a.jsxs)(C.Select,{value:T,onValueChange:w,children:[(0,a.jsxs)(C.SelectTrigger,{children:[(0,a.jsx)(h.Store,{className:"h-4 w-4 mr-2"}),(0,a.jsx)(C.SelectValue,{placeholder:"Sube secin"})]}),(0,a.jsx)(C.SelectContent,{children:$.filter(e=>!1!==e.isActive).map(e=>(0,a.jsx)(C.SelectItem,{value:e.id,children:e.name},e.id))})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(I.Label,{children:"Tedarikci"}),(0,a.jsxs)(C.Select,{value:k,onValueChange:P,children:[(0,a.jsxs)(C.SelectTrigger,{children:[(0,a.jsx)(r.Building2,{className:"h-4 w-4 mr-2"}),(0,a.jsx)(C.SelectValue,{placeholder:"Tedarikci secin"})]}),(0,a.jsxs)(C.SelectContent,{children:[(0,a.jsx)(C.SelectItem,{value:"",children:"-- Secim yok --"}),q.map(e=>(0,a.jsxs)(C.SelectItem,{value:e.id,children:[e.name,e.taxId&&(0,a.jsxs)("span",{className:"text-xs text-muted-foreground ml-1",children:["(",e.taxId,")"]})]},e.id))]})]}),o.supplier.name&&!k&&(0,a.jsxs)("p",{className:"text-xs text-muted-foreground",children:["XML'den: ",o.supplier.name]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)(I.Label,{className:"flex items-center gap-2",children:[(0,a.jsx)(H.Truck,{className:"h-4 w-4"}),"Nakliye Masrafi (EUR)"]}),(0,a.jsx)(y.Input,{type:"number",value:_,onChange:e=>L(parseFloat(e.target.value)||0),min:"0",step:"0.01"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)(I.Label,{className:"flex items-center gap-2",children:[(0,a.jsx)(O.Package,{className:"h-4 w-4"}),"Gumruk Masrafi (EUR)"]}),(0,a.jsx)(y.Input,{type:"number",value:R,onChange:e=>K(parseFloat(e.target.value)||0),min:"0",step:"0.01"})]})]}),(0,a.jsxs)(v.Card,{children:[(0,a.jsx)(v.CardHeader,{children:(0,a.jsx)(v.CardTitle,{className:"text-sm",children:"Fatura Ozeti"})}),(0,a.jsxs)(v.CardContent,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Fatura No:"}),(0,a.jsx)("span",{className:"font-medium",children:o.invoiceNumber})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Tarih:"}),(0,a.jsx)("span",{children:o.invoiceDate})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Kalem Sayisi:"}),(0,a.jsx)("span",{children:o.items.length})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Eslesen:"}),(0,a.jsxs)("span",{className:"text-green-600",children:[ea," / ",o.items.length]})]})]}),(0,a.jsxs)("div",{className:"border-t pt-4 space-y-2",children:[(0,a.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Fatura Toplami:"}),(0,a.jsxs)("span",{className:"font-mono",children:[o.grandTotal.toFixed(2)," EUR"]})]}),_>0&&(0,a.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Nakliye:"}),(0,a.jsxs)("span",{className:"font-mono",children:["+",_.toFixed(2)," EUR"]})]}),R>0&&(0,a.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Gumruk:"}),(0,a.jsxs)("span",{className:"font-mono",children:["+",R.toFixed(2)," EUR"]})]}),(0,a.jsxs)("div",{className:"flex justify-between text-lg font-semibold border-t pt-2",children:[(0,a.jsx)("span",{children:"Genel Toplam:"}),(0,a.jsxs)("span",{className:"text-primary font-mono",children:[ee.toFixed(2)," EUR"]})]})]})]})]})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)(b.Button,{variant:"outline",onClick:()=>n("review"),children:"Geri"}),(0,a.jsx)(b.Button,{onClick:ei,disabled:g||!T,children:g?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(x.RefreshCw,{className:"h-4 w-4 mr-2 animate-spin"}),"Kaydediliyor..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(E.CheckCircle,{className:"h-4 w-4 mr-2"}),"Fatura Olustur"]})})]})]})]})})}function z(e){let a=[/(\d{4})-(\d{2})-(\d{2})/,/(\d{2})\.(\d{2})\.(\d{4})/,/(\d{2})\/(\d{2})\/(\d{4})/];for(let t of a){let s=e.match(t);if(s)if(t===a[0])return e.substring(0,10);else return`${s[3]}-${s[2]}-${s[1]}`}return e}var q=e.i(70016);let G={supplierCode:["tedarikci","tedarikçi","supplier","partner","kod","code","sifra","şifra"],ourCode:["bizim","sifra","şifra","kod","code","sku","stok"],productName:["urun","ürün","product","ad","name","isim","aciklama","açıklama","description"],quantity:["miktar","quantity","qty","adet","amount","kolicina","menge"],unit:["birim","unit","olcu","ölçü","einheit"],unitPrice:["fiyat","price","tutar","cena","preis","birim fiyat"],taxRate:["kdv","ddv","vat","tax","vergi","oran"]};function $({open:e,onOpenChange:s,onSuccess:l}){let[i,n]=(0,t.useState)("config"),[c,d]=(0,t.useState)(null),[o,u]=(0,t.useState)([]),[m,p]=(0,t.useState)({supplierCode:null,ourCode:null,productName:null,quantity:null,unit:null,unitPrice:null,taxRate:null}),[j,g]=(0,t.useState)([]),[T,w]=(0,t.useState)(!1),[k,P]=(0,t.useState)(!1),[_,L]=(0,t.useState)(""),[R,U]=(0,t.useState)(""),[K,z]=(0,t.useState)(""),[$,X]=(0,t.useState)(new Date().toISOString().split("T")[0]),[Z,Q]=(0,t.useState)(""),[Y,W]=(0,t.useState)(0),[J,ee]=(0,t.useState)(0),[ea,et]=(0,t.useState)(0),[es,el]=(0,t.useState)(22),[ei,er]=(0,t.useState)([]),[en,ec]=(0,t.useState)([]),[ed,eo]=(0,t.useState)([]);(0,t.useEffect)(()=>{let e=(0,D.subscribeToRTDB)("partners",e=>{if(e){let a=e.filter(e=>e.basic?.type==="supplier"||"supplier"===e.type).map(e=>({id:e.id||e._id,name:e.basic?.name||e.name||e.companyName||"",taxId:e.tax?.taxId||e.financial?.vatNumber||e.taxNumber||""})).filter(e=>e.name);a.sort((e,a)=>e.name.localeCompare(a.name)),er(a)}}),a=(0,D.subscribeToBranches)(e=>{ec(e||[])}),t=(0,D.subscribeToRTDB)("products",e=>{e&&eo(e.map(e=>({id:e.id||e._id,name:e.name||e.productName||"",code:e.code||e.sku||"",barcode:e.barcode||"",supplierMappings:e.supplierMappings||{}})))});return()=>{e(),a(),t()}},[]),(0,t.useEffect)(()=>{e||(n("config"),d(null),u([]),g([]),p({supplierCode:null,ourCode:null,productName:null,quantity:null,unit:null,unitPrice:null,taxRate:null}),L(""),U(""),z(""),X(new Date().toISOString().split("T")[0]),Q(""),W(0),ee(0),et(0))},[e]),(0,t.useEffect)(()=>{if($){let e=new Date($);e.setDate(e.getDate()+30),Q(e.toISOString().split("T")[0])}},[$]);let eu=(0,t.useCallback)(e=>{let a={supplierCode:null,ourCode:null,productName:null,quantity:null,unit:null,unitPrice:null,taxRate:null};return e.forEach((e,t)=>{let s=e.toLowerCase().trim();for(let[e,l]of Object.entries(G))l.some(e=>s.includes(e))&&null===a[e]&&(a[e]=t)}),a},[]),em=(0,t.useCallback)((e,a,t)=>{if(e.ourCode){let t=a.find(a=>a.code?.toLowerCase()===e.ourCode?.toLowerCase());if(t)return{...e,matchedProductId:t.id,matchedProductName:t.name,matchStatus:"matched"}}if(e.supplierCode&&t){let s=a.find(a=>a.supplierMappings?.[t]?.code?.toLowerCase()===e.supplierCode?.toLowerCase());if(s)return{...e,matchedProductId:s.id,matchedProductName:s.name,matchStatus:"matched"}}if(e.productName){let t=e.productName.toLowerCase(),s=a.find(e=>e.name.toLowerCase().includes(t)||t.includes(e.name.toLowerCase()));if(s)return{...e,matchedProductId:s.id,matchedProductName:s.name,matchStatus:"suggested"}}return{...e,matchStatus:"unmatched"}},[]),ex=(0,t.useCallback)(async e=>{let a=q.read(e,{type:"array"}),t=a.Sheets[a.SheetNames[0]],s=q.utils.sheet_to_json(t,{header:1});if(s.length<2)throw Error("Excel dosyasi bos veya sadece baslik satiri var");let l=s[0].map(e=>String(e||""));g(l);let i=eu(l);p(i);let r=[];for(let e=1;e<s.length;e++){let a=s[e];if(!a||a.every(e=>null==e||""===e))continue;let t=e=>null==e?null:a[e],l=t(i.supplierCode)?.toString()||"",n=t(i.ourCode)?.toString()||"",c=t(i.productName)?.toString()||`Satir ${e+1}`,d=parseFloat(t(i.quantity))||1,o=t(i.unit)?.toString()||"KG",u=parseFloat(t(i.unitPrice))||0,m=parseFloat(t(i.taxRate))||es,x=d*u,h={id:`item-${e}`,rowNumber:e+1,supplierCode:l,ourCode:n,productName:c,quantity:d,unit:o,unitPrice:u,taxRate:m,lineTotal:x,matchStatus:"unmatched"},p=em(h,ed,R);r.push(p)}return r},[eu,em,ed,R,es]),eh=async e=>{let a=e.target.files?.[0];if(a){if(![".xlsx",".xls",".csv"].includes(a.name.toLowerCase().substring(a.name.lastIndexOf("."))))return void A.toast.error("Lutfen bir Excel dosyasi secin (.xlsx, .xls, .csv)");d(a),w(!0);try{let e=await a.arrayBuffer(),t=await ex(e);u(t),n("review"),A.toast.success(`Excel basariyla okundu: ${t.length} kalem`)}catch(e){console.error("Excel parse error:",e),A.toast.error("Excel dosyasi okunamadi: "+e.message)}finally{w(!1)}}},ep=(0,t.useCallback)(()=>{u(o.map(e=>em(e,ed,R)))},[o,ed,R,em]),ej=o.reduce((e,a)=>e+a.lineTotal,0),eg=o.reduce((e,a)=>e+a.lineTotal*a.taxRate/100,0),ef=Y+J+ea,eN=ej+eg+ef,ev=o.filter(e=>"matched"===e.matchStatus).length,eb=o.filter(e=>"suggested"===e.matchStatus).length,ey=o.filter(e=>"unmatched"===e.matchStatus).length,eC=o.length>0?Math.round(ev/o.length*100):0,eS=async()=>{if(!_)return void A.toast.error("Lutfen sube secin");if(!R)return void A.toast.error("Lutfen tedarikci secin");if(!K.trim())return void A.toast.error("Lutfen fatura numarasi girin");if(0===o.length)return void A.toast.error("Fatura kalemleri bos");P(!0);try{let e=ei.find(e=>e.id===R),a={invoice_number:K.trim(),invoiceNo:K.trim(),type:"purchase",invoice_date:$,date:$,due_date:Z||null,dueDate:Z||null,branch_id:_,branchId:_,supplier_id:R,supplierId:R,supplier_name:e?.name||"",supplier:e?.name||"",currency:"EUR",items:o.map(e=>({product_id:e.matchedProductId||null,productId:e.matchedProductId||null,name:e.productName,description:e.productName,supplier_code:e.supplierCode||null,our_code:e.ourCode||null,quantity:e.quantity,unit:e.unit,unit_price:e.unitPrice,unitPrice:e.unitPrice,tax_rate:e.taxRate,ddvRate:e.taxRate,tax_amount:e.lineTotal*e.taxRate/100,ddvAmount:e.lineTotal*e.taxRate/100,line_total:e.lineTotal+e.lineTotal*e.taxRate/100,total:e.lineTotal+e.lineTotal*e.taxRate/100})),subtotal:ej,total_tax:eg,vatAmount:eg,transport_cost:Y,customs_cost:J,other_expenses:ea,total_expense:ef,grand_total:eN,total:eN,status:"pending",paymentStatus:"unpaid",importSource:"Excel",matchingStats:{totalItems:o.length,matchedItems:ev,matchPercentage:eC},notes:`Excel import: ${c?.name}`,createdAt:new Date().toISOString(),created_at:new Date().toISOString()};await (0,D.addFirestoreData)("purchases",a),A.toast.success("Fatura basariyla eklendi"),s(!1),l?.()}catch(e){console.error("Save error:",e),A.toast.error("Kaydetme hatasi: "+e.message)}finally{P(!1)}};return(0,a.jsx)(F.Dialog,{open:e,onOpenChange:s,children:(0,a.jsxs)(F.DialogContent,{className:"max-w-5xl max-h-[90vh] overflow-y-auto",children:[(0,a.jsx)(F.DialogHeader,{children:(0,a.jsxs)(F.DialogTitle,{className:"text-xl font-semibold flex items-center gap-2",children:[(0,a.jsx)(f.FileSpreadsheet,{className:"h-5 w-5"}),"Excel Fatura Iceri Aktar"]})}),"config"===i&&(0,a.jsxs)("div",{className:"space-y-6 py-4",children:[(0,a.jsxs)(v.Card,{children:[(0,a.jsx)(v.CardHeader,{children:(0,a.jsx)(v.CardTitle,{className:"text-sm",children:"Oncelikle Tedarikci ve Sube Secin"})}),(0,a.jsxs)(v.CardContent,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(I.Label,{children:"Tedarikci *"}),(0,a.jsxs)(C.Select,{value:R,onValueChange:U,children:[(0,a.jsxs)(C.SelectTrigger,{children:[(0,a.jsx)(r.Building2,{className:"h-4 w-4 mr-2"}),(0,a.jsx)(C.SelectValue,{placeholder:"Tedarikci secin"})]}),(0,a.jsx)(C.SelectContent,{children:ei.map(e=>(0,a.jsx)(C.SelectItem,{value:e.id,children:e.name},e.id))})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(I.Label,{children:"Sube *"}),(0,a.jsxs)(C.Select,{value:_,onValueChange:L,children:[(0,a.jsxs)(C.SelectTrigger,{children:[(0,a.jsx)(h.Store,{className:"h-4 w-4 mr-2"}),(0,a.jsx)(C.SelectValue,{placeholder:"Sube secin"})]}),(0,a.jsx)(C.SelectContent,{children:en.filter(e=>!1!==e.isActive).map(e=>(0,a.jsx)(C.SelectItem,{value:e.id,children:e.name},e.id))})]})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(I.Label,{children:"Fatura No *"}),(0,a.jsx)(y.Input,{value:K,onChange:e=>z(e.target.value),placeholder:"ALI-2024-001"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(I.Label,{children:"Fatura Tarihi"}),(0,a.jsx)(y.Input,{type:"date",value:$,onChange:e=>X(e.target.value)})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(I.Label,{children:"Vade Tarihi"}),(0,a.jsx)(y.Input,{type:"date",value:Z,onChange:e=>Q(e.target.value)})]})]})]})]}),(0,a.jsxs)(v.Card,{children:[(0,a.jsx)(v.CardHeader,{children:(0,a.jsx)(v.CardTitle,{className:"text-sm",children:"Beklenen Excel Formati"})}),(0,a.jsx)(v.CardContent,{children:(0,a.jsxs)("div",{className:"text-sm text-muted-foreground space-y-2",children:[(0,a.jsx)("p",{children:"Excel dosyanizda asagidaki sutunlar otomatik algilanir:"}),(0,a.jsxs)("ul",{className:"list-disc list-inside space-y-1",children:[(0,a.jsxs)("li",{children:[(0,a.jsx)("strong",{children:"Tedarikci Kodu:"})," tedarikci, supplier, partner, kod"]}),(0,a.jsxs)("li",{children:[(0,a.jsx)("strong",{children:"Bizim Sifra:"})," bizim, sifra, kod, sku"]}),(0,a.jsxs)("li",{children:[(0,a.jsx)("strong",{children:"Urun Adi:"})," urun, product, ad, name, aciklama"]}),(0,a.jsxs)("li",{children:[(0,a.jsx)("strong",{children:"Miktar:"})," miktar, quantity, qty, adet"]}),(0,a.jsxs)("li",{children:[(0,a.jsx)("strong",{children:"Birim:"})," birim, unit"]}),(0,a.jsxs)("li",{children:[(0,a.jsx)("strong",{children:"Birim Fiyat:"})," fiyat, price, tutar"]}),(0,a.jsxs)("li",{children:[(0,a.jsx)("strong",{children:"KDV %:"})," kdv, ddv, vat, tax"]})]})]})})]}),(0,a.jsx)("div",{className:"flex justify-end",children:(0,a.jsx)(b.Button,{onClick:()=>n("upload"),disabled:!R||!_||!K.trim(),children:"Devam - Dosya Sec"})})]}),"upload"===i&&(0,a.jsxs)("div",{className:"space-y-6 py-4",children:[(0,a.jsxs)("div",{className:"border-2 border-dashed rounded-lg p-8 text-center",children:[(0,a.jsx)(N,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),(0,a.jsx)("p",{className:"text-lg font-medium mb-2",children:"Excel Dosyasi Secin"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground mb-4",children:".xlsx, .xls veya .csv dosyasi yukleyin"}),(0,a.jsx)(y.Input,{type:"file",accept:".xlsx,.xls,.csv",onChange:eh,className:"max-w-xs mx-auto",disabled:T}),T&&(0,a.jsxs)("div",{className:"mt-4 flex items-center justify-center gap-2",children:[(0,a.jsx)(x.RefreshCw,{className:"h-4 w-4 animate-spin"}),(0,a.jsx)("span",{children:"Excel okunuyor..."})]})]}),(0,a.jsx)("div",{className:"flex justify-between",children:(0,a.jsx)(b.Button,{variant:"outline",onClick:()=>n("config"),children:"Geri"})})]}),"review"===i&&(0,a.jsxs)("div",{className:"space-y-4 py-4",children:[(0,a.jsx)(v.Card,{children:(0,a.jsx)(v.CardContent,{className:"pt-4",children:(0,a.jsxs)("div",{className:"flex items-center gap-6",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,a.jsx)("span",{className:"text-sm",children:"Urun Eslestirme"}),(0,a.jsxs)("span",{className:"text-sm font-medium",children:[eC,"%"]})]}),(0,a.jsx)(V.Progress,{value:eC,className:"h-2"})]}),(0,a.jsxs)("div",{className:"flex gap-4 text-sm",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(E.CheckCircle,{className:"h-4 w-4 text-green-500"}),(0,a.jsxs)("span",{children:[ev," Eslesti"]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(B.AlertTriangle,{className:"h-4 w-4 text-yellow-500"}),(0,a.jsxs)("span",{children:[eb," Oneri"]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(M.XCircle,{className:"h-4 w-4 text-red-500"}),(0,a.jsxs)("span",{children:[ey," Eslesmedi"]})]})]}),(0,a.jsxs)(b.Button,{variant:"outline",size:"sm",onClick:ep,children:[(0,a.jsx)(x.RefreshCw,{className:"h-4 w-4 mr-1"}),"Yeniden Esle"]})]})})}),(0,a.jsxs)(v.Card,{children:[(0,a.jsx)(v.CardHeader,{className:"pb-2",children:(0,a.jsxs)(v.CardTitle,{className:"text-sm",children:["Fatura Kalemleri (",o.length,")"]})}),(0,a.jsx)(v.CardContent,{children:(0,a.jsx)("div",{className:"max-h-[300px] overflow-y-auto",children:(0,a.jsxs)(S.Table,{children:[(0,a.jsx)(S.TableHeader,{children:(0,a.jsxs)(S.TableRow,{children:[(0,a.jsx)(S.TableHead,{className:"w-[30px]"}),(0,a.jsx)(S.TableHead,{className:"w-[40px]",children:"#"}),(0,a.jsx)(S.TableHead,{children:"Tedarikci Kodu"}),(0,a.jsx)(S.TableHead,{children:"Bizim Sifra"}),(0,a.jsx)(S.TableHead,{children:"Urun Adi"}),(0,a.jsx)(S.TableHead,{className:"text-right",children:"Miktar"}),(0,a.jsx)(S.TableHead,{children:"Birim"}),(0,a.jsx)(S.TableHead,{className:"text-right",children:"Fiyat"}),(0,a.jsx)(S.TableHead,{className:"text-right",children:"Toplam"}),(0,a.jsx)(S.TableHead,{children:"Eslesen Urun"})]})}),(0,a.jsx)(S.TableBody,{children:o.map(e=>(0,a.jsxs)(S.TableRow,{className:"matched"===e.matchStatus?"bg-green-50":"suggested"===e.matchStatus?"bg-yellow-50":"bg-red-50",children:[(0,a.jsxs)(S.TableCell,{children:["matched"===e.matchStatus&&(0,a.jsx)(E.CheckCircle,{className:"h-4 w-4 text-green-500"}),"suggested"===e.matchStatus&&(0,a.jsx)(B.AlertTriangle,{className:"h-4 w-4 text-yellow-500"}),"unmatched"===e.matchStatus&&(0,a.jsx)(M.XCircle,{className:"h-4 w-4 text-red-500"})]}),(0,a.jsx)(S.TableCell,{className:"text-xs text-muted-foreground",children:e.rowNumber}),(0,a.jsx)(S.TableCell,{className:"font-mono text-xs",children:e.supplierCode||"-"}),(0,a.jsx)(S.TableCell,{className:"font-mono text-xs",children:e.ourCode||"-"}),(0,a.jsx)(S.TableCell,{className:"max-w-[150px] truncate",children:e.productName}),(0,a.jsx)(S.TableCell,{className:"text-right",children:e.quantity}),(0,a.jsx)(S.TableCell,{children:e.unit}),(0,a.jsx)(S.TableCell,{className:"text-right font-mono",children:e.unitPrice.toFixed(2)}),(0,a.jsx)(S.TableCell,{className:"text-right font-mono font-medium",children:e.lineTotal.toFixed(2)}),(0,a.jsx)(S.TableCell,{children:(0,a.jsxs)(C.Select,{value:e.matchedProductId||"",onValueChange:a=>{var t;let s;return t=e.id,s=ed.find(e=>e.id===a),void u(o.map(e=>e.id!==t?e:{...e,matchedProductId:a||void 0,matchedProductName:s?.name||"",matchStatus:a?"matched":"unmatched"}))},children:[(0,a.jsx)(C.SelectTrigger,{className:"h-8 text-xs",children:(0,a.jsx)(C.SelectValue,{placeholder:"Urun sec..."})}),(0,a.jsxs)(C.SelectContent,{children:[(0,a.jsx)(C.SelectItem,{value:"",children:"-- Secim yok --"}),ed.map(e=>(0,a.jsx)(C.SelectItem,{value:e.id,children:e.name},e.id))]})]})})]},e.id))})]})})})]}),(0,a.jsxs)(v.Card,{children:[(0,a.jsx)(v.CardHeader,{className:"pb-2",children:(0,a.jsx)(v.CardTitle,{className:"text-sm",children:"Ek Masraflar"})}),(0,a.jsx)(v.CardContent,{children:(0,a.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)(I.Label,{className:"flex items-center gap-2",children:[(0,a.jsx)(H.Truck,{className:"h-4 w-4"}),"Nakliye (EUR)"]}),(0,a.jsx)(y.Input,{type:"number",value:Y,onChange:e=>W(parseFloat(e.target.value)||0),min:"0",step:"0.01"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)(I.Label,{className:"flex items-center gap-2",children:[(0,a.jsx)(O.Package,{className:"h-4 w-4"}),"Gumruk (EUR)"]}),(0,a.jsx)(y.Input,{type:"number",value:J,onChange:e=>ee(parseFloat(e.target.value)||0),min:"0",step:"0.01"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(I.Label,{children:"Diger Masraflar (EUR)"}),(0,a.jsx)(y.Input,{type:"number",value:ea,onChange:e=>et(parseFloat(e.target.value)||0),min:"0",step:"0.01"})]})]})})]}),(0,a.jsx)("div",{className:"flex justify-end",children:(0,a.jsxs)("div",{className:"w-72 space-y-1 text-sm",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Ara Toplam (KDV Haric):"}),(0,a.jsxs)("span",{className:"font-mono",children:[ej.toFixed(2)," EUR"]})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"KDV Toplam:"}),(0,a.jsxs)("span",{className:"font-mono",children:[eg.toFixed(2)," EUR"]})]}),ef>0&&(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Ek Masraflar:"}),(0,a.jsxs)("span",{className:"font-mono",children:["+",ef.toFixed(2)," EUR"]})]}),(0,a.jsxs)("div",{className:"flex justify-between font-medium border-t pt-1 text-lg",children:[(0,a.jsx)("span",{children:"Genel Toplam:"}),(0,a.jsxs)("span",{className:"font-mono text-primary",children:[eN.toFixed(2)," EUR"]})]})]})}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)(b.Button,{variant:"outline",onClick:()=>n("upload"),children:"Geri"}),(0,a.jsx)(b.Button,{onClick:eS,disabled:k,children:k?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(x.RefreshCw,{className:"h-4 w-4 mr-2 animate-spin"}),"Kaydediliyor..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(E.CheckCircle,{className:"h-4 w-4 mr-2"}),"Fatura Olustur"]})})]})]})]})})}let X={draft:{label:"Taslak",color:"bg-gray-100 text-gray-700"},pending:{label:"Beklemede",color:"bg-yellow-100 text-yellow-700"},approved:{label:"Onaylandı",color:"bg-emerald-100 text-emerald-700"},cancelled:{label:"İptal",color:"bg-red-100 text-red-700"}},Z={unpaid:{label:"Ödenmedi",color:"bg-red-100 text-red-700"},partial:{label:"Kısmi Ödeme",color:"bg-yellow-100 text-yellow-700"},paid:{label:"Ödendi",color:"bg-emerald-100 text-emerald-700"}};function Q(){let[e,j]=(0,t.useState)([]),[I,k]=(0,t.useState)([]),[F,P]=(0,t.useState)(!0),[_,L]=(0,t.useState)(""),[E,M]=(0,t.useState)("all"),[B,H]=(0,t.useState)("all"),[O,V]=(0,t.useState)(!1),[U,z]=(0,t.useState)(null),[q,G]=(0,t.useState)(!1),[Q,Y]=(0,t.useState)(!1);(0,t.useEffect)(()=>{let e=(0,D.subscribeToFirestore)("purchases",e=>{e?j([...e].sort((e,a)=>{let t=new Date(e.date||e.invoice_date||e.createdAt||e.created_at||"").getTime();return new Date(a.date||a.invoice_date||a.createdAt||a.created_at||"").getTime()-t})):j([]),P(!1)}),a=(0,D.subscribeToBranches)(e=>{k(e||[])});return()=>{e(),a()}},[]);let W=(0,t.useMemo)(()=>e.filter(e=>{let a=e.invoiceNo||e.invoice_number||"",t=e.supplier||e.supplier_name||"",s=e.branchId||e.branch_id||"",l=a.toLowerCase().includes(_.toLowerCase())||t.toLowerCase().includes(_.toLowerCase()),i="all"===E||e.status===E,r="all"===B||s===B;return l&&i&&r}),[e,_,E,B]),J=(0,t.useMemo)(()=>{let a=e.length,t=e.reduce((e,a)=>e+(a.total||a.grand_total||0),0),s=e.filter(e=>"unpaid"===e.paymentStatus||"pending"===e.status).length,l=e.filter(e=>"unpaid"===e.paymentStatus||"pending"===e.status).reduce((e,a)=>e+(a.total||a.grand_total||0),0);return{total:a,totalAmount:t,unpaid:s,unpaidAmount:l,paidCount:e.filter(e=>"paid"===e.paymentStatus||"paid"===e.status).length,paidAmount:e.filter(e=>"paid"===e.paymentStatus||"paid"===e.status).reduce((e,a)=>e+(a.total||a.grand_total||0),0)}},[e]),ee=e=>{z(e),V(!0)},ea=async e=>{let a=e.invoiceNo||e.invoice_number||e.id;if(confirm(`"${a}" faturasini silmek istediginize emin misiniz?`))try{await (0,D.deleteFirestoreData)("purchases",e.id),A.toast.success("Fatura silindi")}catch(e){A.toast.error("Silme hatasi: "+e.message)}};return F?(0,a.jsxs)("div",{className:"flex items-center justify-center h-96",children:[(0,a.jsx)(u.Loader2,{className:"h-8 w-8 animate-spin text-primary"}),(0,a.jsx)("span",{className:"ml-2 text-muted-foreground",children:"Yükleniyor..."})]}):(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold tracking-tight",children:"Alış Faturaları"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"Tedarikçilerden alınan faturalar"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)(b.Button,{variant:"outline",size:"sm",onClick:()=>{P(!0),setTimeout(()=>P(!1),500)},children:[(0,a.jsx)(x.RefreshCw,{className:`h-4 w-4 mr-2 ${F?"animate-spin":""}`}),"Yenile"]}),(0,a.jsxs)(T.DropdownMenu,{children:[(0,a.jsx)(T.DropdownMenuTrigger,{asChild:!0,children:(0,a.jsxs)(b.Button,{variant:"outline",size:"sm",children:[(0,a.jsx)(N,{className:"h-4 w-4 mr-2"}),"İçe Aktar"]})}),(0,a.jsxs)(T.DropdownMenuContent,{align:"end",children:[(0,a.jsxs)(T.DropdownMenuItem,{onClick:()=>G(!0),children:[(0,a.jsx)(g,{className:"h-4 w-4 mr-2"}),"XML Fatura (e-Fatura)"]}),(0,a.jsxs)(T.DropdownMenuItem,{onClick:()=>Y(!0),children:[(0,a.jsx)(f.FileSpreadsheet,{className:"h-4 w-4 mr-2"}),"Excel Dosyası"]})]})]}),(0,a.jsxs)(b.Button,{variant:"outline",size:"sm",children:[(0,a.jsx)(o.Download,{className:"h-4 w-4 mr-2"}),"Dışa Aktar"]}),(0,a.jsxs)(b.Button,{size:"sm",onClick:()=>{z(null),V(!0)},children:[(0,a.jsx)(s.Plus,{className:"h-4 w-4 mr-2"}),"Yeni Fatura"]})]})]}),(0,a.jsxs)("div",{className:"grid gap-4 md:grid-cols-4",children:[(0,a.jsxs)(v.Card,{children:[(0,a.jsxs)(v.CardHeader,{className:"flex flex-row items-center justify-between pb-2",children:[(0,a.jsx)(v.CardTitle,{className:"text-sm font-medium text-muted-foreground",children:"Toplam Fatura"}),(0,a.jsx)(m.FileText,{className:"h-4 w-4 text-muted-foreground"})]}),(0,a.jsx)(v.CardContent,{children:(0,a.jsx)("div",{className:"text-2xl font-bold",children:J.total})})]}),(0,a.jsxs)(v.Card,{children:[(0,a.jsxs)(v.CardHeader,{className:"flex flex-row items-center justify-between pb-2",children:[(0,a.jsx)(v.CardTitle,{className:"text-sm font-medium text-muted-foreground",children:"Toplam Tutar"}),(0,a.jsx)(r.Building2,{className:"h-4 w-4 text-muted-foreground"})]}),(0,a.jsx)(v.CardContent,{children:(0,a.jsx)("div",{className:"text-2xl font-bold text-primary",children:(0,w.formatCurrency)(J.totalAmount)})})]}),(0,a.jsxs)(v.Card,{children:[(0,a.jsxs)(v.CardHeader,{className:"flex flex-row items-center justify-between pb-2",children:[(0,a.jsx)(v.CardTitle,{className:"text-sm font-medium text-muted-foreground",children:"Ödenmemiş"}),(0,a.jsx)("div",{className:"h-2 w-2 rounded-full bg-red-500"})]}),(0,a.jsx)(v.CardContent,{children:(0,a.jsx)("div",{className:"text-2xl font-bold text-red-600",children:J.unpaid})})]}),(0,a.jsxs)(v.Card,{children:[(0,a.jsxs)(v.CardHeader,{className:"flex flex-row items-center justify-between pb-2",children:[(0,a.jsx)(v.CardTitle,{className:"text-sm font-medium text-muted-foreground",children:"Ödenmemiş Tutar"}),(0,a.jsx)(i.ShoppingCart,{className:"h-4 w-4 text-muted-foreground"})]}),(0,a.jsx)(v.CardContent,{children:(0,a.jsx)("div",{className:"text-2xl font-bold text-red-600",children:(0,w.formatCurrency)(J.unpaidAmount)})})]})]}),(0,a.jsx)(v.Card,{children:(0,a.jsx)(v.CardContent,{className:"pt-6",children:(0,a.jsx)("div",{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:(0,a.jsxs)("div",{className:"flex flex-1 gap-4",children:[(0,a.jsxs)("div",{className:"relative flex-1 max-w-sm",children:[(0,a.jsx)(l.Search,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),(0,a.jsx)(y.Input,{type:"search",placeholder:"Fatura no veya tedarikci ara...",value:_,onChange:e=>L(e.target.value),className:"pl-9"})]}),(0,a.jsxs)(C.Select,{value:B,onValueChange:H,children:[(0,a.jsxs)(C.SelectTrigger,{className:"w-[180px]",children:[(0,a.jsx)(h.Store,{className:"h-4 w-4 mr-2"}),(0,a.jsx)(C.SelectValue,{placeholder:"Sube"})]}),(0,a.jsxs)(C.SelectContent,{children:[(0,a.jsx)(C.SelectItem,{value:"all",children:"Tum Subeler"}),I.filter(e=>!1!==e.isActive).map(e=>(0,a.jsx)(C.SelectItem,{value:e.id,children:e.name},e.id))]})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(b.Button,{variant:"all"===E?"default":"outline",size:"sm",onClick:()=>M("all"),children:"Tumu"}),Object.entries(X).map(([e,{label:t}])=>(0,a.jsx)(b.Button,{variant:E===e?"default":"outline",size:"sm",onClick:()=>M(e),children:t},e))]})]})})})}),(0,a.jsx)(v.Card,{children:(0,a.jsx)(v.CardContent,{className:"pt-6",children:(0,a.jsxs)(S.Table,{children:[(0,a.jsx)(S.TableHeader,{children:(0,a.jsxs)(S.TableRow,{children:[(0,a.jsx)(S.TableHead,{children:"Fatura No"}),(0,a.jsx)(S.TableHead,{children:"Tarih"}),(0,a.jsx)(S.TableHead,{children:"Tedarikci"}),(0,a.jsx)(S.TableHead,{children:"Sube"}),(0,a.jsx)(S.TableHead,{className:"text-right",children:"Ara Toplam"}),(0,a.jsx)(S.TableHead,{className:"text-right",children:"KDV"}),(0,a.jsx)(S.TableHead,{className:"text-right",children:"Toplam"}),(0,a.jsx)(S.TableHead,{children:"Durum"}),(0,a.jsx)(S.TableHead,{children:"Odeme"}),(0,a.jsx)(S.TableHead,{className:"w-[100px]",children:"Islem"})]})}),(0,a.jsx)(S.TableBody,{children:0===W.length?(0,a.jsx)(S.TableRow,{children:(0,a.jsxs)(S.TableCell,{colSpan:10,className:"text-center py-12",children:[(0,a.jsx)(i.ShoppingCart,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),(0,a.jsx)("h3",{className:"text-lg font-medium",children:"Fatura bulunamadi"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"Henuz alis faturasi eklenmemis veya arama kriterlerine uygun sonuc yok."})]})}):W.slice(0,100).map(e=>(0,a.jsxs)(S.TableRow,{children:[(0,a.jsx)(S.TableCell,{className:"font-medium font-mono",children:e.invoiceNo||e.invoice_number||"-"}),(0,a.jsx)(S.TableCell,{children:(0,w.formatDate)(e.date||e.invoice_date||e.createdAt||new Date)}),(0,a.jsx)(S.TableCell,{children:e.supplier||e.supplier_name||"-"}),(0,a.jsx)(S.TableCell,{children:(0,a.jsx)("span",{className:"text-xs text-muted-foreground",children:(e=>{if(!e)return"-";let a=I.find(a=>a.id===e);return a?.name||e})(e.branchId||e.branch_id)})}),(0,a.jsx)(S.TableCell,{className:"text-right font-mono",children:(0,w.formatCurrency)(e.subtotal||0)}),(0,a.jsx)(S.TableCell,{className:"text-right font-mono text-muted-foreground",children:(0,w.formatCurrency)(e.vatAmount||e.total_tax||0)}),(0,a.jsx)(S.TableCell,{className:"text-right font-mono font-medium",children:(0,w.formatCurrency)(e.total||e.grand_total||0)}),(0,a.jsx)(S.TableCell,{children:(0,a.jsx)("span",{className:`inline-flex items-center rounded-full px-2 py-1 text-xs font-medium ${X[e.status||"pending"]?.color||"bg-gray-100"}`,children:X[e.status||"pending"]?.label||e.status||"Beklemede"})}),(0,a.jsx)(S.TableCell,{children:(0,a.jsx)("span",{className:`inline-flex items-center rounded-full px-2 py-1 text-xs font-medium ${Z[e.paymentStatus||"unpaid"]?.color||"bg-gray-100"}`,children:Z[e.paymentStatus||"unpaid"]?.label||e.paymentStatus||"Odenmedi"})}),(0,a.jsx)(S.TableCell,{children:(0,a.jsxs)(T.DropdownMenu,{children:[(0,a.jsx)(T.DropdownMenuTrigger,{asChild:!0,children:(0,a.jsx)(b.Button,{variant:"ghost",size:"icon",className:"h-8 w-8",children:(0,a.jsx)(d.Eye,{className:"h-4 w-4"})})}),(0,a.jsxs)(T.DropdownMenuContent,{align:"end",children:[(0,a.jsxs)(T.DropdownMenuItem,{onClick:()=>ee(e),children:[(0,a.jsx)(d.Eye,{className:"h-4 w-4 mr-2"}),"Goruntule"]}),(0,a.jsxs)(T.DropdownMenuItem,{onClick:()=>ee(e),children:[(0,a.jsx)(n.Edit,{className:"h-4 w-4 mr-2"}),"Duzenle"]}),(0,a.jsxs)(T.DropdownMenuItem,{children:[(0,a.jsx)(p.Printer,{className:"h-4 w-4 mr-2"}),"Yazdir"]}),(0,a.jsx)(T.DropdownMenuSeparator,{}),(0,a.jsxs)(T.DropdownMenuItem,{className:"text-destructive",onClick:()=>ea(e),children:[(0,a.jsx)(c.Trash2,{className:"h-4 w-4 mr-2"}),"Sil"]})]})]})})]},e.id))})]})})}),(0,a.jsx)(R,{open:O,onOpenChange:V,invoice:U}),(0,a.jsx)(K,{open:q,onOpenChange:G}),(0,a.jsx)($,{open:Q,onOpenChange:Y})]})}e.s(["default",()=>Q],43413)}]);