(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,73884,e=>{"use strict";let a=(0,e.i(75254).default)("circle-x",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);e.s(["XCircle",()=>a],73884)},3281,e=>{"use strict";let a=(0,e.i(75254).default)("printer",[["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["path",{d:"M6 9V3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v6",key:"1itne7"}],["rect",{x:"6",y:"14",width:"12",height:"8",rx:"1",key:"1ue0tg"}]]);e.s(["Printer",()=>a],3281)},87378,e=>{"use strict";let a=(0,e.i(75254).default)("banknote",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"2",key:"9lu3g6"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"M6 12h.01M18 12h.01",key:"113zkx"}]]);e.s(["Banknote",()=>a],87378)},56909,e=>{"use strict";let a=(0,e.i(75254).default)("save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);e.s(["Save",()=>a],56909)},79567,e=>{"use strict";var a=e.i(43476),t=e.i(71645),s=e.i(7233),l=e.i(55436),i=e.i(50627),r=e.i(7486),n=e.i(88511),c=e.i(27612),d=e.i(86536),o=e.i(40160),u=e.i(31278),x=e.i(78583),m=e.i(69638),h=e.i(3116),j=e.i(73884),p=e.i(16715),g=e.i(23945),f=e.i(3281),b=e.i(61659),N=e.i(87378),v=e.i(15288),C=e.i(19455),y=e.i(93479),w=e.i(67489),T=e.i(84774),S=e.i(55146),k=e.i(75157),D=e.i(69457),I=e.i(76639),M=e.i(10204),H=e.i(46696),F=e.i(56909),B=e.i(37727);function z({open:e,onOpenChange:s,invoice:l,branches:r=[],onSave:n}){let[c,d]=(0,t.useState)({}),[o,x]=(0,t.useState)(!1);(0,t.useEffect)(()=>{l?d(l):d({invoiceDate:new Date().toISOString().split("T")[0],status:"pending",paymentMethod:"cash"})},[l,e]);let m=async e=>{e.preventDefault(),x(!0);try{if(l?.id)await (0,D.updateFirestoreData)("saleInvoices",l.id,c),H.toast.success("Fatura guncellendi");else{let e=`SF-${Date.now().toString().slice(-6)}`;await (0,D.addFirestoreData)("saleInvoices",{...c,invoiceNumber:e}),H.toast.success("Yeni fatura olusturuldu")}s(!1),n?.()}catch(e){console.error("Save error:",e),H.toast.error("Kayit sirasinda hata olustu")}finally{x(!1)}};return(0,a.jsx)(I.Dialog,{open:e,onOpenChange:s,children:(0,a.jsxs)(I.DialogContent,{className:"max-w-2xl",children:[(0,a.jsxs)(I.DialogHeader,{children:[(0,a.jsxs)(I.DialogTitle,{className:"flex items-center gap-2",children:[(0,a.jsx)(i.Receipt,{className:"h-5 w-5"}),l?"Fatura Duzenle":"Yeni Satis Faturasi"]}),(0,a.jsx)(I.DialogDescription,{children:"Satis faturasi bilgilerini girin"})]}),(0,a.jsxs)("form",{onSubmit:m,className:"space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(M.Label,{children:"Fatura Tarihi"}),(0,a.jsx)(y.Input,{type:"date",value:c.invoiceDate||"",onChange:e=>d({...c,invoiceDate:e.target.value}),required:!0})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(M.Label,{children:"Sube"}),(0,a.jsxs)(w.Select,{value:c.branchId||"none",onValueChange:e=>d({...c,branchId:"none"===e?"":e}),children:[(0,a.jsx)(w.SelectTrigger,{children:(0,a.jsx)(w.SelectValue,{placeholder:"Sube secin"})}),(0,a.jsxs)(w.SelectContent,{children:[(0,a.jsx)(w.SelectItem,{value:"none",children:"-- Sube secin --"}),r.filter(e=>e.id).map(e=>(0,a.jsx)(w.SelectItem,{value:e.id,children:e.name||e.id},e.id))]})]})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(M.Label,{children:"Musteri Adi"}),(0,a.jsx)(y.Input,{value:c.customerName||"",onChange:e=>d({...c,customerName:e.target.value}),placeholder:"Musteri adi",required:!0})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(M.Label,{children:"Odeme Yontemi"}),(0,a.jsxs)(w.Select,{value:c.paymentMethod||"cash",onValueChange:e=>d({...c,paymentMethod:e}),children:[(0,a.jsx)(w.SelectTrigger,{children:(0,a.jsx)(w.SelectValue,{})}),(0,a.jsxs)(w.SelectContent,{children:[(0,a.jsx)(w.SelectItem,{value:"cash",children:"Nakit"}),(0,a.jsx)(w.SelectItem,{value:"card",children:"Kredi Karti"}),(0,a.jsx)(w.SelectItem,{value:"transfer",children:"Havale/EFT"})]})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(M.Label,{children:"Durum"}),(0,a.jsxs)(w.Select,{value:c.status||"pending",onValueChange:e=>d({...c,status:e}),children:[(0,a.jsx)(w.SelectTrigger,{children:(0,a.jsx)(w.SelectValue,{})}),(0,a.jsxs)(w.SelectContent,{children:[(0,a.jsx)(w.SelectItem,{value:"pending",children:"Beklemede"}),(0,a.jsx)(w.SelectItem,{value:"paid",children:"Odendi"}),(0,a.jsx)(w.SelectItem,{value:"partial",children:"Kismi"}),(0,a.jsx)(w.SelectItem,{value:"cancelled",children:"Iptal"})]})]})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(M.Label,{children:"Toplam Tutar"}),(0,a.jsx)(y.Input,{type:"number",step:"0.01",value:c.total||"",onChange:e=>d({...c,total:parseFloat(e.target.value)||0}),placeholder:"0.00"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(M.Label,{children:"Notlar"}),(0,a.jsx)(y.Input,{value:c.notes||"",onChange:e=>d({...c,notes:e.target.value}),placeholder:"Fatura notu (opsiyonel)"})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-2 pt-4",children:[(0,a.jsxs)(C.Button,{type:"button",variant:"outline",onClick:()=>s(!1),children:[(0,a.jsx)(B.X,{className:"h-4 w-4 mr-2"}),"Iptal"]}),(0,a.jsxs)(C.Button,{type:"submit",disabled:o,children:[o?(0,a.jsx)(u.Loader2,{className:"h-4 w-4 mr-2 animate-spin"}):(0,a.jsx)(F.Save,{className:"h-4 w-4 mr-2"}),"Kaydet"]})]})]})]})})}let A={paid:{label:"Odendi",color:"bg-green-100 text-green-700",icon:m.CheckCircle},pending:{label:"Beklemede",color:"bg-yellow-100 text-yellow-700",icon:h.Clock},partial:{label:"Kismi Odeme",color:"bg-blue-100 text-blue-700",icon:h.Clock},cancelled:{label:"Iptal",color:"bg-red-100 text-red-700",icon:j.XCircle}},L={cash:{label:"Nakit",icon:N.Banknote},credit_card:{label:"Kredi Karti",icon:b.CreditCard},bank_transfer:{label:"Havale/EFT",icon:r.Building2}};function O(){let[e,r]=(0,t.useState)([]),[j,b]=(0,t.useState)([]),[I,M]=(0,t.useState)(!0),[F,B]=(0,t.useState)(""),[O,V]=(0,t.useState)("all"),[K,R]=(0,t.useState)("all"),[E,Y]=(0,t.useState)(!1),[P,$]=(0,t.useState)(null);(0,t.useEffect)(()=>{let e=(0,D.subscribeToFirestore)("sale_invoices",e=>{e?r([...e].sort((e,a)=>{let t=new Date(e.invoiceDate||e.date||e.createdAt||"").getTime();return new Date(a.invoiceDate||a.date||a.createdAt||"").getTime()-t})):r([]),M(!1)}),a=(0,D.subscribeToBranches)(e=>{b(e||[])});return()=>{e(),a()}},[]);let _=(0,t.useMemo)(()=>e.filter(e=>{let a=e.invoiceNumber||e.invoiceNo||"",t=e.customer?.name||e.customerName||"",s=a.toLowerCase().includes(F.toLowerCase())||t.toLowerCase().includes(F.toLowerCase()),l="all"===O||e.status===O,i="all"===K||e.branchId===K;return s&&l&&i}),[e,F,O,K]),q=(0,t.useMemo)(()=>{let a=e.length,t=e.reduce((e,a)=>e+(a.total||0),0),s=e.filter(e=>"paid"===e.status).length,l=e.filter(e=>"paid"===e.status).reduce((e,a)=>e+(a.total||0),0);return{total:a,totalAmount:t,paidCount:s,paidAmount:l,pendingCount:e.filter(e=>"pending"===e.status||"partial"===e.status).length,pendingAmount:e.filter(e=>"pending"===e.status||"partial"===e.status).reduce((e,a)=>e+((a.total||0)-(a.paidAmount||0)),0)}},[e]),X=e=>{$(e),Y(!0)},U=async e=>{let a=e.invoiceNumber||e.invoiceNo||e.id;if(confirm(`"${a}" faturasini silmek istediginize emin misiniz?`))try{await (0,D.deleteFirestoreData)("sale_invoices",e.id),H.toast.success("Fatura silindi")}catch(e){H.toast.error("Silme hatasi: "+e.message)}};return I?(0,a.jsxs)("div",{className:"flex items-center justify-center h-96",children:[(0,a.jsx)(u.Loader2,{className:"h-8 w-8 animate-spin text-primary"}),(0,a.jsx)("span",{className:"ml-2 text-muted-foreground",children:"Yukleniyor..."})]}):(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold tracking-tight",children:"Satis Faturalari"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"Musterilere kesilen faturalar"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)(C.Button,{variant:"outline",size:"sm",onClick:()=>{M(!0),setTimeout(()=>M(!1),500)},children:[(0,a.jsx)(p.RefreshCw,{className:`h-4 w-4 mr-2 ${I?"animate-spin":""}`}),"Yenile"]}),(0,a.jsxs)(C.Button,{variant:"outline",size:"sm",children:[(0,a.jsx)(o.Download,{className:"h-4 w-4 mr-2"}),"Excel"]}),(0,a.jsxs)(C.Button,{size:"sm",onClick:()=>{$(null),Y(!0)},children:[(0,a.jsx)(s.Plus,{className:"h-4 w-4 mr-2"}),"Yeni Fatura"]})]})]}),(0,a.jsxs)("div",{className:"grid gap-4 md:grid-cols-4",children:[(0,a.jsxs)(v.Card,{children:[(0,a.jsxs)(v.CardHeader,{className:"flex flex-row items-center justify-between pb-2",children:[(0,a.jsx)(v.CardTitle,{className:"text-sm font-medium text-muted-foreground",children:"Toplam Fatura"}),(0,a.jsx)(x.FileText,{className:"h-4 w-4 text-muted-foreground"})]}),(0,a.jsxs)(v.CardContent,{children:[(0,a.jsx)("div",{className:"text-2xl font-bold",children:q.total}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"fatura"})]})]}),(0,a.jsxs)(v.Card,{children:[(0,a.jsxs)(v.CardHeader,{className:"flex flex-row items-center justify-between pb-2",children:[(0,a.jsx)(v.CardTitle,{className:"text-sm font-medium text-muted-foreground",children:"Toplam Tutar"}),(0,a.jsx)(i.Receipt,{className:"h-4 w-4 text-muted-foreground"})]}),(0,a.jsx)(v.CardContent,{children:(0,a.jsx)("div",{className:"text-2xl font-bold text-primary",children:(0,k.formatCurrency)(q.totalAmount)})})]}),(0,a.jsxs)(v.Card,{children:[(0,a.jsxs)(v.CardHeader,{className:"flex flex-row items-center justify-between pb-2",children:[(0,a.jsx)(v.CardTitle,{className:"text-sm font-medium text-muted-foreground",children:"Odenen"}),(0,a.jsx)(m.CheckCircle,{className:"h-4 w-4 text-green-500"})]}),(0,a.jsxs)(v.CardContent,{children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-green-600",children:(0,k.formatCurrency)(q.paidAmount)}),(0,a.jsxs)("p",{className:"text-xs text-muted-foreground",children:[q.paidCount," fatura"]})]})]}),(0,a.jsxs)(v.Card,{children:[(0,a.jsxs)(v.CardHeader,{className:"flex flex-row items-center justify-between pb-2",children:[(0,a.jsx)(v.CardTitle,{className:"text-sm font-medium text-muted-foreground",children:"Bekleyen"}),(0,a.jsx)(h.Clock,{className:"h-4 w-4 text-yellow-500"})]}),(0,a.jsxs)(v.CardContent,{children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-yellow-600",children:(0,k.formatCurrency)(q.pendingAmount)}),(0,a.jsxs)("p",{className:"text-xs text-muted-foreground",children:[q.pendingCount," fatura"]})]})]})]}),(0,a.jsx)(v.Card,{children:(0,a.jsx)(v.CardContent,{className:"pt-6",children:(0,a.jsx)("div",{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:(0,a.jsxs)("div",{className:"flex flex-1 gap-4",children:[(0,a.jsxs)("div",{className:"relative flex-1 max-w-sm",children:[(0,a.jsx)(l.Search,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),(0,a.jsx)(y.Input,{type:"search",placeholder:"Fatura no veya musteri ara...",value:F,onChange:e=>B(e.target.value),className:"pl-9"})]}),(0,a.jsxs)(w.Select,{value:K,onValueChange:R,children:[(0,a.jsxs)(w.SelectTrigger,{className:"w-[180px]",children:[(0,a.jsx)(g.Store,{className:"h-4 w-4 mr-2"}),(0,a.jsx)(w.SelectValue,{placeholder:"Sube"})]}),(0,a.jsxs)(w.SelectContent,{children:[(0,a.jsx)(w.SelectItem,{value:"all",children:"Tum Subeler"}),j.filter(e=>e.id&&!1!==e.isActive).map(e=>(0,a.jsx)(w.SelectItem,{value:e.id,children:e.name},e.id))]})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(C.Button,{variant:"all"===O?"default":"outline",size:"sm",onClick:()=>V("all"),children:"Tumu"}),Object.entries(A).map(([e,{label:t}])=>(0,a.jsx)(C.Button,{variant:O===e?"default":"outline",size:"sm",onClick:()=>V(e),children:t},e))]})]})})})}),(0,a.jsx)(v.Card,{children:(0,a.jsx)(v.CardContent,{className:"pt-6",children:(0,a.jsxs)(T.Table,{children:[(0,a.jsx)(T.TableHeader,{children:(0,a.jsxs)(T.TableRow,{children:[(0,a.jsx)(T.TableHead,{children:"Fatura No"}),(0,a.jsx)(T.TableHead,{children:"Tarih"}),(0,a.jsx)(T.TableHead,{children:"Musteri"}),(0,a.jsx)(T.TableHead,{children:"Sube"}),(0,a.jsx)(T.TableHead,{className:"text-right",children:"Ara Toplam"}),(0,a.jsx)(T.TableHead,{className:"text-right",children:"KDV"}),(0,a.jsx)(T.TableHead,{className:"text-right",children:"Toplam"}),(0,a.jsx)(T.TableHead,{children:"Odeme"}),(0,a.jsx)(T.TableHead,{children:"Durum"}),(0,a.jsx)(T.TableHead,{className:"w-[100px]",children:"Islem"})]})}),(0,a.jsx)(T.TableBody,{children:0===_.length?(0,a.jsx)(T.TableRow,{children:(0,a.jsxs)(T.TableCell,{colSpan:10,className:"text-center py-12",children:[(0,a.jsx)(i.Receipt,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),(0,a.jsx)("h3",{className:"text-lg font-medium",children:"Fatura bulunamadi"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"Henuz satis faturasi eklenmemis veya arama kriterlerine uygun sonuc yok."})]})}):_.slice(0,100).map(e=>{let t=A[e.status||"pending"]?.icon||h.Clock,s=L[e.paymentMethod||"cash"]?.icon||N.Banknote;return(0,a.jsxs)(T.TableRow,{children:[(0,a.jsx)(T.TableCell,{className:"font-medium font-mono",children:e.invoiceNumber||e.invoiceNo||"-"}),(0,a.jsx)(T.TableCell,{children:(0,k.formatDate)(e.invoiceDate||e.date||e.createdAt||new Date)}),(0,a.jsx)(T.TableCell,{children:e.customer?.name||e.customerName||"-"}),(0,a.jsx)(T.TableCell,{children:(0,a.jsx)("span",{className:"text-xs text-muted-foreground",children:(e=>{if(!e)return"-";let a=j.find(a=>a.id===e);return a?.name||e})(e.branchId)})}),(0,a.jsx)(T.TableCell,{className:"text-right font-mono",children:(0,k.formatCurrency)(e.subtotal||0)}),(0,a.jsx)(T.TableCell,{className:"text-right font-mono text-muted-foreground",children:(0,k.formatCurrency)(e.totalTax||e.vatAmount||0)}),(0,a.jsx)(T.TableCell,{className:"text-right font-mono font-medium",children:(0,k.formatCurrency)(e.total||0)}),(0,a.jsx)(T.TableCell,{children:(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(s,{className:"h-3 w-3 text-muted-foreground"}),(0,a.jsx)("span",{className:"text-xs",children:L[e.paymentMethod||"cash"]?.label||e.paymentMethod})]})}),(0,a.jsx)(T.TableCell,{children:(0,a.jsxs)("span",{className:`inline-flex items-center gap-1 rounded-full px-2 py-1 text-xs font-medium ${A[e.status||"pending"]?.color||"bg-gray-100"}`,children:[(0,a.jsx)(t,{className:"h-3 w-3"}),A[e.status||"pending"]?.label||e.status]})}),(0,a.jsx)(T.TableCell,{children:(0,a.jsxs)(S.DropdownMenu,{children:[(0,a.jsx)(S.DropdownMenuTrigger,{asChild:!0,children:(0,a.jsx)(C.Button,{variant:"ghost",size:"icon",className:"h-8 w-8",children:(0,a.jsx)(d.Eye,{className:"h-4 w-4"})})}),(0,a.jsxs)(S.DropdownMenuContent,{align:"end",children:[(0,a.jsxs)(S.DropdownMenuItem,{onClick:()=>X(e),children:[(0,a.jsx)(d.Eye,{className:"h-4 w-4 mr-2"}),"Goruntule"]}),(0,a.jsxs)(S.DropdownMenuItem,{onClick:()=>X(e),children:[(0,a.jsx)(n.Edit,{className:"h-4 w-4 mr-2"}),"Duzenle"]}),(0,a.jsxs)(S.DropdownMenuItem,{children:[(0,a.jsx)(f.Printer,{className:"h-4 w-4 mr-2"}),"Yazdir"]}),(0,a.jsx)(S.DropdownMenuSeparator,{}),(0,a.jsxs)(S.DropdownMenuItem,{className:"text-destructive",onClick:()=>U(e),children:[(0,a.jsx)(c.Trash2,{className:"h-4 w-4 mr-2"}),"Sil"]})]})]})})]},e.id)})})]})})}),(0,a.jsx)(z,{open:E,onOpenChange:Y,invoice:P})]})}e.s(["default",()=>O],79567)}]);