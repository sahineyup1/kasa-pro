(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,67034,(e,t,n)=>{var i={675:function(e,t){"use strict";t.byteLength=function(e){var t=l(e),n=t[0],i=t[1];return(n+i)*3/4-i},t.toByteArray=function(e){var t,n,s=l(e),o=s[0],a=s[1],h=new r((o+a)*3/4-a),u=0,c=a>0?o-4:o;for(n=0;n<c;n+=4)t=i[e.charCodeAt(n)]<<18|i[e.charCodeAt(n+1)]<<12|i[e.charCodeAt(n+2)]<<6|i[e.charCodeAt(n+3)],h[u++]=t>>16&255,h[u++]=t>>8&255,h[u++]=255&t;return 2===a&&(t=i[e.charCodeAt(n)]<<2|i[e.charCodeAt(n+1)]>>4,h[u++]=255&t),1===a&&(t=i[e.charCodeAt(n)]<<10|i[e.charCodeAt(n+1)]<<4|i[e.charCodeAt(n+2)]>>2,h[u++]=t>>8&255,h[u++]=255&t),h},t.fromByteArray=function(e){for(var t,i=e.length,r=i%3,s=[],o=0,a=i-r;o<a;o+=16383)s.push(function(e,t,i){for(var r,s=[],o=t;o<i;o+=3)r=(e[o]<<16&0xff0000)+(e[o+1]<<8&65280)+(255&e[o+2]),s.push(n[r>>18&63]+n[r>>12&63]+n[r>>6&63]+n[63&r]);return s.join("")}(e,o,o+16383>a?a:o+16383));return 1===r?s.push(n[(t=e[i-1])>>2]+n[t<<4&63]+"=="):2===r&&s.push(n[(t=(e[i-2]<<8)+e[i-1])>>10]+n[t>>4&63]+n[t<<2&63]+"="),s.join("")};for(var n=[],i=[],r="undefined"!=typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0,a=s.length;o<a;++o)n[o]=s[o],i[s.charCodeAt(o)]=o;function l(e){var t=e.length;if(t%4>0)throw Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");-1===n&&(n=t);var i=n===t?0:4-n%4;return[n,i]}i[45]=62,i[95]=63},72:function(e,t,n){"use strict";var i=n(675),r=n(783),s="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;function o(e){if(e>0x7fffffff)throw RangeError('The value "'+e+'" is invalid for option "size"');var t=new Uint8Array(e);return Object.setPrototypeOf(t,a.prototype),t}function a(e,t,n){if("number"==typeof e){if("string"==typeof t)throw TypeError('The "string" argument must be of type string. Received type number');return u(e)}return l(e,t,n)}function l(e,t,n){if("string"==typeof e){var i=e,r=t;if(("string"!=typeof r||""===r)&&(r="utf8"),!a.isEncoding(r))throw TypeError("Unknown encoding: "+r);var s=0|f(i,r),l=o(s),h=l.write(i,r);return h!==s&&(l=l.slice(0,h)),l}if(ArrayBuffer.isView(e))return c(e);if(null==e)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(N(e,ArrayBuffer)||e&&N(e.buffer,ArrayBuffer)||"undefined"!=typeof SharedArrayBuffer&&(N(e,SharedArrayBuffer)||e&&N(e.buffer,SharedArrayBuffer)))return function(e,t,n){var i;if(t<0||e.byteLength<t)throw RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(n||0))throw RangeError('"length" is outside of buffer bounds');return Object.setPrototypeOf(i=void 0===t&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,t):new Uint8Array(e,t,n),a.prototype),i}(e,t,n);if("number"==typeof e)throw TypeError('The "value" argument must not be of type number. Received type number');var u=e.valueOf&&e.valueOf();if(null!=u&&u!==e)return a.from(u,t,n);var p=function(e){if(a.isBuffer(e)){var t=0|d(e.length),n=o(t);return 0===n.length||e.copy(n,0,0,t),n}return void 0!==e.length?"number"!=typeof e.length||function(e){return e!=e}(e.length)?o(0):c(e):"Buffer"===e.type&&Array.isArray(e.data)?c(e.data):void 0}(e);if(p)return p;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return a.from(e[Symbol.toPrimitive]("string"),t,n);throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function h(e){if("number"!=typeof e)throw TypeError('"size" argument must be of type number');if(e<0)throw RangeError('The value "'+e+'" is invalid for option "size"')}function u(e){return h(e),o(e<0?0:0|d(e))}function c(e){for(var t=e.length<0?0:0|d(e.length),n=o(t),i=0;i<t;i+=1)n[i]=255&e[i];return n}t.Buffer=a,t.SlowBuffer=function(e){return+e!=e&&(e=0),a.alloc(+e)},t.INSPECT_MAX_BYTES=50,t.kMaxLength=0x7fffffff,a.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}(),a.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(a.prototype,"parent",{enumerable:!0,get:function(){if(a.isBuffer(this))return this.buffer}}),Object.defineProperty(a.prototype,"offset",{enumerable:!0,get:function(){if(a.isBuffer(this))return this.byteOffset}}),a.poolSize=8192,a.from=function(e,t,n){return l(e,t,n)},Object.setPrototypeOf(a.prototype,Uint8Array.prototype),Object.setPrototypeOf(a,Uint8Array),a.alloc=function(e,t,n){return(h(e),e<=0)?o(e):void 0!==t?"string"==typeof n?o(e).fill(t,n):o(e).fill(t):o(e)},a.allocUnsafe=function(e){return u(e)},a.allocUnsafeSlow=function(e){return u(e)};function d(e){if(e>=0x7fffffff)throw RangeError("Attempt to allocate Buffer larger than maximum size: 0x7fffffff bytes");return 0|e}function f(e,t){if(a.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||N(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);var n=e.length,i=arguments.length>2&&!0===arguments[2];if(!i&&0===n)return 0;for(var r=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":return I(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return k(e).length;default:if(r)return i?-1:I(e).length;t=(""+t).toLowerCase(),r=!0}}function p(e,t,n){var r,s,o,a=!1;if((void 0===t||t<0)&&(t=0),t>this.length||((void 0===n||n>this.length)&&(n=this.length),n<=0||(n>>>=0)<=(t>>>=0)))return"";for(e||(e="utf8");;)switch(e){case"hex":return function(e,t,n){var i=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>i)&&(n=i);for(var r="",s=t;s<n;++s)r+=R[e[s]];return r}(this,t,n);case"utf8":case"utf-8":return _(this,t,n);case"ascii":return function(e,t,n){var i="";n=Math.min(e.length,n);for(var r=t;r<n;++r)i+=String.fromCharCode(127&e[r]);return i}(this,t,n);case"latin1":case"binary":return function(e,t,n){var i="";n=Math.min(e.length,n);for(var r=t;r<n;++r)i+=String.fromCharCode(e[r]);return i}(this,t,n);case"base64":return r=this,s=t,o=n,0===s&&o===r.length?i.fromByteArray(r):i.fromByteArray(r.slice(s,o));case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return function(e,t,n){for(var i=e.slice(t,n),r="",s=0;s<i.length;s+=2)r+=String.fromCharCode(i[s]+256*i[s+1]);return r}(this,t,n);default:if(a)throw TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),a=!0}}function g(e,t,n){var i=e[t];e[t]=e[n],e[n]=i}function m(e,t,n,i,r){var s;if(0===e.length)return -1;if("string"==typeof n?(i=n,n=0):n>0x7fffffff?n=0x7fffffff:n<-0x80000000&&(n=-0x80000000),(s=n*=1)!=s&&(n=r?0:e.length-1),n<0&&(n=e.length+n),n>=e.length)if(r)return -1;else n=e.length-1;else if(n<0)if(!r)return -1;else n=0;if("string"==typeof t&&(t=a.from(t,i)),a.isBuffer(t))return 0===t.length?-1:y(e,t,n,i,r);if("number"==typeof t){if(t&=255,"function"==typeof Uint8Array.prototype.indexOf)if(r)return Uint8Array.prototype.indexOf.call(e,t,n);else return Uint8Array.prototype.lastIndexOf.call(e,t,n);return y(e,[t],n,i,r)}throw TypeError("val must be string, number or Buffer")}function y(e,t,n,i,r){var s,o=1,a=e.length,l=t.length;if(void 0!==i&&("ucs2"===(i=String(i).toLowerCase())||"ucs-2"===i||"utf16le"===i||"utf-16le"===i)){if(e.length<2||t.length<2)return -1;o=2,a/=2,l/=2,n/=2}function h(e,t){return 1===o?e[t]:e.readUInt16BE(t*o)}if(r){var u=-1;for(s=n;s<a;s++)if(h(e,s)===h(t,-1===u?0:s-u)){if(-1===u&&(u=s),s-u+1===l)return u*o}else -1!==u&&(s-=s-u),u=-1}else for(n+l>a&&(n=a-l),s=n;s>=0;s--){for(var c=!0,d=0;d<l;d++)if(h(e,s+d)!==h(t,d)){c=!1;break}if(c)return s}return -1}a.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==a.prototype},a.compare=function(e,t){if(N(e,Uint8Array)&&(e=a.from(e,e.offset,e.byteLength)),N(t,Uint8Array)&&(t=a.from(t,t.offset,t.byteLength)),!a.isBuffer(e)||!a.isBuffer(t))throw TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;for(var n=e.length,i=t.length,r=0,s=Math.min(n,i);r<s;++r)if(e[r]!==t[r]){n=e[r],i=t[r];break}return n<i?-1:+(i<n)},a.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},a.concat=function(e,t){if(!Array.isArray(e))throw TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return a.alloc(0);if(void 0===t)for(n=0,t=0;n<e.length;++n)t+=e[n].length;var n,i=a.allocUnsafe(t),r=0;for(n=0;n<e.length;++n){var s=e[n];if(N(s,Uint8Array)&&(s=a.from(s)),!a.isBuffer(s))throw TypeError('"list" argument must be an Array of Buffers');s.copy(i,r),r+=s.length}return i},a.byteLength=f,a.prototype._isBuffer=!0,a.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)g(this,t,t+1);return this},a.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)g(this,t,t+3),g(this,t+1,t+2);return this},a.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)g(this,t,t+7),g(this,t+1,t+6),g(this,t+2,t+5),g(this,t+3,t+4);return this},a.prototype.toString=function(){var e=this.length;return 0===e?"":0==arguments.length?_(this,0,e):p.apply(this,arguments)},a.prototype.toLocaleString=a.prototype.toString,a.prototype.equals=function(e){if(!a.isBuffer(e))throw TypeError("Argument must be a Buffer");return this===e||0===a.compare(this,e)},a.prototype.inspect=function(){var e="",n=t.INSPECT_MAX_BYTES;return e=this.toString("hex",0,n).replace(/(.{2})/g,"$1 ").trim(),this.length>n&&(e+=" ... "),"<Buffer "+e+">"},s&&(a.prototype[s]=a.prototype.inspect),a.prototype.compare=function(e,t,n,i,r){if(N(e,Uint8Array)&&(e=a.from(e,e.offset,e.byteLength)),!a.isBuffer(e))throw TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===i&&(i=0),void 0===r&&(r=this.length),t<0||n>e.length||i<0||r>this.length)throw RangeError("out of range index");if(i>=r&&t>=n)return 0;if(i>=r)return -1;if(t>=n)return 1;if(t>>>=0,n>>>=0,i>>>=0,r>>>=0,this===e)return 0;for(var s=r-i,o=n-t,l=Math.min(s,o),h=this.slice(i,r),u=e.slice(t,n),c=0;c<l;++c)if(h[c]!==u[c]){s=h[c],o=u[c];break}return s<o?-1:+(o<s)},a.prototype.includes=function(e,t,n){return -1!==this.indexOf(e,t,n)},a.prototype.indexOf=function(e,t,n){return m(this,e,t,n,!0)},a.prototype.lastIndexOf=function(e,t,n){return m(this,e,t,n,!1)};function _(e,t,n){n=Math.min(e.length,n);for(var i=[],r=t;r<n;){var s,o,a,l,h=e[r],u=null,c=h>239?4:h>223?3:h>191?2:1;if(r+c<=n)switch(c){case 1:h<128&&(u=h);break;case 2:(192&(s=e[r+1]))==128&&(l=(31&h)<<6|63&s)>127&&(u=l);break;case 3:s=e[r+1],o=e[r+2],(192&s)==128&&(192&o)==128&&(l=(15&h)<<12|(63&s)<<6|63&o)>2047&&(l<55296||l>57343)&&(u=l);break;case 4:s=e[r+1],o=e[r+2],a=e[r+3],(192&s)==128&&(192&o)==128&&(192&a)==128&&(l=(15&h)<<18|(63&s)<<12|(63&o)<<6|63&a)>65535&&l<1114112&&(u=l)}null===u?(u=65533,c=1):u>65535&&(u-=65536,i.push(u>>>10&1023|55296),u=56320|1023&u),i.push(u),r+=c}var d=i,f=d.length;if(f<=4096)return String.fromCharCode.apply(String,d);for(var p="",g=0;g<f;)p+=String.fromCharCode.apply(String,d.slice(g,g+=4096));return p}function v(e,t,n){if(e%1!=0||e<0)throw RangeError("offset is not uint");if(e+t>n)throw RangeError("Trying to access beyond buffer length")}function w(e,t,n,i,r,s){if(!a.isBuffer(e))throw TypeError('"buffer" argument must be a Buffer instance');if(t>r||t<s)throw RangeError('"value" argument is out of bounds');if(n+i>e.length)throw RangeError("Index out of range")}function b(e,t,n,i,r,s){if(n+i>e.length||n<0)throw RangeError("Index out of range")}function E(e,t,n,i,s){return t*=1,n>>>=0,s||b(e,t,n,4,34028234663852886e22,-34028234663852886e22),r.write(e,t,n,i,23,4),n+4}function T(e,t,n,i,s){return t*=1,n>>>=0,s||b(e,t,n,8,17976931348623157e292,-17976931348623157e292),r.write(e,t,n,i,52,8),n+8}a.prototype.write=function(e,t,n,i){if(void 0===t)i="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)i=t,n=this.length,t=0;else if(isFinite(t))t>>>=0,isFinite(n)?(n>>>=0,void 0===i&&(i="utf8")):(i=n,n=void 0);else throw Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var r,s,o,a,l,h,u,c,d=this.length-t;if((void 0===n||n>d)&&(n=d),e.length>0&&(n<0||t<0)||t>this.length)throw RangeError("Attempt to write outside buffer bounds");i||(i="utf8");for(var f=!1;;)switch(i){case"hex":return function(e,t,n,i){n=Number(n)||0;var r=e.length-n;i?(i=Number(i))>r&&(i=r):i=r;var s=t.length;i>s/2&&(i=s/2);for(var o=0;o<i;++o){var a,l=parseInt(t.substr(2*o,2),16);if((a=l)!=a)break;e[n+o]=l}return o}(this,e,t,n);case"utf8":case"utf-8":return r=t,s=n,A(I(e,this.length-r),this,r,s);case"ascii":return o=t,a=n,A(S(e),this,o,a);case"latin1":case"binary":return function(e,t,n,i){return A(S(t),e,n,i)}(this,e,t,n);case"base64":return l=t,h=n,A(k(e),this,l,h);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return u=t,c=n,A(function(e,t){for(var n,i,r=[],s=0;s<e.length&&!((t-=2)<0);++s)i=(n=e.charCodeAt(s))>>8,r.push(n%256),r.push(i);return r}(e,this.length-u),this,u,c);default:if(f)throw TypeError("Unknown encoding: "+i);i=(""+i).toLowerCase(),f=!0}},a.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},a.prototype.slice=function(e,t){var n=this.length;e=~~e,t=void 0===t?n:~~t,e<0?(e+=n)<0&&(e=0):e>n&&(e=n),t<0?(t+=n)<0&&(t=0):t>n&&(t=n),t<e&&(t=e);var i=this.subarray(e,t);return Object.setPrototypeOf(i,a.prototype),i},a.prototype.readUIntLE=function(e,t,n){e>>>=0,t>>>=0,n||v(e,t,this.length);for(var i=this[e],r=1,s=0;++s<t&&(r*=256);)i+=this[e+s]*r;return i},a.prototype.readUIntBE=function(e,t,n){e>>>=0,t>>>=0,n||v(e,t,this.length);for(var i=this[e+--t],r=1;t>0&&(r*=256);)i+=this[e+--t]*r;return i},a.prototype.readUInt8=function(e,t){return e>>>=0,t||v(e,1,this.length),this[e]},a.prototype.readUInt16LE=function(e,t){return e>>>=0,t||v(e,2,this.length),this[e]|this[e+1]<<8},a.prototype.readUInt16BE=function(e,t){return e>>>=0,t||v(e,2,this.length),this[e]<<8|this[e+1]},a.prototype.readUInt32LE=function(e,t){return e>>>=0,t||v(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+0x1000000*this[e+3]},a.prototype.readUInt32BE=function(e,t){return e>>>=0,t||v(e,4,this.length),0x1000000*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},a.prototype.readIntLE=function(e,t,n){e>>>=0,t>>>=0,n||v(e,t,this.length);for(var i=this[e],r=1,s=0;++s<t&&(r*=256);)i+=this[e+s]*r;return i>=(r*=128)&&(i-=Math.pow(2,8*t)),i},a.prototype.readIntBE=function(e,t,n){e>>>=0,t>>>=0,n||v(e,t,this.length);for(var i=t,r=1,s=this[e+--i];i>0&&(r*=256);)s+=this[e+--i]*r;return s>=(r*=128)&&(s-=Math.pow(2,8*t)),s},a.prototype.readInt8=function(e,t){return(e>>>=0,t||v(e,1,this.length),128&this[e])?-((255-this[e]+1)*1):this[e]},a.prototype.readInt16LE=function(e,t){e>>>=0,t||v(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?0xffff0000|n:n},a.prototype.readInt16BE=function(e,t){e>>>=0,t||v(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?0xffff0000|n:n},a.prototype.readInt32LE=function(e,t){return e>>>=0,t||v(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},a.prototype.readInt32BE=function(e,t){return e>>>=0,t||v(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},a.prototype.readFloatLE=function(e,t){return e>>>=0,t||v(e,4,this.length),r.read(this,e,!0,23,4)},a.prototype.readFloatBE=function(e,t){return e>>>=0,t||v(e,4,this.length),r.read(this,e,!1,23,4)},a.prototype.readDoubleLE=function(e,t){return e>>>=0,t||v(e,8,this.length),r.read(this,e,!0,52,8)},a.prototype.readDoubleBE=function(e,t){return e>>>=0,t||v(e,8,this.length),r.read(this,e,!1,52,8)},a.prototype.writeUIntLE=function(e,t,n,i){if(e*=1,t>>>=0,n>>>=0,!i){var r=Math.pow(2,8*n)-1;w(this,e,t,n,r,0)}var s=1,o=0;for(this[t]=255&e;++o<n&&(s*=256);)this[t+o]=e/s&255;return t+n},a.prototype.writeUIntBE=function(e,t,n,i){if(e*=1,t>>>=0,n>>>=0,!i){var r=Math.pow(2,8*n)-1;w(this,e,t,n,r,0)}var s=n-1,o=1;for(this[t+s]=255&e;--s>=0&&(o*=256);)this[t+s]=e/o&255;return t+n},a.prototype.writeUInt8=function(e,t,n){return e*=1,t>>>=0,n||w(this,e,t,1,255,0),this[t]=255&e,t+1},a.prototype.writeUInt16LE=function(e,t,n){return e*=1,t>>>=0,n||w(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},a.prototype.writeUInt16BE=function(e,t,n){return e*=1,t>>>=0,n||w(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},a.prototype.writeUInt32LE=function(e,t,n){return e*=1,t>>>=0,n||w(this,e,t,4,0xffffffff,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},a.prototype.writeUInt32BE=function(e,t,n){return e*=1,t>>>=0,n||w(this,e,t,4,0xffffffff,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},a.prototype.writeIntLE=function(e,t,n,i){if(e*=1,t>>>=0,!i){var r=Math.pow(2,8*n-1);w(this,e,t,n,r-1,-r)}var s=0,o=1,a=0;for(this[t]=255&e;++s<n&&(o*=256);)e<0&&0===a&&0!==this[t+s-1]&&(a=1),this[t+s]=(e/o|0)-a&255;return t+n},a.prototype.writeIntBE=function(e,t,n,i){if(e*=1,t>>>=0,!i){var r=Math.pow(2,8*n-1);w(this,e,t,n,r-1,-r)}var s=n-1,o=1,a=0;for(this[t+s]=255&e;--s>=0&&(o*=256);)e<0&&0===a&&0!==this[t+s+1]&&(a=1),this[t+s]=(e/o|0)-a&255;return t+n},a.prototype.writeInt8=function(e,t,n){return e*=1,t>>>=0,n||w(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},a.prototype.writeInt16LE=function(e,t,n){return e*=1,t>>>=0,n||w(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},a.prototype.writeInt16BE=function(e,t,n){return e*=1,t>>>=0,n||w(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},a.prototype.writeInt32LE=function(e,t,n){return e*=1,t>>>=0,n||w(this,e,t,4,0x7fffffff,-0x80000000),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},a.prototype.writeInt32BE=function(e,t,n){return e*=1,t>>>=0,n||w(this,e,t,4,0x7fffffff,-0x80000000),e<0&&(e=0xffffffff+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},a.prototype.writeFloatLE=function(e,t,n){return E(this,e,t,!0,n)},a.prototype.writeFloatBE=function(e,t,n){return E(this,e,t,!1,n)},a.prototype.writeDoubleLE=function(e,t,n){return T(this,e,t,!0,n)},a.prototype.writeDoubleBE=function(e,t,n){return T(this,e,t,!1,n)},a.prototype.copy=function(e,t,n,i){if(!a.isBuffer(e))throw TypeError("argument should be a Buffer");if(n||(n=0),i||0===i||(i=this.length),t>=e.length&&(t=e.length),t||(t=0),i>0&&i<n&&(i=n),i===n||0===e.length||0===this.length)return 0;if(t<0)throw RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw RangeError("Index out of range");if(i<0)throw RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length),e.length-t<i-n&&(i=e.length-t+n);var r=i-n;if(this===e&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(t,n,i);else if(this===e&&n<t&&t<i)for(var s=r-1;s>=0;--s)e[s+t]=this[s+n];else Uint8Array.prototype.set.call(e,this.subarray(n,i),t);return r},a.prototype.fill=function(e,t,n,i){if("string"==typeof e){if("string"==typeof t?(i=t,t=0,n=this.length):"string"==typeof n&&(i=n,n=this.length),void 0!==i&&"string"!=typeof i)throw TypeError("encoding must be a string");if("string"==typeof i&&!a.isEncoding(i))throw TypeError("Unknown encoding: "+i);if(1===e.length){var r,s=e.charCodeAt(0);("utf8"===i&&s<128||"latin1"===i)&&(e=s)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<n)throw RangeError("Out of range index");if(n<=t)return this;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(r=t;r<n;++r)this[r]=e;else{var o=a.isBuffer(e)?e:a.from(e,i),l=o.length;if(0===l)throw TypeError('The value "'+e+'" is invalid for argument "value"');for(r=0;r<n-t;++r)this[r+t]=o[r%l]}return this};var C=/[^+/0-9A-Za-z-_]/g;function I(e,t){t=t||1/0;for(var n,i=e.length,r=null,s=[],o=0;o<i;++o){if((n=e.charCodeAt(o))>55295&&n<57344){if(!r){if(n>56319||o+1===i){(t-=3)>-1&&s.push(239,191,189);continue}r=n;continue}if(n<56320){(t-=3)>-1&&s.push(239,191,189),r=n;continue}n=(r-55296<<10|n-56320)+65536}else r&&(t-=3)>-1&&s.push(239,191,189);if(r=null,n<128){if((t-=1)<0)break;s.push(n)}else if(n<2048){if((t-=2)<0)break;s.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;s.push(n>>12|224,n>>6&63|128,63&n|128)}else if(n<1114112){if((t-=4)<0)break;s.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}else throw Error("Invalid code point")}return s}function S(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}function k(e){return i.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(C,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function A(e,t,n,i){for(var r=0;r<i&&!(r+n>=t.length)&&!(r>=e.length);++r)t[r+n]=e[r];return r}function N(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}var R=function(){for(var e="0123456789abcdef",t=Array(256),n=0;n<16;++n)for(var i=16*n,r=0;r<16;++r)t[i+r]=e[n]+e[r];return t}()},783:function(e,t){t.read=function(e,t,n,i,r){var s,o,a=8*r-i-1,l=(1<<a)-1,h=l>>1,u=-7,c=n?r-1:0,d=n?-1:1,f=e[t+c];for(c+=d,s=f&(1<<-u)-1,f>>=-u,u+=a;u>0;s=256*s+e[t+c],c+=d,u-=8);for(o=s&(1<<-u)-1,s>>=-u,u+=i;u>0;o=256*o+e[t+c],c+=d,u-=8);if(0===s)s=1-h;else{if(s===l)return o?NaN:1/0*(f?-1:1);o+=Math.pow(2,i),s-=h}return(f?-1:1)*o*Math.pow(2,s-i)},t.write=function(e,t,n,i,r,s){var o,a,l,h=8*s-r-1,u=(1<<h)-1,c=u>>1,d=5960464477539062e-23*(23===r),f=i?0:s-1,p=i?1:-1,g=+(t<0||0===t&&1/t<0);for(isNaN(t=Math.abs(t))||t===1/0?(a=+!!isNaN(t),o=u):(o=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-o))<1&&(o--,l*=2),o+c>=1?t+=d/l:t+=d*Math.pow(2,1-c),t*l>=2&&(o++,l/=2),o+c>=u?(a=0,o=u):o+c>=1?(a=(t*l-1)*Math.pow(2,r),o+=c):(a=t*Math.pow(2,c-1)*Math.pow(2,r),o=0));r>=8;e[n+f]=255&a,f+=p,a/=256,r-=8);for(o=o<<r|a,h+=r;h>0;e[n+f]=255&o,f+=p,o/=256,h-=8);e[n+f-p]|=128*g}}},r={};function s(e){var t=r[e];if(void 0!==t)return t.exports;var n=r[e]={exports:{}},o=!0;try{i[e](n,n.exports,s),o=!1}finally{o&&delete r[e]}return n.exports}s.ab="/ROOT/node_modules/next/dist/compiled/buffer/",t.exports=s(72)},69457,e=>{"use strict";let t,n,i,r,s,o,a,l,h,u,c,d,f,p,g,m;var y,_,v,w,b,E,T,C,I,S,k,A,N,R,P,x,D,O,L,M=e.i(47167);let F=function(e,t){if(!e)throw U(t)},U=function(e){return Error("Firebase Database (${JSCORE_VERSION}) INTERNAL ASSERT FAILED: "+e)},V=function(e){let t=[],n=0;for(let i=0;i<e.length;i++){let r=e.charCodeAt(i);r<128?t[n++]=r:(r<2048?t[n++]=r>>6|192:((64512&r)==55296&&i+1<e.length&&(64512&e.charCodeAt(i+1))==56320?(r=65536+((1023&r)<<10)+(1023&e.charCodeAt(++i)),t[n++]=r>>18|240,t[n++]=r>>12&63|128):t[n++]=r>>12|224,t[n++]=r>>6&63|128),t[n++]=63&r|128)}return t},q=function(e){let t=[],n=0,i=0;for(;n<e.length;){let r=e[n++];if(r<128)t[i++]=String.fromCharCode(r);else if(r>191&&r<224){let s=e[n++];t[i++]=String.fromCharCode((31&r)<<6|63&s)}else if(r>239&&r<365){let s=((7&r)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[i++]=String.fromCharCode(55296+(s>>10)),t[i++]=String.fromCharCode(56320+(1023&s))}else{let s=e[n++],o=e[n++];t[i++]=String.fromCharCode((15&r)<<12|(63&s)<<6|63&o)}}return t.join("")},j={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();let n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let t=0;t<e.length;t+=3){let r=e[t],s=t+1<e.length,o=s?e[t+1]:0,a=t+2<e.length,l=a?e[t+2]:0,h=r>>2,u=(3&r)<<4|o>>4,c=(15&o)<<2|l>>6,d=63&l;!a&&(d=64,s||(c=64)),i.push(n[h],n[u],n[c],n[d])}return i.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(V(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):q(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();let n=t?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let t=0;t<e.length;){let r=n[e.charAt(t++)],s=t<e.length?n[e.charAt(t)]:0,o=++t<e.length?n[e.charAt(t)]:64,a=++t<e.length?n[e.charAt(t)]:64;if(++t,null==r||null==s||null==o||null==a)throw new B;let l=r<<2|s>>4;if(i.push(l),64!==o){let e=s<<4&240|o>>2;if(i.push(e),64!==a){let e=o<<6&192|a;i.push(e)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class B extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}let z=function(e){let t=V(e);return j.encodeByteArray(t,!0)},$=function(e){return z(e).replace(/\./g,"")},H=function(e){try{return j.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null},W=()=>{try{return("undefined"!=typeof self?self:"undefined"!=typeof window?window:e.g).__FIREBASE_DEFAULTS__||(()=>{if(void 0===M.default||void 0===M.default.env)return;let e=M.default.env.__FIREBASE_DEFAULTS__;if(e)return JSON.parse(e)})()||(()=>{let e;if("undefined"==typeof document)return;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}let t=e&&H(e[1]);return t&&JSON.parse(t)})()}catch(e){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`);return}},K=e=>W()?.emulatorHosts?.[e],G=e=>{let t=K(e);if(!t)return;let n=t.lastIndexOf(":");if(n<=0||n+1===t.length)throw Error(`Invalid host ${t} with no separate hostname and port!`);let i=parseInt(t.substring(n+1),10);return"["===t[0]?[t.substring(1,n-1),i]:[t.substring(0,n),i]},Q=()=>W()?.config,Y=e=>W()?.[`_${e}`];class X{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"==typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,n))}}}function J(e){try{return(e.startsWith("http://")||e.startsWith("https://")?new URL(e).hostname:e).endsWith(".cloudworkstations.dev")}catch{return!1}}async function Z(e){return(await fetch(e,{credentials:"include"})).ok}function ee(e,t){if(e.uid)throw Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let n=t||"demo-project",i=e.iat||0,r=e.sub||e.user_id;if(!r)throw Error("mockUserToken must contain 'sub' or 'user_id' field!");let s={iss:`https://securetoken.google.com/${n}`,aud:n,iat:i,exp:i+3600,auth_time:i,sub:r,user_id:r,firebase:{sign_in_provider:"custom",identities:{}},...e};return[$(JSON.stringify({alg:"none",type:"JWT"})),$(JSON.stringify(s)),""].join(".")}let et={},en=!1;function ei(e,t){if("undefined"==typeof window||"undefined"==typeof document||!J(window.location.host)||et[e]===t||et[e]||en)return;function n(e){return`__firebase__banner__${e}`}et[e]=t;let i="__firebase__banner",r=function(){let e={prod:[],emulator:[]};for(let t of Object.keys(et))et[t]?e.emulator.push(t):e.prod.push(t);return e}().prod.length>0;function s(){let e,t,s=(e=document.getElementById(i),t=!1,e||((e=document.createElement("div")).setAttribute("id",i),t=!0),{created:t,element:e}),o=n("text"),a=document.getElementById(o)||document.createElement("span"),l=n("learnmore"),h=document.getElementById(l)||document.createElement("a"),u=n("preprendIcon"),c=document.getElementById(u)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(s.created){let e,t=s.element;t.style.display="flex",t.style.background="#7faaf0",t.style.position="fixed",t.style.bottom="5px",t.style.left="5px",t.style.padding=".5em",t.style.borderRadius="5px",t.style.alignItems="center",h.setAttribute("id",l),h.innerText="Learn more",h.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",h.setAttribute("target","__blank"),h.style.paddingLeft="5px",h.style.textDecoration="underline";let n=((e=document.createElement("span")).style.cursor="pointer",e.style.marginLeft="16px",e.style.fontSize="24px",e.innerHTML=" &times;",e.onclick=()=>{let e;en=!0,(e=document.getElementById(i))&&e.remove()},e);c.setAttribute("width","24"),c.setAttribute("id",u),c.setAttribute("height","24"),c.setAttribute("viewBox","0 0 24 24"),c.setAttribute("fill","none"),c.style.marginLeft="-6px",t.append(c,a,h,n),document.body.appendChild(t)}r?(a.innerText="Preview backend disconnected.",c.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(c.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,a.innerText="Preview backend running in this workspace."),a.setAttribute("id",o)}"loading"===document.readyState?window.addEventListener("DOMContentLoaded",s):s()}function er(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function es(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(er())}function eo(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function ea(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function el(){return false}class eh extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,eh.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,eu.prototype.create)}}class eu{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){var n,i;let r=t[0]||{},s=`${this.service}/${e}`,o=this.errors[e],a=o?(n=o,i=r,n.replace(ec,(e,t)=>{let n=i[t];return null!=n?String(n):`<${t}?>`})):"Error",l=`${this.serviceName}: ${a} (${s}).`;return new eh(s,l,r)}}let ec=/\{\$([^}]+)}/g;function ed(e){return JSON.parse(e)}function ef(e){return JSON.stringify(e)}let ep=function(e){let t={},n={},i={},r="";try{let s=e.split(".");t=ed(H(s[0])||""),n=ed(H(s[1])||""),r=s[2],i=n.d||{},delete n.d}catch(e){}return{header:t,claims:n,data:i,signature:r}},eg=function(e){let t=ep(e).claims;return!!t&&"object"==typeof t&&t.hasOwnProperty("iat")},em=function(e){let t=ep(e).claims;return"object"==typeof t&&!0===t.admin};function ey(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function e_(e,t){return Object.prototype.hasOwnProperty.call(e,t)?e[t]:void 0}function ev(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function ew(e,t,n){let i={};for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&(i[r]=t.call(n,e[r],r,e));return i}function eb(e,t){if(e===t)return!0;let n=Object.keys(e),i=Object.keys(t);for(let r of n){if(!i.includes(r))return!1;let n=e[r],s=t[r];if(eE(n)&&eE(s)){if(!eb(n,s))return!1}else if(n!==s)return!1}for(let e of i)if(!n.includes(e))return!1;return!0}function eE(e){return null!==e&&"object"==typeof e}function eT(e){let t=[];for(let[n,i]of Object.entries(e))Array.isArray(i)?i.forEach(e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(n)+"="+encodeURIComponent(i));return t.length?"&"+t.join("&"):""}function eC(e){let t={};return e.replace(/^\?/,"").split("&").forEach(e=>{if(e){let[n,i]=e.split("=");t[decodeURIComponent(n)]=decodeURIComponent(i)}}),t}function eI(e){let t=e.indexOf("?");if(!t)return"";let n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)}class eS{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=0x67452301,this.chain_[1]=0xefcdab89,this.chain_[2]=0x98badcfe,this.chain_[3]=0x10325476,this.chain_[4]=0xc3d2e1f0,this.inbuf_=0,this.total_=0}compress_(e,t){let n,i;t||(t=0);let r=this.W_;if("string"==typeof e)for(let n=0;n<16;n++)r[n]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let n=0;n<16;n++)r[n]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let e=16;e<80;e++){let t=r[e-3]^r[e-8]^r[e-14]^r[e-16];r[e]=(t<<1|t>>>31)&0xffffffff}let s=this.chain_[0],o=this.chain_[1],a=this.chain_[2],l=this.chain_[3],h=this.chain_[4];for(let e=0;e<80;e++){e<40?e<20?(n=l^o&(a^l),i=0x5a827999):(n=o^a^l,i=0x6ed9eba1):e<60?(n=o&a|l&(o|a),i=0x8f1bbcdc):(n=o^a^l,i=0xca62c1d6);let t=(s<<5|s>>>27)+n+h+i+r[e]|0;h=l,l=a,a=(o<<30|o>>>2)&0xffffffff,o=s,s=t}this.chain_[0]=this.chain_[0]+s|0,this.chain_[1]=this.chain_[1]+o|0,this.chain_[2]=this.chain_[2]+a|0,this.chain_[3]=this.chain_[3]+l|0,this.chain_[4]=this.chain_[4]+h|0}update(e,t){if(null==e)return;void 0===t&&(t=e.length);let n=t-this.blockSize,i=0,r=this.buf_,s=this.inbuf_;for(;i<t;){if(0===s)for(;i<=n;)this.compress_(e,i),i+=this.blockSize;if("string"==typeof e){for(;i<t;)if(r[s]=e.charCodeAt(i),++s,++i,s===this.blockSize){this.compress_(r),s=0;break}}else for(;i<t;)if(r[s]=e[i],++s,++i,s===this.blockSize){this.compress_(r),s=0;break}}this.inbuf_=s,this.total_+=t}digest(){let e=[],t=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let e=this.blockSize-1;e>=56;e--)this.buf_[e]=255&t,t/=256;this.compress_(this.buf_);let n=0;for(let t=0;t<5;t++)for(let i=24;i>=0;i-=8)e[n]=this.chain_[t]>>i&255,++n;return e}}class ek{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(e=>{this.error(e)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,n){let i;if(void 0===e&&void 0===t&&void 0===n)throw Error("Missing Observer.");void 0===(i=!function(e,t){if("object"!=typeof e||null===e)return!1;for(let n of t)if(n in e&&"function"==typeof e[n])return!0;return!1}(e,["next","error","complete"])?{next:e,error:t,complete:n}:e).next&&(i.next=eA),void 0===i.error&&(i.error=eA),void 0===i.complete&&(i.complete=eA);let r=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch(e){}}),this.observers.push(i),r}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}})}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function eA(){}function eN(e,t){return`${e} failed: ${t} argument `}let eR=function(e){let t=[],n=0;for(let i=0;i<e.length;i++){let r=e.charCodeAt(i);if(r>=55296&&r<=56319){let t=r-55296;F(++i<e.length,"Surrogate pair missing trail surrogate."),r=65536+(t<<10)+(e.charCodeAt(i)-56320)}r<128?t[n++]=r:(r<2048?t[n++]=r>>6|192:(r<65536?t[n++]=r>>12|224:(t[n++]=r>>18|240,t[n++]=r>>12&63|128),t[n++]=r>>6&63|128),t[n++]=63&r|128)}return t},eP=function(e){let t=0;for(let n=0;n<e.length;n++){let i=e.charCodeAt(n);i<128?t++:i<2048?t+=2:i>=55296&&i<=56319?(t+=4,n++):t+=3}return t};function ex(e){return e&&e._delegate?e._delegate:e}class eD{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}let eO="[DEFAULT]";class eL{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){let t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){let e=new X;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{let n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){let t=this.normalizeInstanceIdentifier(e?.identifier),n=e?.optional??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(e){if(n)return null;throw e}if(n)return null;throw Error(`Service ${this.name} is not available`)}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if("EAGER"===e.instantiationMode)try{this.getOrInitializeService({instanceIdentifier:eO})}catch(e){}for(let[e,t]of this.instancesDeferred.entries()){let n=this.normalizeInstanceIdentifier(e);try{let e=this.getOrInitializeService({instanceIdentifier:n});t.resolve(e)}catch(e){}}}}clearInstance(e=eO){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){let e=Array.from(this.instances.values());await Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return null!=this.component}isInitialized(e=eO){return this.instances.has(e)}getOptions(e=eO){return this.instancesOptions.get(e)||{}}initialize(e={}){let{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let i=this.getOrInitializeService({instanceIdentifier:n,options:t});for(let[e,t]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(e)&&t.resolve(i);return i}onInit(e,t){let n=this.normalizeInstanceIdentifier(t),i=this.onInitCallbacks.get(n)??new Set;i.add(e),this.onInitCallbacks.set(n,i);let r=this.instances.get(n);return r&&e(r,n),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){let n=this.onInitCallbacks.get(t);if(n)for(let i of n)try{i(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){var n;let i=this.instances.get(e);if(!i&&this.component&&(i=this.component.instanceFactory(this.container,{instanceIdentifier:(n=e)===eO?void 0:n,options:t}),this.instances.set(e,i),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(i,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,i)}catch{}return i||null}normalizeInstanceIdentifier(e=eO){return this.component?this.component.multipleInstances?e:eO:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class eM{constructor(e){this.name=e,this.providers=new Map}addComponent(e){let t=this.getProvider(e.name);if(t.isComponentSet())throw Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);let t=new eL(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}let eF=[];(y=w||(w={}))[y.DEBUG=0]="DEBUG",y[y.VERBOSE=1]="VERBOSE",y[y.INFO=2]="INFO",y[y.WARN=3]="WARN",y[y.ERROR=4]="ERROR",y[y.SILENT=5]="SILENT";let eU={debug:w.DEBUG,verbose:w.VERBOSE,info:w.INFO,warn:w.WARN,error:w.ERROR,silent:w.SILENT},eV=w.INFO,eq={[w.DEBUG]:"log",[w.VERBOSE]:"log",[w.INFO]:"info",[w.WARN]:"warn",[w.ERROR]:"error"},ej=(e,t,...n)=>{if(t<e.logLevel)return;let i=new Date().toISOString(),r=eq[t];if(r)console[r](`[${i}]  ${e.name}:`,...n);else throw Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class eB{constructor(e){this.name=e,this._logLevel=eV,this._logHandler=ej,this._userLogHandler=null,eF.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in w))throw TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?eU[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,w.DEBUG,...e),this._logHandler(this,w.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,w.VERBOSE,...e),this._logHandler(this,w.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,w.INFO,...e),this._logHandler(this,w.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,w.WARN,...e),this._logHandler(this,w.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,w.ERROR,...e),this._logHandler(this,w.ERROR,...e)}}let ez=new WeakMap,e$=new WeakMap,eH=new WeakMap,eW=new WeakMap,eK=new WeakMap,eG={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return e$.get(e);if("objectStoreNames"===t)return e.objectStoreNames||eH.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return eQ(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function eQ(e){if(e instanceof IDBRequest){let t;return(t=new Promise((t,n)=>{let i=()=>{e.removeEventListener("success",r),e.removeEventListener("error",s)},r=()=>{t(eQ(e.result)),i()},s=()=>{n(e.error),i()};e.addEventListener("success",r),e.addEventListener("error",s)})).then(t=>{t instanceof IDBCursor&&ez.set(t,e)}).catch(()=>{}),eK.set(t,e),t}if(eW.has(e))return eW.get(e);let i=function(e){if("function"==typeof e)return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(n||(n=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(eY(this),t),eQ(ez.get(this))}:function(...t){return eQ(e.apply(eY(this),t))}:function(t,...n){let i=e.call(eY(this),t,...n);return eH.set(i,t.sort?t.sort():[t]),eQ(i)};return e instanceof IDBTransaction&&function(e){if(e$.has(e))return;let t=new Promise((t,n)=>{let i=()=>{e.removeEventListener("complete",r),e.removeEventListener("error",s),e.removeEventListener("abort",s)},r=()=>{t(),i()},s=()=>{n(e.error||new DOMException("AbortError","AbortError")),i()};e.addEventListener("complete",r),e.addEventListener("error",s),e.addEventListener("abort",s)});e$.set(e,t)}(e),(t||(t=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some(t=>e instanceof t)?new Proxy(e,eG):e}(e);return i!==e&&(eW.set(e,i),eK.set(i,e)),i}let eY=e=>eK.get(e),eX=["get","getKey","getAll","getAllKeys","count"],eJ=["put","add","delete","clear"],eZ=new Map;function e0(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t))return;if(eZ.get(t))return eZ.get(t);let n=t.replace(/FromIndex$/,""),i=t!==n,r=eJ.includes(n);if(!(n in(i?IDBIndex:IDBObjectStore).prototype)||!(r||eX.includes(n)))return;let s=async function(e,...t){let s=this.transaction(e,r?"readwrite":"readonly"),o=s.store;return i&&(o=o.index(t.shift())),(await Promise.all([o[n](...t),r&&s.done]))[0]};return eZ.set(t,s),s}eG={...m=eG,get:(e,t,n)=>e0(e,t)||m.get(e,t,n),has:(e,t)=>!!e0(e,t)||m.has(e,t)};class e1{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{let t;if(t=e.getComponent(),t?.type!=="VERSION")return null;{let t=e.getImmediate();return`${t.library}/${t.version}`}}).filter(e=>e).join(" ")}}let e2="@firebase/app",e6="0.14.6",e3=new eB("@firebase/app"),e5="[DEFAULT]",e4={[e2]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/data-connect":"fire-data-connect","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","@firebase/ai":"fire-vertex","fire-js":"fire-js",firebase:"fire-js-all"},e8=new Map,e7=new Map,e9=new Map;function te(e,t){try{e.container.addComponent(t)}catch(n){e3.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function tt(e,t){e.container.addOrOverwriteComponent(t)}function tn(e){let t=e.name;if(e9.has(t))return e3.debug(`There were multiple attempts to register component ${t}.`),!1;for(let n of(e9.set(t,e),e8.values()))te(n,e);for(let t of e7.values())te(t,e);return!0}function ti(e,t){let n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}function tr(e,t,n=e5){ti(e,t).clearInstance(n)}function ts(e){return void 0!==e.options}function to(e){return!ts(e)&&("authIdToken"in e||"appCheckToken"in e||"releaseOnDeref"in e||"automaticDataCollectionEnabled"in e)}function ta(e){return null!=e&&void 0!==e.settings}function tl(){e9.clear()}let th=new eu("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class tu{constructor(e,t,n){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new eD("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw th.create("app-deleted",{appName:this._name})}}function tc(e,t){let n=H(e.split(".")[1]);null===n?console.error(`FirebaseServerApp ${t} is invalid: second part could not be parsed.`):void 0===JSON.parse(n).exp?console.error(`FirebaseServerApp ${t} is invalid: expiration claim could not be parsed`):1e3*JSON.parse(n).exp-new Date().getTime()<=0&&console.error(`FirebaseServerApp ${t} is invalid: the token has expired.`)}class td extends tu{constructor(e,t,n,i){const r=void 0===t.automaticDataCollectionEnabled||t.automaticDataCollectionEnabled,s={name:n,automaticDataCollectionEnabled:r};void 0!==e.apiKey?super(e,s,i):super(e.options,s,i),this._serverConfig={automaticDataCollectionEnabled:r,...t},this._serverConfig.authIdToken&&tc(this._serverConfig.authIdToken,"authIdToken"),this._serverConfig.appCheckToken&&tc(this._serverConfig.appCheckToken,"appCheckToken"),this._finalizationRegistry=null,"undefined"!=typeof FinalizationRegistry&&(this._finalizationRegistry=new FinalizationRegistry(()=>{this.automaticCleanup()})),this._refCount=0,this.incRefCount(this._serverConfig.releaseOnDeref),this._serverConfig.releaseOnDeref=void 0,t.releaseOnDeref=void 0,tv(e2,e6,"serverapp")}toJSON(){}get refCount(){return this._refCount}incRefCount(e){this.isDeleted||(this._refCount++,void 0!==e&&null!==this._finalizationRegistry&&this._finalizationRegistry.register(e,this))}decRefCount(){return this.isDeleted?0:--this._refCount}automaticCleanup(){t_(this)}get settings(){return this.checkDestroyed(),this._serverConfig}checkDestroyed(){if(this.isDeleted)throw th.create("server-app-deleted")}}let tf="12.6.0";function tp(e,t={}){let n=e;"object"!=typeof t&&(t={name:t});let i={name:e5,automaticDataCollectionEnabled:!0,...t},r=i.name;if("string"!=typeof r||!r)throw th.create("bad-app-name",{appName:String(r)});if(n||(n=Q()),!n)throw th.create("no-options");let s=e8.get(r);if(s)if(eb(n,s.options)&&eb(i,s.config))return s;else throw th.create("duplicate-app",{appName:r});let o=new eM(r);for(let e of e9.values())o.addComponent(e);let a=new tu(n,i,o);return e8.set(r,a),a}function tg(e,t={}){let n;if(("undefined"!=typeof window||eo())&&!eo())throw th.create("invalid-server-app-environment");let i=t||{};if(e&&(ts(e)?n=e.options:to(e)?i=e:n=e),void 0===i.automaticDataCollectionEnabled&&(i.automaticDataCollectionEnabled=!0),n||(n=Q()),!n)throw th.create("no-options");let r={...i,...n};if(void 0!==r.releaseOnDeref&&delete r.releaseOnDeref,void 0!==i.releaseOnDeref&&"undefined"==typeof FinalizationRegistry)throw th.create("finalization-registry-not-supported",{});let s=""+[...JSON.stringify(r)].reduce((e,t)=>Math.imul(31,e)+t.charCodeAt(0)|0,0),o=e7.get(s);if(o)return o.incRefCount(i.releaseOnDeref),o;let a=new eM(s);for(let e of e9.values())a.addComponent(e);let l=new td(n,i,s,a);return e7.set(s,l),l}function tm(e=e5){let t=e8.get(e);if(!t&&e===e5&&Q())return tp();if(!t)throw th.create("no-app",{appName:e});return t}function ty(){return Array.from(e8.values())}async function t_(e){let t=!1,n=e.name;e8.has(n)?(t=!0,e8.delete(n)):e7.has(n)&&0>=e.decRefCount()&&(e7.delete(n),t=!0),t&&(await Promise.all(e.container.getProviders().map(e=>e.delete())),e.isDeleted=!0)}function tv(e,t,n){let i=e4[e]??e;n&&(i+=`-${n}`);let r=i.match(/\s|\//),s=t.match(/\s|\//);if(r||s){let e=[`Unable to register library "${i}" with version "${t}":`];r&&e.push(`library name "${i}" contains illegal characters (whitespace or "/")`),r&&s&&e.push("and"),s&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),e3.warn(e.join(" "));return}tn(new eD(`${i}-version`,()=>({library:i,version:t}),"VERSION"))}function tw(e,t){if(null!==e&&"function"!=typeof e)throw th.create("invalid-log-argument");for(let n of eF){let i=null;t&&t.level&&(i=eU[t.level]),null===e?n.userLogHandler=null:n.userLogHandler=(t,n,...r)=>{let s=r.map(e=>{if(null==e)return null;if("string"==typeof e)return e;if("number"==typeof e||"boolean"==typeof e)return e.toString();if(e instanceof Error)return e.message;try{return JSON.stringify(e)}catch(e){return null}}).filter(e=>e).join(" ");n>=(i??t.logLevel)&&e({level:w[n].toLowerCase(),message:s,args:r,type:t.name})}}}function tb(e){eF.forEach(t=>{t.setLogLevel(e)})}let tE="firebase-heartbeat-store",tT=null;function tC(){return tT||(tT=(function(e,t,{blocked:n,upgrade:i,blocking:r,terminated:s}={}){let o=indexedDB.open(e,1),a=eQ(o);return i&&o.addEventListener("upgradeneeded",e=>{i(eQ(o.result),e.oldVersion,e.newVersion,eQ(o.transaction),e)}),n&&o.addEventListener("blocked",e=>n(e.oldVersion,e.newVersion,e)),a.then(e=>{s&&e.addEventListener("close",()=>s()),r&&e.addEventListener("versionchange",e=>r(e.oldVersion,e.newVersion,e))}).catch(()=>{}),a})("firebase-heartbeat-database",0,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(tE)}catch(e){console.warn(e)}}}).catch(e=>{throw th.create("idb-open",{originalErrorMessage:e.message})})),tT}async function tI(e){try{let t=(await tC()).transaction(tE),n=await t.objectStore(tE).get(tk(e));return await t.done,n}catch(e){if(e instanceof eh)e3.warn(e.message);else{let t=th.create("idb-get",{originalErrorMessage:e?.message});e3.warn(t.message)}}}async function tS(e,t){try{let n=(await tC()).transaction(tE,"readwrite"),i=n.objectStore(tE);await i.put(t,tk(e)),await n.done}catch(e){if(e instanceof eh)e3.warn(e.message);else{let t=th.create("idb-set",{originalErrorMessage:e?.message});e3.warn(t.message)}}}function tk(e){return`${e.name}!${e.options.appId}`}class tA{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new tR(t),this._heartbeatsCachePromise=this._storage.read().then(e=>(this._heartbeatsCache=e,e))}async triggerHeartbeat(){try{let e=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),t=tN();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===t||this._heartbeatsCache.heartbeats.some(e=>e.date===t))return;if(this._heartbeatsCache.heartbeats.push({date:t,agent:e}),this._heartbeatsCache.heartbeats.length>30){let e=function(e){if(0===e.length)return -1;let t=0,n=e[0].date;for(let i=1;i<e.length;i++)e[i].date<n&&(n=e[i].date,t=i);return t}(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(e,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){e3.warn(e)}}async getHeartbeatsHeader(){try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||0===this._heartbeatsCache.heartbeats.length)return"";let e=tN(),{heartbeatsToSend:t,unsentEntries:n}=function(e,t=1024){let n=[],i=e.slice();for(let r of e){let e=n.find(e=>e.agent===r.agent);if(e){if(e.dates.push(r.date),tP(n)>t){e.dates.pop();break}}else if(n.push({agent:r.agent,dates:[r.date]}),tP(n)>t){n.pop();break}i=i.slice(1)}return{heartbeatsToSend:n,unsentEntries:i}}(this._heartbeatsCache.heartbeats),i=$(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(e){return e3.warn(e),""}}}function tN(){return new Date().toISOString().substring(0,10)}class tR{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!function(){try{return"object"==typeof indexedDB}catch(e){return!1}}()&&new Promise((e,t)=>{try{let n=!0,i="validate-browser-context-for-indexeddb-analytics-module",r=self.indexedDB.open(i);r.onsuccess=()=>{r.result.close(),n||self.indexedDB.deleteDatabase(i),e(!0)},r.onupgradeneeded=()=>{n=!1},r.onerror=()=>{t(r.error?.message||"")}}catch(e){t(e)}}).then(()=>!0).catch(()=>!1)}async read(){if(!await this._canUseIndexedDBPromise)return{heartbeats:[]};{let e=await tI(this.app);return e?.heartbeats?e:{heartbeats:[]}}}async overwrite(e){if(await this._canUseIndexedDBPromise){let t=await this.read();return tS(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??t.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){if(await this._canUseIndexedDBPromise){let t=await this.read();return tS(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??t.lastSentHeartbeatDate,heartbeats:[...t.heartbeats,...e.heartbeats]})}}}function tP(e){return $(JSON.stringify({version:2,heartbeats:e})).length}function tx(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}tn(new eD("platform-logger",e=>new e1(e),"PRIVATE")),tn(new eD("heartbeat",e=>new tA(e),"PRIVATE")),tv(e2,e6,""),tv(e2,e6,"esm2020"),tv("fire-js",""),e.s(["SDK_VERSION",()=>tf,"_DEFAULT_ENTRY_NAME",()=>e5,"_addComponent",()=>te,"_addOrOverwriteComponent",()=>tt,"_apps",()=>e8,"_clearComponents",()=>tl,"_components",()=>e9,"_getProvider",()=>ti,"_isFirebaseApp",()=>ts,"_isFirebaseServerApp",()=>ta,"_isFirebaseServerAppSettings",()=>to,"_registerComponent",()=>tn,"_removeServiceInstance",()=>tr,"_serverApps",()=>e7,"deleteApp",()=>t_,"getApp",()=>tm,"getApps",()=>ty,"initializeApp",()=>tp,"initializeServerApp",()=>tg,"onLog",()=>tw,"registerVersion",()=>tv,"setLogLevel",()=>tb],92953),tv("firebase","12.6.0","app"),e.i(92953);let tD=new eu("auth","Firebase",tx()),tO=new eB("@firebase/auth");function tL(e,...t){tO.logLevel<=w.ERROR&&tO.error(`Auth (${tf}): ${e}`,...t)}function tM(e,...t){throw tq(e,...t)}function tF(e,...t){return tq(e,...t)}function tU(e,t,n){return new eu("auth","Firebase",{...tx(),[t]:n}).create(t,{appName:e.name})}function tV(e){return tU(e,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function tq(e,...t){if("string"!=typeof e){let n=t[0],i=[...t.slice(1)];return i[0]&&(i[0].appName=e.name),e._errorFactory.create(n,...i)}return tD.create(e,...t)}function tj(e,t,...n){if(!e)throw tq(t,...n)}function tB(e){let t="INTERNAL ASSERTION FAILED: "+e;throw tL(t),Error(t)}function tz(){return"undefined"!=typeof self&&self.location?.href||""}function t$(){return"undefined"!=typeof self&&self.location?.protocol||null}class tH{constructor(e,t){var n;this.shortDelay=e,this.longDelay=t,n="Short delay should be less than long delay!",t>e||tB(n),this.isMobile=es()||ea()}get(){let e;return!("undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&("http:"===t$()||"https:"===t$()||"object"==typeof(e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0)&&void 0!==e.id||"connection"in navigator))||navigator.onLine?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function tW(e,t){var n,i;n=e.emulator,i="Emulator should always be set here",n||tB(i);let{url:r}=e.emulator;return t?`${r}${t.startsWith("/")?t.slice(1):t}`:r}class tK{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:"undefined"!=typeof globalThis&&globalThis.fetch?globalThis.fetch:"undefined"!=typeof fetch?fetch:void tB("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:"undefined"!=typeof globalThis&&globalThis.Headers?globalThis.Headers:"undefined"!=typeof Headers?Headers:void tB("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:"undefined"!=typeof globalThis&&globalThis.Response?globalThis.Response:"undefined"!=typeof Response?Response:void tB("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}let tG={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},tQ=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],tY=new tH(3e4,6e4);function tX(e,t){return e.tenantId&&!t.tenantId?{...t,tenantId:e.tenantId}:t}async function tJ(e,t,n,i,r={}){return tZ(e,r,async()=>{let r={},s={};i&&("GET"===t?s=i:r={body:JSON.stringify(i)});let o=eT({key:e.config.apiKey,...s}).slice(1),a=await e._getAdditionalHeaders();a["Content-Type"]="application/json",e.languageCode&&(a["X-Firebase-Locale"]=e.languageCode);let l={method:t,headers:a,...r};return("undefined"==typeof navigator||"Cloudflare-Workers"!==navigator.userAgent)&&(l.referrerPolicy="no-referrer"),e.emulatorConfig&&J(e.emulatorConfig.host)&&(l.credentials="include"),tK.fetch()(await t1(e,e.config.apiHost,n,o),l)})}async function tZ(e,t,n){e._canInitEmulator=!1;let i={...tG,...t};try{let t=new t2(e),r=await Promise.race([n(),t.promise]);t.clearNetworkTimeout();let s=await r.json();if("needConfirmation"in s)throw t6(e,"account-exists-with-different-credential",s);if(r.ok&&!("errorMessage"in s))return s;{let[t,n]=(r.ok?s.errorMessage:s.error.message).split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===t)throw t6(e,"credential-already-in-use",s);if("EMAIL_EXISTS"===t)throw t6(e,"email-already-in-use",s);if("USER_DISABLED"===t)throw t6(e,"user-disabled",s);let o=i[t]||t.toLowerCase().replace(/[_\s]+/g,"-");if(n)throw tU(e,o,n);tM(e,o)}}catch(t){if(t instanceof eh)throw t;tM(e,"network-request-failed",{message:String(t)})}}async function t0(e,t,n,i,r={}){let s=await tJ(e,t,n,i,r);return"mfaPendingCredential"in s&&tM(e,"multi-factor-auth-required",{_serverResponse:s}),s}async function t1(e,t,n,i){let r=`${t}${n}?${i}`,s=e.config.emulator?tW(e.config,r):`${e.config.apiScheme}://${r}`;return tQ.includes(n)&&(await e._persistenceManagerAvailable,"COOKIE"===e._getPersistenceType())?e._getPersistence()._getFinalTarget(s).toString():s}class t2{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((e,t)=>{this.timer=setTimeout(()=>t(tF(this.auth,"network-request-failed")),tY.get())})}}function t6(e,t,n){let i={appName:e.name};n.email&&(i.email=n.email),n.phoneNumber&&(i.phoneNumber=n.phoneNumber);let r=tF(e,t,i);return r.customData._tokenResponse=n,r}function t3(e){return void 0!==e&&void 0!==e.enterprise}class t5{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===e.recaptchaKey)throw Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||0===this.recaptchaEnforcementState.length)return null;for(let t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)switch(t.enforcementState){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}return null}isProviderEnabled(e){return"ENFORCE"===this.getProviderEnforcementState(e)||"AUDIT"===this.getProviderEnforcementState(e)}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function t4(e,t){return tJ(e,"GET","/v2/recaptchaConfig",tX(e,t))}async function t8(e,t){return tJ(e,"POST","/v1/accounts:delete",t)}async function t7(e,t){return tJ(e,"POST","/v1/accounts:lookup",t)}function t9(e){if(e)try{let t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(e){}}async function ne(e,t=!1){let n=ex(e),i=await n.getIdToken(t),r=nn(i);tj(r&&r.exp&&r.auth_time&&r.iat,n.auth,"internal-error");let s="object"==typeof r.firebase?r.firebase:void 0,o=s?.sign_in_provider;return{claims:r,token:i,authTime:t9(nt(r.auth_time)),issuedAtTime:t9(nt(r.iat)),expirationTime:t9(nt(r.exp)),signInProvider:o||null,signInSecondFactor:s?.sign_in_second_factor||null}}function nt(e){return 1e3*Number(e)}function nn(e){let[t,n,i]=e.split(".");if(void 0===t||void 0===n||void 0===i)return tL("JWT malformed, contained fewer than 3 sections"),null;try{let e=H(n);if(!e)return tL("Failed to decode base64 JWT payload"),null;return JSON.parse(e)}catch(e){return tL("Caught error parsing JWT payload as JSON",e?.toString()),null}}function ni(e){let t=nn(e);return tj(t,"internal-error"),tj(void 0!==t.exp,"internal-error"),tj(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}async function nr(e,t,n=!1){if(n)return t;try{return await t}catch(t){throw t instanceof eh&&function({code:e}){return"auth/user-disabled"===e||"auth/user-token-expired"===e}(t)&&e.auth.currentUser===e&&await e.auth.signOut(),t}}class ns{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){if(!e)return this.errorBackoff=3e4,Math.max(0,(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5);{let e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}}schedule(e=!1){if(!this.isRunning)return;let t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}class no{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=t9(this.lastLoginAt),this.creationTime=t9(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function na(e){var t,n;let i=e.auth,r=await e.getIdToken(),s=await nr(e,t7(i,{idToken:r}));tj(s?.users.length,i,"internal-error");let o=s.users[0];e._notifyReloadListener(o);let a=o.providerUserInfo?.length?nh(o.providerUserInfo):[],l=(t=e.providerData,n=a,[...t.filter(e=>!n.some(t=>t.providerId===e.providerId)),...n]),h=e.isAnonymous,u=!(e.email&&o.passwordHash)&&!l?.length;Object.assign(e,{uid:o.localId,displayName:o.displayName||null,photoURL:o.photoUrl||null,email:o.email||null,emailVerified:o.emailVerified||!1,phoneNumber:o.phoneNumber||null,tenantId:o.tenantId||null,providerData:l,metadata:new no(o.createdAt,o.lastLoginAt),isAnonymous:!!h&&u})}async function nl(e){let t=ex(e);await na(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}function nh(e){return e.map(({providerId:e,...t})=>({providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}))}async function nu(e,t){let n=await tZ(e,{},async()=>{let n=eT({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:i,apiKey:r}=e.config,s=await t1(e,i,"/v1/token",`key=${r}`),o=await e._getAdditionalHeaders();o["Content-Type"]="application/x-www-form-urlencoded";let a={method:"POST",headers:o,body:n};return e.emulatorConfig&&J(e.emulatorConfig.host)&&(a.credentials="include"),tK.fetch()(s,a)});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}async function nc(e,t){return tJ(e,"POST","/v2/accounts:revokeToken",tX(e,t))}class nd{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){tj(e.idToken,"internal-error"),tj(void 0!==e.idToken,"internal-error"),tj(void 0!==e.refreshToken,"internal-error");let t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):ni(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){tj(0!==e.length,"internal-error");let t=ni(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return t||!this.accessToken||this.isExpired?(tj(this.refreshToken,e,"user-token-expired"),this.refreshToken)?(await this.refresh(e,this.refreshToken),this.accessToken):null:this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){let{accessToken:n,refreshToken:i,expiresIn:r}=await nu(e,t);this.updateTokensAndExpiration(n,i,Number(r))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){let{refreshToken:n,accessToken:i,expirationTime:r}=t,s=new nd;return n&&(tj("string"==typeof n,"internal-error",{appName:e}),s.refreshToken=n),i&&(tj("string"==typeof i,"internal-error",{appName:e}),s.accessToken=i),r&&(tj("number"==typeof r,"internal-error",{appName:e}),s.expirationTime=r),s}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new nd,this.toJSON())}_performRefresh(){return tB("not implemented")}}function nf(e,t){tj("string"==typeof e||void 0===e,"internal-error",{appName:t})}class np{constructor({uid:e,auth:t,stsTokenManager:n,...i}){this.providerId="firebase",this.proactiveRefresh=new ns(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=n,this.accessToken=n.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new no(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){let t=await nr(this,this.stsTokenManager.getToken(this.auth,e));return tj(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return ne(this,e)}reload(){return nl(this)}_assign(e){this!==e&&(tj(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(e=>({...e})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){let t=new np({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return t.metadata._copy(this.metadata),t}_onReload(e){tj(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await na(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(ta(this.auth.app))return Promise.reject(tV(this.auth));let e=await this.getIdToken();return await nr(this,t8(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){let n=t.displayName??void 0,i=t.email??void 0,r=t.phoneNumber??void 0,s=t.photoURL??void 0,o=t.tenantId??void 0,a=t._redirectEventId??void 0,l=t.createdAt??void 0,h=t.lastLoginAt??void 0,{uid:u,emailVerified:c,isAnonymous:d,providerData:f,stsTokenManager:p}=t;tj(u&&p,e,"internal-error");let g=nd.fromJSON(this.name,p);tj("string"==typeof u,e,"internal-error"),nf(n,e.name),nf(i,e.name),tj("boolean"==typeof c,e,"internal-error"),tj("boolean"==typeof d,e,"internal-error"),nf(r,e.name),nf(s,e.name),nf(o,e.name),nf(a,e.name),nf(l,e.name),nf(h,e.name);let m=new np({uid:u,auth:e,email:i,emailVerified:c,displayName:n,isAnonymous:d,photoURL:s,phoneNumber:r,tenantId:o,stsTokenManager:g,createdAt:l,lastLoginAt:h});return f&&Array.isArray(f)&&(m.providerData=f.map(e=>({...e}))),a&&(m._redirectEventId=a),m}static async _fromIdTokenResponse(e,t,n=!1){let i=new nd;i.updateFromServerResponse(t);let r=new np({uid:t.localId,auth:e,stsTokenManager:i,isAnonymous:n});return await na(r),r}static async _fromGetAccountInfoResponse(e,t,n){let i=t.users[0];tj(void 0!==i.localId,"internal-error");let r=void 0!==i.providerUserInfo?nh(i.providerUserInfo):[],s=!(i.email&&i.passwordHash)&&!r?.length,o=new nd;o.updateFromIdToken(n);let a=new np({uid:i.localId,auth:e,stsTokenManager:o,isAnonymous:s});return Object.assign(a,{uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:r,metadata:new no(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash)&&!r?.length}),a}}let ng=new Map;function nm(e){var t,n;t="Expected a class definition",e instanceof Function||tB(t);let i=ng.get(e);return i?(n="Instance stored in cache mismatched with class",i instanceof e||tB(n)):(i=new e,ng.set(e,i)),i}class ny{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){let t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}function n_(e,t,n){return`firebase:${e}:${t}:${n}`}ny.type="NONE";class nv{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:i,name:r}=this.auth;this.fullUserKey=n_(this.userKey,i.apiKey,r),this.fullPersistenceKey=n_("persistence",i.apiKey,r),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){let e=await this.persistence._get(this.fullUserKey);if(!e)return null;if("string"==typeof e){let t=await t7(this.auth,{idToken:e}).catch(()=>void 0);return t?np._fromGetAccountInfoResponse(this.auth,t,e):null}return np._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;let t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,n="authUser"){if(!t.length)return new nv(nm(ny),e,n);let i=(await Promise.all(t.map(async e=>{if(await e._isAvailable())return e}))).filter(e=>e),r=i[0]||nm(ny),s=n_(n,e.config.apiKey,e.name),o=null;for(let n of t)try{let t=await n._get(s);if(t){let i;if("string"==typeof t){let n=await t7(e,{idToken:t}).catch(()=>void 0);if(!n)break;i=await np._fromGetAccountInfoResponse(e,n,t)}else i=np._fromJSON(e,t);n!==r&&(o=i),r=n;break}}catch{}let a=i.filter(e=>e._shouldAllowMigration);return r._shouldAllowMigration&&a.length&&(r=a[0],o&&await r._set(s,o.toJSON()),await Promise.all(t.map(async e=>{if(e!==r)try{await e._remove(s)}catch{}}))),new nv(r,e,n)}}function nw(e){let t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";{if(nC(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(nb(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(nS(t))return"Blackberry";if(nk(t))return"Webos";if(nE(t))return"Safari";if((t.includes("chrome/")||nT(t))&&!t.includes("edge/"))return"Chrome";if(nI(t))return"Android";let n=e.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/);if(n?.length===2)return n[1]}return"Other"}function nb(e=er()){return/firefox\//i.test(e)}function nE(e=er()){let t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function nT(e=er()){return/crios\//i.test(e)}function nC(e=er()){return/iemobile/i.test(e)}function nI(e=er()){return/android/i.test(e)}function nS(e=er()){return/blackberry/i.test(e)}function nk(e=er()){return/webos/i.test(e)}function nA(e=er()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function nN(e=er()){return nA(e)||nI(e)||nk(e)||nS(e)||/windows phone/i.test(e)||nC(e)}function nR(e,t=[]){let n;switch(e){case"Browser":n=nw(er());break;case"Worker":n=`${nw(er())}-${e}`;break;default:n=e}let i=t.length?t.join(","):"FirebaseCore-web";return`${n}/JsCore/${tf}/${i}`}class nP{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){let n=t=>new Promise((n,i)=>{try{let i=e(t);n(i)}catch(e){i(e)}});n.onAbort=t,this.queue.push(n);let i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;let t=[];try{for(let n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(e){for(let e of(t.reverse(),t))try{e()}catch(e){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:e?.message})}}}async function nx(e,t={}){return tJ(e,"GET","/v2/passwordPolicy",tX(e,t))}class nD{constructor(e){const t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??6,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),void 0!==t.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),void 0!==t.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),void 0!==t.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),void 0!==t.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=e.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){let t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){let n=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;n&&(t.meetsMinPasswordLength=e.length>=n),i&&(t.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,t){let n;this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);for(let i=0;i<e.length;i++)n=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(t,n>="a"&&n<="z",n>="A"&&n<="Z",n>="0"&&n<="9",this.allowedNonAlphanumericCharacters.includes(n))}updatePasswordCharacterOptionsStatuses(e,t,n,i,r){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=n)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=r))}}class nO{constructor(e,t,n,i){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=n,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new nL(this),this.idTokenSubscription=new nL(this),this.beforeStateQueue=new nP(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=tD,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion,this._persistenceManagerAvailable=new Promise(e=>this._resolvePersistenceManagerAvailable=e)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=nm(t)),this._initializationPromise=this.queue(async()=>{if(!this._deleted){if(this.persistenceManager=await nv.create(this,e),this._resolvePersistenceManagerAvailable?.(),!this._deleted){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(e){}await this.initializeCurrentUser(t),this.lastNotifiedUid=this.currentUser?.uid||null,this._deleted||(this._isInitialized=!0)}}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;let e=await this.assertedPersistence.getCurrentUser();if(this.currentUser||e){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{let t=await t7(this,{idToken:e}),n=await np._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(n)}catch(e){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",e),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){if(ta(this.app)){let e=this.app.settings.authIdToken;return e?new Promise(t=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(e).then(t,t))}):this.directlySetCurrentUser(null)}let t=await this.assertedPersistence.getCurrentUser(),n=t,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();let t=this.redirectUser?._redirectEventId,r=n?._redirectEventId,s=await this.tryRedirectSignIn(e);(!t||t===r)&&s?.user&&(n=s.user,i=!0)}if(!n)return this.directlySetCurrentUser(null);if(!n._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(n)}catch(e){n=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(e))}return n?this.reloadAndSetCurrentUserOrClear(n):this.directlySetCurrentUser(null)}return(tj(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===n._redirectEventId)?this.directlySetCurrentUser(n):this.reloadAndSetCurrentUserOrClear(n)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(e){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await na(e)}catch(e){if(e?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;let e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(ta(this.app))return Promise.reject(tV(this));let t=e?ex(e):null;return t&&tj(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&tj(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return ta(this.app)?Promise.reject(tV(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return ta(this.app)?Promise.reject(tV(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(nm(e))})}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();let t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){let e=new nD(await nx(this));null===this.tenantId?this._projectPasswordPolicy=e:this._tenantPasswordPolicies[this.tenantId]=e}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new eu("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{let n=this.onAuthStateChanged(()=>{n(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){let t={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:await this.currentUser.getIdToken()};null!=this.tenantId&&(t.tenantId=this.tenantId),await nc(this,t)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(e,t){let n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){let t=e&&nm(e)||this._popupRedirectResolver;tj(t,this,"argument-error"),this.redirectPersistenceManager=await nv.create(this,[nm(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){return(this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===e)?this._currentUser:this.redirectUser?._redirectEventId===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);let e=this.currentUser?.uid??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,i){if(this._deleted)return()=>{};let r="function"==typeof t?t:t.next.bind(t),s=!1,o=this._isInitialized?Promise.resolve():this._initializationPromise;if(tj(o,this,"internal-error"),o.then(()=>{s||r(this.currentUser)}),"function"==typeof t){let r=e.addObserver(t,n,i);return()=>{s=!0,r()}}{let n=e.addObserver(t);return()=>{s=!0,n()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return tj(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=nR(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){let e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);let t=await this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();t&&(e["X-Firebase-Client"]=t);let n=await this._getAppCheckToken();return n&&(e["X-Firebase-AppCheck"]=n),e}async _getAppCheckToken(){if(ta(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;let e=await this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return e?.error&&function(e,...t){tO.logLevel<=w.WARN&&tO.warn(`Auth (${tf}): ${e}`,...t)}(`Error while retrieving App Check token: ${e.error}`),e?.token}}class nL{constructor(e){this.auth=e,this.observer=null,this.addObserver=function(e,t){let n=new ek(e,void 0);return n.subscribe.bind(n)}(e=>this.observer=e)}get next(){return tj(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let nM={async loadJS(){throw Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function nF(e){return`__${e}${Math.floor(1e6*Math.random())}`}class nU{constructor(){this.enterprise=new nV}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class nV{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}let nq="NO_RECAPTCHA";class nj{constructor(e){this.type="recaptcha-enterprise",this.auth=ex(e)}async verify(e="verify",t=!1){async function n(e){if(!t){if(null==e.tenantId&&null!=e._agentRecaptchaConfig)return e._agentRecaptchaConfig.siteKey;if(null!=e.tenantId&&void 0!==e._tenantRecaptchaConfigs[e.tenantId])return e._tenantRecaptchaConfigs[e.tenantId].siteKey}return new Promise(async(t,n)=>{t4(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(i=>{if(void 0===i.recaptchaKey)n(Error("recaptcha Enterprise site key undefined"));else{let n=new t5(i);return null==e.tenantId?e._agentRecaptchaConfig=n:e._tenantRecaptchaConfigs[e.tenantId]=n,t(n.siteKey)}}).catch(e=>{n(e)})})}function i(t,n,i){let r=window.grecaptcha;t3(r)?r.enterprise.ready(()=>{r.enterprise.execute(t,{action:e}).then(e=>{n(e)}).catch(()=>{n(nq)})}):i(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new nU().execute("siteKey",{action:"verify"}):new Promise((e,r)=>{n(this.auth).then(n=>{if(!t&&t3(window.grecaptcha))i(n,e,r);else{var s;if("undefined"==typeof window)return void r(Error("RecaptchaVerifier is only supported in browser"));let t=nM.recaptchaEnterpriseScript;0!==t.length&&(t+=n),(s=t,nM.loadJS(s)).then(()=>{i(n,e,r)}).catch(e=>{r(e)})}}).catch(e=>{r(e)})})}}async function nB(e,t,n,i=!1,r=!1){let s,o=new nj(e);if(r)s=nq;else try{s=await o.verify(n)}catch(e){s=await o.verify(n,!0)}let a={...t};if("mfaSmsEnrollment"===n||"mfaSmsSignIn"===n){if("phoneEnrollmentInfo"in a){let e=a.phoneEnrollmentInfo.phoneNumber,t=a.phoneEnrollmentInfo.recaptchaToken;Object.assign(a,{phoneEnrollmentInfo:{phoneNumber:e,recaptchaToken:t,captchaResponse:s,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in a){let e=a.phoneSignInInfo.recaptchaToken;Object.assign(a,{phoneSignInInfo:{recaptchaToken:e,captchaResponse:s,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return a}return i?Object.assign(a,{captchaResp:s}):Object.assign(a,{captchaResponse:s}),Object.assign(a,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(a,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),a}async function nz(e,t,n,i,r){if("EMAIL_PASSWORD_PROVIDER"===r)if(!e._getRecaptchaConfig()?.isProviderEnabled("EMAIL_PASSWORD_PROVIDER"))return i(e,t).catch(async r=>{if("auth/missing-recaptcha-token"!==r.code)return Promise.reject(r);{console.log(`${n} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);let r=await nB(e,t,n,"getOobCode"===n);return i(e,r)}});else{let r=await nB(e,t,n,"getOobCode"===n);return i(e,r)}if("PHONE_PROVIDER"!==r)return Promise.reject(r+" provider is not supported.");if(e._getRecaptchaConfig()?.isProviderEnabled("PHONE_PROVIDER")){let r=await nB(e,t,n);return i(e,r).catch(async r=>{if(e._getRecaptchaConfig()?.getProviderEnforcementState("PHONE_PROVIDER")==="AUDIT"&&("auth/missing-recaptcha-token"===r.code||"auth/invalid-app-credential"===r.code)){console.log(`Failed to verify with reCAPTCHA Enterprise. Automatically triggering the reCAPTCHA v2 flow to complete the ${n} flow.`);let r=await nB(e,t,n,!1,!0);return i(e,r)}return Promise.reject(r)})}{let r=await nB(e,t,n,!1,!0);return i(e,r)}}async function n$(e){let t=ex(e),n=new t5(await t4(t,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}));null==t.tenantId?t._agentRecaptchaConfig=n:t._tenantRecaptchaConfigs[t.tenantId]=n,n.isAnyProviderEnabled()&&new nj(t).verify()}function nH(e){let t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function nW(e){if(!e)return null;let t=Number(e);return isNaN(t)?null:t}class nK{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return tB("not implemented")}_getIdTokenResponse(e){return tB("not implemented")}_linkToIdToken(e,t){return tB("not implemented")}_getReauthenticationResolver(e){return tB("not implemented")}}async function nG(e,t){return tJ(e,"POST","/v1/accounts:signUp",t)}async function nQ(e,t){return t0(e,"POST","/v1/accounts:signInWithPassword",tX(e,t))}async function nY(e,t){return t0(e,"POST","/v1/accounts:signInWithEmailLink",tX(e,t))}async function nX(e,t){return t0(e,"POST","/v1/accounts:signInWithEmailLink",tX(e,t))}class nJ extends nK{constructor(e,t,n,i=null){super("password",n),this._email=e,this._password=t,this._tenantId=i}static _fromEmailAndPassword(e,t){return new nJ(e,t,"password")}static _fromEmailAndCode(e,t,n=null){return new nJ(e,t,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){let t="string"==typeof e?JSON.parse(e):e;if(t?.email&&t?.password){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);else if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return nz(e,{returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signInWithPassword",nQ,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return nY(e,{email:this._email,oobCode:this._password});default:tM(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return nz(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",nG,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return nX(e,{idToken:t,email:this._email,oobCode:this._password});default:tM(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function nZ(e,t){return t0(e,"POST","/v1/accounts:signInWithIdp",tX(e,t))}class n0 extends nK{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){let t=new n0(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):tM("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){let{providerId:t,signInMethod:n,...i}="string"==typeof e?JSON.parse(e):e;if(!t||!n)return null;let r=new n0(t,n);return r.idToken=i.idToken||void 0,r.accessToken=i.accessToken||void 0,r.secret=i.secret,r.nonce=i.nonce,r.pendingToken=i.pendingToken||null,r}_getIdTokenResponse(e){return nZ(e,this.buildRequest())}_linkToIdToken(e,t){let n=this.buildRequest();return n.idToken=t,nZ(e,n)}_getReauthenticationResolver(e){let t=this.buildRequest();return t.autoCreate=!1,nZ(e,t)}buildRequest(){let e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{let t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=eT(t)}return e}}async function n1(e,t){return tJ(e,"POST","/v1/accounts:sendVerificationCode",tX(e,t))}async function n2(e,t){return t0(e,"POST","/v1/accounts:signInWithPhoneNumber",tX(e,t))}async function n6(e,t){let n=await t0(e,"POST","/v1/accounts:signInWithPhoneNumber",tX(e,t));if(n.temporaryProof)throw t6(e,"account-exists-with-different-credential",n);return n}let n3={USER_NOT_FOUND:"user-not-found"};async function n5(e,t){return t0(e,"POST","/v1/accounts:signInWithPhoneNumber",tX(e,{...t,operation:"REAUTH"}),n3)}class n4 extends nK{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new n4({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new n4({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return n2(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return n6(e,{idToken:t,...this._makeVerificationRequest()})}_getReauthenticationResolver(e){return n5(e,this._makeVerificationRequest())}_makeVerificationRequest(){let{temporaryProof:e,phoneNumber:t,verificationId:n,verificationCode:i}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:n,code:i}}toJSON(){let e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){"string"==typeof e&&(e=JSON.parse(e));let{verificationId:t,verificationCode:n,phoneNumber:i,temporaryProof:r}=e;return n||t||i||r?new n4({verificationId:t,verificationCode:n,phoneNumber:i,temporaryProof:r}):null}}class n8{constructor(e){const t=eC(eI(e)),n=t.apiKey??null,i=t.oobCode??null,r=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(t.mode??null);tj(n&&i&&r,"argument-error"),this.apiKey=n,this.operation=r,this.code=i,this.continueUrl=t.continueUrl??null,this.languageCode=t.lang??null,this.tenantId=t.tenantId??null}static parseLink(e){let t,n,i,r=(n=(t=eC(eI(e)).link)?eC(eI(t)).deep_link_id:null,((i=eC(eI(e)).deep_link_id)?eC(eI(i)).link:null)||i||n||t||e);try{return new n8(r)}catch{return null}}}class n7{constructor(){this.providerId=n7.PROVIDER_ID}static credential(e,t){return nJ._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){let n=n8.parseLink(t);return tj(n,"argument-error"),nJ._fromEmailAndCode(e,n.code,n.tenantId)}}n7.PROVIDER_ID="password",n7.EMAIL_PASSWORD_SIGN_IN_METHOD="password",n7.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class n9{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class ie extends n9{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class it extends ie{constructor(){super("facebook.com")}static credential(e){return n0._fromParams({providerId:it.PROVIDER_ID,signInMethod:it.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return it.credentialFromTaggedObject(e)}static credentialFromError(e){return it.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return it.credential(e.oauthAccessToken)}catch{return null}}}it.FACEBOOK_SIGN_IN_METHOD="facebook.com",it.PROVIDER_ID="facebook.com";class ii extends ie{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return n0._fromParams({providerId:ii.PROVIDER_ID,signInMethod:ii.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return ii.credentialFromTaggedObject(e)}static credentialFromError(e){return ii.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{oauthIdToken:t,oauthAccessToken:n}=e;if(!t&&!n)return null;try{return ii.credential(t,n)}catch{return null}}}ii.GOOGLE_SIGN_IN_METHOD="google.com",ii.PROVIDER_ID="google.com";class ir extends ie{constructor(){super("github.com")}static credential(e){return n0._fromParams({providerId:ir.PROVIDER_ID,signInMethod:ir.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return ir.credentialFromTaggedObject(e)}static credentialFromError(e){return ir.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return ir.credential(e.oauthAccessToken)}catch{return null}}}ir.GITHUB_SIGN_IN_METHOD="github.com",ir.PROVIDER_ID="github.com";class is extends ie{constructor(){super("twitter.com")}static credential(e,t){return n0._fromParams({providerId:is.PROVIDER_ID,signInMethod:is.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return is.credentialFromTaggedObject(e)}static credentialFromError(e){return is.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{oauthAccessToken:t,oauthTokenSecret:n}=e;if(!t||!n)return null;try{return is.credential(t,n)}catch{return null}}}is.TWITTER_SIGN_IN_METHOD="twitter.com",is.PROVIDER_ID="twitter.com";class io{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n,i=!1){return new io({user:await np._fromIdTokenResponse(e,n,i),providerId:ia(n),_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){return await e._updateTokensIfNecessary(n,!0),new io({user:e,providerId:ia(n),_tokenResponse:n,operationType:t})}}function ia(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}class il extends eh{constructor(e,t,n,i){super(t.code,t.message),this.operationType=n,this.user=i,Object.setPrototypeOf(this,il.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,i){return new il(e,t,n,i)}}function ih(e,t,n,i){return("reauthenticate"===t?n._getReauthenticationResolver(e):n._getIdTokenResponse(e)).catch(n=>{if("auth/multi-factor-auth-required"===n.code)throw il._fromErrorAndOperation(e,n,t,i);throw n})}async function iu(e,t,n=!1){let i=await nr(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return io._forOperation(e,"link",i)}async function ic(e,t,n=!1){let{auth:i}=e;if(ta(i.app))return Promise.reject(tV(i));let r="reauthenticate";try{let s=await nr(e,ih(i,r,t,e),n);tj(s.idToken,i,"internal-error");let o=nn(s.idToken);tj(o,i,"internal-error");let{sub:a}=o;return tj(e.uid===a,i,"user-mismatch"),io._forOperation(e,r,s)}catch(e){throw e?.code==="auth/user-not-found"&&tM(i,"user-mismatch"),e}}async function id(e,t,n=!1){if(ta(e.app))return Promise.reject(tV(e));let i="signIn",r=await ih(e,i,t),s=await io._fromIdTokenResponse(e,i,r);return n||await e._updateCurrentUser(s.user),s}class ip{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?ig._fromServerResponse(e,t):"totpInfo"in t?im._fromServerResponse(e,t):tM(e,"internal-error")}}class ig extends ip{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new ig(t)}}class im extends ip{constructor(e){super("totp",e)}static _fromServerResponse(e,t){return new im(t)}}function iy(e,t){return tJ(e,"POST","/v2/accounts/mfaEnrollment:start",tX(e,t))}new WeakMap;let i_="__sak";class iv{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{if(!this.storage)return Promise.resolve(!1);return this.storage.setItem(i_,"1"),this.storage.removeItem(i_),Promise.resolve(!0)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){let t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class iw extends iv{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=nN(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(let t of Object.keys(this.listeners)){let n=this.storage.getItem(t),i=this.localCache[t];n!==i&&e(t,i,n)}}onStorageEvent(e,t=!1){let n;if(!e.key)return void this.forAllChangedKeys((e,t,n)=>{this.notifyListeners(e,n)});let i=e.key;t?this.detachListener():this.stopPolling();let r=()=>{let e=this.storage.getItem(i);(t||this.localCache[i]!==e)&&this.notifyListeners(i,e)},s=this.storage.getItem(i);((n=er()).indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0)&&10===document.documentMode&&s!==e.newValue&&e.newValue!==e.oldValue?setTimeout(r,10):r()}notifyListeners(e,t){this.localCache[e]=t;let n=this.listeners[e];if(n)for(let e of Array.from(n))e(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){let t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}iw.type="LOCAL";class ib extends iv{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}ib.type="SESSION";class iE{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){let t=this.receivers.find(t=>t.isListeningto(e));if(t)return t;let n=new iE(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){let{eventId:t,eventType:n,data:i}=e.data,r=this.handlersMap[n];if(!r?.size)return;e.ports[0].postMessage({status:"ack",eventId:t,eventType:n});let s=Array.from(r).map(async t=>t(e.origin,i)),o=await Promise.all(s.map(async e=>{try{let t=await e;return{fulfilled:!0,value:t}}catch(e){return{fulfilled:!1,reason:e}}}));e.ports[0].postMessage({status:"done",eventId:t,eventType:n,response:o})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function iT(e="",t=10){let n="";for(let e=0;e<t;e++)n+=Math.floor(10*Math.random());return e+n}iE.receivers=[];class iC{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,n=50){let i,r,s="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!s)throw Error("connection_unavailable");return new Promise((o,a)=>{let l=iT("",20);s.port1.start();let h=setTimeout(()=>{a(Error("unsupported_event"))},n);r={messageChannel:s,onMessage(e){if(e.data.eventId===l)switch(e.data.status){case"ack":clearTimeout(h),i=setTimeout(()=>{a(Error("timeout"))},3e3);break;case"done":clearTimeout(i),o(e.data.response);break;default:clearTimeout(h),clearTimeout(i),a(Error("invalid_response"))}}},this.handlers.add(r),s.port1.addEventListener("message",r.onMessage),this.target.postMessage({eventType:e,eventId:l,data:t},[s.port2])}).finally(()=>{r&&this.removeMessageHandler(r)})}}function iI(){return window}function iS(){return void 0!==iI().WorkerGlobalScope&&"function"==typeof iI().importScripts}async function ik(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}let iA="firebaseLocalStorageDb",iN="firebaseLocalStorage",iR="fbase_key";class iP{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function ix(e,t){return e.transaction([iN],t?"readwrite":"readonly").objectStore(iN)}function iD(){let e=indexedDB.open(iA,1);return new Promise((t,n)=>{e.addEventListener("error",()=>{n(e.error)}),e.addEventListener("upgradeneeded",()=>{let t=e.result;try{t.createObjectStore(iN,{keyPath:iR})}catch(e){n(e)}}),e.addEventListener("success",async()=>{let n=e.result;n.objectStoreNames.contains(iN)?t(n):(n.close(),await new iP(indexedDB.deleteDatabase(iA)).toPromise(),t(await iD()))})})}async function iO(e,t,n){return new iP(ix(e,!0).put({[iR]:t,value:n})).toPromise()}async function iL(e,t){let n=ix(e,!1).get(t),i=await new iP(n).toPromise();return void 0===i?null:i.value}function iM(e,t){return new iP(ix(e,!0).delete(t)).toPromise()}class iF{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db||(this.db=await iD()),this.db}async _withRetries(e){let t=0;for(;;)try{let t=await this._openDb();return await e(t)}catch(e){if(t++>3)throw e;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return iS()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=iE._getInstance(iS()?self:null),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){if(this.activeServiceWorker=await ik(),!this.activeServiceWorker)return;this.sender=new iC(this.activeServiceWorker);let e=await this.sender._send("ping",{},800);e&&e[0]?.fulfilled&&e[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(this.sender&&this.activeServiceWorker&&(navigator?.serviceWorker?.controller||null)===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;let e=await iD();return await iO(e,i_,"1"),await iM(e,i_),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(n=>iO(n,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){let t=await this._withRetries(t=>iL(t,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>iM(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){let e=await this._withRetries(e=>new iP(ix(e,!1).getAll()).toPromise());if(!e||0!==this.pendingWrites)return[];let t=[],n=new Set;if(0!==e.length)for(let{fbase_key:i,value:r}of e)n.add(i),JSON.stringify(this.localCache[i])!==JSON.stringify(r)&&(this.notifyListeners(i,r),t.push(i));for(let e of Object.keys(this.localCache))this.localCache[e]&&!n.has(e)&&(this.notifyListeners(e,null),t.push(e));return t}notifyListeners(e,t){this.localCache[e]=t;let n=this.listeners[e];if(n)for(let e of Array.from(n))e(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}function iU(e,t){return tJ(e,"POST","/v2/accounts/mfaSignIn:start",tX(e,t))}iF.type="LOCAL",nF("rcb"),new tH(3e4,6e4);let iV="recaptcha";async function iq(e,t,n){if(!e._getRecaptchaConfig())try{await n$(e)}catch(e){console.log("Failed to initialize reCAPTCHA Enterprise config. Triggering the reCAPTCHA v2 verification.")}try{let i;if(i="string"==typeof t?{phoneNumber:t}:t,"session"in i){let t=i.session;if("phoneNumber"in i){tj("enroll"===t.type,e,"internal-error");let r={idToken:t.credential,phoneEnrollmentInfo:{phoneNumber:i.phoneNumber,clientType:"CLIENT_TYPE_WEB"}},s=async(e,t)=>{if(t.phoneEnrollmentInfo.captchaResponse===nq){tj(n?.type===iV,e,"argument-error");let i=await ij(e,t,n);return iy(e,i)}return iy(e,t)},o=nz(e,r,"mfaSmsEnrollment",s,"PHONE_PROVIDER");return(await o.catch(e=>Promise.reject(e))).phoneSessionInfo.sessionInfo}{tj("signin"===t.type,e,"internal-error");let r=i.multiFactorHint?.uid||i.multiFactorUid;tj(r,e,"missing-multi-factor-info");let s={mfaPendingCredential:t.credential,mfaEnrollmentId:r,phoneSignInInfo:{clientType:"CLIENT_TYPE_WEB"}},o=async(e,t)=>{if(t.phoneSignInInfo.captchaResponse===nq){tj(n?.type===iV,e,"argument-error");let i=await ij(e,t,n);return iU(e,i)}return iU(e,t)},a=nz(e,s,"mfaSmsSignIn",o,"PHONE_PROVIDER");return(await a.catch(e=>Promise.reject(e))).phoneResponseInfo.sessionInfo}}{let t={phoneNumber:i.phoneNumber,clientType:"CLIENT_TYPE_WEB"},r=async(e,t)=>{if(t.captchaResponse===nq){tj(n?.type===iV,e,"argument-error");let i=await ij(e,t,n);return n1(e,i)}return n1(e,t)},s=nz(e,t,"sendVerificationCode",r,"PHONE_PROVIDER");return(await s.catch(e=>Promise.reject(e))).sessionInfo}}finally{n?._reset()}}async function ij(e,t,n){tj(n.type===iV,e,"argument-error");let i=await n.verify();tj("string"==typeof i,e,"argument-error");let r={...t};if("phoneEnrollmentInfo"in r){let e=r.phoneEnrollmentInfo.phoneNumber,t=r.phoneEnrollmentInfo.captchaResponse,n=r.phoneEnrollmentInfo.clientType,s=r.phoneEnrollmentInfo.recaptchaVersion;return Object.assign(r,{phoneEnrollmentInfo:{phoneNumber:e,recaptchaToken:i,captchaResponse:t,clientType:n,recaptchaVersion:s}}),r}if(!("phoneSignInInfo"in r))return Object.assign(r,{recaptchaToken:i}),r;{let e=r.phoneSignInInfo.captchaResponse,t=r.phoneSignInInfo.clientType,n=r.phoneSignInInfo.recaptchaVersion;return Object.assign(r,{phoneSignInInfo:{recaptchaToken:i,captchaResponse:e,clientType:t,recaptchaVersion:n}}),r}}class iB{constructor(e){this.providerId=iB.PROVIDER_ID,this.auth=ex(e)}verifyPhoneNumber(e,t){return iq(this.auth,e,ex(t))}static credential(e,t){return n4._fromVerification(e,t)}static credentialFromResult(e){return iB.credentialFromTaggedObject(e)}static credentialFromError(e){return iB.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{phoneNumber:t,temporaryProof:n}=e;return t&&n?n4._fromTokenResponse(t,n):null}}iB.PROVIDER_ID="phone",iB.PHONE_SIGN_IN_METHOD="phone";class iz extends nK{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return nZ(e,this._buildIdpRequest())}_linkToIdToken(e,t){return nZ(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return nZ(e,this._buildIdpRequest())}_buildIdpRequest(e){let t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function i$(e){return id(e.auth,new iz(e),e.bypassAuthState)}function iH(e){let{auth:t,user:n}=e;return tj(n,t,"internal-error"),ic(n,new iz(e),e.bypassAuthState)}async function iW(e){let{auth:t,user:n}=e;return tj(n,t,"internal-error"),iu(n,new iz(e),e.bypassAuthState)}class iK{constructor(e,t,n,i,r=!1){this.auth=e,this.resolver=n,this.user=i,this.bypassAuthState=r,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(e){this.reject(e)}})}async onAuthEvent(e){let{urlResponse:t,sessionId:n,postBody:i,tenantId:r,error:s,type:o}=e;if(s)return void this.reject(s);let a={auth:this.auth,requestUri:t,sessionId:n,tenantId:r||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(o)(a))}catch(e){this.reject(e)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return i$;case"linkViaPopup":case"linkViaRedirect":return iW;case"reauthViaPopup":case"reauthViaRedirect":return iH;default:tM(this.auth,"internal-error")}}resolve(e){var t,n;t=this.pendingPromise,n="Pending promise was never set",t||tB(n),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){var t,n;t=this.pendingPromise,n="Pending promise was never set",t||tB(n),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}let iG=new tH(2e3,1e4);class iQ extends iK{constructor(e,t,n,i,r){super(e,t,i,r),this.provider=n,this.authWindow=null,this.pollId=null,iQ.currentPopupAction&&iQ.currentPopupAction.cancel(),iQ.currentPopupAction=this}async executeNotNull(){let e=await this.execute();return tj(e,this.auth,"internal-error"),e}async onExecution(){var e,t;e=1===this.filter.length,t="Popup operations only handle one event",e||tB(t);let n=iT();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],n),this.authWindow.associatedEvent=n,this.resolver._originValidation(this.auth).catch(e=>{this.reject(e)}),this.resolver._isIframeWebStorageSupported(this.auth,e=>{e||this.reject(tF(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){return this.authWindow?.associatedEvent||null}cancel(){this.reject(tF(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,iQ.currentPopupAction=null}pollUserCancellation(){let e=()=>{if(this.authWindow?.window?.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(tF(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,iG.get())};e()}}iQ.currentPopupAction=null;let iY=new Map;class iX extends iK{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}async execute(){let e=iY.get(this.auth._key());if(!e){try{let t=await iJ(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(t)}catch(t){e=()=>Promise.reject(t)}iY.set(this.auth._key(),e)}return this.bypassAuthState||iY.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"===e.type)return void this.resolve(null);if(e.eventId){let t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function iJ(e,t){var n;let i=n_("pendingRedirect",(n=t).config.apiKey,n.name),r=nm(e._redirectPersistence);if(!await r._isAvailable())return!1;let s=await r._get(i)==="true";return await r._remove(i),s}function iZ(e,t){iY.set(e._key(),t)}async function i0(e,t,n=!1){if(ta(e.app))return Promise.reject(tV(e));let i=ex(e),r=t?nm(t):(tj(i._popupRedirectResolver,i,"argument-error"),i._popupRedirectResolver),s=new iX(i,r,n),o=await s.execute();return o&&!n&&(delete o.user._redirectEventId,await i._persistUserIfCurrent(o.user),await i._setRedirectUser(null,t)),o}class i1{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return i6(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){if(e.error&&!i6(e)){let n=e.error.code?.split("auth/")[1]||"internal-error";t.onError(tF(this.auth,n))}else t.onAuthEvent(e)}isEventForConsumer(e,t){let n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(i2(e))}saveEventToCache(e){this.cachedEventUids.add(i2(e)),this.lastProcessedEventTime=Date.now()}}function i2(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter(e=>e).join("-")}function i6({type:e,error:t}){return"unknown"===e&&t?.code==="auth/no-auth-event"}async function i3(e,t={}){return tJ(e,"GET","/v1/projects",t)}let i5=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,i4=/^https?/;async function i8(e){if(e.config.emulator)return;let{authorizedDomains:t}=await i3(e);for(let e of t)try{if(function(e){let t=tz(),{protocol:n,hostname:i}=new URL(t);if(e.startsWith("chrome-extension://")){let r=new URL(e);return""===r.hostname&&""===i?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&r.hostname===i}if(!i4.test(n))return!1;if(i5.test(e))return i===e;let r=e.replace(/\./g,"\\.");return RegExp("^(.+\\."+r+"|"+r+")$","i").test(i)}(e))return}catch{}tM(e,"unauthorized-domain")}let i7=new tH(3e4,6e4);function i9(){let e=iI().___jsl;if(e?.H){for(let t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let t=0;t<e.CP.length;t++)e.CP[t]=null}}let re=null,rt=new tH(5e3,15e3),rn={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},ri=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);async function rr(e){let t,n,i,r,s,o=await (re=re||new Promise((t,n)=>{function i(){i9(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{i9(),n(tF(e,"network-request-failed"))},timeout:i7.get()})}if(iI().gapi?.iframes?.Iframe)t(gapi.iframes.getContext());else if(iI().gapi?.load)i();else{var r;let t=nF("iframefcb");return iI()[t]=()=>{gapi.load?i():n(tF(e,"network-request-failed"))},(r=`${nM.gapiScript}?onload=${t}`,nM.loadJS(r)).catch(e=>n(e))}}).catch(e=>{throw re=null,e})),a=iI().gapi;return tj(a,e,"internal-error"),o.open({where:document.body,url:(tj((t=e.config).authDomain,e,"auth-domain-config-required"),n=t.emulator?tW(t,"emulator/auth/iframe"):`https://${e.config.authDomain}/__/auth/iframe`,i={apiKey:t.apiKey,appName:e.name,v:tf},(r=ri.get(e.config.apiHost))&&(i.eid=r),(s=e._getFrameworks()).length&&(i.fw=s.join(",")),`${n}?${eT(i).slice(1)}`),messageHandlersFilter:a.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:rn,dontclear:!0},t=>new Promise(async(n,i)=>{await t.restyle({setHideOnLeave:!1});let r=tF(e,"network-request-failed"),s=iI().setTimeout(()=>{i(r)},rt.get());function o(){iI().clearTimeout(s),n(t)}t.ping(o).then(o,()=>{i(r)})}))}let rs={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class ro{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}let ra=encodeURIComponent("fac");async function rl(e,t,n,i,r,s){tj(e.config.authDomain,e,"auth-domain-config-required"),tj(e.config.apiKey,e,"invalid-api-key");let o={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:i,v:tf,eventId:r};if(t instanceof n9)for(let[n,i]of(t.setDefaultLanguage(e.languageCode),o.providerId=t.providerId||"",ev(t.getCustomParameters())||(o.customParameters=JSON.stringify(t.getCustomParameters())),Object.entries(s||{})))o[n]=i;if(t instanceof ie){let e=t.getScopes().filter(e=>""!==e);e.length>0&&(o.scopes=e.join(","))}for(let t of(e.tenantId&&(o.tid=e.tenantId),Object.keys(o)))void 0===o[t]&&delete o[t];let a=await e._getAppCheckToken(),l=a?`#${ra}=${encodeURIComponent(a)}`:"";return`${function({config:e}){return e.emulator?tW(e,"emulator/auth/handler"):`https://${e.authDomain}/__/auth/handler`}(e)}?${eT(o).slice(1)}${l}`}let rh="webStorageSupport",ru=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=ib,this._completeRedirectFn=i0,this._overrideRedirectResult=iZ}async _openPopup(e,t,n,i){var r,s;r=this.eventManagers[e._key()]?.manager,s="_initialize() not called before _openPopup()",r||tB(s);let o=await rl(e,t,n,tz(),i);return function(e,t,n,i=500,r=600){let s=Math.max((window.screen.availHeight-r)/2,0).toString(),o=Math.max((window.screen.availWidth-i)/2,0).toString(),a="",l={...rs,width:i.toString(),height:r.toString(),top:s,left:o},h=er().toLowerCase();n&&(a=nT(h)?"_blank":n),nb(h)&&(t=t||"http://localhost",l.scrollbars="yes");let u=Object.entries(l).reduce((e,[t,n])=>`${e}${t}=${n},`,"");if(function(e=er()){return nA(e)&&!!window.navigator?.standalone}(h)&&"_self"!==a){var c,d;let e,n;return c=t||"",d=a,(e=document.createElement("a")).href=c,e.target=d,(n=document.createEvent("MouseEvent")).initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),e.dispatchEvent(n),new ro(null)}let f=window.open(t||"",a,u);tj(f,e,"popup-blocked");try{f.focus()}catch(e){}return new ro(f)}(e,o,iT())}async _openRedirect(e,t,n,i){var r;return await this._originValidation(e),r=await rl(e,t,n,tz(),i),iI().location.href=r,new Promise(()=>{})}_initialize(e){let t=e._key();if(this.eventManagers[t]){var n;let{manager:e,promise:i}=this.eventManagers[t];return e?Promise.resolve(e):(n="If manager is not set, promise should be",i||tB(n),i)}let i=this.initAndGetManager(e);return this.eventManagers[t]={promise:i},i.catch(()=>{delete this.eventManagers[t]}),i}async initAndGetManager(e){let t=await rr(e),n=new i1(e);return t.register("authEvent",t=>(tj(t?.authEvent,e,"invalid-auth-event"),{status:n.onEvent(t.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(rh,{type:rh},n=>{let i=n?.[0]?.[rh];void 0!==i&&t(!!i),tM(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){let t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=i8(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return nN()||nE()||nA()}};var rc="@firebase/auth",rd="1.11.1";class rf{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(e){return(this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser)?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;let t=this.auth.onIdTokenChanged(t=>{e(t?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();let t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){tj(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}let rp=Y("authIdTokenMaxAge")||300,rg=null;nM={loadJS:e=>new Promise((t,n)=>{let i=document.createElement("script");i.setAttribute("src",e),i.onload=t,i.onerror=e=>{let t=tF("internal-error");t.customData=e,n(t)},i.type="text/javascript",i.charset="UTF-8",(document.getElementsByTagName("head")?.[0]??document).appendChild(i)}),gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="},_="Browser",tn(new eD("auth",(e,{options:t})=>{let n,i,r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),o=e.getProvider("app-check-internal"),{apiKey:a,authDomain:l}=r.options;tj(a&&!a.includes(":"),"invalid-api-key",{appName:r.name});let h=new nO(r,s,o,{apiKey:a,authDomain:l,clientPlatform:_,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:nR(_)});return i=(Array.isArray(n=t?.persistence||[])?n:[n]).map(nm),t?.errorMap&&h._updateErrorMap(t.errorMap),h._initializeWithPersistence(i,t?.popupRedirectResolver),h},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{e.getProvider("auth-internal").initialize()})),tn(new eD("auth-internal",e=>new rf(ex(e.getProvider("auth").getImmediate())),"PRIVATE").setInstantiationMode("EXPLICIT")),tv(rc,rd,function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}(_)),tv(rc,rd,"esm2020"),e.s([],58556),e.i(58556);let rm="@firebase/database",ry="1.1.0",r_="";class rv{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){null==t?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),ef(t))}get(e){let t=this.domStorage_.getItem(this.prefixedName_(e));return null==t?null:ed(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}class rw{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t}get(e){return ey(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}let rb=function(e){try{if("undefined"!=typeof window&&void 0!==window[e]){let t=window[e];return t.setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new rv(t)}}catch(e){}return new rw},rE=rb("localStorage"),rT=rb("sessionStorage"),rC=new eB("@firebase/database"),rI=(f=1,function(){return f++}),rS=function(e){let t=eR(e),n=new eS;n.update(t);let i=n.digest();return j.encodeByteArray(i)},rk=function(...e){let t="";for(let n=0;n<e.length;n++){let i=e[n];Array.isArray(i)||i&&"object"==typeof i&&"number"==typeof i.length?t+=rk.apply(null,i):"object"==typeof i?t+=ef(i):t+=i,t+=" "}return t},rA=null,rN=!0,rR=function(e,t){F(!t||!0===e||!1===e,"Can't turn on custom loggers persistently."),!0===e?(rC.logLevel=w.VERBOSE,rA=rC.log.bind(rC),t&&rT.set("logging_enabled",!0)):"function"==typeof e?rA=e:(rA=null,rT.remove("logging_enabled"))},rP=function(...e){if(!0===rN&&(rN=!1,null===rA&&!0===rT.get("logging_enabled")&&rR(!0)),rA){let t=rk.apply(null,e);rA(t)}},rx=function(e){return function(...t){rP(e,...t)}},rD=function(...e){let t="FIREBASE INTERNAL ERROR: "+rk(...e);rC.error(t)},rO=function(...e){let t=`FIREBASE FATAL ERROR: ${rk(...e)}`;throw rC.error(t),Error(t)},rL=function(...e){let t="FIREBASE WARNING: "+rk(...e);rC.warn(t)},rM=function(){"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&rL("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},rF=function(e){return"number"==typeof e&&(e!=e||e===1/0||e===-1/0)},rU=function(e){if(el()||"complete"===document.readyState)e();else{let t=!1,n=function(){document.body?t||(t=!0,e()):setTimeout(n,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{"complete"===document.readyState&&n()}),window.attachEvent("onload",n))}},rV="[MIN_NAME]",rq="[MAX_NAME]",rj=function(e,t){if(e===t)return 0;{if(e===rV||t===rq)return -1;if(t===rV||e===rq)return 1;let n=rQ(e),i=rQ(t);if(null!==n)if(null!==i)return n-i==0?e.length-t.length:n-i;else return -1;return null!==i?1:e<t?-1:1}},rB=function(e,t){return e===t?0:e<t?-1:1},rz=function(e,t){if(t&&e in t)return t[e];throw Error("Missing required key ("+e+") in object: "+ef(t))},r$=function(e){if("object"!=typeof e||null===e)return ef(e);let t=[];for(let n in e)t.push(n);t.sort();let n="{";for(let i=0;i<t.length;i++)0!==i&&(n+=","),n+=ef(t[i]),n+=":",n+=r$(e[t[i]]);return n+"}"},rH=function(e,t){let n=e.length;if(n<=t)return[e];let i=[];for(let r=0;r<n;r+=t)r+t>n?i.push(e.substring(r,n)):i.push(e.substring(r,r+t));return i};function rW(e,t){for(let n in e)e.hasOwnProperty(n)&&t(n,e[n])}let rK=function(e){let t,n,i,r,s;F(!rF(e),"Invalid JSON number");0===e?(n=0,i=0,t=+(1/e==-1/0)):(t=e<0,(e=Math.abs(e))>=22250738585072014e-324?(n=(r=Math.min(Math.floor(Math.log(e)/Math.LN2),1023))+1023,i=Math.round(e*Math.pow(2,52-r)-0x10000000000000)):(n=0,i=Math.round(e/5e-324)));let o=[];for(s=52;s;s-=1)o.push(i%2?1:0),i=Math.floor(i/2);for(s=11;s;s-=1)o.push(n%2?1:0),n=Math.floor(n/2);o.push(+!!t),o.reverse();let a=o.join(""),l="";for(s=0;s<64;s+=8){let e=parseInt(a.substr(s,8),2).toString(16);1===e.length&&(e="0"+e),l+=e}return l.toLowerCase()},rG=RegExp("^-?(0*)\\d{1,10}$"),rQ=function(e){if(rG.test(e)){let t=Number(e);if(t>=-0x80000000&&t<=0x7fffffff)return t}return null},rY=function(e){try{e()}catch(e){setTimeout(()=>{throw rL("Exception was thrown by user callback.",e.stack||""),e},Math.floor(0))}},rX=function(e,t){let n=setTimeout(e,t);return"number"==typeof n&&"undefined"!=typeof Deno&&Deno.unrefTimer?Deno.unrefTimer(n):"object"==typeof n&&n.unref&&n.unref(),n};class rJ{constructor(e,t){this.appCheckProvider=t,this.appName=e.name,ta(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.appCheck=t?.getImmediate({optional:!0}),this.appCheck||t?.get().then(e=>this.appCheck=e)}getToken(e){if(this.serverAppAppCheckToken){if(e)throw Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(e):new Promise((t,n)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,n):t(null)},0)})}addTokenChangeListener(e){this.appCheckProvider?.get().then(t=>t.addTokenListener(e))}notifyForInvalidToken(){rL(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}class rZ{constructor(e,t,n){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=n,this.auth_=null,this.auth_=n.getImmediate({optional:!0}),this.auth_||n.onInit(e=>this.auth_=e)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(e=>e&&"auth/token-not-initialized"===e.code?(rP("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e)):new Promise((t,n)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,n):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',rL(e)}}class r0{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}r0.OWNER="owner";let r1=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,r2="websocket",r6="long_polling";class r3{constructor(e,t,n,i,r=!1,s="",o=!1,a=!1,l=null){this.secure=t,this.namespace=n,this.webSocketOnly=i,this.nodeAdmin=r,this.persistenceKey=s,this.includeNamespaceInQueryParams=o,this.isUsingEmulator=a,this.emulatorOptions=l,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=rE.get("host:"+e)||this._host}isCacheableHost(){return"s-"===this.internalHost.substr(0,2)}isCustomHost(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&rE.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){let e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function r5(e,t,n){let i;if(F("string"==typeof t,"typeof type must == string"),F("object"==typeof n,"typeof params must == object"),t===r2)i=(e.secure?"wss://":"ws://")+e.internalHost+"/.ws?";else if(t===r6)i=(e.secure?"https://":"http://")+e.internalHost+"/.lp?";else throw Error("Unknown connection type: "+t);(e.host!==e.internalHost||e.isCustomHost()||e.includeNamespaceInQueryParams)&&(n.ns=e.namespace);let r=[];return rW(n,(e,t)=>{r.push(e+"="+t)}),i+r.join("&")}class r4{constructor(){this.counters_={}}incrementCounter(e,t=1){ey(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return function e(t,n){if(!(n instanceof Object))return n;switch(n.constructor){case Date:return new Date(n.getTime());case Object:void 0===t&&(t={});break;case Array:t=[];break;default:return n}for(let i in n)n.hasOwnProperty(i)&&"__proto__"!==i&&(t[i]=e(t[i],n[i]));return t}(void 0,this.counters_)}}let r8={},r7={};function r9(e){let t=e.toString();return r8[t]||(r8[t]=new r4),r8[t]}class se{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){let e=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let t=0;t<e.length;++t)e[t]&&rY(()=>{this.onMessage_(e[t])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}let st="start";class sn{constructor(e,t,n,i,r,s,o){this.connId=e,this.repoInfo=t,this.applicationId=n,this.appCheckToken=i,this.authToken=r,this.transportSessionId=s,this.lastSessionId=o,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=rx(e),this.stats_=r9(t),this.urlFn=e=>(this.appCheckToken&&(e.ac=this.appCheckToken),r5(t,r6,e))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new se(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(3e4)),rU(()=>{if(this.isClosed_)return;this.scriptTagHolder=new si((...e)=>{let[t,n,i,r,s]=e;if(this.incrementIncomingBytes_(e),this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,t===st)this.id=n,this.password=i;else if("close"===t)n?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(n,()=>{this.onClosed_()})):this.onClosed_();else throw Error("Unrecognized command received: "+t)},(...e)=>{let[t,n]=e;this.incrementIncomingBytes_(e),this.myPacketOrderer.handleResponse(t,n)},()=>{this.onClosed_()},this.urlFn);let e={};e[st]="t",e.ser=Math.floor(1e8*Math.random()),this.scriptTagHolder.uniqueCallbackIdentifier&&(e.cb=this.scriptTagHolder.uniqueCallbackIdentifier),e.v="5",this.transportSessionId&&(e.s=this.transportSessionId),this.lastSessionId&&(e.ls=this.lastSessionId),this.applicationId&&(e.p=this.applicationId),this.appCheckToken&&(e.ac=this.appCheckToken),"undefined"!=typeof location&&location.hostname&&r1.test(location.hostname)&&(e.r="f");let t=this.urlFn(e);this.log_("Connecting via long-poll to "+t),this.scriptTagHolder.addTag(t,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){sn.forceAllow_=!0}static forceDisallow(){sn.forceDisallow_=!0}static isAvailable(){return!el()&&(!!sn.forceAllow_||!sn.forceDisallow_&&"undefined"!=typeof document&&null!=document.createElement&&!("object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))&&("object"!=typeof Windows||"object"!=typeof Windows.UI))}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){!this.isClosed_&&(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){let t=ef(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);let n=rH(z(t),1840);for(let e=0;e<n.length;e++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,n.length,n[e]),this.curSegmentNum++}addDisconnectPingFrame(e,t){if(el())return;this.myDisconnFrame=document.createElement("iframe");let n={};n.dframe="t",n.id=e,n.pw=t,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){let t=ef(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class si{constructor(e,t,n,i){if(this.onDisconnect=n,this.urlFn=i,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,el())this.commandCB=e,this.onMessageCB=t;else{this.uniqueCallbackIdentifier=rI(),window["pLPCommand"+this.uniqueCallbackIdentifier]=e,window["pRTLPCB"+this.uniqueCallbackIdentifier]=t,this.myIFrame=si.createIFrame_();let n="";this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,11)&&(n='<script>document.domain="'+document.domain+'";</script>');const i="<html><body>"+n+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(i),this.myIFrame.doc.close()}catch(e){rP("frame writing exception"),e.stack&&rP(e.stack),rP(e)}}}static createIFrame_(){let e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||rP("No IE domain setting required")}catch(t){e.src="javascript:void((function(){document.open();document.domain='"+document.domain+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{null!==this.myIFrame&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));let e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(!this.alive||!this.sendNewPolls||!(this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)))return!1;{this.currentSerial++;let e={};e.id=this.myID,e.pw=this.myPW,e.ser=this.currentSerial;let t=this.urlFn(e),n="",i=0;for(;this.pendingSegs.length>0;)if(this.pendingSegs[0].d.length+30+n.length<=1870){let e=this.pendingSegs.shift();n=n+"&seg"+i+"="+e.seg+"&ts"+i+"="+e.ts+"&d"+i+"="+e.d,i++}else break;return t+=n,this.addLongPollTag_(t,this.currentSerial),!0}}enqueueSegment(e,t,n){this.pendingSegs.push({seg:e,ts:t,d:n}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);let n=()=>{this.outstandingRequests.delete(t),this.newRequest_()},i=setTimeout(n,Math.floor(25e3));this.addTag(e,()=>{clearTimeout(i),n()})}addTag(e,t){el()?this.doNodeLongPoll(e,t):setTimeout(()=>{try{if(!this.sendNewPolls)return;let n=this.myIFrame.doc.createElement("script");n.type="text/javascript",n.async=!0,n.src=e,n.onload=n.onreadystatechange=function(){let e=n.readyState;e&&"loaded"!==e&&"complete"!==e||(n.onload=n.onreadystatechange=null,n.parentNode&&n.parentNode.removeChild(n),t())},n.onerror=()=>{rP("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(n)}catch(e){}},Math.floor(1))}}let sr=null;"undefined"!=typeof MozWebSocket?sr=MozWebSocket:"undefined"!=typeof WebSocket&&(sr=WebSocket);class ss{constructor(e,t,n,i,r,s,o){this.connId=e,this.applicationId=n,this.appCheckToken=i,this.authToken=r,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=rx(this.connId),this.stats_=r9(t),this.connURL=ss.connectionURL_(t,s,o,i,n),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,n,i,r){let s={};return s.v="5",!el()&&"undefined"!=typeof location&&location.hostname&&r1.test(location.hostname)&&(s.r="f"),t&&(s.s=t),n&&(s.ls=n),i&&(s.ac=i),r&&(s.p=r),r5(e,r2,s)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,rE.set("previous_websocket_failure",!0);try{let e;if(el()){let t=this.nodeAdmin?"AdminNode":"Node";e={headers:{"User-Agent":`Firebase/5/${r_}/${M.default.platform}/${t}`,"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(e.headers.Authorization=`Bearer ${this.authToken}`),this.appCheckToken&&(e.headers["X-Firebase-AppCheck"]=this.appCheckToken);let n=M.default.env,i=0===this.connURL.indexOf("wss://")?n.HTTPS_PROXY||n.https_proxy:n.HTTP_PROXY||n.http_proxy;i&&(e.proxy={origin:i})}this.mySock=new sr(this.connURL,[],e)}catch(t){this.log_("Error instantiating WebSocket.");let e=t.message||t.data;e&&this.log_(e),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=e=>{this.handleIncomingFrame(e)},this.mySock.onerror=e=>{this.log_("WebSocket error.  Closing connection.");let t=e.message||e.data;t&&this.log_(t),this.onClosed_()}}start(){}static forceDisallow(){ss.forceDisallow_=!0}static isAvailable(){let e=!1;if("undefined"!=typeof navigator&&navigator.userAgent){let t=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/);t&&t.length>1&&4.4>parseFloat(t[1])&&(e=!0)}return!e&&null!==sr&&!ss.forceDisallow_}static previouslyFailed(){return rE.isInMemoryStorage||!0===rE.get("previous_websocket_failure")}markConnectionHealthy(){rE.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){let e=this.frames.join("");this.frames=null;let t=ed(e);this.onMessage(t)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(F(null===this.frames,"We already have a frame buffer"),e.length<=6){let t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(null===this.mySock)return;let t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(t);else{let e=this.extractFrameCount_(t);null!==e&&this.appendFrame_(e)}}send(e){this.resetKeepAlive();let t=ef(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);let n=rH(t,16384);n.length>1&&this.sendString_(String(n.length));for(let e=0;e<n.length;e++)this.sendString_(n[e])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){!this.isClosed_&&(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(45e3))}sendString_(e){try{this.mySock.send(e)}catch(e){this.log_("Exception thrown from WebSocket.send():",e.message||e.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}ss.responsesRequiredToBeHealthy=2,ss.healthyTimeout=3e4;class so{static get ALL_TRANSPORTS(){return[sn,ss]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(e){this.initTransports_(e)}initTransports_(e){let t=ss&&ss.isAvailable(),n=t&&!ss.previouslyFailed();if(e.webSocketOnly&&(t||rL("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),n=!0),n)this.transports_=[ss];else{let e=this.transports_=[];for(let t of so.ALL_TRANSPORTS)t&&t.isAvailable()&&e.push(t);so.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}so.globalTransportInitialized_=!1;class sa{constructor(e,t,n,i,r,s,o,a,l,h){this.id=e,this.repoInfo_=t,this.applicationId_=n,this.appCheckToken_=i,this.authToken_=r,this.onMessage_=s,this.onReady_=o,this.onDisconnect_=a,this.onKill_=l,this.lastSessionId=h,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=rx("c:"+this.id+":"),this.transportManager_=new so(t),this.log_("Connection created"),this.start_()}start_(){let e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.conn_),n=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,n)},Math.floor(0));let i=e.healthyTimeout||0;i>0&&(this.healthyTimeout_=rX(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>102400?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>10240?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(i)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{2!==this.state_&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){this.sendData_({t:"d",d:e})}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if("t"in e){let t=e.t;"a"===t?this.upgradeIfSecondaryHealthy_():"r"===t?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):"o"===t&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){let t=rz("t",e),n=rz("d",e);if("c"===t)this.onSecondaryControl_(n);else if("d"===t)this.pendingDataMessages.push(n);else throw Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){let t=rz("t",e),n=rz("d",e);"c"===t?this.onControl_(n):"d"===t&&this.onDataMessage_(n)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){!this.isHealthy_&&(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){let t=rz("t",e);if("d"in e){let n=e.d;if("h"===t){let e={...n};this.repoInfo_.isUsingEmulator&&(e.h=this.repoInfo_.host),this.onHandshake_(e)}else if("n"===t){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let e=0;e<this.pendingDataMessages.length;++e)this.onDataMessage_(this.pendingDataMessages[e]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===t?this.onConnectionShutdown_(n):"r"===t?this.onReset_(n):"e"===t?rD("Server Error: "+n):"o"===t?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):rD("Unknown control packet command: "+t)}}onHandshake_(e){let t=e.ts,n=e.v,i=e.h;this.sessionId=e.s,this.repoInfo_.host=i,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),"5"!==n&&rL("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){let e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.secondaryConn_),n=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,n),rX(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(6e4))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,1===this.state_?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):rX(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(5e3))}sendPingOnPrimaryIfNecessary_(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))}onSecondaryConnectionLost_(){let e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,e||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(rE.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(e)}close(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class sl{put(e,t,n,i){}merge(e,t,n,i){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,n){}onDisconnectMerge(e,t,n){}onDisconnectCancel(e,t){}reportStats(e){}}class sh{constructor(e){this.allowedEvents_=e,this.listeners_={},F(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){let n=[...this.listeners_[e]];for(let e=0;e<n.length;e++)n[e].callback.apply(n[e].context,t)}}on(e,t,n){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:n});let i=this.getInitialEvent(e);i&&t.apply(n,i)}off(e,t,n){this.validateEventType_(e);let i=this.listeners_[e]||[];for(let e=0;e<i.length;e++)if(i[e].callback===t&&(!n||n===i[e].context))return void i.splice(e,1)}validateEventType_(e){F(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}}class su extends sh{static getInstance(){return new su}constructor(){super(["online"]),this.online_=!0,"undefined"==typeof window||void 0===window.addEventListener||es()||(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(e){return F("online"===e,"Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}class sc{constructor(e,t){if(void 0===t){this.pieces_=e.split("/");let t=0;for(let e=0;e<this.pieces_.length;e++)this.pieces_[e].length>0&&(this.pieces_[t]=this.pieces_[e],t++);this.pieces_.length=t,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+this.pieces_[t]);return e||"/"}}function sd(){return new sc("")}function sf(e){return e.pieceNum_>=e.pieces_.length?null:e.pieces_[e.pieceNum_]}function sp(e){return e.pieces_.length-e.pieceNum_}function sg(e){let t=e.pieceNum_;return t<e.pieces_.length&&t++,new sc(e.pieces_,t)}function sm(e){return e.pieceNum_<e.pieces_.length?e.pieces_[e.pieces_.length-1]:null}function sy(e,t=0){return e.pieces_.slice(e.pieceNum_+t)}function s_(e){if(e.pieceNum_>=e.pieces_.length)return null;let t=[];for(let n=e.pieceNum_;n<e.pieces_.length-1;n++)t.push(e.pieces_[n]);return new sc(t,0)}function sv(e,t){let n=[];for(let t=e.pieceNum_;t<e.pieces_.length;t++)n.push(e.pieces_[t]);if(t instanceof sc)for(let e=t.pieceNum_;e<t.pieces_.length;e++)n.push(t.pieces_[e]);else{let e=t.split("/");for(let t=0;t<e.length;t++)e[t].length>0&&n.push(e[t])}return new sc(n,0)}function sw(e){return e.pieceNum_>=e.pieces_.length}function sb(e,t){let n=sf(e),i=sf(t);if(null===n)return t;if(n===i)return sb(sg(e),sg(t));throw Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+e+")")}function sE(e,t){let n=sy(e,0),i=sy(t,0);for(let e=0;e<n.length&&e<i.length;e++){let t=rj(n[e],i[e]);if(0!==t)return t}return n.length===i.length?0:n.length<i.length?-1:1}function sT(e,t){if(sp(e)!==sp(t))return!1;for(let n=e.pieceNum_,i=t.pieceNum_;n<=e.pieces_.length;n++,i++)if(e.pieces_[n]!==t.pieces_[i])return!1;return!0}function sC(e,t){let n=e.pieceNum_,i=t.pieceNum_;if(sp(e)>sp(t))return!1;for(;n<e.pieces_.length;){if(e.pieces_[n]!==t.pieces_[i])return!1;++n,++i}return!0}class sI{constructor(e,t){this.errorPrefix_=t,this.parts_=sy(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let e=0;e<this.parts_.length;e++)this.byteLength_+=eP(this.parts_[e]);sS(this)}}function sS(e){if(e.byteLength_>768)throw Error(e.errorPrefix_+"has a key path longer than 768 bytes ("+e.byteLength_+").");if(e.parts_.length>32)throw Error(e.errorPrefix_+"path specified exceeds the maximum depth that can be written (32) or object contains a cycle "+sk(e))}function sk(e){return 0===e.parts_.length?"":"in property '"+e.parts_.join(".")+"'"}class sA extends sh{static getInstance(){return new sA}constructor(){let e,t;super(["visible"]),"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(t="visibilitychange",e="hidden"):void 0!==document.mozHidden?(t="mozvisibilitychange",e="mozHidden"):void 0!==document.msHidden?(t="msvisibilitychange",e="msHidden"):void 0!==document.webkitHidden&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{let t=!document[e];t!==this.visible_&&(this.visible_=t,this.trigger("visible",t))},!1)}getInitialEvent(e){return F("visible"===e,"Unknown event type: "+e),[this.visible_]}}class sN extends sl{constructor(e,t,n,i,r,s,o,a){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=n,this.onConnectStatus_=i,this.onServerInfoUpdate_=r,this.authTokenProvider_=s,this.appCheckTokenProvider_=o,this.authOverride_=a,this.id=sN.nextPersistentConnectionId_++,this.log_=rx("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=1e3,this.maxReconnectDelay_=3e5,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,a&&!el())throw Error("Auth override specified in options, but not supported on non Node.js platforms");sA.getInstance().on("visible",this.onVisible_,this),-1===e.host.indexOf("fblocal")&&su.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,n){let i=++this.requestNumber_,r={r:i,a:e,b:t};this.log_(ef(r)),F(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(r),n&&(this.requestCBHash_[i]=n)}get(e){this.initConnection_();let t=new X,n={p:e._path.toString(),q:e._queryObject};this.outstandingGets_.push({action:"g",request:n,onComplete:e=>{let n=e.d;"ok"===e.s?t.resolve(n):t.reject(n)}}),this.outstandingGetCount_++;let i=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(i),t.promise}listen(e,t,n,i){this.initConnection_();let r=e._queryIdentifier,s=e._path.toString();this.log_("Listen called for "+s+" "+r),this.listens.has(s)||this.listens.set(s,new Map),F(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),F(!this.listens.get(s).has(r),"listen() called twice for same path/queryId.");let o={onComplete:i,hashFn:t,query:e,tag:n};this.listens.get(s).set(r,o),this.connected_&&this.sendListen_(o)}sendGet_(e){let t=this.outstandingGets_[e];this.sendRequest("g",t.request,n=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(n)})}sendListen_(e){let t=e.query,n=t._path.toString(),i=t._queryIdentifier;this.log_("Listen on "+n+" for "+i);let r={p:n};e.tag&&(r.q=t._queryObject,r.t=e.tag),r.h=e.hashFn(),this.sendRequest("q",r,r=>{let s=r.d,o=r.s;sN.warnOnListenWarnings_(s,t),(this.listens.get(n)&&this.listens.get(n).get(i))===e&&(this.log_("listen response",r),"ok"!==o&&this.removeListen_(n,i),e.onComplete&&e.onComplete(o,s))})}static warnOnListenWarnings_(e,t){if(e&&"object"==typeof e&&ey(e,"w")){let n=e_(e,"w");if(Array.isArray(n)&&~n.indexOf("no_index")){let e='".indexOn": "'+t._queryParams.getIndex().toString()+'"',n=t._path.toString();rL(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${e} at ${n} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&40===e.length||em(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){let e=this.authToken_,t=eg(e)?"auth":"gauth",n={cred:e};null===this.authOverride_?n.noauth=!0:"object"==typeof this.authOverride_&&(n.authvar=this.authOverride_),this.sendRequest(t,n,t=>{let n=t.s,i=t.d||"error";this.authToken_===e&&("ok"===n?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(n,i))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{let t=e.s,n=e.d||"error";"ok"===t?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,n)})}unlisten(e,t){let n=e._path.toString(),i=e._queryIdentifier;this.log_("Unlisten called for "+n+" "+i),F(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(n,i)&&this.connected_&&this.sendUnlisten_(n,i,e._queryObject,t)}sendUnlisten_(e,t,n,i){this.log_("Unlisten on "+e+" for "+t);let r={p:e};i&&(r.q=n,r.t=i),this.sendRequest("n",r)}onDisconnectPut(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:n})}onDisconnectMerge(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:n})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,n,i){let r={p:t,d:n};this.log_("onDisconnect "+e,r),this.sendRequest(e,r,e=>{i&&setTimeout(()=>{i(e.s,e.d)},Math.floor(0))})}put(e,t,n,i){this.putInternal("p",e,t,n,i)}merge(e,t,n,i){this.putInternal("m",e,t,n,i)}putInternal(e,t,n,i,r){this.initConnection_();let s={p:t,d:n};void 0!==r&&(s.h=r),this.outstandingPuts_.push({action:e,request:s,onComplete:i}),this.outstandingPutCount_++;let o=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(o):this.log_("Buffering put: "+t)}sendPut_(e){let t=this.outstandingPuts_[e].action,n=this.outstandingPuts_[e].request,i=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,n,n=>{this.log_(t+" response",n),delete this.outstandingPuts_[e],this.outstandingPutCount_--,0===this.outstandingPutCount_&&(this.outstandingPuts_=[]),i&&i(n.s,n.d)})}reportStats(e){if(this.connected_){let t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,e=>{if("ok"!==e.s){let t=e.d;this.log_("reportStats","Error sending stats: "+t)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+ef(e));let t=e.r,n=this.requestCBHash_[t];n&&(delete this.requestCBHash_[t],n(e.b))}else if("error"in e)throw"A server-side error has occurred: "+e.error;else"a"in e&&this.onDataPush_(e.a,e.b)}onDataPush_(e,t){this.log_("handleServerMessage",e,t),"d"===e?this.onDataUpdate_(t.p,t.d,!1,t.t):"m"===e?this.onDataUpdate_(t.p,t.d,!0,t.t):"c"===e?this.onListenRevoked_(t.p,t.q):"ac"===e?this.onAuthRevoked_(t.s,t.d):"apc"===e?this.onAppCheckRevoked_(t.s,t.d):"sd"===e?this.onSecurityDebugPacket_(t):rD("Unrecognized action received from server: "+ef(e)+"\nAre you using the latest client?")}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){F(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=1e3),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());let e=Math.max(0,new Date().getTime()-this.lastConnectionAttemptTime_),t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;let e=this.onDataMessage_.bind(this),t=this.onReady_.bind(this),n=this.onRealtimeDisconnect_.bind(this),i=this.id+":"+sN.nextConnectionId_++,r=this.lastSessionId,s=!1,o=null,a=function(){o?o.close():(s=!0,n())};this.realtime_={close:a,sendRequest:function(e){F(o,"sendRequest call when we're not connected not allowed."),o.sendRequest(e)}};let l=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{let[a,h]=await Promise.all([this.authTokenProvider_.getToken(l),this.appCheckTokenProvider_.getToken(l)]);s?rP("getToken() completed but was canceled"):(rP("getToken() completed. Creating connection."),this.authToken_=a&&a.accessToken,this.appCheckToken_=h&&h.token,o=new sa(i,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,t,n,e=>{rL(e+" ("+this.repoInfo_.toString()+")"),this.interrupt("server_kill")},r))}catch(e){this.log_("Failed to get token: "+e),s||(this.repoInfo_.nodeAdmin&&rL(e),a())}}}interrupt(e){rP("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){rP("Resuming connection for reason: "+e),delete this.interruptReasons_[e],ev(this.interruptReasons_)&&(this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){let t=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){let t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let n;n=t?t.map(e=>r$(e)).join("$"):"default";let i=this.removeListen_(e,n);i&&i.onComplete&&i.onComplete("permission_denied")}removeListen_(e,t){let n,i=new sc(e).toString();if(this.listens.has(i)){let e=this.listens.get(i);n=e.get(t),e.delete(t),0===e.size&&this.listens.delete(i)}else n=void 0;return n}onAuthRevoked_(e,t){rP("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),("invalid_token"===e||"permission_denied"===e)&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){rP("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,("invalid_token"===e||"permission_denied"===e)&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=3&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace("\n","\nFIREBASE: "))}restoreState_(){for(let e of(this.tryAuth(),this.tryAppCheck(),this.listens.values()))for(let t of e.values())this.sendListen_(t);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){let e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){let e={},t="js";el()&&(t=this.repoInfo_.nodeAdmin?"admin_node":"node"),e["sdk."+t+"."+r_.replace(/\./g,"-")]=1,es()?e["framework.cordova"]=1:ea()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){let e=su.getInstance().currentlyOnline();return ev(this.interruptReasons_)&&e}}sN.nextPersistentConnectionId_=0,sN.nextConnectionId_=0;class sR{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new sR(e,t)}}class sP{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){let n=new sR(rV,e),i=new sR(rV,t);return 0!==this.compare(n,i)}minPost(){return sR.MIN}}class sx extends sP{static get __EMPTY_NODE(){return i}static set __EMPTY_NODE(e){i=e}compare(e,t){return rj(e.name,t.name)}isDefinedOn(e){throw U("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return sR.MIN}maxPost(){return new sR(rq,i)}makePost(e,t){return F("string"==typeof e,"KeyIndex indexValue must always be a string."),new sR(e,i)}toString(){return".key"}}let sD=new sx;class sO{constructor(e,t,n,i,r=null){this.isReverse_=i,this.resultGenerator_=r,this.nodeStack_=[];let s=1;for(;!e.isEmpty();)if(s=t?n(e.key,t):1,i&&(s*=-1),s<0)e=this.isReverse_?e.left:e.right;else if(0===s){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}getNext(){let e;if(0===this.nodeStack_.length)return null;let t=this.nodeStack_.pop();if(e=this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value},this.isReverse_)for(t=t.left;!t.isEmpty();)this.nodeStack_.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack_.push(t),t=t.left;return e}hasNext(){return this.nodeStack_.length>0}peek(){if(0===this.nodeStack_.length)return null;let e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class sL{constructor(e,t,n,i,r){this.key=e,this.value=t,this.color=null!=n?n:sL.RED,this.left=null!=i?i:sM.EMPTY_NODE,this.right=null!=r?r:sM.EMPTY_NODE}copy(e,t,n,i,r){return new sL(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=i?i:this.left,null!=r?r:this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let i=this,r=n(e,i.key);return(i=r<0?i.copy(null,null,null,i.left.insert(e,t,n),null):0===r?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,n))).fixUp_()}removeMin_(){if(this.left.isEmpty())return sM.EMPTY_NODE;let e=this;return e.left.isRed_()||e.left.left.isRed_()||(e=e.moveRedLeft_()),(e=e.copy(null,null,null,e.left.removeMin_(),null)).fixUp_()}remove(e,t){let n,i;if(n=this,0>t(e,n.key))n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===t(e,n.key))if(n.right.isEmpty())return sM.EMPTY_NODE;else i=n.right.min_(),n=n.copy(i.key,i.value,null,null,n.right.removeMin_());n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight_())).rotateLeft_()).colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=(e=e.rotateRight_()).colorFlip_()),e}rotateLeft_(){let e=this.copy(null,null,sL.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){let e=this.copy(null,null,sL.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){return Math.pow(2,this.check_())<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw Error("Right child of ("+this.key+","+this.value+") is red");let e=this.left.check_();if(e===this.right.check_())return e+ +!this.isRed_();throw Error("Black depths differ")}}sL.RED=!0,sL.BLACK=!1;class sM{constructor(e,t=sM.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new sM(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,sL.BLACK,null,null))}remove(e){return new sM(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,sL.BLACK,null,null))}get(e){let t,n=this.root_;for(;!n.isEmpty();){if(0===(t=this.comparator_(e,n.key)))return n.value;t<0?n=n.left:t>0&&(n=n.right)}return null}getPredecessorKey(e){let t,n=this.root_,i=null;for(;!n.isEmpty();){if(0===(t=this.comparator_(e,n.key)))if(n.left.isEmpty())if(i)return i.key;else return null;else{for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}t<0?n=n.left:t>0&&(i=n,n=n.right)}throw Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new sO(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new sO(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new sO(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new sO(this.root_,null,this.comparator_,!0,e)}}function sF(e,t){return rj(e.name,t.name)}function sU(e,t){return rj(e,t)}sM.EMPTY_NODE=new class{copy(e,t,n,i,r){return this}insert(e,t,n){return new sL(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}};let sV=function(e){return"number"==typeof e?"number:"+rK(e):"string:"+e},sq=function(e){if(e.isLeafNode()){let t=e.val();F("string"==typeof t||"number"==typeof t||"object"==typeof t&&ey(t,".sv"),"Priority must be a string or number.")}else F(e===r||e.isEmpty(),"priority of unexpected type.");F(e===r||e.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};class sj{static set __childrenNodeConstructor(e){s=e}static get __childrenNodeConstructor(){return s}constructor(e,t=sj.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,F(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),sq(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new sj(this.value_,e)}getImmediateChild(e){return".priority"===e?this.priorityNode_:sj.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return sw(e)?this:".priority"===sf(e)?this.priorityNode_:sj.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return".priority"===e?this.updatePriority(t):t.isEmpty()&&".priority"!==e?this:sj.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){let n=sf(e);return null===n?t:t.isEmpty()&&".priority"!==n?this:(F(".priority"!==n||1===sp(e),".priority must be the last token in a path"),this.updateImmediateChild(n,sj.__childrenNodeConstructor.EMPTY_NODE.updateChild(sg(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(null===this.lazyHash_){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+sV(this.priorityNode_.val())+":");let t=typeof this.value_;e+=t+":","number"===t?e+=rK(this.value_):e+=this.value_,this.lazyHash_=rS(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===sj.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof sj.__childrenNodeConstructor?-1:(F(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){let t=typeof e.value_,n=typeof this.value_,i=sj.VALUE_TYPE_ORDER.indexOf(t),r=sj.VALUE_TYPE_ORDER.indexOf(n);return(F(i>=0,"Unknown leaf type: "+t),F(r>=0,"Unknown leaf type: "+n),i!==r)?r-i:"object"===n?0:this.value_<e.value_?-1:1*(this.value_!==e.value_)}withIndex(){return this}isIndexed(){return!0}equals(e){return e===this||!!e.isLeafNode()&&this.value_===e.value_&&this.priorityNode_.equals(e.priorityNode_)}}sj.VALUE_TYPE_ORDER=["object","boolean","number","string"];let sB=new class extends sP{compare(e,t){let n=e.node.getPriority(),i=t.node.getPriority(),r=n.compareTo(i);return 0===r?rj(e.name,t.name):r}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return sR.MIN}maxPost(){return new sR(rq,new sj("[PRIORITY-POST]",a))}makePost(e,t){return new sR(t,new sj("[PRIORITY-POST]",o(e)))}toString(){return".priority"}},sz=Math.log(2);class s${constructor(e){this.count=parseInt(Math.log(e+1)/sz,10),this.current_=this.count-1;const t=parseInt(Array(this.count+1).join("1"),2);this.bits_=e+1&t}nextBitIsOne(){let e=!(this.bits_&1<<this.current_);return this.current_--,e}}let sH=function(e,t,n,i){e.sort(t);let r=function(t,i){let s,o=i-t;if(0===o)return null;if(1===o)return s=e[t],new sL(n?n(s):s,s.node,sL.BLACK,null,null);{let a=parseInt(o/2,10)+t,l=r(t,a),h=r(a+1,i);return s=e[a],new sL(n?n(s):s,s.node,sL.BLACK,l,h)}};return new sM(i||t,function(t){let i=null,s=null,o=e.length,a=function(t,i){let s=o-t,a=o;o-=t;let h=r(s+1,a),u=e[s];l(new sL(n?n(u):u,u.node,i,null,h))},l=function(e){i?i.left=e:s=e,i=e};for(let e=0;e<t.count;++e){let n=t.nextBitIsOne(),i=Math.pow(2,t.count-(e+1));n?a(i,sL.BLACK):(a(i,sL.BLACK),a(i,sL.RED))}return s}(new s$(e.length)))},sW={};class sK{static get Default(){return F(sW&&sB,"ChildrenNode.ts has not been loaded"),l=l||new sK({".priority":sW},{".priority":sB})}constructor(e,t){this.indexes_=e,this.indexSet_=t}get(e){let t=e_(this.indexes_,e);if(!t)throw Error("No index defined for "+e);return t instanceof sM?t:null}hasIndex(e){return ey(this.indexSet_,e.toString())}addIndex(e,t){let n;F(e!==sD,"KeyIndex always exists and isn't meant to be added to the IndexMap.");let i=[],r=!1,s=t.getIterator(sR.Wrap),o=s.getNext();for(;o;)r=r||e.isDefinedOn(o.node),i.push(o),o=s.getNext();n=r?sH(i,e.getCompare()):sW;let a=e.toString(),l={...this.indexSet_};l[a]=e;let h={...this.indexes_};return h[a]=n,new sK(h,l)}addToIndexes(e,t){return new sK(ew(this.indexes_,(n,i)=>{let r=e_(this.indexSet_,i);if(F(r,"Missing index implementation for "+i),n===sW)if(!r.isDefinedOn(e.node))return sW;else{let n=[],i=t.getIterator(sR.Wrap),s=i.getNext();for(;s;)s.name!==e.name&&n.push(s),s=i.getNext();return n.push(e),sH(n,r.getCompare())}{let i=t.get(e.name),r=n;return i&&(r=r.remove(new sR(e.name,i))),r.insert(e,e.node)}}),this.indexSet_)}removeFromIndexes(e,t){return new sK(ew(this.indexes_,n=>{if(n===sW)return n;{let i=t.get(e.name);return i?n.remove(new sR(e.name,i)):n}}),this.indexSet_)}}class sG{static get EMPTY_NODE(){return h||(h=new sG(new sM(sU),null,sK.Default))}constructor(e,t,n){this.children_=e,this.priorityNode_=t,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&sq(this.priorityNode_),this.children_.isEmpty()&&F(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||h}updatePriority(e){return this.children_.isEmpty()?this:new sG(this.children_,e,this.indexMap_)}getImmediateChild(e){if(".priority"===e)return this.getPriority();{let t=this.children_.get(e);return null===t?h:t}}getChild(e){let t=sf(e);return null===t?this:this.getImmediateChild(t).getChild(sg(e))}hasChild(e){return null!==this.children_.get(e)}updateImmediateChild(e,t){if(F(t,"We should always be passing snapshot nodes"),".priority"===e)return this.updatePriority(t);{let n,i,r=new sR(e,t);t.isEmpty()?(n=this.children_.remove(e),i=this.indexMap_.removeFromIndexes(r,this.children_)):(n=this.children_.insert(e,t),i=this.indexMap_.addToIndexes(r,this.children_));let s=n.isEmpty()?h:this.priorityNode_;return new sG(n,s,i)}}updateChild(e,t){let n=sf(e);if(null===n)return t;{F(".priority"!==sf(e)||1===sp(e),".priority must be the last token in a path");let i=this.getImmediateChild(n).updateChild(sg(e),t);return this.updateImmediateChild(n,i)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;let t={},n=0,i=0,r=!0;if(this.forEachChild(sB,(s,o)=>{t[s]=o.val(e),n++,r&&sG.INTEGER_REGEXP_.test(s)?i=Math.max(i,Number(s)):r=!1}),e||!r||!(i<2*n))return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t;{let e=[];for(let n in t)e[n]=t[n];return e}}hash(){if(null===this.lazyHash_){let e="";this.getPriority().isEmpty()||(e+="priority:"+sV(this.getPriority().val())+":"),this.forEachChild(sB,(t,n)=>{let i=n.hash();""!==i&&(e+=":"+t+":"+i)}),this.lazyHash_=""===e?"":rS(e)}return this.lazyHash_}getPredecessorChildName(e,t,n){let i=this.resolveIndex_(n);if(!i)return this.children_.getPredecessorKey(e);{let n=i.getPredecessorKey(new sR(e,t));return n?n.name:null}}getFirstChildName(e){let t=this.resolveIndex_(e);if(!t)return this.children_.minKey();{let e=t.minKey();return e&&e.name}}getFirstChild(e){let t=this.getFirstChildName(e);return t?new sR(t,this.children_.get(t)):null}getLastChildName(e){let t=this.resolveIndex_(e);if(!t)return this.children_.maxKey();{let e=t.maxKey();return e&&e.name}}getLastChild(e){let t=this.getLastChildName(e);return t?new sR(t,this.children_.get(t)):null}forEachChild(e,t){let n=this.resolveIndex_(e);return n?n.inorderTraversal(e=>t(e.name,e.node)):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){let n=this.resolveIndex_(t);if(n)return n.getIteratorFrom(e,e=>e);{let n=this.children_.getIteratorFrom(e.name,sR.Wrap),i=n.peek();for(;null!=i&&0>t.compare(i,e);)n.getNext(),i=n.peek();return n}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){let n=this.resolveIndex_(t);if(n)return n.getReverseIteratorFrom(e,e=>e);{let n=this.children_.getReverseIteratorFrom(e.name,sR.Wrap),i=n.peek();for(;null!=i&&t.compare(i,e)>0;)n.getNext(),i=n.peek();return n}}compareTo(e){if(this.isEmpty())if(e.isEmpty())return 0;else return -1;return e.isLeafNode()||e.isEmpty()?1:e===sQ?-1:0}withIndex(e){if(e===sD||this.indexMap_.hasIndex(e))return this;{let t=this.indexMap_.addIndex(e,this.children_);return new sG(this.children_,this.priorityNode_,t)}}isIndexed(e){return e===sD||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode()||!this.getPriority().equals(e.getPriority()))return!1;if(this.children_.count()!==e.children_.count())return!1;{let t=this.getIterator(sB),n=e.getIterator(sB),i=t.getNext(),r=n.getNext();for(;i&&r;){if(i.name!==r.name||!i.node.equals(r.node))return!1;i=t.getNext(),r=n.getNext()}return null===i&&null===r}}resolveIndex_(e){return e===sD?null:this.indexMap_.get(e.toString())}}sG.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;let sQ=new class extends sG{constructor(){super(new sM(sU),sG.EMPTY_NODE,sK.Default)}compareTo(e){return+(e!==this)}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return sG.EMPTY_NODE}isEmpty(){return!1}};function sY(e,t=null){if(null===e)return sG.EMPTY_NODE;if("object"==typeof e&&".priority"in e&&(t=e[".priority"]),F(null===t||"string"==typeof t||"number"==typeof t||"object"==typeof t&&".sv"in t,"Invalid priority type found: "+typeof t),"object"==typeof e&&".value"in e&&null!==e[".value"]&&(e=e[".value"]),"object"!=typeof e||".sv"in e)return new sj(e,sY(t));if(e instanceof Array){let n=sG.EMPTY_NODE;return rW(e,(t,i)=>{if(ey(e,t)&&"."!==t.substring(0,1)){let e=sY(i);(e.isLeafNode()||!e.isEmpty())&&(n=n.updateImmediateChild(t,e))}}),n.updatePriority(sY(t))}{let n=[],i=!1;if(rW(e,(e,t)=>{if("."!==e.substring(0,1)){let r=sY(t);r.isEmpty()||(i=i||!r.getPriority().isEmpty(),n.push(new sR(e,r)))}}),0===n.length)return sG.EMPTY_NODE;let r=sH(n,sF,e=>e.name,sU);if(!i)return new sG(r,sY(t),sK.Default);{let e=sH(n,sB.getCompare());return new sG(r,sY(t),new sK({".priority":e},{".priority":sB}))}}}Object.defineProperties(sR,{MIN:{value:new sR(rV,sG.EMPTY_NODE)},MAX:{value:new sR(rq,sQ)}}),sx.__EMPTY_NODE=sG.EMPTY_NODE,sj.__childrenNodeConstructor=sG,r=sQ,a=sQ,o=sY;class sX extends sP{constructor(e){super(),this.indexPath_=e,F(!sw(e)&&".priority"!==sf(e),"Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){let n=this.extractChild(e.node),i=this.extractChild(t.node),r=n.compareTo(i);return 0===r?rj(e.name,t.name):r}makePost(e,t){let n=sY(e);return new sR(t,sG.EMPTY_NODE.updateChild(this.indexPath_,n))}maxPost(){return new sR(rq,sG.EMPTY_NODE.updateChild(this.indexPath_,sQ))}toString(){return sy(this.indexPath_,0).join("/")}}let sJ=new class extends sP{compare(e,t){let n=e.node.compareTo(t.node);return 0===n?rj(e.name,t.name):n}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return sR.MIN}maxPost(){return sR.MAX}makePost(e,t){return new sR(t,sY(e))}toString(){return".value"}};function sZ(e){return{type:"value",snapshotNode:e}}function s0(e,t){return{type:"child_added",snapshotNode:t,childName:e}}function s1(e,t){return{type:"child_removed",snapshotNode:t,childName:e}}function s2(e,t,n){return{type:"child_changed",snapshotNode:t,childName:e,oldSnap:n}}class s6{constructor(e){this.index_=e}updateChild(e,t,n,i,r,s){F(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");let o=e.getImmediateChild(t);return o.getChild(i).equals(n.getChild(i))&&o.isEmpty()===n.isEmpty()||(null!=s&&(n.isEmpty()?e.hasChild(t)?s.trackChildChange(s1(t,o)):F(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):o.isEmpty()?s.trackChildChange(s0(t,n)):s.trackChildChange(s2(t,n,o))),e.isLeafNode()&&n.isEmpty())?e:e.updateImmediateChild(t,n).withIndex(this.index_)}updateFullNode(e,t,n){return null!=n&&(e.isLeafNode()||e.forEachChild(sB,(e,i)=>{t.hasChild(e)||n.trackChildChange(s1(e,i))}),t.isLeafNode()||t.forEachChild(sB,(t,i)=>{if(e.hasChild(t)){let r=e.getImmediateChild(t);r.equals(i)||n.trackChildChange(s2(t,i,r))}else n.trackChildChange(s0(t,i))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?sG.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}class s3{constructor(e){this.indexedFilter_=new s6(e.getIndex()),this.index_=e.getIndex(),this.startPost_=s3.getStartPost_(e),this.endPost_=s3.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){let t=this.startIsInclusive_?0>=this.index_.compare(this.getStartPost(),e):0>this.index_.compare(this.getStartPost(),e),n=this.endIsInclusive_?0>=this.index_.compare(e,this.getEndPost()):0>this.index_.compare(e,this.getEndPost());return t&&n}updateChild(e,t,n,i,r,s){return this.matches(new sR(t,n))||(n=sG.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,n,i,r,s)}updateFullNode(e,t,n){t.isLeafNode()&&(t=sG.EMPTY_NODE);let i=t.withIndex(this.index_);i=i.updatePriority(sG.EMPTY_NODE);let r=this;return t.forEachChild(sB,(e,t)=>{r.matches(new sR(e,t))||(i=i.updateImmediateChild(e,sG.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,i,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(!e.hasStart())return e.getIndex().minPost();{let t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}}static getEndPost_(e){if(!e.hasEnd())return e.getIndex().maxPost();{let t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}}}class s5{constructor(e){this.withinDirectionalStart=e=>this.reverse_?this.withinEndPost(e):this.withinStartPost(e),this.withinDirectionalEnd=e=>this.reverse_?this.withinStartPost(e):this.withinEndPost(e),this.withinStartPost=e=>{let t=this.index_.compare(this.rangedFilter_.getStartPost(),e);return this.startIsInclusive_?t<=0:t<0},this.withinEndPost=e=>{let t=this.index_.compare(e,this.rangedFilter_.getEndPost());return this.endIsInclusive_?t<=0:t<0},this.rangedFilter_=new s3(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,n,i,r,s){return(this.rangedFilter_.matches(new sR(t,n))||(n=sG.EMPTY_NODE),e.getImmediateChild(t).equals(n))?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,n,i,r,s):this.fullLimitUpdateChild_(e,t,n,r,s)}updateFullNode(e,t,n){let i;if(t.isLeafNode()||t.isEmpty())i=sG.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<t.numChildren()&&t.isIndexed(this.index_)){let e;i=sG.EMPTY_NODE.withIndex(this.index_),e=this.reverse_?t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let n=0;for(;e.hasNext()&&n<this.limit_;){let t=e.getNext();if(this.withinDirectionalStart(t))if(this.withinDirectionalEnd(t))i=i.updateImmediateChild(t.name,t.node),n++;else break}}else{let e;i=(i=t.withIndex(this.index_)).updatePriority(sG.EMPTY_NODE),e=this.reverse_?i.getReverseIterator(this.index_):i.getIterator(this.index_);let n=0;for(;e.hasNext();){let t=e.getNext();n<this.limit_&&this.withinDirectionalStart(t)&&this.withinDirectionalEnd(t)?n++:i=i.updateImmediateChild(t.name,sG.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,i,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,n,i,r){let s;if(this.reverse_){let e=this.index_.getCompare();s=(t,n)=>e(n,t)}else s=this.index_.getCompare();F(e.numChildren()===this.limit_,"");let o=new sR(t,n),a=this.reverse_?e.getFirstChild(this.index_):e.getLastChild(this.index_),l=this.rangedFilter_.matches(o);if(e.hasChild(t)){let h=e.getImmediateChild(t),u=i.getChildAfterChild(this.index_,a,this.reverse_);for(;null!=u&&(u.name===t||e.hasChild(u.name));)u=i.getChildAfterChild(this.index_,u,this.reverse_);let c=null==u?1:s(u,o);if(l&&!n.isEmpty()&&c>=0)return null!=r&&r.trackChildChange(s2(t,n,h)),e.updateImmediateChild(t,n);{null!=r&&r.trackChildChange(s1(t,h));let n=e.updateImmediateChild(t,sG.EMPTY_NODE);return null!=u&&this.rangedFilter_.matches(u)?(null!=r&&r.trackChildChange(s0(u.name,u.node)),n.updateImmediateChild(u.name,u.node)):n}}return n.isEmpty()?e:l?s(a,o)>=0?(null!=r&&(r.trackChildChange(s1(a.name,a.node)),r.trackChildChange(s0(t,n))),e.updateImmediateChild(t,n).updateImmediateChild(a.name,sG.EMPTY_NODE)):e:e}}class s4{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=sB}hasStart(){return this.startSet_}isViewFromLeft(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_}getIndexStartValue(){return F(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return(F(this.startSet_,"Only valid if start has been set"),this.startNameSet_)?this.indexStartName_:rV}hasEnd(){return this.endSet_}getIndexEndValue(){return F(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return(F(this.endSet_,"Only valid if end has been set"),this.endNameSet_)?this.indexEndName_:rq}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&""!==this.viewFrom_}getLimit(){return F(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===sB}copy(){let e=new s4;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function s8(e){let t,n={};if(e.isDefault())return n;if(e.index_===sB?t="$priority":e.index_===sJ?t="$value":e.index_===sD?t="$key":(F(e.index_ instanceof sX,"Unrecognized index type!"),t=e.index_.toString()),n.orderBy=ef(t),e.startSet_){let t=e.startAfterSet_?"startAfter":"startAt";n[t]=ef(e.indexStartValue_),e.startNameSet_&&(n[t]+=","+ef(e.indexStartName_))}if(e.endSet_){let t=e.endBeforeSet_?"endBefore":"endAt";n[t]=ef(e.indexEndValue_),e.endNameSet_&&(n[t]+=","+ef(e.indexEndName_))}return e.limitSet_&&(e.isViewFromLeft()?n.limitToFirst=e.limit_:n.limitToLast=e.limit_),n}function s7(e){let t={};if(e.startSet_&&(t.sp=e.indexStartValue_,e.startNameSet_&&(t.sn=e.indexStartName_),t.sin=!e.startAfterSet_),e.endSet_&&(t.ep=e.indexEndValue_,e.endNameSet_&&(t.en=e.indexEndName_),t.ein=!e.endBeforeSet_),e.limitSet_){t.l=e.limit_;let n=e.viewFrom_;""===n&&(n=e.isViewFromLeft()?"l":"r"),t.vf=n}return e.index_!==sB&&(t.i=e.index_.toString()),t}class s9 extends sl{reportStats(e){throw Error("Method not implemented.")}static getListenId_(e,t){return void 0!==t?"tag$"+t:(F(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}constructor(e,t,n,i){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=n,this.appCheckTokenProvider_=i,this.log_=rx("p:rest:"),this.listens_={}}listen(e,t,n,i){let r=e._path.toString();this.log_("Listen called for "+r+" "+e._queryIdentifier);let s=s9.getListenId_(e,n),o={};this.listens_[s]=o;let a=s8(e._queryParams);this.restRequest_(r+".json",a,(e,t)=>{let a=t;(404===e&&(a=null,e=null),null===e&&this.onDataUpdate_(r,a,!1,n),e_(this.listens_,s)===o)&&i(e?401===e?"permission_denied":"rest_error:"+e:"ok",null)})}unlisten(e,t){let n=s9.getListenId_(e,t);delete this.listens_[n]}get(e){let t=s8(e._queryParams),n=e._path.toString(),i=new X;return this.restRequest_(n+".json",t,(e,t)=>{let r=t;404===e&&(r=null,e=null),null===e?(this.onDataUpdate_(n,r,!1,null),i.resolve(r)):i.reject(Error(r))}),i.promise}refreshAuthToken(e){}restRequest_(e,t={},n){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([i,r])=>{i&&i.accessToken&&(t.auth=i.accessToken),r&&r.token&&(t.ac=r.token);let s=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+eT(t);this.log_("Sending REST request for "+s);let o=new XMLHttpRequest;o.onreadystatechange=()=>{if(n&&4===o.readyState){this.log_("REST Response for "+s+" received. status:",o.status,"response:",o.responseText);let e=null;if(o.status>=200&&o.status<300){try{e=ed(o.responseText)}catch(e){rL("Failed to parse JSON response for "+s+": "+o.responseText)}n(null,e)}else 401!==o.status&&404!==o.status&&rL("Got unsuccessful REST response for "+s+" Status: "+o.status),n(o.status);n=null}},o.open("GET",s,!0),o.send()})}}class oe{constructor(){this.rootNode_=sG.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}function ot(){return{value:null,children:new Map}}function on(e,t,n){var i,r;null!==e.value?n(t,e.value):(i=e,r=(e,i)=>{on(i,new sc(t.toString()+"/"+e),n)},i.children.forEach((e,t)=>{r(t,e)}))}class oi{constructor(e){this.collection_=e,this.last_=null}get(){let e=this.collection_.get(),t={...e};return this.last_&&rW(this.last_,(e,n)=>{t[e]=t[e]-n}),this.last_=e,t}}class or{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new oi(e);const n=1e4+2e4*Math.random();rX(this.reportStats_.bind(this),Math.floor(n))}reportStats_(){let e=this.statsListener_.get(),t={},n=!1;rW(e,(e,i)=>{i>0&&ey(this.statsToReport_,e)&&(t[e]=i,n=!0)}),n&&this.server_.reportStats(t),rX(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))}}function os(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function oo(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function oa(e){return{fromUser:!1,fromServer:!0,queryId:e,tagged:!0}}(v=b||(b={}))[v.OVERWRITE=0]="OVERWRITE",v[v.MERGE=1]="MERGE",v[v.ACK_USER_WRITE=2]="ACK_USER_WRITE",v[v.LISTEN_COMPLETE=3]="LISTEN_COMPLETE";class ol{constructor(e,t,n){this.path=e,this.affectedTree=t,this.revert=n,this.type=b.ACK_USER_WRITE,this.source=os()}operationForChild(e){if(!sw(this.path))return F(sf(this.path)===e,"operationForChild called for unrelated child."),new ol(sg(this.path),this.affectedTree,this.revert);if(null!=this.affectedTree.value)return F(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{let t=this.affectedTree.subtree(new sc(e));return new ol(sd(),t,this.revert)}}}class oh{constructor(e,t){this.source=e,this.path=t,this.type=b.LISTEN_COMPLETE}operationForChild(e){return sw(this.path)?new oh(this.source,sd()):new oh(this.source,sg(this.path))}}class ou{constructor(e,t,n){this.source=e,this.path=t,this.snap=n,this.type=b.OVERWRITE}operationForChild(e){return sw(this.path)?new ou(this.source,sd(),this.snap.getImmediateChild(e)):new ou(this.source,sg(this.path),this.snap)}}class oc{constructor(e,t,n){this.source=e,this.path=t,this.children=n,this.type=b.MERGE}operationForChild(e){if(!sw(this.path))return F(sf(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new oc(this.source,sg(this.path),this.children);{let t=this.children.subtree(new sc(e));return t.isEmpty()?null:t.value?new ou(this.source,sd(),t.value):new oc(this.source,sd(),t)}}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class od{constructor(e,t,n){this.node_=e,this.fullyInitialized_=t,this.filtered_=n}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(sw(e))return this.isFullyInitialized()&&!this.filtered_;let t=sf(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}class of{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function op(e,t,n,i,r,s){let o=i.filter(e=>e.type===n);o.sort((t,n)=>(function(e,t,n){if(null==t.childName||null==n.childName)throw U("Should only compare child_ events.");let i=new sR(t.childName,t.snapshotNode),r=new sR(n.childName,n.snapshotNode);return e.index_.compare(i,r)})(e,t,n)),o.forEach(n=>{var i,o,a;let l=(i=e,o=n,a=s,"value"===o.type||"child_removed"===o.type||(o.prevName=a.getPredecessorChildName(o.childName,o.snapshotNode,i.index_)),o);r.forEach(i=>{i.respondsTo(n.type)&&t.push(i.createEvent(l,e.query_))})})}function og(e,t){return{eventCache:e,serverCache:t}}function om(e,t,n,i){return og(new od(t,n,i),e.serverCache)}function oy(e,t,n,i){return og(e.eventCache,new od(t,n,i))}function o_(e){return e.eventCache.isFullyInitialized()?e.eventCache.getNode():null}function ov(e){return e.serverCache.isFullyInitialized()?e.serverCache.getNode():null}class ow{static fromObject(e){let t=new ow(null);return rW(e,(e,n)=>{t=t.set(new sc(e),n)}),t}constructor(e,t=(!u&&(u=new sM(rB)),u)){this.value=e,this.children=t}isEmpty(){return null===this.value&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(null!=this.value&&t(this.value))return{path:sd(),value:this.value};{if(sw(e))return null;let n=sf(e),i=this.children.get(n);if(null===i)return null;{let r=i.findRootMostMatchingPathAndValue(sg(e),t);return null!=r?{path:sv(new sc(n),r.path),value:r.value}:null}}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(sw(e))return this;{let t=sf(e),n=this.children.get(t);return null!==n?n.subtree(sg(e)):new ow(null)}}set(e,t){if(sw(e))return new ow(t,this.children);{let n=sf(e),i=(this.children.get(n)||new ow(null)).set(sg(e),t),r=this.children.insert(n,i);return new ow(this.value,r)}}remove(e){if(sw(e))if(this.children.isEmpty())return new ow(null);else return new ow(null,this.children);{let t=sf(e),n=this.children.get(t);if(!n)return this;{let i,r=n.remove(sg(e));return(i=r.isEmpty()?this.children.remove(t):this.children.insert(t,r),null===this.value&&i.isEmpty())?new ow(null):new ow(this.value,i)}}}get(e){if(sw(e))return this.value;{let t=sf(e),n=this.children.get(t);return n?n.get(sg(e)):null}}setTree(e,t){if(sw(e))return t;{let n,i=sf(e),r=(this.children.get(i)||new ow(null)).setTree(sg(e),t);return n=r.isEmpty()?this.children.remove(i):this.children.insert(i,r),new ow(this.value,n)}}fold(e){return this.fold_(sd(),e)}fold_(e,t){let n={};return this.children.inorderTraversal((i,r)=>{n[i]=r.fold_(sv(e,i),t)}),t(e,this.value,n)}findOnPath(e,t){return this.findOnPath_(e,sd(),t)}findOnPath_(e,t,n){let i=!!this.value&&n(t,this.value);if(i)return i;{if(sw(e))return null;let i=sf(e),r=this.children.get(i);return r?r.findOnPath_(sg(e),sv(t,i),n):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,sd(),t)}foreachOnPath_(e,t,n){if(sw(e))return this;{this.value&&n(t,this.value);let i=sf(e),r=this.children.get(i);return r?r.foreachOnPath_(sg(e),sv(t,i),n):new ow(null)}}foreach(e){this.foreach_(sd(),e)}foreach_(e,t){this.children.inorderTraversal((n,i)=>{i.foreach_(sv(e,n),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,n)=>{n.value&&e(t,n.value)})}}class ob{constructor(e){this.writeTree_=e}static empty(){return new ob(new ow(null))}}function oE(e,t,n){if(sw(t))return new ob(new ow(n));{let i=e.writeTree_.findRootMostValueAndPath(t);if(null!=i){let r=i.path,s=i.value,o=sb(r,t);return s=s.updateChild(o,n),new ob(e.writeTree_.set(r,s))}{let i=new ow(n);return new ob(e.writeTree_.setTree(t,i))}}}function oT(e,t,n){let i=e;return rW(n,(e,n)=>{i=oE(i,sv(t,e),n)}),i}function oC(e,t){return sw(t)?ob.empty():new ob(e.writeTree_.setTree(t,new ow(null)))}function oI(e,t){return null!=oS(e,t)}function oS(e,t){let n=e.writeTree_.findRootMostValueAndPath(t);return null!=n?e.writeTree_.get(n.path).getChild(sb(n.path,t)):null}function ok(e){let t=[],n=e.writeTree_.value;return null!=n?n.isLeafNode()||n.forEachChild(sB,(e,n)=>{t.push(new sR(e,n))}):e.writeTree_.children.inorderTraversal((e,n)=>{null!=n.value&&t.push(new sR(e,n.value))}),t}function oA(e,t){if(sw(t))return e;{let n=oS(e,t);return new ob(null!=n?new ow(n):e.writeTree_.subtree(t))}}function oN(e){return e.writeTree_.isEmpty()}function oR(e,t){return function e(t,n,i){if(null!=n.value)return i.updateChild(t,n.value);{let r=null;return n.children.inorderTraversal((n,s)=>{".priority"===n?(F(null!==s.value,"Priority writes must always be leaf nodes"),r=s.value):i=e(sv(t,n),s,i)}),i.getChild(t).isEmpty()||null===r||(i=i.updateChild(sv(t,".priority"),r)),i}}(sd(),e.writeTree_,t)}function oP(e){return e.visible}function ox(e,t,n){let i=ob.empty();for(let r=0;r<e.length;++r){let s=e[r];if(t(s)){let e,t=s.path;if(s.snap)sC(n,t)?i=oE(i,e=sb(n,t),s.snap):sC(t,n)&&(e=sb(t,n),i=oE(i,sd(),s.snap.getChild(e)));else if(s.children){if(sC(n,t))i=oT(i,e=sb(n,t),s.children);else if(sC(t,n))if(sw(e=sb(t,n)))i=oT(i,sd(),s.children);else{let t=e_(s.children,sf(e));if(t){let n=t.getChild(sg(e));i=oE(i,sd(),n)}}}else throw U("WriteRecord should have .snap or .children")}}return i}function oD(e,t,n,i,r){if(i||r){let s=oA(e.visibleWrites,t);return!r&&oN(s)?n:r||null!=n||oI(s,sd())?oR(ox(e.allWrites,function(e){return(e.visible||r)&&(!i||!~i.indexOf(e.writeId))&&(sC(e.path,t)||sC(t,e.path))},t),n||sG.EMPTY_NODE):null}{let i=oS(e.visibleWrites,t);if(null!=i)return i;{let i=oA(e.visibleWrites,t);return oN(i)?n:null!=n||oI(i,sd())?oR(i,n||sG.EMPTY_NODE):null}}}function oO(e,t,n,i){return oD(e.writeTree,e.treePath,t,n,i)}function oL(e,t){return function(e,t,n){let i=sG.EMPTY_NODE,r=oS(e.visibleWrites,t);if(r)return r.isLeafNode()||r.forEachChild(sB,(e,t)=>{i=i.updateImmediateChild(e,t)}),i;if(!n)return ok(oA(e.visibleWrites,t)).forEach(e=>{i=i.updateImmediateChild(e.name,e.node)}),i;{let r=oA(e.visibleWrites,t);return n.forEachChild(sB,(e,t)=>{let n=oR(oA(r,new sc(e)),t);i=i.updateImmediateChild(e,n)}),ok(r).forEach(e=>{i=i.updateImmediateChild(e.name,e.node)}),i}}(e.writeTree,e.treePath,t)}function oM(e,t,n,i){return function(e,t,n,i,r){F(i||r,"Either existingEventSnap or existingServerSnap must exist");let s=sv(t,n);if(oI(e.visibleWrites,s))return null;{let t=oA(e.visibleWrites,s);return oN(t)?r.getChild(n):oR(t,r.getChild(n))}}(e.writeTree,e.treePath,t,n,i)}function oF(e,t){var n,i;return n=e.writeTree,i=sv(e.treePath,t),oS(n.visibleWrites,i)}function oU(e,t,n){var i,r;let s,o;return i=e.writeTree,r=e.treePath,s=sv(r,t),null!=(o=oS(i.visibleWrites,s))?o:n.isCompleteForChild(t)?oR(oA(i.visibleWrites,s),n.getNode().getImmediateChild(t)):null}function oV(e,t){return oq(sv(e.treePath,t),e.writeTree)}function oq(e,t){return{treePath:e,writeTree:t}}class oj{constructor(){this.changeMap=new Map}trackChildChange(e){let t=e.type,n=e.childName;F("child_added"===t||"child_changed"===t||"child_removed"===t,"Only child changes supported for tracking"),F(".priority"!==n,"Only non-priority child changes can be tracked.");let i=this.changeMap.get(n);if(i){let r=i.type;if("child_added"===t&&"child_removed"===r)this.changeMap.set(n,s2(n,e.snapshotNode,i.snapshotNode));else if("child_removed"===t&&"child_added"===r)this.changeMap.delete(n);else if("child_removed"===t&&"child_changed"===r)this.changeMap.set(n,s1(n,i.oldSnap));else if("child_changed"===t&&"child_added"===r)this.changeMap.set(n,s0(n,e.snapshotNode));else if("child_changed"===t&&"child_changed"===r)this.changeMap.set(n,s2(n,e.snapshotNode,i.oldSnap));else throw U("Illegal combination of changes: "+e+" occurred after "+i)}else this.changeMap.set(n,e)}getChanges(){return Array.from(this.changeMap.values())}}let oB=new class{getCompleteChild(e){return null}getChildAfterChild(e,t,n){return null}};class oz{constructor(e,t,n=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=n}getCompleteChild(e){let t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{let t=null!=this.optCompleteServerCache_?new od(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return oU(this.writes_,e,t)}}getChildAfterChild(e,t,n){var i;let r=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:ov(this.viewCache_),s=(i=this.writes_,function(e,t,n,i,r,s,o){let a,l=oA(e.visibleWrites,t),h=oS(l,sd());if(null!=h)a=h;else{if(null==n)return[];a=oR(l,n)}if((a=a.withIndex(o)).isEmpty()||a.isLeafNode())return[];{let e=[],t=o.getCompare(),n=s?a.getReverseIteratorFrom(i,o):a.getIteratorFrom(i,o),r=n.getNext();for(;r&&e.length<1;)0!==t(r,i)&&e.push(r),r=n.getNext();return e}}(i.writeTree,i.treePath,r,t,1,n,e));return 0===s.length?null:s[0]}}function o$(e,t,n,i,r,s){let o=t.eventCache;if(null!=oF(i,n))return t;{let a,l;if(sw(n))if(F(t.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),t.serverCache.isFiltered()){let n=ov(t),r=oL(i,n instanceof sG?n:sG.EMPTY_NODE);a=e.filter.updateFullNode(t.eventCache.getNode(),r,s)}else{let n=oO(i,ov(t));a=e.filter.updateFullNode(t.eventCache.getNode(),n,s)}else{let h=sf(n);if(".priority"===h){F(1===sp(n),"Can't have a priority with additional path components");let r=o.getNode(),s=oM(i,n,r,l=t.serverCache.getNode());a=null!=s?e.filter.updatePriority(r,s):o.getNode()}else{let u,c=sg(n);if(o.isCompleteForChild(h)){l=t.serverCache.getNode();let e=oM(i,n,o.getNode(),l);u=null!=e?o.getNode().getImmediateChild(h).updateChild(c,e):o.getNode().getImmediateChild(h)}else u=oU(i,h,t.serverCache);a=null!=u?e.filter.updateChild(o.getNode(),h,u,c,r,s):o.getNode()}}return om(t,a,o.isFullyInitialized()||sw(n),e.filter.filtersNodes())}}function oH(e,t,n,i,r,s,o,a){let l,h=t.serverCache,u=o?e.filter:e.filter.getIndexedFilter();if(sw(n))l=u.updateFullNode(h.getNode(),i,null);else if(u.filtersNodes()&&!h.isFiltered()){let e=h.getNode().updateChild(n,i);l=u.updateFullNode(h.getNode(),e,null)}else{let e=sf(n);if(!h.isCompleteForPath(n)&&sp(n)>1)return t;let r=sg(n),s=h.getNode().getImmediateChild(e).updateChild(r,i);l=".priority"===e?u.updatePriority(h.getNode(),s):u.updateChild(h.getNode(),e,s,r,oB,null)}let c=oy(t,l,h.isFullyInitialized()||sw(n),u.filtersNodes()),d=new oz(r,c,s);return o$(e,c,n,r,d,a)}function oW(e,t,n,i,r,s,o){let a,l,h=t.eventCache,u=new oz(r,t,s);if(sw(n))l=e.filter.updateFullNode(t.eventCache.getNode(),i,o),a=om(t,l,!0,e.filter.filtersNodes());else{let r=sf(n);if(".priority"===r)l=e.filter.updatePriority(t.eventCache.getNode(),i),a=om(t,l,h.isFullyInitialized(),h.isFiltered());else{let s,l=sg(n),c=h.getNode().getImmediateChild(r);if(sw(l))s=i;else{let e=u.getCompleteChild(r);s=null!=e?".priority"===sm(l)&&e.getChild(s_(l)).isEmpty()?e:e.updateChild(l,i):sG.EMPTY_NODE}a=c.equals(s)?t:om(t,e.filter.updateChild(h.getNode(),r,s,l,u,o),h.isFullyInitialized(),e.filter.filtersNodes())}}return a}function oK(e,t){return e.eventCache.isCompleteForChild(t)}function oG(e,t,n){return n.foreach((e,n)=>{t=t.updateChild(e,n)}),t}function oQ(e,t,n,i,r,s,o,a){let l;if(t.serverCache.getNode().isEmpty()&&!t.serverCache.isFullyInitialized())return t;let h=t;l=sw(n)?i:new ow(null).setTree(n,i);let u=t.serverCache.getNode();return l.children.inorderTraversal((n,i)=>{if(u.hasChild(n)){let l=oG(e,t.serverCache.getNode().getImmediateChild(n),i);h=oH(e,h,new sc(n),l,r,s,o,a)}}),l.children.inorderTraversal((n,i)=>{let l=!t.serverCache.isCompleteForChild(n)&&null===i.value;if(!u.hasChild(n)&&!l){let l=oG(e,t.serverCache.getNode().getImmediateChild(n),i);h=oH(e,h,new sc(n),l,r,s,o,a)}}),h}class oY{constructor(e,t){this.query_=e,this.eventRegistrations_=[];const n=this.query_._queryParams,i=new s6(n.getIndex()),r=function(e){return e.loadsAllData()?new s6(e.getIndex()):e.hasLimit()?new s5(e):new s3(e)}(n);this.processor_={filter:r};const s=t.serverCache,o=t.eventCache,a=i.updateFullNode(sG.EMPTY_NODE,s.getNode(),null),l=r.updateFullNode(sG.EMPTY_NODE,o.getNode(),null),h=new od(a,s.isFullyInitialized(),i.filtersNodes()),u=new od(l,o.isFullyInitialized(),r.filtersNodes());this.viewCache_=og(u,h),this.eventGenerator_=new of(this.query_)}get query(){return this.query_}}function oX(e){return 0===e.eventRegistrations_.length}function oJ(e,t,n){let i=[];if(n){F(null==t,"A cancel should cancel all event registrations.");let r=e.query._path;e.eventRegistrations_.forEach(e=>{let t=e.createCancelEvent(n,r);t&&i.push(t)})}if(t){let n=[];for(let i=0;i<e.eventRegistrations_.length;++i){let r=e.eventRegistrations_[i];if(r.matches(t)){if(t.hasAnyCallback()){n=n.concat(e.eventRegistrations_.slice(i+1));break}}else n.push(r)}e.eventRegistrations_=n}else e.eventRegistrations_=[];return i}function oZ(e,t,n,i){var r,s;t.type===b.MERGE&&null!==t.source.queryId&&(F(ov(e.viewCache_),"We should always have a full cache before handling merges"),F(o_(e.viewCache_),"Missing event cache, even though we have a server cache"));let o=e.viewCache_,a=function(e,t,n,i,r){var s,o,a,l,h,u,c,d,f,p,g,m;let y,_,v=new oj;if(n.type===b.OVERWRITE)n.source.fromUser?y=oW(e,t,n.path,n.snap,i,r,v):(F(n.source.fromServer,"Unknown source."),_=n.source.tagged||t.serverCache.isFiltered()&&!sw(n.path),y=oH(e,t,n.path,n.snap,i,r,_,v));else if(n.type===b.MERGE){let d;n.source.fromUser?(s=e,o=t,a=n.path,l=n.children,h=i,u=r,c=v,d=o,l.foreach((e,t)=>{let n=sv(a,e);oK(o,sf(n))&&(d=oW(s,d,n,t,h,u,c))}),l.foreach((e,t)=>{let n=sv(a,e);oK(o,sf(n))||(d=oW(s,d,n,t,h,u,c))}),y=d):(F(n.source.fromServer,"Unknown source."),_=n.source.tagged||t.serverCache.isFiltered(),y=oQ(e,t,n.path,n.children,i,r,_,v))}else if(n.type===b.ACK_USER_WRITE)y=n.revert?function(e,t,n,i,r,s){let o;if(null!=oF(i,n))return t;{let a,l=new oz(i,t,r),h=t.eventCache.getNode();if(sw(n)||".priority"===sf(n)){let n;if(t.serverCache.isFullyInitialized())n=oO(i,ov(t));else{let e=t.serverCache.getNode();F(e instanceof sG,"serverChildren would be complete if leaf node"),n=oL(i,e)}a=e.filter.updateFullNode(h,n,s)}else{let r=sf(n),u=oU(i,r,t.serverCache);null==u&&t.serverCache.isCompleteForChild(r)&&(u=h.getImmediateChild(r)),(a=null!=u?e.filter.updateChild(h,r,u,sg(n),l,s):t.eventCache.getNode().hasChild(r)?e.filter.updateChild(h,r,sG.EMPTY_NODE,sg(n),l,s):h).isEmpty()&&t.serverCache.isFullyInitialized()&&(o=oO(i,ov(t))).isLeafNode()&&(a=e.filter.updateFullNode(a,o,s))}return o=t.serverCache.isFullyInitialized()||null!=oF(i,sd()),om(t,a,o,e.filter.filtersNodes())}}(e,t,n.path,i,r,v):function(e,t,n,i,r,s,o){if(null!=oF(r,n))return t;let a=t.serverCache.isFiltered(),l=t.serverCache;if(null!=i.value)if(sw(n)&&l.isFullyInitialized()||l.isCompleteForPath(n))return oH(e,t,n,l.getNode().getChild(n),r,s,a,o);else{if(!sw(n))return t;let i=new ow(null);return l.getNode().forEachChild(sD,(e,t)=>{i=i.set(new sc(e),t)}),oQ(e,t,n,i,r,s,a,o)}{let h=new ow(null);return i.foreach((e,t)=>{let i=sv(n,e);l.isCompleteForPath(i)&&(h=h.set(e,l.getNode().getChild(i)))}),oQ(e,t,n,h,r,s,a,o)}}(e,t,n.path,n.affectedTree,i,r,v);else if(n.type===b.LISTEN_COMPLETE){let r;d=e,f=t,p=n.path,g=i,m=v,r=f.serverCache,y=o$(d,oy(f,r.getNode(),r.isFullyInitialized()||sw(p),r.isFiltered()),p,g,oB,m)}else throw U("Unknown operation type: "+n.type);let w=v.getChanges();return function(e,t,n){let i=t.eventCache;if(i.isFullyInitialized()){let r=i.getNode().isLeafNode()||i.getNode().isEmpty(),s=o_(e);!(n.length>0)&&e.eventCache.isFullyInitialized()&&(!r||i.getNode().equals(s))&&i.getNode().getPriority().equals(s.getPriority())||n.push(sZ(o_(t)))}}(t,y,w),{viewCache:y,changes:w}}(e.processor_,o,t,n,i);return r=e.processor_,F((s=a.viewCache).eventCache.getNode().isIndexed(r.filter.getIndex()),"Event snap not indexed"),F(s.serverCache.getNode().isIndexed(r.filter.getIndex()),"Server snap not indexed"),F(a.viewCache.serverCache.isFullyInitialized()||!o.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),e.viewCache_=a.viewCache,o0(e,a.changes,a.viewCache.eventCache.getNode(),null)}function o0(e,t,n,i){var r;let s,o,a=i?[i]:e.eventRegistrations_;return r=e.eventGenerator_,s=[],o=[],t.forEach(e=>{var t;"child_changed"===e.type&&r.index_.indexedValueChanged(e.oldSnap,e.snapshotNode)&&o.push((t=e.childName,{type:"child_moved",snapshotNode:e.snapshotNode,childName:t}))}),op(r,s,"child_removed",t,a,n),op(r,s,"child_added",t,a,n),op(r,s,"child_moved",o,a,n),op(r,s,"child_changed",t,a,n),op(r,s,"value",t,a,n),s}class o1{constructor(){this.views=new Map}}function o2(e,t,n,i){let r=t.source.queryId;if(null!==r){let s=e.views.get(r);return F(null!=s,"SyncTree gave us an op for an invalid query."),oZ(s,t,n,i)}{let r=[];for(let s of e.views.values())r=r.concat(oZ(s,t,n,i));return r}}function o6(e){let t=[];for(let n of e.views.values())n.query._queryParams.loadsAllData()||t.push(n);return t}function o3(e,t){let n=null;for(let i of e.views.values())n=n||function(e,t){let n=ov(e.viewCache_);return n&&(e.query._queryParams.loadsAllData()||!sw(t)&&!n.getImmediateChild(sf(t)).isEmpty())?n.getChild(t):null}(i,t);return n}function o5(e,t){if(t._queryParams.loadsAllData())return o8(e);{let n=t._queryIdentifier;return e.views.get(n)}}function o4(e){return null!=o8(e)}function o8(e){for(let t of e.views.values())if(t.query._queryParams.loadsAllData())return t;return null}let o7=1;class o9{constructor(e){this.listenProvider_=e,this.syncPointTree_=new ow(null),this.pendingWriteTree_={visibleWrites:ob.empty(),allWrites:[],lastWriteId:-1},this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function ae(e,t,n,i,r){var s,o;return(s=e.pendingWriteTree_,o=r,F(i>s.lastWriteId,"Stacking an older write on top of newer ones"),void 0===o&&(o=!0),s.allWrites.push({path:t,snap:n,writeId:i,visible:o}),o&&(s.visibleWrites=oE(s.visibleWrites,t,n)),s.lastWriteId=i,r)?ao(e,new ou(os(),t,n)):[]}function at(e,t,n=!1){let i=function(e,t){for(let n=0;n<e.allWrites.length;n++){let i=e.allWrites[n];if(i.writeId===t)return i}return null}(e.pendingWriteTree_,t);if(!function(e,t){var n;let i=e.allWrites.findIndex(e=>e.writeId===t);F(i>=0,"removeWrite called with nonexistent writeId.");let r=e.allWrites[i];e.allWrites.splice(i,1);let s=r.visible,o=!1,a=e.allWrites.length-1;for(;s&&a>=0;){let t=e.allWrites[a];t.visible&&(a>=i&&function(e,t){if(e.snap)return sC(e.path,t);for(let n in e.children)if(e.children.hasOwnProperty(n)&&sC(sv(e.path,n),t))return!0;return!1}(t,r.path)?s=!1:sC(r.path,t.path)&&(o=!0)),a--}return!!s&&(o?((n=e).visibleWrites=ox(n.allWrites,oP,sd()),n.allWrites.length>0?n.lastWriteId=n.allWrites[n.allWrites.length-1].writeId:n.lastWriteId=-1):r.snap?e.visibleWrites=oC(e.visibleWrites,r.path):rW(r.children,t=>{e.visibleWrites=oC(e.visibleWrites,sv(r.path,t))}),!0)}(e.pendingWriteTree_,t))return[];{let t=new ow(null);return null!=i.snap?t=t.set(sd(),!0):rW(i.children,e=>{t=t.set(new sc(e),!0)}),ao(e,new ol(i.path,t,n))}}function an(e,t,n){return ao(e,new ou(oo(),t,n))}function ai(e,t,n,i,r=!1){let s=t._path,o=e.syncPointTree_.get(s),a=[];if(o&&("default"===t._queryIdentifier||null!=o5(o,t))){let u=function(e,t,n,i){let r=t._queryIdentifier,s=[],o=[],a=o4(e);if("default"===r)for(let[t,r]of e.views.entries())o=o.concat(oJ(r,n,i)),oX(r)&&(e.views.delete(t),r.query._queryParams.loadsAllData()||s.push(r.query));else{let t=e.views.get(r);t&&(o=o.concat(oJ(t,n,i)),oX(t)&&(e.views.delete(r),t.query._queryParams.loadsAllData()||s.push(t.query)))}return a&&!o4(e)&&s.push(new(F(c,"Reference.ts has not been loaded"),c)(t._repo,t._path)),{removed:s,events:o}}(o,t,n,i);0===o.views.size&&(e.syncPointTree_=e.syncPointTree_.remove(s));let d=u.removed;if(a=u.events,!r){let n=-1!==d.findIndex(e=>e._queryParams.loadsAllData()),r=e.syncPointTree_.findOnPath(s,(e,t)=>o4(t));if(n&&!r){let t=e.syncPointTree_.subtree(s);if(!t.isEmpty()){let n=t.fold((e,t,n)=>{if(t&&o4(t))return[o8(t)];{let e=[];return t&&(e=o6(t)),rW(n,(t,n)=>{e=e.concat(n)}),e}});for(let t=0;t<n.length;++t){let i=n[t],r=i.query,s=aa(e,i);e.listenProvider_.startListening(af(r),al(e,r),s.hashFn,s.onComplete)}}}r||!(d.length>0)||i||(n?e.listenProvider_.stopListening(af(t),null):d.forEach(t=>{let n=e.queryToTagMap.get(ah(t));e.listenProvider_.stopListening(af(t),n)}))}var l=e,h=d;for(let e=0;e<h.length;++e){let t=h[e];if(!t._queryParams.loadsAllData()){let e=ah(t),n=l.queryToTagMap.get(e);l.queryToTagMap.delete(e),l.tagToQueryMap.delete(n)}}}return a}function ar(e,t,n,i=!1){var r;let s,o,a,l,h=t._path,u=null,c=!1;e.syncPointTree_.foreachOnPath(h,(e,t)=>{let n=sb(e,h);u=u||o3(t,n),c=c||o4(t)});let d=e.syncPointTree_.get(h);d?(c=c||o4(d),u=u||o3(d,sd())):(d=new o1,e.syncPointTree_=e.syncPointTree_.set(h,d)),null!=u?s=!0:(s=!1,u=sG.EMPTY_NODE,e.syncPointTree_.subtree(h).foreachChild((e,t)=>{let n=o3(t,sd());n&&(u=u.updateImmediateChild(e,n))}));let f=null!=o5(d,t);if(!f&&!t._queryParams.loadsAllData()){let n=ah(t);F(!e.queryToTagMap.has(n),"View does not exist, but we have a tag");let i=o7++;e.queryToTagMap.set(n,i),e.tagToQueryMap.set(i,n)}let p=oq(h,e.pendingWriteTree_),g=(o=function(e,t,n,i,r){let s=t._queryIdentifier,o=e.views.get(s);if(!o){let e=oO(n,r?i:null),s=!1;return e?s=!0:(e=i instanceof sG?oL(n,i):sG.EMPTY_NODE,s=!1),new oY(t,og(new od(e,s,!1),new od(i,r,!1)))}return o}(r=d,t,p,u,s),r.views.has(t._queryIdentifier)||r.views.set(t._queryIdentifier,o),o.eventRegistrations_.push(n),a=o.viewCache_.eventCache,l=[],a.getNode().isLeafNode()||a.getNode().forEachChild(sB,(e,t)=>{l.push(s0(e,t))}),a.isFullyInitialized()&&l.push(sZ(a.getNode())),o0(o,l,a.getNode(),n));if(!f&&!c&&!i){let n=o5(d,t);g=g.concat(function(e,t,n){let i=t._path,r=al(e,t),s=aa(e,n),o=e.listenProvider_.startListening(af(t),r,s.hashFn,s.onComplete),a=e.syncPointTree_.subtree(i);if(r)F(!o4(a.value),"If we're adding a query, it shouldn't be shadowed");else{let t=a.fold((e,t,n)=>{if(!sw(e)&&t&&o4(t))return[o8(t).query];{let e=[];return t&&(e=e.concat(o6(t).map(e=>e.query))),rW(n,(t,n)=>{e=e.concat(n)}),e}});for(let n=0;n<t.length;++n){let i=t[n];e.listenProvider_.stopListening(af(i),al(e,i))}}return o}(e,t,n))}return g}function as(e,t,n){let i=e.pendingWriteTree_,r=e.syncPointTree_.findOnPath(t,(e,n)=>{let i=o3(n,sb(e,t));if(i)return i});return oD(i,t,r,n,!0)}function ao(e,t){var n;return function e(t,n,i,r){if(sw(t.path))return function e(t,n,i,r){let s=n.get(sd());null==i&&null!=s&&(i=o3(s,sd()));let o=[];return n.children.inorderTraversal((n,s)=>{let a=i?i.getImmediateChild(n):null,l=oV(r,n),h=t.operationForChild(n);h&&(o=o.concat(e(h,s,a,l)))}),s&&(o=o.concat(o2(s,t,r,i))),o}(t,n,i,r);{let s=n.get(sd());null==i&&null!=s&&(i=o3(s,sd()));let o=[],a=sf(t.path),l=t.operationForChild(a),h=n.children.get(a);if(h&&l){let t=i?i.getImmediateChild(a):null,n=oV(r,a);o=o.concat(e(l,h,t,n))}return s&&(o=o.concat(o2(s,t,r,i))),o}}(t,e.syncPointTree_,null,(n=e.pendingWriteTree_,oq(sd(),n)))}function aa(e,t){let n=t.query,i=al(e,n);return{hashFn:()=>(t.viewCache_.serverCache.getNode()||sG.EMPTY_NODE).hash(),onComplete:t=>{var r;if("ok"===t)if(i)return function(e,t,n){let i=au(e,n);if(!i)return[];{let n=ac(i),r=n.path,s=n.queryId,o=sb(r,t);return ad(e,r,new oh(oa(s),o))}}(e,n._path,i);else return r=n._path,ao(e,new oh(oo(),r));{let i,r,s=(i="Unknown Error","too_big"===t?i="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===t?i="Client doesn't have permission to access the desired data.":"unavailable"===t&&(i="The service is unavailable"),(r=Error(t+" at "+n._path.toString()+": "+i)).code=t.toUpperCase(),r);return ai(e,n,null,s)}}}}function al(e,t){let n=ah(t);return e.queryToTagMap.get(n)}function ah(e){return e._path.toString()+"$"+e._queryIdentifier}function au(e,t){return e.tagToQueryMap.get(t)}function ac(e){let t=e.indexOf("$");return F(-1!==t&&t<e.length-1,"Bad queryKey."),{queryId:e.substr(t+1),path:new sc(e.substr(0,t))}}function ad(e,t,n){let i=e.syncPointTree_.get(t);return F(i,"Missing sync point for query tag that we're tracking"),o2(i,n,oq(t,e.pendingWriteTree_),null)}function af(e){return e._queryParams.loadsAllData()&&!e._queryParams.isDefault()?new(F(d,"Reference.ts has not been loaded"),d)(e._repo,e._path):e}class ap{constructor(e){this.node_=e}getImmediateChild(e){return new ap(this.node_.getImmediateChild(e))}node(){return this.node_}}class ag{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){let t=sv(this.path_,e);return new ag(this.syncTree_,t)}node(){return as(this.syncTree_,this.path_)}}let am=function(e,t,n){return e&&"object"==typeof e?(F(".sv"in e,"Unexpected leaf node or priority contents"),"string"==typeof e[".sv"])?ay(e[".sv"],t,n):"object"==typeof e[".sv"]?a_(e[".sv"],t):void F(!1,"Unexpected server value: "+JSON.stringify(e,null,2)):e},ay=function(e,t,n){if("timestamp"===e)return n.timestamp;F(!1,"Unexpected server value: "+e)},a_=function(e,t,n){e.hasOwnProperty("increment")||F(!1,"Unexpected server value: "+JSON.stringify(e,null,2));let i=e.increment;"number"!=typeof i&&F(!1,"Unexpected increment value: "+i);let r=t.node();if(F(null!=r,"Expected ChildrenNode.EMPTY_NODE for nulls"),!r.isLeafNode())return i;let s=r.getValue();return"number"!=typeof s?i:s+i},av=function(e,t,n,i){return ab(t,new ag(n,e),i)},aw=function(e,t,n){return ab(e,new ap(t),n)};function ab(e,t,n){let i,r=am(e.getPriority().val(),t.getImmediateChild(".priority"),n);if(!e.isLeafNode())return i=e,r!==e.getPriority().val()&&(i=i.updatePriority(new sj(r))),e.forEachChild(sB,(e,r)=>{let s=ab(r,t.getImmediateChild(e),n);s!==r&&(i=i.updateImmediateChild(e,s))}),i;{let i=am(e.getValue(),t,n);return i!==e.getValue()||r!==e.getPriority().val()?new sj(i,sY(r)):e}}class aE{constructor(e="",t=null,n={children:{},childCount:0}){this.name=e,this.parent=t,this.node=n}}function aT(e,t){let n=t instanceof sc?t:new sc(t),i=e,r=sf(n);for(;null!==r;){let e=e_(i.node.children,r)||{children:{},childCount:0};i=new aE(r,i,e),r=sf(n=sg(n))}return i}function aC(e){return e.node.value}function aI(e,t){e.node.value=t,function e(t){null!==t.parent&&function(t,n,i){let r=void 0===aC(i)&&!aS(i),s=ey(t.node.children,n);r&&s?(delete t.node.children[n],t.node.childCount--,e(t)):r||s||(t.node.children[n]=i.node,t.node.childCount++,e(t))}(t.parent,t.name,t)}(e)}function aS(e){return e.node.childCount>0}function ak(e,t){rW(e.node.children,(n,i)=>{t(new aE(n,e,i))})}function aA(e){return new sc(null===e.parent?e.name:aA(e.parent)+"/"+e.name)}let aN=/[\[\].#$\/\u0000-\u001F\u007F]/,aR=/[\[\].#$\u0000-\u001F\u007F]/,aP=function(e){return"string"==typeof e&&0!==e.length&&!aN.test(e)},ax=function(e){return"string"==typeof e&&0!==e.length&&!aR.test(e)},aD=function(e,t,n,i){i&&void 0===t||aO(eN(e,"value"),t,n)},aO=function(e,t,n){let i=n instanceof sc?new sI(n,e):n;if(void 0===t)throw Error(e+"contains undefined "+sk(i));if("function"==typeof t)throw Error(e+"contains a function "+sk(i)+" with contents = "+t.toString());if(rF(t))throw Error(e+"contains "+t.toString()+" "+sk(i));if("string"==typeof t&&t.length>3495253.3333333335&&eP(t)>0xa00000)throw Error(e+"contains a string greater than 10485760 utf8 bytes "+sk(i)+" ('"+t.substring(0,50)+"...')");if(t&&"object"==typeof t){let n=!1,r=!1;if(rW(t,(t,s)=>{let o;if(".value"===t)n=!0;else if(".priority"!==t&&".sv"!==t&&(r=!0,!aP(t)))throw Error(e+" contains an invalid key ("+t+") "+sk(i)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');i.parts_.length>0&&(i.byteLength_+=1),i.parts_.push(t),i.byteLength_+=eP(t),sS(i),aO(e,s,i),o=i.parts_.pop(),i.byteLength_-=eP(o),i.parts_.length>0&&(i.byteLength_-=1)}),n&&r)throw Error(e+' contains ".value" child '+sk(i)+" in addition to actual children.")}},aL=function(e,t){let n,i;for(n=0;n<t.length;n++){let r=sy(i=t[n]);for(let t=0;t<r.length;t++)if(".priority"===r[t]&&t===r.length-1);else if(!aP(r[t]))throw Error(e+"contains an invalid key ("+r[t]+") in path "+i.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"')}t.sort(sE);let r=null;for(n=0;n<t.length;n++){if(i=t[n],null!==r&&sC(r,i))throw Error(e+"contains a path "+r.toString()+" that is ancestor of another path "+i.toString());r=i}},aM=function(e,t,n,i){if(i&&void 0===t)return;let r=eN(e,"values");if(!(t&&"object"==typeof t)||Array.isArray(t))throw Error(r+" must be an object containing the children to replace.");let s=[];rW(t,(e,t)=>{let i=new sc(e);if(aO(r,t,sv(n,i)),".priority"===sm(i)&&!(null===t||"string"==typeof t||"number"==typeof t&&!rF(t)||t&&"object"==typeof t&&ey(t,".sv")))throw Error(r+"contains an invalid value for '"+i.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");s.push(i)}),aL(r,s)},aF=function(e,t,n,i){if((!i||void 0!==n)&&!ax(n))throw Error(eN(e,t)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},aU=function(e,t,n,i){n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),aF(e,t,n,i)},aV=function(e,t){if(".info"===sf(t))throw Error(e+" failed = Can't modify data under /.info/")},aq=function(e,t){var n;let i=t.path.toString();if("string"!=typeof t.repoInfo.host||0===t.repoInfo.host.length||!aP(t.repoInfo.namespace)&&"localhost"!==t.repoInfo.host.split(":")[0]||0!==i.length&&((n=i)&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),!ax(n)))throw Error(eN(e,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')};class aj{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function aB(e,t){let n=null;for(let i=0;i<t.length;i++){let r=t[i],s=r.getPath();null===n||sT(s,n.path)||(e.eventLists_.push(n),n=null),null===n&&(n={events:[],path:s}),n.events.push(r)}n&&e.eventLists_.push(n)}function az(e,t,n){aB(e,n),aH(e,e=>sT(e,t))}function a$(e,t,n){aB(e,n),aH(e,e=>sC(e,t)||sC(t,e))}function aH(e,t){e.recursionDepth_++;let n=!0;for(let i=0;i<e.eventLists_.length;i++){let r=e.eventLists_[i];r&&(t(r.path)?(function(e){for(let t=0;t<e.events.length;t++){let n=e.events[t];if(null!==n){e.events[t]=null;let i=n.getEventRunner();rA&&rP("event: "+n.toString()),rY(i)}}}(e.eventLists_[i]),e.eventLists_[i]=null):n=!1)}n&&(e.eventLists_=[]),e.recursionDepth_--}class aW{constructor(e,t,n,i){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=n,this.appCheckProvider_=i,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new aj,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=ot(),this.transactionQueueTree_=new aE,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function aK(e){let t=e.infoData_.getNode(new sc(".info/serverTimeOffset")).val()||0;return new Date().getTime()+t}function aG(e){var t;return(t=t={timestamp:aK(e)}).timestamp=t.timestamp||new Date().getTime(),t}function aQ(e,t,n,i,r){e.dataUpdateCount++;let s=new sc(t);n=e.interceptServerDataCallback_?e.interceptServerDataCallback_(t,n):n;let o=[];if(r)if(i){let t=ew(n,e=>sY(e));o=function(e,t,n,i){let r=au(e,i);if(!r)return[];{let i=ac(r),s=i.path,o=i.queryId,a=sb(s,t),l=ow.fromObject(n);return ad(e,s,new oc(oa(o),a,l))}}(e.serverSyncTree_,s,t,r)}else{let t=sY(n);o=function(e,t,n,i){let r=au(e,i);if(null==r)return[];{let i=ac(r),s=i.path,o=i.queryId,a=sb(s,t);return ad(e,s,new ou(oa(o),a,n))}}(e.serverSyncTree_,s,t,r)}else if(i){var a;let t,i=ew(n,e=>sY(e));a=e.serverSyncTree_,t=ow.fromObject(i),o=ao(a,new oc(oo(),s,t))}else{let t=sY(n);o=an(e.serverSyncTree_,s,t)}let l=s;o.length>0&&(l=a6(e,s)),a$(e.eventQueue_,l,o)}function aY(e,t){var n;let i,r,s;aX(e,"connected",t),!1===t&&(a0(n=e,"onDisconnectEvents"),i=aG(n),r=ot(),on(n.onDisconnect_,sd(),(e,t)=>{let s=av(e,t,n.serverSyncTree_,i);!function e(t,n,i){if(sw(n))t.value=i,t.children.clear();else if(null!==t.value)t.value=t.value.updateChild(n,i);else{let r=sf(n);t.children.has(r)||t.children.set(r,ot()),e(t.children.get(r),n=sg(n),i)}}(r,e,s)}),s=[],on(r,sd(),(e,t)=>{s=s.concat(an(n.serverSyncTree_,e,t));let i=a8(n,e);a6(n,i)}),n.onDisconnect_=ot(),a$(n.eventQueue_,sd(),s))}function aX(e,t,n){let i=new sc("/.info/"+t),r=sY(n);e.infoData_.updateSnapshot(i,r);let s=an(e.infoSyncTree_,i,r);a$(e.eventQueue_,i,s)}function aJ(e){return e.nextWriteId_++}function aZ(e,t,n){let i;i=".info"===sf(t._path)?ai(e.infoSyncTree_,t,n):ai(e.serverSyncTree_,t,n),az(e.eventQueue_,t._path,i)}function a0(e,...t){let n="";e.persistentConnection_&&(n=e.persistentConnection_.id+":"),rP(n,...t)}function a1(e,t,n,i){t&&rY(()=>{if("ok"===n)t(null);else{let e=(n||"error").toUpperCase(),r=e;i&&(r+=": "+i);let s=Error(r);s.code=e,t(s)}})}function a2(e,t,n){return as(e.serverSyncTree_,t,n)||sG.EMPTY_NODE}function a6(e,t){let n=a3(e,t),i=aA(n),r=a5(e,n);return function(e,t,n){if(0===t.length)return;let i=[],r=[],s=t.filter(e=>0===e.status).map(e=>e.currentWriteId);for(let o=0;o<t.length;o++){let a=t[o],l=sb(n,a.path),h=!1,u;if(F(null!==l,"rerunTransactionsUnderNode_: relativePath should not be null."),4===a.status)h=!0,u=a.abortReason,r=r.concat(at(e.serverSyncTree_,a.currentWriteId,!0));else if(0===a.status)if(a.retryCount>=25)h=!0,u="maxretry",r=r.concat(at(e.serverSyncTree_,a.currentWriteId,!0));else{let n=a2(e,a.path,s);a.currentInputSnapshot=n;let i=t[o].update(n.val());if(void 0!==i){aO("transaction failed: Data returned ",i,a.path);let t=sY(i);"object"==typeof i&&null!=i&&ey(i,".priority")||(t=t.updatePriority(n.getPriority()));let o=a.currentWriteId,l=aw(t,n,aG(e));a.currentOutputSnapshotRaw=t,a.currentOutputSnapshotResolved=l,a.currentWriteId=aJ(e),s.splice(s.indexOf(o),1),r=(r=r.concat(ae(e.serverSyncTree_,a.path,l,a.currentWriteId,a.applyLocally))).concat(at(e.serverSyncTree_,o,!0))}else h=!0,u="nodata",r=r.concat(at(e.serverSyncTree_,a.currentWriteId,!0))}a$(e.eventQueue_,n,r),r=[],h&&(t[o].status=2,setTimeout(t[o].unwatcher,Math.floor(0)),t[o].onComplete&&("nodata"===u?i.push(()=>t[o].onComplete(null,!1,t[o].currentInputSnapshot)):i.push(()=>t[o].onComplete(Error(u),!1,null))))}a4(e,e.transactionQueueTree_);for(let e=0;e<i.length;e++)rY(i[e]);!function e(t,n=t.transactionQueueTree_){if(n||a4(t,n),aC(n)){let i=a5(t,n);F(i.length>0,"Sending zero length transaction queue"),i.every(e=>0===e.status)&&function(t,n,i){let r=a2(t,n,i.map(e=>e.currentWriteId)),s=r,o=r.hash();for(let e=0;e<i.length;e++){let t=i[e];F(0===t.status,"tryToSendTransactionQueue_: items in queue should all be run."),t.status=1,t.retryCount++;let r=sb(n,t.path);s=s.updateChild(r,t.currentOutputSnapshotRaw)}let a=s.val(!0);t.server_.put(n.toString(),a,r=>{a0(t,"transaction put response",{path:n.toString(),status:r});let s=[];if("ok"===r){let r=[];for(let e=0;e<i.length;e++)i[e].status=2,s=s.concat(at(t.serverSyncTree_,i[e].currentWriteId)),i[e].onComplete&&r.push(()=>i[e].onComplete(null,!0,i[e].currentOutputSnapshotResolved)),i[e].unwatcher();a4(t,aT(t.transactionQueueTree_,n)),e(t,t.transactionQueueTree_),a$(t.eventQueue_,n,s);for(let e=0;e<r.length;e++)rY(r[e])}else{if("datastale"===r)for(let e=0;e<i.length;e++)3===i[e].status?i[e].status=4:i[e].status=0;else{rL("transaction at "+n.toString()+" failed: "+r);for(let e=0;e<i.length;e++)i[e].status=4,i[e].abortReason=r}a6(t,n)}},o)}(t,aA(n),i)}else aS(n)&&ak(n,n=>{e(t,n)})}(e,e.transactionQueueTree_)}(e,r,i),i}function a3(e,t){let n,i=e.transactionQueueTree_;for(n=sf(t);null!==n&&void 0===aC(i);)i=aT(i,n),n=sf(t=sg(t));return i}function a5(e,t){let n=[];return function e(t,n,i){let r=aC(n);if(r)for(let e=0;e<r.length;e++)i.push(r[e]);ak(n,n=>{e(t,n,i)})}(e,t,n),n.sort((e,t)=>e.order-t.order),n}function a4(e,t){let n=aC(t);if(n){let e=0;for(let t=0;t<n.length;t++)2!==n[t].status&&(n[e]=n[t],e++);n.length=e,aI(t,n.length>0?n:void 0)}ak(t,t=>{a4(e,t)})}function a8(e,t){let n=aA(a3(e,t)),i=aT(e.transactionQueueTree_,t);return!function(e,t,n){let i=e.parent;for(;null!==i;){if(t(i))return!0;i=i.parent}}(i,t=>{a7(e,t)}),a7(e,i),!function e(t,n,i,r){i&&!r&&n(t),ak(t,t=>{e(t,n,!0,r)}),i&&r&&n(t)}(i,t=>{a7(e,t)}),n}function a7(e,t){let n=aC(t);if(n){let i=[],r=[],s=-1;for(let t=0;t<n.length;t++)3===n[t].status||(1===n[t].status?(F(s===t-1,"All SENT items should be at beginning of queue."),s=t,n[t].status=3,n[t].abortReason="set"):(F(0===n[t].status,"Unexpected transaction status in abort"),n[t].unwatcher(),r=r.concat(at(e.serverSyncTree_,n[t].currentWriteId,!0)),n[t].onComplete&&i.push(n[t].onComplete.bind(null,Error("set"),!1,null))));-1===s?aI(t,void 0):n.length=s+1,a$(e.eventQueue_,aA(t),r);for(let e=0;e<i.length;e++)rY(i[e])}}let a9=function(e,t){let n=le(e),i=n.namespace;"firebase.com"===n.domain&&rO(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),i&&"undefined"!==i||"localhost"===n.domain||rO("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||rM();let r="ws"===n.scheme||"wss"===n.scheme;return{repoInfo:new r3(n.host,n.secure,i,r,t,"",i!==n.subdomain),path:new sc(n.pathString)}},le=function(e){let t="",n="",i="",r="",s="",o=!0,a="https",l=443;if("string"==typeof e){let h=e.indexOf("//");h>=0&&(a=e.substring(0,h-1),e=e.substring(h+2));let u=e.indexOf("/");-1===u&&(u=e.length);let c=e.indexOf("?");-1===c&&(c=e.length),t=e.substring(0,Math.min(u,c)),u<c&&(r=function(e){let t="",n=e.split("/");for(let e=0;e<n.length;e++)if(n[e].length>0){let i=n[e];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch(e){}t+="/"+i}return t}(e.substring(u,c)));let d=function(e){let t={};for(let n of("?"===e.charAt(0)&&(e=e.substring(1)),e.split("&"))){if(0===n.length)continue;let i=n.split("=");2===i.length?t[decodeURIComponent(i[0])]=decodeURIComponent(i[1]):rL(`Invalid query segment '${n}' in query '${e}'`)}return t}(e.substring(Math.min(e.length,c)));(h=t.indexOf(":"))>=0?(o="https"===a||"wss"===a,l=parseInt(t.substring(h+1),10)):h=t.length;let f=t.slice(0,h);if("localhost"===f.toLowerCase())n="localhost";else if(f.split(".").length<=2)n=f;else{let e=t.indexOf(".");i=t.substring(0,e).toLowerCase(),n=t.substring(e+1),s=i}"ns"in d&&(s=d.ns)}return{host:t,port:l,domain:n,subdomain:i,secure:o,scheme:a,pathString:r,namespace:s}},lt="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",ln=(p=0,g=[],function(e){let t,n=e===p;p=e;let i=Array(8);for(t=7;t>=0;t--)i[t]=lt.charAt(e%64),e=Math.floor(e/64);F(0===e,"Cannot push at time == 0");let r=i.join("");if(n){for(t=11;t>=0&&63===g[t];t--)g[t]=0;g[t]++}else for(t=0;t<12;t++)g[t]=Math.floor(64*Math.random());for(t=0;t<12;t++)r+=lt.charAt(g[t]);return F(20===r.length,"nextPushId: Length should be 20."),r});class li{constructor(e,t,n,i){this.eventType=e,this.eventRegistration=t,this.snapshot=n,this.prevName=i}getPath(){let e=this.snapshot.ref;return"value"===this.eventType?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+ef(this.snapshot.exportVal())}}class lr{constructor(e,t,n){this.eventRegistration=e,this.error=t,this.path=n}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}class ls{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return F(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||void 0!==this.snapshotCallback.userCallback&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}class lo{constructor(e,t,n,i){this._repo=e,this._path=t,this._queryParams=n,this._orderByCalled=i}get key(){return sw(this._path)?null:sm(this._path)}get ref(){return new la(this._repo,this._path)}get _queryIdentifier(){let e=r$(s7(this._queryParams));return"{}"===e?"default":e}get _queryObject(){return s7(this._queryParams)}isEqual(e){if(!((e=ex(e))instanceof lo))return!1;let t=this._repo===e._repo,n=sT(this._path,e._path),i=this._queryIdentifier===e._queryIdentifier;return t&&n&&i}toJSON(){return this.toString()}toString(){return this._repo.toString()+function(e){let t="";for(let n=e.pieceNum_;n<e.pieces_.length;n++)""!==e.pieces_[n]&&(t+="/"+encodeURIComponent(String(e.pieces_[n])));return t||"/"}(this._path)}}class la extends lo{constructor(e,t){super(e,t,new s4,!1)}get parent(){let e=s_(this._path);return null===e?null:new la(this._repo,e)}get root(){let e=this;for(;null!==e.parent;)e=e.parent;return e}}class ll{constructor(e,t,n){this._node=e,this.ref=t,this._index=n}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){let t=new sc(e),n=lu(this.ref,e);return new ll(this._node.getChild(t),n,sB)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return!this._node.isLeafNode()&&!!this._node.forEachChild(this._index,(t,n)=>e(new ll(n,lu(this.ref,t),sB)))}hasChild(e){let t=new sc(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return!this._node.isLeafNode()&&!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function lh(e,t){return(e=ex(e))._checkNotDeleted("ref"),void 0!==t?lu(e._root,t):e._root}function lu(e,t){return null===sf((e=ex(e))._path)?aU("child","path",t,!1):aF("child","path",t,!1),new la(e._repo,sv(e._path,t))}function lc(e,t){var n,i,r;let s,o,a,l,h,u;aV("set",(e=ex(e))._path),aD("set",t,e._path,!1);let c=new X;return n=e._repo,i=e._path,r=c.wrapCallback(()=>{}),a0(n,"set",{path:i.toString(),value:t,priority:null}),s=aG(n),a=aw(o=sY(t,null),as(n.serverSyncTree_,i),s),l=aJ(n),h=ae(n.serverSyncTree_,i,a,l,!0),aB(n.eventQueue_,h),n.server_.put(i.toString(),o.val(!0),(e,t)=>{let s="ok"===e;s||rL("set at "+i+" failed: "+e);let o=at(n.serverSyncTree_,l,!s);a$(n.eventQueue_,i,o),a1(n,r,e,t)}),u=a8(n,i),a6(n,u),a$(n.eventQueue_,u,[]),c.promise}class ld{constructor(e){this.callbackContext=e}respondsTo(e){return"value"===e}createEvent(e,t){let n=t._queryParams.getIndex();return new li("value",this,new ll(e.snapshotNode,new la(t._repo,t._path),n))}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new lr(this,e,t):null}matches(e){return e instanceof ld&&(!e.callbackContext||!this.callbackContext||e.callbackContext.matches(this.callbackContext))}hasAnyCallback(){return null!==this.callbackContext}}class lf{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t="children_added"===e?"child_added":e;return t="children_removed"===t?"child_removed":t,this.eventType===t}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new lr(this,e,t):null}createEvent(e,t){F(null!=e.childName,"Child events should have a childName.");let n=lu(new la(t._repo,t._path),e.childName),i=t._queryParams.getIndex();return new li(e.type,this,new ll(e.snapshotNode,n,i),e.prevName)}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof lf&&this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext))}hasAnyCallback(){return!!this.callbackContext}}function lp(e,t,n,i){return function(e,t,n,i,r){var s;let o,a;if("object"==typeof i&&(o=void 0,r=i),"function"==typeof i&&(o=i),r&&r.onlyOnce){let t=n,i=(n,i)=>{aZ(e._repo,e,h),t(n,i)};i.userCallback=n.userCallback,i.context=n.context,n=i}let l=new ls(n,o||void 0),h="value"===t?new ld(l):new lf(t,l);return s=e._repo,a=".info"===sf(e._path)?ar(s.infoSyncTree_,e,h):ar(s.serverSyncTree_,e,h),az(s.eventQueue_,e._path,a),()=>aZ(e._repo,e,h)}(e,"value",t,n,i)}F(!c,"__referenceConstructor has already been defined"),c=la,F(!d,"__referenceConstructor has already been defined"),d=la;let lg={};class lm{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(!function(e,t,n){var i;let r;if(e.stats_=r9(e.repoInfo_),e.forceRestClient_||("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0)e.server_=new s9(e.repoInfo_,(t,n,i,r)=>{aQ(e,t,n,i,r)},e.authTokenProvider_,e.appCheckProvider_),setTimeout(()=>aY(e,!0),0);else{if(null!=n){if("object"!=typeof n)throw Error("Only objects are supported for option databaseAuthVariableOverride");try{ef(n)}catch(e){throw Error("Invalid authOverride provided: "+e)}}e.persistentConnection_=new sN(e.repoInfo_,t,(t,n,i,r)=>{aQ(e,t,n,i,r)},t=>{aY(e,t)},t=>{var n;n=e,rW(t,(e,t)=>{aX(n,e,t)})},e.authTokenProvider_,e.appCheckProvider_,n),e.server_=e.persistentConnection_}e.authTokenProvider_.addTokenChangeListener(t=>{e.server_.refreshAuthToken(t)}),e.appCheckProvider_.addTokenChangeListener(t=>{e.server_.refreshAppCheckToken(t.token)}),i=e.repoInfo_,r7[r=i.toString()]||(r7[r]=(()=>new or(e.stats_,e.server_))()),e.statsReporter_=r7[r],e.infoData_=new oe,e.infoSyncTree_=new o9({startListening:(t,n,i,r)=>{let s=[],o=e.infoData_.getNode(t._path);return o.isEmpty()||(s=an(e.infoSyncTree_,t._path,o),setTimeout(()=>{r("ok")},0)),s},stopListening:()=>{}}),aX(e,"connected",!1),e.serverSyncTree_=new o9({startListening:(t,n,i,r)=>(e.server_.listen(t,i,n,(n,i)=>{let s=r(n,i);a$(e.eventQueue_,t._path,s)}),[]),stopListening:(t,n)=>{e.server_.unlisten(t,n)}})}(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new la(this._repo,sd())),this._rootInternal}_delete(){if(null!==this._rootInternal){var e,t;let n;e=this._repo,(n=lg[t=this.app.name])&&n[e.key]===e||rO(`Database ${t}(${e.repoInfo_}) has already been deleted.`),e.persistentConnection_&&e.persistentConnection_.interrupt("repo_interrupt"),delete n[e.key],this._repoInternal=null,this._rootInternal=null}return Promise.resolve()}_checkNotDeleted(e){null===this._rootInternal&&rO("Cannot call "+e+" on a deleted database.")}}sN.prototype.simpleListen=function(e,t){this.sendRequest("q",{p:e},t)},sN.prototype.echo=function(e,t){this.sendRequest("echo",{d:e},t)},r_=tf,tn(new eD("database",(e,{instanceIdentifier:t})=>{var n,i,r,s;let o,a,l,h,u,c,d,f=e.getProvider("app").getImmediate(),p=e.getProvider("auth-internal"),g=e.getProvider("app-check-internal");return void 0===(l=t||f.options.databaseURL)&&(f.options.projectId||rO("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),rP("Using default host for project ",f.options.projectId),l=`${f.options.projectId}-default-rtdb.firebaseio.com`),u=(h=a9(l,void 0)).repoInfo,void 0!==M.default&&M.default.env&&(c=M.default.env.FIREBASE_DATABASE_EMULATOR_HOST),c?u=(h=a9(l=`http://${c}?ns=${u.namespace}`,void 0)).repoInfo:!h.repoInfo.secure,d=new rZ(f.name,f.options,p),aq("Invalid Firebase Database URL",h),sw(h.path)||rO("Database URL must point to the root of a Firebase Database (not including a child path)."),new lm((n=u,i=f,r=d,s=new rJ(f,g),(o=lg[i.name])||(o={},lg[i.name]=o),(a=o[n.toURLString()])&&rO("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),a=new aW(n,!1,r,s),o[n.toURLString()]=a,a),f)},"PUBLIC").setMultipleInstances(!0)),tv(rm,ry,void 0),tv(rm,ry,"esm2020");var ly=e.i(67034),l_="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:e.g,lv={};(function(){function e(){this.blockSize=-1,this.blockSize=64,this.g=[,,,,],this.C=Array(this.blockSize),this.o=this.h=0,this.u()}var t=function(){this.blockSize=-1};function n(){}function i(e,t,n){n||(n=0);let i=Array(16);if("string"==typeof t)for(var r=0;r<16;++r)i[r]=t.charCodeAt(n++)|t.charCodeAt(n++)<<8|t.charCodeAt(n++)<<16|t.charCodeAt(n++)<<24;else for(r=0;r<16;++r)i[r]=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;t=e.g[0],n=e.g[1],r=e.g[2];let s=e.g[3],o;o=t+(s^n&(r^s))+i[0]+0xd76aa478|0,o=s+(r^(t=n+(o<<7|o>>>25))&(n^r))+i[1]+0xe8c7b756|0,o=r+(n^(s=t+(o<<12|o>>>20))&(t^n))+i[2]+0x242070db|0,o=n+(t^(r=s+(o<<17|o>>>15))&(s^t))+i[3]+0xc1bdceee|0,o=t+(s^(n=r+(o<<22|o>>>10))&(r^s))+i[4]+0xf57c0faf|0,o=s+(r^(t=n+(o<<7|o>>>25))&(n^r))+i[5]+0x4787c62a|0,o=r+(n^(s=t+(o<<12|o>>>20))&(t^n))+i[6]+0xa8304613|0,o=n+(t^(r=s+(o<<17|o>>>15))&(s^t))+i[7]+0xfd469501|0,o=t+(s^(n=r+(o<<22|o>>>10))&(r^s))+i[8]+0x698098d8|0,o=s+(r^(t=n+(o<<7|o>>>25))&(n^r))+i[9]+0x8b44f7af|0,o=r+(n^(s=t+(o<<12|o>>>20))&(t^n))+i[10]+0xffff5bb1|0,o=n+(t^(r=s+(o<<17|o>>>15))&(s^t))+i[11]+0x895cd7be|0,o=t+(s^(n=r+(o<<22|o>>>10))&(r^s))+i[12]+0x6b901122|0,o=s+(r^(t=n+(o<<7|o>>>25))&(n^r))+i[13]+0xfd987193|0,o=r+(n^(s=t+(o<<12|o>>>20))&(t^n))+i[14]+0xa679438e|0,o=n+(t^(r=s+(o<<17|o>>>15))&(s^t))+i[15]+0x49b40821|0,n=r+(o<<22|o>>>10),o=t+(r^s&(n^r))+i[1]+0xf61e2562|0,t=n+(o<<5|o>>>27),o=s+(n^r&(t^n))+i[6]+0xc040b340|0,s=t+(o<<9|o>>>23),o=r+(t^n&(s^t))+i[11]+0x265e5a51|0,r=s+(o<<14|o>>>18),o=n+(s^t&(r^s))+i[0]+0xe9b6c7aa|0,n=r+(o<<20|o>>>12),o=t+(r^s&(n^r))+i[5]+0xd62f105d|0,t=n+(o<<5|o>>>27),o=s+(n^r&(t^n))+i[10]+0x2441453|0,s=t+(o<<9|o>>>23),o=r+(t^n&(s^t))+i[15]+0xd8a1e681|0,r=s+(o<<14|o>>>18),o=n+(s^t&(r^s))+i[4]+0xe7d3fbc8|0,n=r+(o<<20|o>>>12),o=t+(r^s&(n^r))+i[9]+0x21e1cde6|0,t=n+(o<<5|o>>>27),o=s+(n^r&(t^n))+i[14]+0xc33707d6|0,s=t+(o<<9|o>>>23),o=r+(t^n&(s^t))+i[3]+0xf4d50d87|0,r=s+(o<<14|o>>>18),o=n+(s^t&(r^s))+i[8]+0x455a14ed|0,n=r+(o<<20|o>>>12),o=t+(r^s&(n^r))+i[13]+0xa9e3e905|0,t=n+(o<<5|o>>>27),o=s+(n^r&(t^n))+i[2]+0xfcefa3f8|0,s=t+(o<<9|o>>>23),o=r+(t^n&(s^t))+i[7]+0x676f02d9|0,r=s+(o<<14|o>>>18),o=n+(s^t&(r^s))+i[12]+0x8d2a4c8a|0,o=t+((n=r+(o<<20|o>>>12))^r^s)+i[5]+0xfffa3942|0,o=s+((t=n+(o<<4|o>>>28))^n^r)+i[8]+0x8771f681|0,o=r+((s=t+(o<<11|o>>>21))^t^n)+i[11]+0x6d9d6122|0,o=n+((r=s+(o<<16|o>>>16))^s^t)+i[14]+0xfde5380c|0,o=t+((n=r+(o<<23|o>>>9))^r^s)+i[1]+0xa4beea44|0,o=s+((t=n+(o<<4|o>>>28))^n^r)+i[4]+0x4bdecfa9|0,o=r+((s=t+(o<<11|o>>>21))^t^n)+i[7]+0xf6bb4b60|0,o=n+((r=s+(o<<16|o>>>16))^s^t)+i[10]+0xbebfbc70|0,o=t+((n=r+(o<<23|o>>>9))^r^s)+i[13]+0x289b7ec6|0,o=s+((t=n+(o<<4|o>>>28))^n^r)+i[0]+0xeaa127fa|0,o=r+((s=t+(o<<11|o>>>21))^t^n)+i[3]+0xd4ef3085|0,o=n+((r=s+(o<<16|o>>>16))^s^t)+i[6]+0x4881d05|0,o=t+((n=r+(o<<23|o>>>9))^r^s)+i[9]+0xd9d4d039|0,o=s+((t=n+(o<<4|o>>>28))^n^r)+i[12]+0xe6db99e5|0,o=r+((s=t+(o<<11|o>>>21))^t^n)+i[15]+0x1fa27cf8|0,o=n+((r=s+(o<<16|o>>>16))^s^t)+i[2]+0xc4ac5665|0,n=r+(o<<23|o>>>9),o=t+(r^(n|~s))+i[0]+0xf4292244|0,t=n+(o<<6|o>>>26),o=s+(n^(t|~r))+i[7]+0x432aff97|0,s=t+(o<<10|o>>>22),o=r+(t^(s|~n))+i[14]+0xab9423a7|0,r=s+(o<<15|o>>>17),o=n+(s^(r|~t))+i[5]+0xfc93a039|0,n=r+(o<<21|o>>>11),o=t+(r^(n|~s))+i[12]+0x655b59c3|0,t=n+(o<<6|o>>>26),o=s+(n^(t|~r))+i[3]+0x8f0ccc92|0,s=t+(o<<10|o>>>22),o=r+(t^(s|~n))+i[10]+0xffeff47d|0,r=s+(o<<15|o>>>17),o=n+(s^(r|~t))+i[1]+0x85845dd1|0,n=r+(o<<21|o>>>11),o=t+(r^(n|~s))+i[8]+0x6fa87e4f|0,t=n+(o<<6|o>>>26),o=s+(n^(t|~r))+i[15]+0xfe2ce6e0|0,s=t+(o<<10|o>>>22),o=r+(t^(s|~n))+i[6]+0xa3014314|0,r=s+(o<<15|o>>>17),o=n+(s^(r|~t))+i[13]+0x4e0811a1|0,n=r+(o<<21|o>>>11),o=t+(r^(n|~s))+i[4]+0xf7537e82|0,t=n+(o<<6|o>>>26),o=s+(n^(t|~r))+i[11]+0xbd3af235|0,s=t+(o<<10|o>>>22),o=r+(t^(s|~n))+i[2]+0x2ad7d2bb|0,r=s+(o<<15|o>>>17),o=n+(s^(r|~t))+i[9]+0xeb86d391|0,e.g[0]=e.g[0]+t|0,e.g[1]=e.g[1]+(r+(o<<21|o>>>11))|0,e.g[2]=e.g[2]+r|0,e.g[3]=e.g[3]+s|0}function r(e,t){this.h=t;let n=[],i=!0;for(let r=e.length-1;r>=0;r--){let s=0|e[r];i&&s==t||(n[r]=s,i=!1)}this.g=n}n.prototype=t.prototype,e.F=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.D=function(e,n,i){for(var r=Array(arguments.length-2),s=2;s<arguments.length;s++)r[s-2]=arguments[s];return t.prototype[n].apply(e,r)},e.prototype.u=function(){this.g[0]=0x67452301,this.g[1]=0xefcdab89,this.g[2]=0x98badcfe,this.g[3]=0x10325476,this.o=this.h=0},e.prototype.v=function(e,t){void 0===t&&(t=e.length);let n=t-this.blockSize,r=this.C,s=this.h,o=0;for(;o<t;){if(0==s)for(;o<=n;)i(this,e,o),o+=this.blockSize;if("string"==typeof e){for(;o<t;)if(r[s++]=e.charCodeAt(o++),s==this.blockSize){i(this,r),s=0;break}}else for(;o<t;)if(r[s++]=e[o++],s==this.blockSize){i(this,r),s=0;break}}this.h=s,this.o+=t},e.prototype.A=function(){var e=Array((this.h<56?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;t=8*this.o;for(var n=e.length-8;n<e.length;++n)e[n]=255&t,t/=256;for(this.v(e),e=Array(16),t=0,n=0;n<4;++n)for(let i=0;i<32;i+=8)e[t++]=this.g[n]>>>i&255;return e};var s,o={};function a(e){var t;return -128<=e&&e<128?(t=function(e){return new r([0|e],e<0?-1:0)},Object.prototype.hasOwnProperty.call(o,e)?o[e]:o[e]=t(e)):new r([0|e],e<0?-1:0)}function l(e){if(isNaN(e)||!isFinite(e))return h;if(e<0)return p(l(-e));let t=[],n=1;for(let i=0;e>=n;i++)t[i]=e/n|0,n*=0x100000000;return new r(t,0)}var h=a(0),u=a(1),c=a(0x1000000);function d(e){if(0!=e.h)return!1;for(let t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function f(e){return -1==e.h}function p(e){let t=e.g.length,n=[];for(let i=0;i<t;i++)n[i]=~e.g[i];return new r(n,~e.h).add(u)}function g(e,t){return e.add(p(t))}function m(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function y(e,t){this.g=e,this.h=t}function _(e,t){if(d(t))throw Error("division by zero");if(d(e))return new y(h,h);if(f(e))return t=_(p(e),t),new y(p(t.g),p(t.h));if(f(t))return t=_(e,p(t)),new y(p(t.g),t.h);if(e.g.length>30){if(f(e)||f(t))throw Error("slowDivide_ only works with positive integers.");for(var n=u,i=t;0>=i.l(e);)n=v(n),i=v(i);var r=w(n,1),s=w(i,1);for(i=w(i,2),n=w(n,2);!d(i);){var o=s.add(i);0>=o.l(e)&&(r=r.add(n),s=o),i=w(i,1),n=w(n,1)}return t=g(e,r.j(t)),new y(r,t)}for(r=h;e.l(t)>=0;){for(i=(i=Math.ceil(Math.log(n=Math.max(1,Math.floor(e.m()/t.m())))/Math.LN2))<=48?1:Math.pow(2,i-48),o=(s=l(n)).j(t);f(o)||o.l(e)>0;)n-=i,o=(s=l(n)).j(t);d(s)&&(s=u),r=r.add(s),e=g(e,o)}return new y(r,e)}function v(e){let t=e.g.length+1,n=[];for(let i=0;i<t;i++)n[i]=e.i(i)<<1|e.i(i-1)>>>31;return new r(n,e.h)}function w(e,t){let n=t>>5;t%=32;let i=e.g.length-n,s=[];for(let r=0;r<i;r++)s[r]=t>0?e.i(r+n)>>>t|e.i(r+n+1)<<32-t:e.i(r+n);return new r(s,e.h)}(s=r.prototype).m=function(){if(f(this))return-p(this).m();let e=0,t=1;for(let n=0;n<this.g.length;n++){let i=this.i(n);e+=(i>=0?i:0x100000000+i)*t,t*=0x100000000}return e},s.toString=function(e){if((e=e||10)<2||36<e)throw Error("radix out of range: "+e);if(d(this))return"0";if(f(this))return"-"+p(this).toString(e);let t=l(Math.pow(e,6));var n=this;let i="";for(;;){let r=_(n,t).g,s=(((n=g(n,r.j(t))).g.length>0?n.g[0]:n.h)>>>0).toString(e);if(d(n=r))return s+i;for(;s.length<6;)s="0"+s;i=s+i}},s.i=function(e){return e<0?0:e<this.g.length?this.g[e]:this.h},s.l=function(e){return f(e=g(this,e))?-1:+!d(e)},s.abs=function(){return f(this)?p(this):this},s.add=function(e){let t=Math.max(this.g.length,e.g.length),n=[],i=0;for(let r=0;r<=t;r++){let t=i+(65535&this.i(r))+(65535&e.i(r)),s=(t>>>16)+(this.i(r)>>>16)+(e.i(r)>>>16);i=s>>>16,t&=65535,s&=65535,n[r]=s<<16|t}return new r(n,-0x80000000&n[n.length-1]?-1:0)},s.j=function(e){if(d(this)||d(e))return h;if(f(this))return f(e)?p(this).j(p(e)):p(p(this).j(e));if(f(e))return p(this.j(p(e)));if(0>this.l(c)&&0>e.l(c))return l(this.m()*e.m());let t=this.g.length+e.g.length,n=[];for(var i=0;i<2*t;i++)n[i]=0;for(i=0;i<this.g.length;i++)for(let t=0;t<e.g.length;t++){let r=this.i(i)>>>16,s=65535&this.i(i),o=e.i(t)>>>16,a=65535&e.i(t);n[2*i+2*t]+=s*a,m(n,2*i+2*t),n[2*i+2*t+1]+=r*a,m(n,2*i+2*t+1),n[2*i+2*t+1]+=s*o,m(n,2*i+2*t+1),n[2*i+2*t+2]+=r*o,m(n,2*i+2*t+2)}for(e=0;e<t;e++)n[e]=n[2*e+1]<<16|n[2*e];for(e=t;e<2*t;e++)n[e]=0;return new r(n,0)},s.B=function(e){return _(this,e).h},s.and=function(e){let t=Math.max(this.g.length,e.g.length),n=[];for(let i=0;i<t;i++)n[i]=this.i(i)&e.i(i);return new r(n,this.h&e.h)},s.or=function(e){let t=Math.max(this.g.length,e.g.length),n=[];for(let i=0;i<t;i++)n[i]=this.i(i)|e.i(i);return new r(n,this.h|e.h)},s.xor=function(e){let t=Math.max(this.g.length,e.g.length),n=[];for(let i=0;i<t;i++)n[i]=this.i(i)^e.i(i);return new r(n,this.h^e.h)},e.prototype.digest=e.prototype.A,e.prototype.reset=e.prototype.u,e.prototype.update=e.prototype.v,T=lv.Md5=e,r.prototype.add=r.prototype.add,r.prototype.multiply=r.prototype.j,r.prototype.modulo=r.prototype.B,r.prototype.compare=r.prototype.l,r.prototype.toNumber=r.prototype.m,r.prototype.toString=r.prototype.toString,r.prototype.getBits=r.prototype.i,r.fromNumber=l,r.fromString=function e(t,n){if(0==t.length)throw Error("number format error: empty string");if((n=n||10)<2||36<n)throw Error("radix out of range: "+n);if("-"==t.charAt(0))return p(e(t.substring(1),n));if(t.indexOf("-")>=0)throw Error('number format error: interior "-" character');let i=l(Math.pow(n,8)),r=h;for(let e=0;e<t.length;e+=8){var s=Math.min(8,t.length-e);let o=parseInt(t.substring(e,e+s),n);s<8?(s=l(Math.pow(n,s)),r=r.j(s).add(l(o))):r=(r=r.j(i)).add(l(o))}return r},E=lv.Integer=r}).apply(void 0!==l_?l_:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var lw="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:e.g,lb={};(function(){var e,t,n=Object.defineProperty,i=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof lw&&lw];for(var t=0;t<e.length;++t){var n=e[t];if(n&&n.Math==Math)return n}throw Error("Cannot find global object")}(this);function r(e,t){if(t)e:{var r=i;e=e.split(".");for(var s=0;s<e.length-1;s++){var o=e[s];if(!(o in r))break e;r=r[o]}(t=t(s=r[e=e[e.length-1]]))!=s&&null!=t&&n(r,e,{configurable:!0,writable:!0,value:t})}}r("Symbol.dispose",function(e){return e||Symbol("Symbol.dispose")}),r("Array.prototype.values",function(e){return e||function(){return this[Symbol.iterator]()}}),r("Object.entries",function(e){return e||function(e){var t,n=[];for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&n.push([t,e[t]]);return n}});var s=s||{},o=this||self;function a(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}function l(e,t,n){return e.call.apply(e.bind,arguments)}function h(e,t,n){return(h=l).apply(null,arguments)}function u(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function c(e,t){function n(){}n.prototype=t.prototype,e.Z=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.Ob=function(e,n,i){for(var r=Array(arguments.length-2),s=2;s<arguments.length;s++)r[s-2]=arguments[s];return t.prototype[n].apply(e,r)}}var d="undefined"!=typeof AsyncContext&&"function"==typeof AsyncContext.Snapshot?e=>e&&AsyncContext.Snapshot.wrap(e):e=>e;function f(e){let t=e.length;if(t>0){let n=Array(t);for(let i=0;i<t;i++)n[i]=e[i];return n}return[]}function p(e,t){for(let t=1;t<arguments.length;t++){let i=arguments[t];var n=typeof i;if("array"==(n="object"!=n?n:i?Array.isArray(i)?"array":n:"null")||"object"==n&&"number"==typeof i.length){n=e.length||0;let t=i.length||0;e.length=n+t;for(let r=0;r<t;r++)e[n+r]=i[r]}else e.push(i)}}var g=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return this.h>0?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new m,e=>e.reset());class m{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}let y,_=!1,v=new class{constructor(){this.h=this.g=null}add(e,t){let n=g.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}},w=()=>{let e=Promise.resolve(void 0);y=()=>{e.then(b)}};function b(){let e;for(var t;e=null,v.g&&(e=v.g,v.g=v.g.next,v.g||(v.h=null),e.next=null),t=e;){try{t.h.call(t.g)}catch(e){!function(e){o.setTimeout(()=>{throw e},0)}(e)}g.j(t),g.h<100&&(g.h++,t.next=g.g,g.g=t)}_=!1}function E(){this.u=this.u,this.C=this.C}function T(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}E.prototype.u=!1,E.prototype.dispose=function(){this.u||(this.u=!0,this.N())},E.prototype[Symbol.dispose]=function(){this.dispose()},E.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},T.prototype.h=function(){this.defaultPrevented=!0};var x=function(){if(!o.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{let e=()=>{};o.addEventListener("test",e,t),o.removeEventListener("test",e,t)}catch(e){}return e}();function D(e){return/^[\s\xa0]*$/.test(e)}function O(e,t){T.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e&&this.init(e,t)}c(O,T),O.prototype.init=function(e,t){let n=this.type=e.type,i=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;this.target=e.target||e.srcElement,this.g=t,(t=e.relatedTarget)||("mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement)),this.relatedTarget=t,i?(this.clientX=void 0!==i.clientX?i.clientX:i.pageX,this.clientY=void 0!==i.clientY?i.clientY:i.pageY,this.screenX=i.screenX||0,this.screenY=i.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType=e.pointerType,this.state=e.state,this.i=e,e.defaultPrevented&&O.Z.h.call(this)},O.prototype.h=function(){O.Z.h.call(this);let e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var L="closure_listenable_"+(1e6*Math.random()|0),M=0;function F(e,t,n,i,r){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!i,this.ha=r,this.key=++M,this.da=this.fa=!1}function U(e){e.da=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function V(e,t,n){for(let i in e)t.call(n,e[i],i,e)}function q(e){let t={};for(let n in e)t[n]=e[n];return t}let j="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function B(e,t){let n,i;for(let t=1;t<arguments.length;t++){for(n in i=arguments[t])e[n]=i[n];for(let t=0;t<j.length;t++)n=j[t],Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}}function z(e){this.src=e,this.g={},this.h=0}function $(e,t){let n=t.type;if(n in e.g){var i,r=e.g[n],s=Array.prototype.indexOf.call(r,t,void 0);(i=s>=0)&&Array.prototype.splice.call(r,s,1),i&&(U(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function H(e,t,n,i){for(let r=0;r<e.length;++r){let s=e[r];if(!s.da&&s.listener==t&&!!n==s.capture&&s.ha==i)return r}return -1}z.prototype.add=function(e,t,n,i,r){let s=e.toString();(e=this.g[s])||(e=this.g[s]=[],this.h++);let o=H(e,t,i,r);return o>-1?(t=e[o],n||(t.fa=!1)):((t=new F(t,this.src,s,!!i,r)).fa=n,e.push(t)),t};var W="closure_lm_"+(1e6*Math.random()|0),K={};function G(e,t,n,i,r,s){if(!t)throw Error("Invalid event type");let o=a(r)?!!r.capture:!!r,l=J(e);if(l||(e[W]=l=new z(e)),(n=l.add(t,n,i,o,s)).proxy)return n;if(i=function e(t){return X.call(e.src,e.listener,t)},n.proxy=i,i.src=e,i.listener=n,e.addEventListener)x||(r=o),void 0===r&&(r=!1),e.addEventListener(t.toString(),i,r);else if(e.attachEvent)e.attachEvent(Y(t.toString()),i);else if(e.addListener&&e.removeListener)e.addListener(i);else throw Error("addEventListener and attachEvent are unavailable.");return n}function Q(e){if("number"!=typeof e&&e&&!e.da){var t=e.src;if(t&&t[L])$(t.i,e);else{var n=e.type,i=e.proxy;t.removeEventListener?t.removeEventListener(n,i,e.capture):t.detachEvent?t.detachEvent(Y(n),i):t.addListener&&t.removeListener&&t.removeListener(i),(n=J(t))?($(n,e),0==n.h&&(n.src=null,t[W]=null)):U(e)}}}function Y(e){return e in K?K[e]:K[e]="on"+e}function X(e,t){if(e.da)e=!0;else{t=new O(t,this);let n=e.listener,i=e.ha||e.src;e.fa&&Q(e),e=n.call(i,t)}return e}function J(e){return(e=e[W])instanceof z?e:null}var Z="__closure_events_fn_"+(1e9*Math.random()>>>0);function ee(e){return"function"==typeof e?e:(e[Z]||(e[Z]=function(t){return e.handleEvent(t)}),e[Z])}function et(){E.call(this),this.i=new z(this),this.M=this,this.G=null}function en(e,t){let n,i;var r,s=e.G;if(s)for(r=[];s;s=s.G)r.push(s);if(e=e.M,s=t.type||t,"string"==typeof t)t=new T(t,e);else if(t instanceof T)t.target=t.target||e;else{var o=t;B(t=new T(s,e),o)}if(o=!0,r)for(i=r.length-1;i>=0;i--)o=ei(n=t.g=r[i],s,!0,t)&&o;if(o=ei(n=t.g=e,s,!0,t)&&o,o=ei(n,s,!1,t)&&o,r)for(i=0;i<r.length;i++)o=ei(n=t.g=r[i],s,!1,t)&&o}function ei(e,t,n,i){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();let r=!0;for(let s=0;s<t.length;++s){let o=t[s];if(o&&!o.da&&o.capture==n){let t=o.listener,n=o.ha||o.src;o.fa&&$(e.i,o),r=!1!==t.call(n,i)&&r}}return r&&!i.defaultPrevented}c(et,E),et.prototype[L]=!0,et.prototype.removeEventListener=function(e,t,n,i){!function e(t,n,i,r,s){if(Array.isArray(n))for(var o=0;o<n.length;o++)e(t,n[o],i,r,s);else(r=a(r)?!!r.capture:!!r,i=ee(i),t&&t[L])?(t=t.i,(o=String(n).toString())in t.g&&(i=H(n=t.g[o],i,r,s))>-1&&(U(n[i]),Array.prototype.splice.call(n,i,1),0==n.length&&(delete t.g[o],t.h--))):t&&(t=J(t))&&(n=t.g[n.toString()],t=-1,n&&(t=H(n,i,r,s)),(i=t>-1?n[t]:null)&&Q(i))}(this,e,t,n,i)},et.prototype.N=function(){if(et.Z.N.call(this),this.i){var e=this.i;for(let t in e.g){let n=e.g[t];for(let e=0;e<n.length;e++)U(n[e]);delete e.g[t],e.h--}}this.G=null},et.prototype.J=function(e,t,n,i){return this.i.add(String(e),t,!1,n,i)},et.prototype.K=function(e,t,n,i){return this.i.add(String(e),t,!0,n,i)};class er extends E{constructor(e,t){super(),this.m=e,this.l=t,this.h=null,this.i=!1,this.g=null}j(e){this.h=arguments,this.g?this.i=!0:function e(t){t.g=function(e,t){if("function"!=typeof e)if(e&&"function"==typeof e.handleEvent)e=h(e.handleEvent,e);else throw Error("Invalid listener argument");return Number(t)>0x7fffffff?-1:o.setTimeout(e,t||0)}(()=>{t.g=null,t.i&&(t.i=!1,e(t))},t.l);let n=t.h;t.h=null,t.m.apply(null,n)}(this)}N(){super.N(),this.g&&(o.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function es(e){E.call(this),this.h=e,this.g={}}c(es,E);var eo=[];function ea(e){V(e.g,function(e,t){this.g.hasOwnProperty(t)&&Q(e)},e),e.g={}}es.prototype.N=function(){es.Z.N.call(this),ea(this)},es.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var el=o.JSON.stringify,eh=o.JSON.parse,eu=class{stringify(e){return o.JSON.stringify(e,void 0)}parse(e){return o.JSON.parse(e,void 0)}};function ec(){}function ed(){}var ef={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function ep(){T.call(this,"d")}function eg(){T.call(this,"c")}c(ep,T),c(eg,T);var em={},ey=null;function e_(){return ey=ey||new et}function ev(e){T.call(this,em.Ia,e)}function ew(e){let t=e_();en(t,new ev(t))}function eb(e,t){T.call(this,em.STAT_EVENT,e),this.stat=t}function eE(e){let t=e_();en(t,new eb(t,e))}function eT(e,t){T.call(this,em.Ja,e),this.size=t}function eC(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return o.setTimeout(function(){e()},t)}function eI(){this.g=!0}function eS(e,t,n,i){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{let s=JSON.parse(t);if(s){for(e=0;e<s.length;e++)if(Array.isArray(s[e])){var n=s[e];if(!(n.length<2)){var i=n[1];if(Array.isArray(i)&&!(i.length<1)){var r=i[0];if("noop"!=r&&"stop"!=r&&"close"!=r)for(let e=1;e<i.length;e++)i[e]=""}}}}return el(s)}catch(e){return t}}(e,n)+(i?" "+i:"")})}em.Ia="serverreachability",c(ev,T),em.STAT_EVENT="statevent",c(eb,T),em.Ja="timingevent",c(eT,T),eI.prototype.ua=function(){this.g=!1},eI.prototype.info=function(){};var ek={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},eA={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"};function eN(){}function eR(e){return encodeURIComponent(String(e))}function eP(e,t,n,i){this.j=e,this.i=t,this.l=n,this.S=i||1,this.V=new es(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new ex}function ex(){this.i=null,this.g="",this.h=!1}c(eN,ec),eN.prototype.g=function(){return new XMLHttpRequest},e=new eN;var eD={},eO={};function eL(e,t,n){e.M=1,e.A=e5(e0(t)),e.u=n,e.R=!0,eM(e,null)}function eM(e,t){e.F=Date.now(),eU(e),e.B=e0(e.A);var n,i,r,s,o,l,u=e.B,c=e.S;Array.isArray(c)||(c=[String(c)]),th(u.i,"t",c),e.C=0,u=e.j.L,e.h=new ex,e.g=tQ(e.j,u?t:null,!e.u),e.P>0&&(e.O=new er(h(e.Y,e,e.g),e.P)),t=e.V,u=e.g,c=e.ba;var d="readystatechange";Array.isArray(d)||(d&&(eo[0]=d.toString()),d=eo);for(let e=0;e<d.length;e++){let n=function e(t,n,i,r,s){if(r&&r.once)return function e(t,n,i,r,s){if(Array.isArray(n)){for(let o=0;o<n.length;o++)e(t,n[o],i,r,s);return null}return i=ee(i),t&&t[L]?t.K(n,i,a(r)?!!r.capture:!!r,s):G(t,n,i,!0,r,s)}(t,n,i,r,s);if(Array.isArray(n)){for(let o=0;o<n.length;o++)e(t,n[o],i,r,s);return null}return i=ee(i),t&&t[L]?t.J(n,i,a(r)?!!r.capture:!!r,s):G(t,n,i,!1,r,s)}(u,d[e],c||t.handleEvent,!1,t.h||t);if(!n)break;t.g[n.key]=n}t=e.J?q(e.J):{},e.u?(e.v||(e.v="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.B,e.v,e.u,t)):(e.v="GET",e.g.ea(e.B,e.v,null,t)),ew(),n=e.i,i=e.v,r=e.B,s=e.l,o=e.S,l=e.u,n.info(function(){if(n.g)if(l){var e="",t=l.split("&");for(let n=0;n<t.length;n++){var a=t[n].split("=");if(a.length>1){let t=a[0];a=a[1];let n=t.split("_");e=n.length>=2&&"type"==n[1]?e+(t+"=")+a+"&":e+(t+"=redacted&")}}}else e=null;else e=l;return"XMLHTTP REQ ("+s+") [attempt "+o+"]: "+i+"\n"+r+"\n"+e})}function eF(e){return!!e.g&&"GET"==e.v&&2!=e.M&&e.j.Aa}function eU(e){e.T=Date.now()+e.H,eV(e,e.H)}function eV(e,t){if(null!=e.D)throw Error("WatchDog timer not null");e.D=eC(h(e.aa,e),t)}function eq(e){e.D&&(o.clearTimeout(e.D),e.D=null)}function ej(e){0==e.j.I||e.K||t$(e.j,e)}function eB(e){eq(e);var t=e.O;t&&"function"==typeof t.dispose&&t.dispose(),e.O=null,ea(e.V),e.g&&(t=e.g,e.g=null,t.abort(),t.dispose())}function ez(e,t){try{var n=e.j;if(0!=n.I&&(n.g==e||eG(n.h,e))){if(!e.L&&eG(n.h,e)&&3==n.I){try{var i=n.Ba.g.parse(t)}catch(e){i=null}if(Array.isArray(i)&&3==i.length){var r=i;if(0==r[0]){e:if(!n.v){if(n.g)if(n.g.F+3e3<e.F)tz(n),tD(n);else break e;tq(n),eE(18)}}else n.xa=r[1],0<n.xa-n.K&&r[2]<37500&&n.F&&0==n.A&&!n.C&&(n.C=eC(h(n.Va,n),6e3));1>=eK(n.h)&&n.ta&&(n.ta=void 0)}else tW(n,11)}else if((e.L||n.g==e)&&tz(n),!D(t))for(r=n.Ba.g.parse(t),t=0;t<r.length;t++){let a=r[t],l=a[0];if(!(l<=n.K))if(n.K=l,a=a[1],2==n.I)if("c"==a[0]){n.M=a[1],n.ba=a[2];let t=a[3];null!=t&&(n.ka=t,n.j.info("VER="+n.ka));let r=a[4];null!=r&&(n.za=r,n.j.info("SVER="+n.za));let l=a[5];null!=l&&"number"==typeof l&&l>0&&(n.O=i=1.5*l,n.j.info("backChannelRequestTimeoutMs_="+i)),i=n;let h=e.g;if(h){let e=h.g?h.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var s=i.h;s.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(eQ(s,s.h),s.h=null))}if(i.G){let e=h.g?h.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(i.wa=e,e3(i.J,i.G,e))}}if(n.I=3,n.l&&n.l.ra(),n.aa&&(n.T=Date.now()-e.F,n.j.info("Handshake RTT: "+n.T+"ms")),(i=n).na=tG(i,i.L?i.ba:null,i.W),e.L){eY(i.h,e);var o=i.O;o&&(e.H=o),e.D&&(eq(e),eU(e)),i.g=e}else tV(i);n.i.length>0&&tL(n)}else"stop"!=a[0]&&"close"!=a[0]||tW(n,7);else 3==n.I&&("stop"==a[0]||"close"==a[0]?"stop"==a[0]?tW(n,7):tx(n):"noop"!=a[0]&&n.l&&n.l.qa(a),n.A=0)}}ew(4)}catch(e){}}eP.prototype.ba=function(e){e=e.target;let t=this.O;t&&3==tA(e)?t.j():this.Y(e)},eP.prototype.Y=function(e){try{if(e==this.g)e:{let f=tA(this.g),p=this.g.ya(),g=this.g.ca();if(!(f<3)&&(3!=f||this.g&&(this.h.h||this.g.la()||tN(this.g)))){this.K||4!=f||7==p||(8==p||g<=0?ew(3):ew(2)),eq(this);var t=this.g.ca();this.X=t;var n=function(e){if(!eF(e))return e.g.la();let t=tN(e.g);if(""===t)return"";let n="",i=t.length,r=4==tA(e.g);if(!e.h.i){if("undefined"==typeof TextDecoder)return eB(e),ej(e),"";e.h.i=new o.TextDecoder}for(let s=0;s<i;s++)e.h.h=!0,n+=e.h.i.decode(t[s],{stream:!(r&&s==i-1)});return t.length=0,e.h.g+=n,e.C=0,e.h.g}(this);if(this.o=200==t,i=this.i,r=this.v,s=this.B,a=this.l,l=this.S,i.info(function(){return"XMLHTTP RESP ("+a+") [ attempt "+l+"]: "+r+"\n"+s+"\n"+f+" "+t}),this.o){if(this.U&&!this.L){t:{if(this.g){var i,r,s,a,l,h,u=this.g;if((h=u.g?u.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!D(h)){var c=h;break t}}c=null}if(e=c)eS(this.i,this.l,e,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,ez(this,e);else{this.o=!1,this.m=3,eE(12),eB(this),ej(this);break e}}if(this.R){let t;for(e=!0;!this.K&&this.C<n.length;)if((t=function(e,t){var n=e.C,i=t.indexOf("\n",n);return -1==i?eO:isNaN(n=Number(t.substring(n,i)))?eD:(i+=1)+n>t.length?eO:(t=t.slice(i,i+n),e.C=i+n,t)}(this,n))==eO){4==f&&(this.m=4,eE(14),e=!1),eS(this.i,this.l,null,"[Incomplete Response]");break}else if(t==eD){this.m=4,eE(15),eS(this.i,this.l,n,"[Invalid Chunk]"),e=!1;break}else eS(this.i,this.l,t,null),ez(this,t);if(eF(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=f||0!=n.length||this.h.h||(this.m=1,eE(16),e=!1),this.o=this.o&&e,e){if(n.length>0&&!this.W){this.W=!0;var d=this.j;d.g==this&&d.aa&&!d.P&&(d.j.info("Great, no buffering proxy detected. Bytes received: "+n.length),tj(d),d.P=!0,eE(11))}}else eS(this.i,this.l,n,"[Invalid Chunked Response]"),eB(this),ej(this)}else eS(this.i,this.l,n,null),ez(this,n);4==f&&eB(this),this.o&&!this.K&&(4==f?t$(this.j,this):(this.o=!1,eU(this)))}else(function(e){let t={};e=(e.g&&tA(e)>=2&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let i=0;i<e.length;i++){if(D(e[i]))continue;var n=function(e){var t=1;e=e.split(":");let n=[];for(;t>0&&e.length;)n.push(e.shift()),t--;return e.length&&n.push(e.join(":")),n}(e[i]);let r=n[0];if("string"!=typeof(n=n[1]))continue;n=n.trim();let s=t[r]||[];t[r]=s,s.push(n)}var i=function(e){return e.join(", ")};for(let e in t)i.call(void 0,t[e],e,t)})(this.g),400==t&&n.indexOf("Unknown SID")>0?(this.m=3,eE(12)):(this.m=0,eE(13)),eB(this),ej(this)}}}catch(e){}finally{}},eP.prototype.cancel=function(){this.K=!0,eB(this)},eP.prototype.aa=function(){var e,t;this.D=null;let n=Date.now();n-this.T>=0?(e=this.i,t=this.B,e.info(function(){return"TIMEOUT: "+t}),2!=this.M&&(ew(),eE(17)),eB(this),this.m=2,ej(this)):eV(this,this.T-n)};var e$=class{constructor(e,t){this.g=e,this.map=t}};function eH(e){this.l=e||10,e=o.PerformanceNavigationTiming?(e=o.performance.getEntriesByType("navigation")).length>0&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(o.chrome&&o.chrome.loadTimes&&o.chrome.loadTimes()&&o.chrome.loadTimes().wasFetchedViaSpdy),this.j=e?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function eW(e){return!!e.h||!!e.g&&e.g.size>=e.j}function eK(e){return e.h?1:e.g?e.g.size:0}function eG(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function eQ(e,t){e.g?e.g.add(t):e.h=t}function eY(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function eX(e){if(null!=e.h)return e.i.concat(e.h.G);if(null!=e.g&&0!==e.g.size){let t=e.i;for(let n of e.g.values())t=t.concat(n.G);return t}return f(e.i)}eH.prototype.cancel=function(){if(this.i=eX(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(let e of this.g.values())e.cancel();this.g.clear()}};var eJ=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function eZ(e){let t;this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1,e instanceof eZ?(this.l=e.l,e1(this,e.j),this.o=e.o,this.g=e.g,e2(this,e.u),this.h=e.h,e6(this,tu(e.i)),this.m=e.m):e&&(t=String(e).match(eJ))?(this.l=!1,e1(this,t[1]||"",!0),this.o=e4(t[2]||""),this.g=e4(t[3]||"",!0),e2(this,t[4]),this.h=e4(t[5]||"",!0),e6(this,t[6]||"",!0),this.m=e4(t[7]||"")):(this.l=!1,this.i=new tr(null,this.l))}function e0(e){return new eZ(e)}function e1(e,t,n){e.j=n?e4(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function e2(e,t){if(t){if(isNaN(t=Number(t))||t<0)throw Error("Bad port number "+t);e.u=t}else e.u=null}function e6(e,t,n){var i,r;t instanceof tr?(e.i=t,i=e.i,(r=e.l)&&!i.j&&(ts(i),i.i=null,i.g.forEach(function(e,t){let n=t.toLowerCase();t!=n&&(to(this,t),th(this,n,e))},i)),i.j=r):(n||(t=e8(t,tn)),e.i=new tr(t,e.l))}function e3(e,t,n){e.i.set(t,n)}function e5(e){return e3(e,"zx",Math.floor(0x80000000*Math.random()).toString(36)+Math.abs(Math.floor(0x80000000*Math.random())^Date.now()).toString(36)),e}function e4(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function e8(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,e7),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function e7(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}eZ.prototype.toString=function(){let e=[];var t=this.j;t&&e.push(e8(t,e9,!0),":");var n=this.g;return(n||"file"==t)&&(e.push("//"),(t=this.o)&&e.push(e8(t,e9,!0),"@"),e.push(eR(n).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.u)&&e.push(":",String(n))),(n=this.h)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(e8(n,"/"==n.charAt(0)?tt:te,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.m)&&e.push("#",e8(n,ti)),e.join("")},eZ.prototype.resolve=function(e){let t=e0(this),n=!!e.j;n?e1(t,e.j):n=!!e.o,n?t.o=e.o:n=!!e.g,n?t.g=e.g:n=null!=e.u;var i=e.h;if(n)e2(t,e.u);else if(n=!!e.h){if("/"!=i.charAt(0))if(this.g&&!this.h)i="/"+i;else{var r=t.h.lastIndexOf("/");-1!=r&&(i=t.h.slice(0,r+1)+i)}if(".."==(r=i)||"."==r)i="";else if(-1!=r.indexOf("./")||-1!=r.indexOf("/.")){i=0==r.lastIndexOf("/",0),r=r.split("/");let e=[];for(let t=0;t<r.length;){let n=r[t++];"."==n?i&&t==r.length&&e.push(""):".."==n?((e.length>1||1==e.length&&""!=e[0])&&e.pop(),i&&t==r.length&&e.push("")):(e.push(n),i=!0)}i=e.join("/")}else i=r}return n?t.h=i:n=""!==e.i.toString(),n?e6(t,tu(e.i)):n=!!e.m,n&&(t.m=e.m),t};var e9=/[#\/\?@]/g,te=/[#\?:]/g,tt=/[#\?]/g,tn=/[#\?@]/g,ti=/#/g;function tr(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function ts(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(let n=0;n<e.length;n++){let i=e[n].indexOf("="),r,s=null;i>=0?(r=e[n].substring(0,i),s=e[n].substring(i+1)):r=e[n],t(r,s?decodeURIComponent(s.replace(/\+/g," ")):"")}}}(e.i,function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)}))}function to(e,t){ts(e),t=tc(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function ta(e,t){return ts(e),t=tc(e,t),e.g.has(t)}function tl(e,t){ts(e);let n=[];if("string"==typeof t)ta(e,t)&&(n=n.concat(e.g.get(tc(e,t))));else for(e=Array.from(e.g.values()),t=0;t<e.length;t++)n=n.concat(e[t]);return n}function th(e,t,n){to(e,t),n.length>0&&(e.i=null,e.g.set(tc(e,t),f(n)),e.h+=n.length)}function tu(e){let t=new tr;return t.i=e.i,e.g&&(t.g=new Map(e.g),t.h=e.h),t}function tc(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function td(e,t,n,i,r){try{r&&(r.onload=null,r.onerror=null,r.onabort=null,r.ontimeout=null),i(n)}catch(e){}}function tf(){this.g=new eu}function tp(e){this.i=e.Sb||null,this.h=e.ab||!1}function tg(e,t){et.call(this),this.H=e,this.o=t,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}function tm(e){e.j.read().then(e.Ma.bind(e)).catch(e.ga.bind(e))}function ty(e){e.readyState=4,e.l=null,e.j=null,e.B=null,t_(e)}function t_(e){e.onreadystatechange&&e.onreadystatechange.call(e)}function tv(e){let t="";return V(e,function(e,n){t+=n,t+=":",t+=e,t+="\r\n"}),t}function tw(e,t,n){e:{for(i in n){var i=!1;break e}i=!0}i||(n=tv(n),"string"==typeof e?null!=n&&eR(n):e3(e,t,n))}function tb(e){et.call(this),this.headers=new Map,this.L=e||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}(t=tr.prototype).add=function(e,t){ts(this),this.i=null,e=tc(this,e);let n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},t.forEach=function(e,t){ts(this),this.g.forEach(function(n,i){n.forEach(function(n){e.call(t,n,i,this)},this)},this)},t.set=function(e,t){return ts(this),this.i=null,ta(this,e=tc(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},t.get=function(e,t){return e&&(e=tl(this,e)).length>0?String(e[0]):t},t.toString=function(){if(this.i)return this.i;if(!this.g)return"";let e=[],t=Array.from(this.g.keys());for(let i=0;i<t.length;i++){var n=t[i];let r=eR(n);n=tl(this,n);for(let t=0;t<n.length;t++){let i=r;""!==n[t]&&(i+="="+eR(n[t])),e.push(i)}}return this.i=e.join("&")},c(tp,ec),tp.prototype.g=function(){return new tg(this.i,this.h)},c(tg,et),(t=tg.prototype).open=function(e,t){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.F=e,this.D=t,this.readyState=1,t_(this)},t.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;let t={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};e&&(t.body=e),(this.H||o).fetch(new Request(this.D,t)).then(this.Pa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&4!=this.readyState&&(this.g=!1,ty(this)),this.readyState=0},t.Pa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,t_(this)),this.g&&(this.readyState=3,t_(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(void 0!==o.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;tm(this)}else e.text().then(this.Oa.bind(this),this.ga.bind(this))},t.Ma=function(e){if(this.g){if(this.o&&e.value)this.response.push(e.value);else if(!this.o){var t=e.value?e.value:new Uint8Array(0);(t=this.B.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?ty(this):t_(this),3==this.readyState&&tm(this)}},t.Oa=function(e){this.g&&(this.response=this.responseText=e,ty(this))},t.Na=function(e){this.g&&(this.response=e,ty(this))},t.ga=function(){this.g&&ty(this)},t.setRequestHeader=function(e,t){this.A.append(e,t)},t.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";let e=[],t=this.h.entries();for(var n=t.next();!n.done;)e.push((n=n.value)[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(tg.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}}),c(tb,et);var tE=/^https?$/i,tT=["POST","PUT"];function tC(e,t){e.h=!1,e.g&&(e.j=!0,e.g.abort(),e.j=!1),e.l=t,e.o=5,tI(e),tk(e)}function tI(e){e.A||(e.A=!0,en(e,"complete"),en(e,"error"))}function tS(e){if(e.h&&void 0!==s){if(e.v&&4==tA(e))setTimeout(e.Ca.bind(e),0);else if(en(e,"readystatechange"),4==tA(e)){e.h=!1;try{let s=e.ca();switch(s){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t,n,i=!0;break;default:i=!1}if(!(t=i)){if(n=0===s){let t=String(e.D).match(eJ)[1]||null;!t&&o.self&&o.self.location&&(t=o.self.location.protocol.slice(0,-1)),n=!tE.test(t?t.toLowerCase():"")}t=n}if(t)en(e,"complete"),en(e,"success");else{e.o=6;try{var r=tA(e)>2?e.g.statusText:""}catch(e){r=""}e.l=r+" ["+e.ca()+"]",tI(e)}}finally{tk(e)}}}}function tk(e,t){if(e.g){e.m&&(clearTimeout(e.m),e.m=null);let n=e.g;e.g=null,t||en(e,"ready");try{n.onreadystatechange=null}catch(e){}}}function tA(e){return e.g?e.g.readyState:0}function tN(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.F){case"":case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function tR(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function tP(e){this.za=0,this.i=[],this.j=new eI,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=tR("failFast",!1,e),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=tR("baseRetryDelayMs",5e3,e),this.Za=tR("retryDelaySeedMs",1e4,e),this.Ta=tR("forwardChannelMaxRetries",2,e),this.va=tR("forwardChannelRequestTimeoutMs",2e4,e),this.ma=e&&e.xmlHttpFactory||void 0,this.Ua=e&&e.Rb||void 0,this.Aa=e&&e.useFetchStreams||!1,this.O=void 0,this.L=e&&e.supportsCrossDomainXhr||!1,this.M="",this.h=new eH(e&&e.concurrentRequestLimit),this.Ba=new tf,this.S=e&&e.fastHandshake||!1,this.R=e&&e.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=e&&e.Pb||!1,e&&e.ua&&this.j.ua(),e&&e.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&e&&e.detectBufferingProxy||!1,this.ia=void 0,e&&e.longPollingTimeout&&e.longPollingTimeout>0&&(this.ia=e.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}function tx(e){if(tO(e),3==e.I){var t=e.V++,n=e0(e.J);if(e3(n,"SID",e.M),e3(n,"RID",t),e3(n,"TYPE","terminate"),tF(e,n),(t=new eP(e,e.j,t)).M=2,t.A=e5(e0(n)),n=!1,o.navigator&&o.navigator.sendBeacon)try{n=o.navigator.sendBeacon(t.A.toString(),"")}catch(e){}!n&&o.Image&&((new Image).src=t.A,n=!0),n||(t.g=tQ(t.j,null),t.g.ea(t.A)),t.F=Date.now(),eU(t)}tK(e)}function tD(e){e.g&&(tj(e),e.g.cancel(),e.g=null)}function tO(e){tD(e),e.v&&(o.clearTimeout(e.v),e.v=null),tz(e),e.h.cancel(),e.m&&("number"==typeof e.m&&o.clearTimeout(e.m),e.m=null)}function tL(e){if(!eW(e.h)&&!e.m){e.m=!0;var t=e.Ea;y||w(),_||(y(),_=!0),v.add(t,e),e.D=0}}function tM(e,t){var n;n=t?t.l:e.V++;let i=e0(e.J);e3(i,"SID",e.M),e3(i,"RID",n),e3(i,"AID",e.K),tF(e,i),e.u&&e.o&&tw(i,e.u,e.o),n=new eP(e,e.j,n,e.D+1),null===e.u&&(n.J=e.o),t&&(e.i=t.G.concat(e.i)),t=tU(e,n,1e3),n.H=Math.round(.5*e.va)+Math.round(.5*e.va*Math.random()),eQ(e.h,n),eL(n,i,t)}function tF(e,t){e.H&&V(e.H,function(e,n){e3(t,n,e)}),e.l&&V({},function(e,n){e3(t,n,e)})}function tU(e,t,n){n=Math.min(e.i.length,n);let i=e.l?h(e.l.Ka,e.l,e):null;e:{var r=e.i;let t=-1;for(;;){let e=["count="+n];-1==t?n>0?(t=r[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let l=!0;for(let h=0;h<n;h++){var s=r[h].g;let n=r[h].map;if((s-=t)<0)t=Math.max(0,r[h].g-100),l=!1;else try{s="req"+s+"_";try{var o=n instanceof Map?n:Object.entries(n);for(let[t,n]of o){let i=n;a(n)&&(i=el(n)),e.push(s+t+"="+encodeURIComponent(i))}}catch(t){throw e.push(s+"type="+encodeURIComponent("_badmap")),t}}catch(e){i&&i(n)}}if(l){o=e.join("&");break e}}o=void 0}return t.G=e=e.i.splice(0,n),o}function tV(e){if(!e.g&&!e.v){e.Y=1;var t=e.Da;y||w(),_||(y(),_=!0),v.add(t,e),e.A=0}}function tq(e){return!e.g&&!e.v&&!(e.A>=3)&&(e.Y++,e.v=eC(h(e.Da,e),tH(e,e.A)),e.A++,!0)}function tj(e){null!=e.B&&(o.clearTimeout(e.B),e.B=null)}function tB(e){e.g=new eP(e,e.j,"rpc",e.Y),null===e.u&&(e.g.J=e.o),e.g.P=0;var t=e0(e.na);e3(t,"RID","rpc"),e3(t,"SID",e.M),e3(t,"AID",e.K),e3(t,"CI",e.F?"0":"1"),!e.F&&e.ia&&e3(t,"TO",e.ia),e3(t,"TYPE","xmlhttp"),tF(e,t),e.u&&e.o&&tw(t,e.u,e.o),e.O&&(e.g.H=e.O);var n=e.g;e=e.ba,n.M=1,n.A=e5(e0(t)),n.u=null,n.R=!0,eM(n,e)}function tz(e){null!=e.C&&(o.clearTimeout(e.C),e.C=null)}function t$(e,t){var n,i=null;if(e.g==t){tz(e),tj(e),e.g=null;var r=2}else{if(!eG(e.h,t))return;i=t.G,eY(e.h,t),r=1}if(0!=e.I){if(t.o)if(1==r){i=t.u?t.u.length:0,t=Date.now()-t.F;var s=e.D;en(r=e_(),new eT(r,i)),tL(e)}else tV(e);else if(3==(s=t.m)||0==s&&t.X>0||!(1==r&&(n=t,!(eK(e.h)>=e.h.j-!!e.m)&&(e.m?(e.i=n.G.concat(e.i),!0):1!=e.I&&2!=e.I&&!(e.D>=(e.Sa?0:e.Ta))&&(e.m=eC(h(e.Ea,e,n),tH(e,e.D)),e.D++,!0)))||2==r&&tq(e)))switch(i&&i.length>0&&((t=e.h).i=t.i.concat(i)),s){case 1:tW(e,5);break;case 4:tW(e,10);break;case 3:tW(e,6);break;default:tW(e,2)}}}function tH(e,t){let n=e.Qa+Math.floor(Math.random()*e.Za);return e.isActive()||(n*=2),n*t}function tW(e,t){if(e.j.info("Error code "+t),2==t){let t,s,a;var n,i=h(e.bb,e),r=e.Ua;let l=!r;r=new eZ(r||"//www.google.com/images/cleardot.gif"),o.location&&"http"==o.location.protocol||e1(r,"https"),e5(r),l?function(e,t){let n=new eI;if(o.Image){let i=new Image;i.onload=u(td,n,"TestLoadImage: loaded",!0,t,i),i.onerror=u(td,n,"TestLoadImage: error",!1,t,i),i.onabort=u(td,n,"TestLoadImage: abort",!1,t,i),i.ontimeout=u(td,n,"TestLoadImage: timeout",!1,t,i),o.setTimeout(function(){i.ontimeout&&i.ontimeout()},1e4),i.src=e}else t(!1)}(r.toString(),i):(n=r.toString(),t=new eI,s=new AbortController,a=setTimeout(()=>{s.abort(),td(t,"TestPingServer: timeout",!1,i)},1e4),fetch(n,{signal:s.signal}).then(e=>{clearTimeout(a),e.ok?td(t,"TestPingServer: ok",!0,i):td(t,"TestPingServer: server error",!1,i)}).catch(()=>{clearTimeout(a),td(t,"TestPingServer: error",!1,i)}))}else eE(2);e.I=0,e.l&&e.l.pa(t),tK(e),tO(e)}function tK(e){if(e.I=0,e.ja=[],e.l){let t=eX(e.h);(0!=t.length||0!=e.i.length)&&(p(e.ja,t),p(e.ja,e.i),e.h.i.length=0,f(e.i),e.i.length=0),e.l.oa()}}function tG(e,t,n){var i=n instanceof eZ?e0(n):new eZ(n);if(""!=i.g)t&&(i.g=t+"."+i.g),e2(i,i.u);else{var r=o.location;i=r.protocol,t=t?t+"."+r.hostname:r.hostname,r=+r.port;let e=new eZ(null);i&&e1(e,i),t&&(e.g=t),r&&e2(e,r),n&&(e.h=n),i=e}return n=e.G,t=e.wa,n&&t&&e3(i,n,t),e3(i,"VER",e.ka),tF(e,i),i}function tQ(e,t,n){if(t&&!e.L)throw Error("Can't create secondary domain capable XhrIo object.");return(t=new tb(e.Aa&&!e.ma?new tp({ab:n}):e.ma)).Fa(e.L),t}function tY(){}function tX(){}function tJ(e,t){et.call(this),this.g=new tP(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.o=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.sa&&(e?e["X-WebChannel-Client-Profile"]=t.sa:e={"X-WebChannel-Client-Profile":t.sa}),this.g.U=e,(e=t&&t.Qb)&&!D(e)&&(this.g.u=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!D(t)&&(this.g.G=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new t1(this)}function tZ(e){ep.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(let n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function t0(){eg.call(this),this.status=1}function t1(e){this.g=e}(t=tb.prototype).Fa=function(e){this.H=e},t.ea=function(t,n,i,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+t);n=n?n.toUpperCase():"GET",this.D=t,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():e.g(),this.g.onreadystatechange=d(h(this.Ca,this));try{this.B=!0,this.g.open(n,String(t),!0),this.B=!1}catch(e){tC(this,e);return}if(t=i||"",i=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var s in r)i.set(s,r[s]);else if("function"==typeof r.keys&&"function"==typeof r.get)for(let e of r.keys())i.set(e,r.get(e));else throw Error("Unknown input type for opt_headers: "+String(r));for(let[e,a]of(r=Array.from(i.keys()).find(e=>"content-type"==e.toLowerCase()),s=o.FormData&&t instanceof o.FormData,!(Array.prototype.indexOf.call(tT,n,void 0)>=0)||r||s||i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i))this.g.setRequestHeader(e,a);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(t),this.v=!1}catch(e){tC(this,e)}},t.abort=function(e){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=e||7,en(this,"complete"),en(this,"abort"),tk(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),tk(this,!0)),tb.Z.N.call(this)},t.Ca=function(){this.u||(this.B||this.v||this.j?tS(this):this.Xa())},t.Xa=function(){tS(this)},t.isActive=function(){return!!this.g},t.ca=function(){try{return tA(this)>2?this.g.status:-1}catch(e){return -1}},t.la=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},t.La=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),eh(t)}},t.ya=function(){return this.o},t.Ha=function(){return"string"==typeof this.l?this.l:String(this.l)},(t=tP.prototype).ka=8,t.I=1,t.connect=function(e,t,n,i){eE(0),this.W=e,this.H=t||{},n&&void 0!==i&&(this.H.OSID=n,this.H.OAID=i),this.F=this.X,this.J=tG(this,null,this.W),tL(this)},t.Ea=function(e){if(this.m)if(this.m=null,1==this.I){if(!e){this.V=Math.floor(1e5*Math.random()),e=this.V++;let r=new eP(this,this.j,e),s=this.o;if(this.U&&(s?B(s=q(s),this.U):s=this.U),null!==this.u||this.R||(r.J=s,s=null),this.S)e:{for(var t=0,n=0;n<this.i.length;n++){t:{var i=this.i[n];if("__data__"in i.map&&"string"==typeof(i=i.map.__data__)){i=i.length;break t}i=void 0}if(void 0===i)break;if((t+=i)>4096){t=n;break e}if(4096===t||n===this.i.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=tU(this,r,t),e3(n=e0(this.J),"RID",e),e3(n,"CVER",22),this.G&&e3(n,"X-HTTP-Session-Id",this.G),tF(this,n),s&&(this.R?t="headers="+eR(tv(s))+"&"+t:this.u&&tw(n,this.u,s)),eQ(this.h,r),this.Ra&&e3(n,"TYPE","init"),this.S?(e3(n,"$req",t),e3(n,"SID","null"),r.U=!0,eL(r,n,null)):eL(r,n,t),this.I=2}}else 3==this.I&&(e?tM(this,e):0==this.i.length||eW(this.h)||tM(this))},t.Da=function(){if(this.v=null,tB(this),this.aa&&!(this.P||null==this.g||this.T<=0)){var e=4*this.T;this.j.info("BP detection timer enabled: "+e),this.B=eC(h(this.Wa,this),e)}},t.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,eE(10),tD(this),tB(this))},t.Va=function(){null!=this.C&&(this.C=null,tD(this),tq(this),eE(19))},t.bb=function(e){e?(this.j.info("Successfully pinged google.com"),eE(2)):(this.j.info("Failed to ping google.com"),eE(1))},t.isActive=function(){return!!this.l&&this.l.isActive(this)},(t=tY.prototype).ra=function(){},t.qa=function(){},t.pa=function(){},t.oa=function(){},t.isActive=function(){return!0},t.Ka=function(){},tX.prototype.g=function(e,t){return new tJ(e,t)},c(tJ,et),tJ.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},tJ.prototype.close=function(){tx(this.g)},tJ.prototype.o=function(e){var t=this.g;if("string"==typeof e){var n={};n.__data__=e,e=n}else this.v&&((n={}).__data__=el(e),e=n);t.i.push(new e$(t.Ya++,e)),3==t.I&&tL(t)},tJ.prototype.N=function(){this.g.l=null,delete this.j,tx(this.g),delete this.g,tJ.Z.N.call(this)},c(tZ,ep),c(t0,eg),c(t1,tY),t1.prototype.ra=function(){en(this.g,"a")},t1.prototype.qa=function(e){en(this.g,new tZ(e))},t1.prototype.pa=function(e){en(this.g,new t0)},t1.prototype.oa=function(){en(this.g,"b")},tX.prototype.createWebChannel=tX.prototype.g,tJ.prototype.send=tJ.prototype.o,tJ.prototype.open=tJ.prototype.m,tJ.prototype.close=tJ.prototype.close,P=lb.createWebChannelTransport=function(){return new tX},R=lb.getStatEventTarget=function(){return e_()},N=lb.Event=em,A=lb.Stat={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},ek.NO_ERROR=0,ek.TIMEOUT=8,ek.HTTP_ERROR=6,k=lb.ErrorCode=ek,eA.COMPLETE="complete",S=lb.EventType=eA,ed.EventType=ef,ef.OPEN="a",ef.CLOSE="b",ef.ERROR="c",ef.MESSAGE="d",et.prototype.listen=et.prototype.J,I=lb.WebChannel=ed,lb.FetchXmlHttpFactory=tp,tb.prototype.listenOnce=tb.prototype.K,tb.prototype.getLastError=tb.prototype.Ha,tb.prototype.getLastErrorCode=tb.prototype.ya,tb.prototype.getStatus=tb.prototype.ca,tb.prototype.getResponseJson=tb.prototype.La,tb.prototype.getResponseText=tb.prototype.la,tb.prototype.send=tb.prototype.ea,tb.prototype.setWithCredentials=tb.prototype.Fa,C=lb.XhrIo=tb}).apply(void 0!==lw?lw:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});let lE="@firebase/firestore",lT="4.9.2";class lC{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}lC.UNAUTHENTICATED=new lC(null),lC.GOOGLE_CREDENTIALS=new lC("google-credentials-uid"),lC.FIRST_PARTY=new lC("first-party-uid"),lC.MOCK_USER=new lC("mock-user");let lI="12.3.0",lS=new eB("@firebase/firestore");function lk(){return lS.logLevel}function lA(e,...t){if(lS.logLevel<=w.DEBUG){let n=t.map(lP);lS.debug(`Firestore (${lI}): ${e}`,...n)}}function lN(e,...t){if(lS.logLevel<=w.ERROR){let n=t.map(lP);lS.error(`Firestore (${lI}): ${e}`,...n)}}function lR(e,...t){if(lS.logLevel<=w.WARN){let n=t.map(lP);lS.warn(`Firestore (${lI}): ${e}`,...n)}}function lP(e){if("string"==typeof e)return e;try{return JSON.stringify(e)}catch(t){return e}}function lx(e,t,n){let i="Unexpected state";"string"==typeof t?i=t:n=t,lD(e,i,n)}function lD(e,t,n){let i=`FIRESTORE (${lI}) INTERNAL ASSERTION FAILED: ${t} (ID: ${e.toString(16)})`;if(void 0!==n)try{i+=" CONTEXT: "+JSON.stringify(n)}catch(e){i+=" CONTEXT: "+n}throw lN(i),Error(i)}function lO(e,t,n,i){let r="Unexpected state";"string"==typeof n?r=n:i=n,e||lD(t,r,i)}let lL={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class lM extends eh{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class lF{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class lU{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class lV{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(lC.UNAUTHENTICATED))}shutdown(){}}class lq{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class lj{constructor(e){this.t=e,this.currentUser=lC.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){lO(void 0===this.o,42304);let n=this.i,i=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve(),r=new lF;this.o=()=>{this.i++,this.currentUser=this.u(),r.resolve(),r=new lF,e.enqueueRetryable(()=>i(this.currentUser))};let s=()=>{let t=r;e.enqueueRetryable(async()=>{await t.promise,await i(this.currentUser)})},o=e=>{lA("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.o&&(this.auth.addAuthTokenListener(this.o),s())};this.t.onInit(e=>o(e)),setTimeout(()=>{if(!this.auth){let e=this.t.getImmediate({optional:!0});e?o(e):(lA("FirebaseAuthCredentialsProvider","Auth not yet detected"),r.resolve(),r=new lF)}},0),s()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(t=>this.i!==e?(lA("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(lO("string"==typeof t.accessToken,31837,{l:t}),new lU(t.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let e=this.auth&&this.auth.getUid();return lO(null===e||"string"==typeof e,2055,{h:e}),new lC(e)}}class lB{constructor(e,t,n){this.P=e,this.T=t,this.I=n,this.type="FirstParty",this.user=lC.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);let e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class lz{constructor(e,t,n){this.P=e,this.T=t,this.I=n}getToken(){return Promise.resolve(new lB(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(lC.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class l${constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class lH{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,ta(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){lO(void 0===this.o,3512);let n=e=>{null!=e.error&&lA("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);let n=e.token!==this.m;return this.m=e.token,lA("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable(()=>n(t))};let i=e=>{lA("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(e=>i(e)),setTimeout(()=>{if(!this.appCheck){let e=this.V.getImmediate({optional:!0});e?i(e):lA("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new l$(this.p));let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(e=>e?(lO("string"==typeof e.token,44558,{tokenResult:e}),this.m=e.token,new l$(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}class lW{static newId(){let e=62*Math.floor(256/62),t="";for(;t.length<20;){let n=function(e){let t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(40);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let e=0;e<40;e++)n[e]=Math.floor(256*Math.random());return n}(0);for(let i=0;i<n.length;++i)t.length<20&&n[i]<e&&(t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(n[i]%62))}return t}}function lK(e,t){return e<t?-1:+(e>t)}function lG(e,t){let n=Math.min(e.length,t.length);for(let i=0;i<n;i++){let n=e.charAt(i),r=t.charAt(i);if(n!==r)return lQ(n)===lQ(r)?lK(n,r):lQ(n)?1:-1}return lK(e.length,t.length)}function lQ(e){let t=e.charCodeAt(0);return t>=55296&&t<=57343}function lY(e,t,n){return e.length===t.length&&e.every((e,i)=>n(e,t[i]))}let lX="__name__";class lJ{constructor(e,t,n){void 0===t?t=0:t>e.length&&lx(637,{offset:t,range:e.length}),void 0===n?n=e.length-t:n>e.length-t&&lx(1746,{length:n,range:e.length-t}),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===lJ.comparator(this,e)}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof lJ?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let n=Math.min(e.length,t.length);for(let i=0;i<n;i++){let n=lJ.compareSegments(e.get(i),t.get(i));if(0!==n)return n}return lK(e.length,t.length)}static compareSegments(e,t){let n=lJ.isNumericId(e),i=lJ.isNumericId(t);return n&&!i?-1:!n&&i?1:n&&i?lJ.extractNumericId(e).compare(lJ.extractNumericId(t)):lG(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return E.fromString(e.substring(4,e.length-2))}}class lZ extends lJ{construct(e,t,n){return new lZ(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let n of e){if(n.indexOf("//")>=0)throw new lM(lL.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(e=>e.length>0))}return new lZ(t)}static emptyPath(){return new lZ([])}}let l0=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class l1 extends lJ{construct(e,t,n){return new l1(e,t,n)}static isValidIdentifier(e){return l0.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),l1.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===lX}static keyField(){return new l1([lX])}static fromServerFormat(e){let t=[],n="",i=0,r=()=>{if(0===n.length)throw new lM(lL.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""},s=!1;for(;i<e.length;){let t=e[i];if("\\"===t){if(i+1===e.length)throw new lM(lL.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let t=e[i+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new lM(lL.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,i+=2}else"`"===t?s=!s:"."!==t||s?n+=t:r(),i++}if(r(),s)throw new lM(lL.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new l1(t)}static emptyPath(){return new l1([])}}class l2{constructor(e){this.path=e}static fromPath(e){return new l2(lZ.fromString(e))}static fromName(e){return new l2(lZ.fromString(e).popFirst(5))}static empty(){return new l2(lZ.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===lZ.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return lZ.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new l2(new lZ(e.slice()))}}function l6(e,t,n){if(!n)throw new lM(lL.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function l3(e){if(!l2.isDocumentKey(e))throw new lM(lL.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function l5(e){if(l2.isDocumentKey(e))throw new lM(lL.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function l4(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}function l8(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{var t;let n=(t=e).constructor?t.constructor.name:null;return n?`a custom ${n} object`:"an object"}}return"function"==typeof e?"a function":lx(12329,{type:typeof e})}function l7(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new lM(lL.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let n=l8(e);throw new lM(lL.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}function l9(e,t){let n={typeString:e};return t&&(n.value=t),n}function he(e,t){let n;if(!l4(e))throw new lM(lL.INVALID_ARGUMENT,"JSON must be an object");for(let i in t)if(t[i]){let r=t[i].typeString,s="value"in t[i]?{value:t[i].value}:void 0;if(!(i in e)){n=`JSON missing required field: '${i}'`;break}let o=e[i];if(r&&typeof o!==r){n=`JSON field '${i}' must be a ${r}.`;break}if(void 0!==s&&o!==s.value){n=`Expected '${i}' field to equal '${s.value}'`;break}}if(n)throw new lM(lL.INVALID_ARGUMENT,n);return!0}class ht{static now(){return ht.fromMillis(Date.now())}static fromDate(e){return ht.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),n=Math.floor((e-1e3*t)*1e6);return new ht(t,n)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0||t>=1e9)throw new lM(lL.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-0xe7791f700||e>=0x3afff44180)throw new lM(lL.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?lK(this.nanoseconds,e.nanoseconds):lK(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:ht._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(he(e,ht._jsonSchema))return new ht(e.seconds,e.nanoseconds)}valueOf(){return String(this.seconds- -0xe7791f700).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}ht._jsonSchemaVersion="firestore/timestamp/1.0",ht._jsonSchema={type:l9("string",ht._jsonSchemaVersion),seconds:l9("number"),nanoseconds:l9("number")};class hn{static fromTimestamp(e){return new hn(e)}static min(){return new hn(new ht(0,0))}static max(){return new hn(new ht(0x3afff4417f,0x3b9ac9ff))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class hi{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new hi(hn.min(),l2.empty(),-1)}static max(){return new hi(hn.max(),l2.empty(),-1)}}class hr{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}async function hs(e){if(e.code!==lL.FAILED_PRECONDITION||"The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab."!==e.message)throw e;lA("LocalStore","Unexpectedly lost primary lease")}class ho{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&lx(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new ho((n,i)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,i)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof ho?t:ho.resolve(t)}catch(e){return ho.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):ho.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):ho.reject(t)}static resolve(e){return new ho((t,n)=>{t(e)})}static reject(e){return new ho((t,n)=>{n(e)})}static waitFor(e){return new ho((t,n)=>{let i=0,r=0,s=!1;e.forEach(e=>{++i,e.next(()=>{++r,s&&r===i&&t()},e=>n(e))}),s=!0,r===i&&t()})}static or(e){let t=ho.resolve(!1);for(let n of e)t=t.next(e=>e?ho.resolve(e):n());return t}static forEach(e,t){let n=[];return e.forEach((e,i)=>{n.push(t.call(this,e,i))}),this.waitFor(n)}static mapArray(e,t){return new ho((n,i)=>{let r=e.length,s=Array(r),o=0;for(let a=0;a<r;a++){let l=a;t(e[l]).next(e=>{s[l]=e,++o===r&&n(s)},e=>i(e))}})}static doWhile(e,t){return new ho((n,i)=>{let r=()=>{!0===e()?t().next(()=>{r()},i):n()};r()})}}function ha(e){return"IndexedDbTransactionError"===e.name}class hl{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ae(e),this.ue=e=>t.writeSequenceNumber(e))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){let e=++this.previousValue;return this.ue&&this.ue(e),e}}hl.ce=-1;function hh(e){return 0===e&&1/e==-1/0}function hu(e){let t=0;for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function hc(e,t){for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function hd(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class hf{constructor(e,t){this.comparator=e,this.root=t||hg.EMPTY}insert(e,t){return new hf(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,hg.BLACK,null,null))}remove(e){return new hf(this.comparator,this.root.remove(e,this.comparator).copy(null,null,hg.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){let i=this.comparator(e,n.key);if(0===i)return t+n.left.size;i<0?n=n.left:(t+=n.left.size+1,n=n.right)}return -1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){let e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new hp(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new hp(this.root,e,this.comparator,!1)}getReverseIterator(){return new hp(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new hp(this.root,e,this.comparator,!0)}}class hp{constructor(e,t,n,i){this.isReverse=i,this.nodeStack=[];let r=1;for(;!e.isEmpty();)if(r=t?n(e.key,t):1,t&&i&&(r*=-1),r<0)e=this.isReverse?e.left:e.right;else{if(0===r){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class hg{constructor(e,t,n,i,r){this.key=e,this.value=t,this.color=null!=n?n:hg.RED,this.left=null!=i?i:hg.EMPTY,this.right=null!=r?r:hg.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,i,r){return new hg(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=i?i:this.left,null!=r?r:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let i=this,r=n(e,i.key);return(i=r<0?i.copy(null,null,null,i.left.insert(e,t,n),null):0===r?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,n))).fixUp()}removeMin(){if(this.left.isEmpty())return hg.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()}remove(e,t){let n,i=this;if(0>t(e,i.key))i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===t(e,i.key)){if(i.right.isEmpty())return hg.EMPTY;n=i.right.min(),i=i.copy(n.key,n.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight())).rotateLeft()).colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=(e=e.rotateRight()).colorFlip()),e}rotateLeft(){let e=this.copy(null,null,hg.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,hg.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){return Math.pow(2,this.check())<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw lx(43730,{key:this.key,value:this.value});if(this.right.isRed())throw lx(14113,{key:this.key,value:this.value});let e=this.left.check();if(e!==this.right.check())throw lx(27949);return e+ +!this.isRed()}}hg.EMPTY=null,hg.RED=!0,hg.BLACK=!1,hg.EMPTY=new class{constructor(){this.size=0}get key(){throw lx(57766)}get value(){throw lx(16141)}get color(){throw lx(16727)}get left(){throw lx(29726)}get right(){throw lx(36894)}copy(e,t,n,i,r){return this}insert(e,t,n){return new hg(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class hm{constructor(e){this.comparator=e,this.data=new hf(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){let n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){let i=n.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new hy(this.data.getIterator())}getIteratorFrom(e){return new hy(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof hm)||this.size!==e.size)return!1;let t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){let e=t.getNext().key,i=n.getNext().key;if(0!==this.comparator(e,i))return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new hm(this.comparator);return t.data=e,t}}class hy{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class h_{constructor(e){this.fields=e,e.sort(l1.comparator)}static empty(){return new h_([])}unionWith(e){let t=new hm(l1.comparator);for(let e of this.fields)t=t.add(e);for(let n of e)t=t.add(n);return new h_(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return lY(this.fields,e.fields,(e,t)=>e.isEqual(t))}}class hv extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class hw{constructor(e){this.binaryString=e}static fromBase64String(e){return new hw(function(e){try{return atob(e)}catch(e){throw"undefined"!=typeof DOMException&&e instanceof DOMException?new hv("Invalid base64 string: "+e):e}}(e))}static fromUint8Array(e){return new hw(function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e))}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){var e=this.binaryString;let t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return lK(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}hw.EMPTY_BYTE_STRING=new hw("");let hb=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function hE(e){if(lO(!!e,39018),"string"==typeof e){let t=0,n=hb.exec(e);if(lO(!!n,46558,{timestamp:e}),n[1]){let e=n[1];t=Number(e=(e+"000000000").substr(0,9))}return{seconds:Math.floor(new Date(e).getTime()/1e3),nanos:t}}return{seconds:hT(e.seconds),nanos:hT(e.nanos)}}function hT(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function hC(e){return"string"==typeof e?hw.fromBase64String(e):hw.fromUint8Array(e)}let hI="server_timestamp",hS="__type__",hk="__previous_value__",hA="__local_write_time__";function hN(e){return(e?.mapValue?.fields||{})[hS]?.stringValue===hI}function hR(e){let t=e.mapValue.fields[hk];return hN(t)?hR(t):t}function hP(e){let t=hE(e.mapValue.fields[hA].timestampValue);return new ht(t.seconds,t.nanos)}class hx{constructor(e,t,n,i,r,s,o,a,l,h){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=i,this.ssl=r,this.forceLongPolling=s,this.autoDetectLongPolling=o,this.longPollingOptions=a,this.useFetchStreams=l,this.isUsingEmulator=h}}let hD="(default)";class hO{constructor(e,t){this.projectId=e,this.database=t||hD}static empty(){return new hO("","")}get isDefaultDatabase(){return this.database===hD}isEqual(e){return e instanceof hO&&e.projectId===this.projectId&&e.database===this.database}}let hL="__type__",hM="__max__",hF={},hU="__vector__",hV="value";function hq(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?hN(e)?4:h1(e)?0x1fffffffffffff:hZ(e)?10:11:lx(28295,{value:e})}function hj(e,t){if(e===t)return!0;let n=hq(e);if(n!==hq(t))return!1;switch(n){case 0:case 0x1fffffffffffff:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return hP(e).isEqual(hP(t));case 3:if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;let i=hE(e.timestampValue),r=hE(t.timestampValue);return i.seconds===r.seconds&&i.nanos===r.nanos;case 5:return e.stringValue===t.stringValue;case 6:return hC(e.bytesValue).isEqual(hC(t.bytesValue));case 7:return e.referenceValue===t.referenceValue;case 8:return hT(e.geoPointValue.latitude)===hT(t.geoPointValue.latitude)&&hT(e.geoPointValue.longitude)===hT(t.geoPointValue.longitude);case 2:if("integerValue"in e&&"integerValue"in t)return hT(e.integerValue)===hT(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){let n=hT(e.doubleValue),i=hT(t.doubleValue);return n===i?hh(n)===hh(i):isNaN(n)&&isNaN(i)}return!1;case 9:return lY(e.arrayValue.values||[],t.arrayValue.values||[],hj);case 10:case 11:let s=e.mapValue.fields||{},o=t.mapValue.fields||{};if(hu(s)!==hu(o))return!1;for(let e in s)if(s.hasOwnProperty(e)&&(void 0===o[e]||!hj(s[e],o[e])))return!1;return!0;default:return lx(52216,{left:e})}}function hB(e,t){return void 0!==(e.values||[]).find(e=>hj(e,t))}function hz(e,t){var n,i,r,s,o,a;if(e===t)return 0;let l=hq(e),h=hq(t);if(l!==h)return lK(l,h);switch(l){case 0:case 0x1fffffffffffff:return 0;case 1:return lK(e.booleanValue,t.booleanValue);case 2:let u,c;return u=hT(e.integerValue||e.doubleValue),u<(c=hT(t.integerValue||t.doubleValue))?-1:u>c?1:u===c?0:isNaN(u)?isNaN(c)?0:-1:1;case 3:return h$(e.timestampValue,t.timestampValue);case 4:return h$(hP(e),hP(t));case 5:return lG(e.stringValue,t.stringValue);case 6:let d,f;return n=e.bytesValue,i=t.bytesValue,d=hC(n),f=hC(i),d.compareTo(f);case 7:return function(e,t){let n=e.split("/"),i=t.split("/");for(let e=0;e<n.length&&e<i.length;e++){let t=lK(n[e],i[e]);if(0!==t)return t}return lK(n.length,i.length)}(e.referenceValue,t.referenceValue);case 8:let p;return r=e.geoPointValue,s=t.geoPointValue,0!==(p=lK(hT(r.latitude),hT(s.latitude)))?p:lK(hT(r.longitude),hT(s.longitude));case 9:return hH(e.arrayValue,t.arrayValue);case 10:let g,m,y,_,v;return o=e.mapValue,a=t.mapValue,g=o.fields||{},m=a.fields||{},y=g[hV]?.arrayValue,_=m[hV]?.arrayValue,0!==(v=lK(y?.values?.length||0,_?.values?.length||0))?v:hH(y,_);case 11:return function(e,t){if(e===hF&&t===hF)return 0;if(e===hF)return 1;if(t===hF)return -1;let n=e.fields||{},i=Object.keys(n),r=t.fields||{},s=Object.keys(r);i.sort(),s.sort();for(let e=0;e<i.length&&e<s.length;++e){let t=lG(i[e],s[e]);if(0!==t)return t;let o=hz(n[i[e]],r[s[e]]);if(0!==o)return o}return lK(i.length,s.length)}(e.mapValue,t.mapValue);default:throw lx(23264,{he:l})}}function h$(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return lK(e,t);let n=hE(e),i=hE(t),r=lK(n.seconds,i.seconds);return 0!==r?r:lK(n.nanos,i.nanos)}function hH(e,t){let n=e.values||[],i=t.values||[];for(let e=0;e<n.length&&e<i.length;++e){let t=hz(n[e],i[e]);if(t)return t}return lK(n.length,i.length)}function hW(e){var t,n;let i;return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?(i=hE(e.timestampValue),`time(${i.seconds},${i.nanos})`):"stringValue"in e?e.stringValue:"bytesValue"in e?hC(e.bytesValue).toBase64():"referenceValue"in e?(t=e.referenceValue,l2.fromName(t).toString()):"geoPointValue"in e?(n=e.geoPointValue,`geo(${n.latitude},${n.longitude})`):"arrayValue"in e?function(e){let t="[",n=!0;for(let i of e.values||[])n?n=!1:t+=",",t+=hW(i);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){let t=Object.keys(e.fields||{}).sort(),n="{",i=!0;for(let r of t)i?i=!1:n+=",",n+=`${r}:${hW(e.fields[r])}`;return n+"}"}(e.mapValue):lx(61005,{value:e})}function hK(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function hG(e){return!!e&&"integerValue"in e}function hQ(e){return!!e&&"arrayValue"in e}function hY(e){return!!e&&"nullValue"in e}function hX(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function hJ(e){return!!e&&"mapValue"in e}function hZ(e){return(e?.mapValue?.fields||{})[hL]?.stringValue===hU}function h0(e){if(e.geoPointValue)return{geoPointValue:{...e.geoPointValue}};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:{...e.timestampValue}};if(e.mapValue){let t={mapValue:{fields:{}}};return hc(e.mapValue.fields,(e,n)=>t.mapValue.fields[e]=h0(n)),t}if(e.arrayValue){let t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=h0(e.arrayValue.values[n]);return t}return{...e}}function h1(e){return(((e.mapValue||{}).fields||{}).__type__||{}).stringValue===hM}class h2{constructor(e){this.value=e}static empty(){return new h2({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(!hJ(t=(t.mapValue.fields||{})[e.get(n)]))return null;return(t=(t.mapValue.fields||{})[e.lastSegment()])||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=h0(t)}setAll(e){let t=l1.emptyPath(),n={},i=[];e.forEach((e,r)=>{if(!t.isImmediateParentOf(r)){let e=this.getFieldsMap(t);this.applyChanges(e,n,i),n={},i=[],t=r.popLast()}e?n[r.lastSegment()]=h0(e):i.push(r.lastSegment())});let r=this.getFieldsMap(t);this.applyChanges(r,n,i)}delete(e){let t=this.field(e.popLast());hJ(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return hj(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let i=t.mapValue.fields[e.get(n)];hJ(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,n){for(let i of(hc(t,(t,n)=>e[t]=n),n))delete e[i]}clone(){return new h2(h0(this.value))}}class h6{constructor(e,t,n,i,r,s,o){this.key=e,this.documentType=t,this.version=n,this.readTime=i,this.createTime=r,this.data=s,this.documentState=o}static newInvalidDocument(e){return new h6(e,0,hn.min(),hn.min(),hn.min(),h2.empty(),0)}static newFoundDocument(e,t,n,i){return new h6(e,1,t,hn.min(),n,i,0)}static newNoDocument(e,t){return new h6(e,2,t,hn.min(),hn.min(),h2.empty(),0)}static newUnknownDocument(e,t){return new h6(e,3,t,hn.min(),hn.min(),h2.empty(),2)}convertToFoundDocument(e,t){return this.createTime.isEqual(hn.min())&&(2===this.documentType||0===this.documentType)&&(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=h2.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=h2.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=hn.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof h6&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new h6(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class h3{constructor(e,t){this.position=e,this.inclusive=t}}function h5(e,t,n){let i=0;for(let r=0;r<e.position.length;r++){let s=t[r],o=e.position[r];if(i=s.field.isKeyField()?l2.comparator(l2.fromName(o.referenceValue),n.key):hz(o,n.data.field(s.field)),"desc"===s.dir&&(i*=-1),0!==i)break}return i}function h4(e,t){if(null===e)return null===t;if(null===t||e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!hj(e.position[n],t.position[n]))return!1;return!0}class h8{constructor(e,t="asc"){this.field=e,this.dir=t}}class h7{}class h9 extends h7{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new ui(e,t,n):"array-contains"===t?new ua(e,n):"in"===t?new ul(e,n):"not-in"===t?new uh(e,n):"array-contains-any"===t?new uu(e,n):new h9(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new ur(e,n):new us(e,n)}matches(e){let t=e.data.field(this.field);return"!="===this.op?null!==t&&void 0===t.nullValue&&this.matchesComparison(hz(t,this.value)):null!==t&&hq(this.value)===hq(t)&&this.matchesComparison(hz(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return lx(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class ue extends h7{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new ue(e,t)}matches(e){return ut(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.Pe||(this.Pe=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function ut(e){return"and"===e.op}function un(e){for(let t of e.filters)if(t instanceof ue)return!1;return!0}class ui extends h9{constructor(e,t,n){super(e,t,n),this.key=l2.fromName(n.referenceValue)}matches(e){let t=l2.comparator(e.key,this.key);return this.matchesComparison(t)}}class ur extends h9{constructor(e,t){super(e,"in",t),this.keys=uo("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class us extends h9{constructor(e,t){super(e,"not-in",t),this.keys=uo("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function uo(e,t){return(t.arrayValue?.values||[]).map(e=>l2.fromName(e.referenceValue))}class ua extends h9{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return hQ(t)&&hB(t.arrayValue,this.value)}}class ul extends h9{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return null!==t&&hB(this.value.arrayValue,t)}}class uh extends h9{constructor(e,t){super(e,"not-in",t)}matches(e){if(hB(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return null!==t&&void 0===t.nullValue&&!hB(this.value.arrayValue,t)}}class uu extends h9{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!hQ(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>hB(this.value.arrayValue,e))}}class uc{constructor(e,t=null,n=[],i=[],r=null,s=null,o=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=i,this.limit=r,this.startAt=s,this.endAt=o,this.Te=null}}function ud(e,t=null,n=[],i=[],r=null,s=null,o=null){return new uc(e,t,n,i,r,s,o)}function uf(e){if(null===e.Te){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(e=>(function e(t){if(t instanceof h9)return t.field.canonicalString()+t.op.toString()+hW(t.value);if(un(t)&&ut(t))return t.filters.map(t=>e(t)).join(",");{let n=t.filters.map(t=>e(t)).join(",");return`${t.op}(${n})`}})(e)).join(","),t+="|ob:",t+=e.orderBy.map(e=>e.field.canonicalString()+e.dir).join(","),null==e.limit||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(e=>hW(e)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(e=>hW(e)).join(",")),e.Te=t}return e.Te}function up(e,t){if(e.limit!==t.limit||e.orderBy.length!==t.orderBy.length)return!1;for(let r=0;r<e.orderBy.length;r++){var n,i;if(n=e.orderBy[r],i=t.orderBy[r],!(n.dir===i.dir&&n.field.isEqual(i.field)))return!1}if(e.filters.length!==t.filters.length)return!1;for(let n=0;n<e.filters.length;n++)if(!function e(t,n){return t instanceof h9?n instanceof h9&&t.op===n.op&&t.field.isEqual(n.field)&&hj(t.value,n.value):t instanceof ue?n instanceof ue&&t.op===n.op&&t.filters.length===n.filters.length&&t.filters.reduce((t,i,r)=>t&&e(i,n.filters[r]),!0):void lx(19439)}(e.filters[n],t.filters[n]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!h4(e.startAt,t.startAt)&&h4(e.endAt,t.endAt)}function ug(e){return l2.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}class um{constructor(e,t=null,n=[],i=[],r=null,s="F",o=null,a=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=i,this.limit=r,this.limitType=s,this.startAt=o,this.endAt=a,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function uy(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function u_(e){return null!==e.collectionGroup}function uv(e){if(null===e.Ie){let t;e.Ie=[];let n=new Set;for(let t of e.explicitOrderBy)e.Ie.push(t),n.add(t.field.canonicalString());let i=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(t=new hm(l1.comparator),e.filters.forEach(e=>{e.getFlattenedFilters().forEach(e=>{e.isInequality()&&(t=t.add(e.field))})}),t).forEach(t=>{n.has(t.canonicalString())||t.isKeyField()||e.Ie.push(new h8(t,i))}),n.has(l1.keyField().canonicalString())||e.Ie.push(new h8(l1.keyField(),i))}return e.Ie}function uw(e){return e.Ee||(e.Ee=function(e,t){if("F"===e.limitType)return ud(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map(e=>{let t="desc"===e.dir?"asc":"desc";return new h8(e.field,t)});let n=e.endAt?new h3(e.endAt.position,e.endAt.inclusive):null,i=e.startAt?new h3(e.startAt.position,e.startAt.inclusive):null;return ud(e.path,e.collectionGroup,t,e.filters,e.limit,n,i)}}(e,uv(e))),e.Ee}function ub(e,t){let n=e.filters.concat([t]);return new um(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}function uE(e,t,n){return new um(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function uT(e,t){return up(uw(e),uw(t))&&e.limitType===t.limitType}function uC(e){return`${uf(uw(e))}|lt:${e.limitType}`}function uI(e){var t;let n;return`Query(target=${n=(t=uw(e)).path.canonicalString(),null!==t.collectionGroup&&(n+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(n+=`, filters: [${t.filters.map(e=>(function e(t){return t instanceof h9?`${t.field.canonicalString()} ${t.op} ${hW(t.value)}`:t instanceof ue?t.op.toString()+" {"+t.getFilters().map(e).join(" ,")+"}":"Filter"})(e)).join(", ")}]`),null==t.limit||(n+=", limit: "+t.limit),t.orderBy.length>0&&(n+=`, orderBy: [${t.orderBy.map(e=>`${e.field.canonicalString()} (${e.dir})`).join(", ")}]`),t.startAt&&(n+=", startAt: ",n+=t.startAt.inclusive?"b:":"a:",n+=t.startAt.position.map(e=>hW(e)).join(",")),t.endAt&&(n+=", endAt: ",n+=t.endAt.inclusive?"a:":"b:",n+=t.endAt.position.map(e=>hW(e)).join(",")),`Target(${n})`}; limitType=${e.limitType})`}function uS(e,t){var n,i,r,s;let o,a,l;return t.isFoundDocument()&&(o=t.key.path,null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(o):l2.isDocumentKey(e.path)?e.path.isEqual(o):e.path.isImmediateParentOf(o))&&function(e,t){for(let n of uv(e))if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(let n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&(n=e,i=t,(!n.startAt||(r=n.startAt,a=h5(r,uv(n),i),r.inclusive?!!(a<=0):!!(a<0)))&&(!n.endAt||(s=n.endAt,l=h5(s,uv(n),i),s.inclusive?!!(l>=0):!!(l>0))))}function uk(e){return(t,n)=>{let i=!1;for(let r of uv(e)){let e=function(e,t,n){var i;let r,s,o=e.field.isKeyField()?l2.comparator(t.key,n.key):(i=e.field,r=t.data.field(i),s=n.data.field(i),null!==r&&null!==s?hz(r,s):lx(42886));switch(e.dir){case"asc":return o;case"desc":return -1*o;default:return lx(19790,{direction:e.dir})}}(r,t,n);if(0!==e)return e;i=i||r.field.isKeyField()}return 0}}class uA{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n){for(let[t,i]of n)if(this.equalsFn(t,e))return i}}has(e){return void 0!==this.get(e)}set(e,t){let n=this.mapKeyFn(e),i=this.inner[n];if(void 0===i)return this.inner[n]=[[e,t]],void this.innerSize++;for(let n=0;n<i.length;n++)if(this.equalsFn(i[n][0],e))return void(i[n]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let i=0;i<n.length;i++)if(this.equalsFn(n[i][0],e))return 1===n.length?delete this.inner[t]:n.splice(i,1),this.innerSize--,!0;return!1}forEach(e){hc(this.inner,(t,n)=>{for(let[t,i]of n)e(t,i)})}isEmpty(){return hd(this.inner)}size(){return this.innerSize}}let uN=new hf(l2.comparator),uR=new hf(l2.comparator);function uP(...e){let t=uR;for(let n of e)t=t.insert(n.key,n);return t}function ux(e){let t=uR;return e.forEach((e,n)=>t=t.insert(e,n.overlayedDocument)),t}function uD(){return new uA(e=>e.toString(),(e,t)=>e.isEqual(t))}let uO=new hf(l2.comparator),uL=new hm(l2.comparator);function uM(...e){let t=uL;for(let n of e)t=t.add(n);return t}let uF=new hm(lK);function uU(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:hh(t)?"-0":t}}function uV(e){return{integerValue:""+e}}class uq{constructor(){this._=void 0}}function uj(e,t){return e instanceof uK?hG(t)||t&&"doubleValue"in t?t:{integerValue:0}:null}class uB extends uq{}class uz extends uq{constructor(e){super(),this.elements=e}}function u$(e,t){let n=uQ(t);for(let t of e.elements)n.some(e=>hj(e,t))||n.push(t);return{arrayValue:{values:n}}}class uH extends uq{constructor(e){super(),this.elements=e}}function uW(e,t){let n=uQ(t);for(let t of e.elements)n=n.filter(e=>!hj(e,t));return{arrayValue:{values:n}}}class uK extends uq{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function uG(e){return hT(e.integerValue||e.doubleValue)}function uQ(e){return hQ(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class uY{constructor(e,t){this.version=e,this.transformResults=t}}class uX{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new uX}static exists(e){return new uX(void 0,e)}static updateTime(e){return new uX(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function uJ(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class uZ{}function u0(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new u7(e.key,uX.none()):new u6(e.key,e.data,uX.none());{let n=e.data,i=h2.empty(),r=new hm(l1.comparator);for(let e of t.fields)if(!r.has(e)){let t=n.field(e);null===t&&e.length>1&&(e=e.popLast(),t=n.field(e)),null===t?i.delete(e):i.set(e,t),r=r.add(e)}return new u3(e.key,i,new h_(r.toArray()),uX.none())}}function u1(e,t,n,i){return e instanceof u6?function(e,t,n,i){if(!uJ(e.precondition,t))return n;let r=e.value.clone(),s=u8(e.fieldTransforms,i,t);return r.setAll(s),t.convertToFoundDocument(t.version,r).setHasLocalMutations(),null}(e,t,n,i):e instanceof u3?function(e,t,n,i){if(!uJ(e.precondition,t))return n;let r=u8(e.fieldTransforms,i,t),s=t.data;return(s.setAll(u5(e)),s.setAll(r),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null===n)?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map(e=>e.field))}(e,t,n,i):uJ(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n}function u2(e,t){var n,i;return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&(n=e.fieldTransforms,i=t.fieldTransforms,!!(void 0===n&&void 0===i||!(!n||!i)&&lY(n,i,(e,t)=>{var n,i;return e.field.isEqual(t.field)&&(n=e.transform,i=t.transform,n instanceof uz&&i instanceof uz||n instanceof uH&&i instanceof uH?lY(n.elements,i.elements,hj):n instanceof uK&&i instanceof uK?hj(n.Ae,i.Ae):n instanceof uB&&i instanceof uB)})))&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class u6 extends uZ{constructor(e,t,n,i=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class u3 extends uZ{constructor(e,t,n,i,r=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=i,this.fieldTransforms=r,this.type=1}getFieldMask(){return this.fieldMask}}function u5(e){let t=new Map;return e.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){let i=e.data.field(n);t.set(n,i)}}),t}function u4(e,t,n){let i=new Map;lO(e.length===n.length,32656,{Re:n.length,Ve:e.length});for(let s=0;s<n.length;s++){var r;let o=e[s],a=o.transform,l=t.data.field(o.field);i.set(o.field,(r=n[s],a instanceof uz?u$(a,l):a instanceof uH?uW(a,l):r))}return i}function u8(e,t,n){let i=new Map;for(let r of e){let e=r.transform,s=n.data.field(r.field);i.set(r.field,function(e,t,n){var i;let r,s,o;return e instanceof uB?(i=t,r={fields:{[hS]:{stringValue:hI},[hA]:{timestampValue:{seconds:n.seconds,nanos:n.nanoseconds}}}},i&&hN(i)&&(i=hR(i)),i&&(r.fields[hk]=i),{mapValue:r}):e instanceof uz?u$(e,t):e instanceof uH?uW(e,t):(o=uG(s=uj(e,t))+uG(e.Ae),hG(s)&&hG(e.Ae)?uV(o):uU(e.serializer,o))}(e,s,t))}return i}class u7 extends uZ{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class u9 extends uZ{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class ce{constructor(e,t,n,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=i}applyToRemoteDocument(e,t){let n=t.mutationResults;for(let t=0;t<this.mutations.length;t++){let i=this.mutations[t];i.key.isEqual(e.key)&&function(e,t,n){let i,r;e instanceof u6?(i=e.value.clone(),r=u4(e.fieldTransforms,t,n.transformResults),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()):e instanceof u3?function(e,t,n){if(!uJ(e.precondition,t))return t.convertToUnknownDocument(n.version);let i=u4(e.fieldTransforms,t,n.transformResults),r=t.data;r.setAll(u5(e)),r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):t.convertToNoDocument(n.version).setHasCommittedMutations()}(i,e,n[t])}}applyToLocalView(e,t){for(let n of this.baseMutations)n.key.isEqual(e.key)&&(t=u1(n,e,t,this.localWriteTime));for(let n of this.mutations)n.key.isEqual(e.key)&&(t=u1(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let n=uD();return this.mutations.forEach(i=>{let r=e.get(i.key),s=r.overlayedDocument,o=this.applyToLocalView(s,r.mutatedFields),a=u0(s,o=t.has(i.key)?null:o);null!==a&&n.set(i.key,a),s.isValidDocument()||s.convertToNoDocument(hn.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),uM())}isEqual(e){return this.batchId===e.batchId&&lY(this.mutations,e.mutations,(e,t)=>u2(e,t))&&lY(this.baseMutations,e.baseMutations,(e,t)=>u2(e,t))}}class ct{constructor(e,t,n,i){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=i}static from(e,t,n){lO(e.mutations.length===n.length,58842,{me:e.mutations.length,fe:n.length});let i=uO,r=e.mutations;for(let e=0;e<r.length;e++)i=i.insert(r[e].key,n[e].version);return new ct(e,t,n,i)}}class cn{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class ci{constructor(e,t){this.count=e,this.unchangedNames=t}}function cr(e){if(void 0===e)return lN("GRPC error has no .code"),lL.UNKNOWN;switch(e){case x.OK:return lL.OK;case x.CANCELLED:return lL.CANCELLED;case x.UNKNOWN:return lL.UNKNOWN;case x.DEADLINE_EXCEEDED:return lL.DEADLINE_EXCEEDED;case x.RESOURCE_EXHAUSTED:return lL.RESOURCE_EXHAUSTED;case x.INTERNAL:return lL.INTERNAL;case x.UNAVAILABLE:return lL.UNAVAILABLE;case x.UNAUTHENTICATED:return lL.UNAUTHENTICATED;case x.INVALID_ARGUMENT:return lL.INVALID_ARGUMENT;case x.NOT_FOUND:return lL.NOT_FOUND;case x.ALREADY_EXISTS:return lL.ALREADY_EXISTS;case x.PERMISSION_DENIED:return lL.PERMISSION_DENIED;case x.FAILED_PRECONDITION:return lL.FAILED_PRECONDITION;case x.ABORTED:return lL.ABORTED;case x.OUT_OF_RANGE:return lL.OUT_OF_RANGE;case x.UNIMPLEMENTED:return lL.UNIMPLEMENTED;case x.DATA_LOSS:return lL.DATA_LOSS;default:return lx(39323,{code:e})}}(D=x||(x={}))[D.OK=0]="OK",D[D.CANCELLED=1]="CANCELLED",D[D.UNKNOWN=2]="UNKNOWN",D[D.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",D[D.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",D[D.NOT_FOUND=5]="NOT_FOUND",D[D.ALREADY_EXISTS=6]="ALREADY_EXISTS",D[D.PERMISSION_DENIED=7]="PERMISSION_DENIED",D[D.UNAUTHENTICATED=16]="UNAUTHENTICATED",D[D.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",D[D.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",D[D.ABORTED=10]="ABORTED",D[D.OUT_OF_RANGE=11]="OUT_OF_RANGE",D[D.UNIMPLEMENTED=12]="UNIMPLEMENTED",D[D.INTERNAL=13]="INTERNAL",D[D.UNAVAILABLE=14]="UNAVAILABLE",D[D.DATA_LOSS=15]="DATA_LOSS";let cs=new E([0xffffffff,0xffffffff],0);function co(e){let t=(new TextEncoder).encode(e),n=new T;return n.update(t),new Uint8Array(n.digest())}function ca(e){let t=new DataView(e.buffer),n=t.getUint32(0,!0),i=t.getUint32(4,!0),r=t.getUint32(8,!0),s=t.getUint32(12,!0);return[new E([n,i],0),new E([r,s],0)]}class cl{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new ch(`Invalid padding: ${t}`);if(n<0||e.length>0&&0===this.hashCount)throw new ch(`Invalid hash count: ${n}`);if(0===e.length&&0!==t)throw new ch(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=E.fromNumber(this.ge)}ye(e,t,n){let i=e.add(t.multiply(E.fromNumber(n)));return 1===i.compare(cs)&&(i=new E([i.getBits(0),i.getBits(1)],0)),i.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.ge)return!1;let[t,n]=ca(co(e));for(let e=0;e<this.hashCount;e++){let i=this.ye(t,n,e);if(!this.we(i))return!1}return!0}static create(e,t,n){let i=new cl(new Uint8Array(Math.ceil(e/8)),e%8==0?0:8-e%8,t);return n.forEach(e=>i.insert(e)),i}insert(e){if(0===this.ge)return;let[t,n]=ca(co(e));for(let e=0;e<this.hashCount;e++){let i=this.ye(t,n,e);this.Se(i)}}Se(e){let t=Math.floor(e/8);this.bitmap[t]|=1<<e%8}}class ch extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class cu{constructor(e,t,n,i,r){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=i,this.resolvedLimboDocuments=r}static createSynthesizedRemoteEventForCurrentChange(e,t,n){let i=new Map;return i.set(e,cc.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new cu(hn.min(),i,new hf(lK),uN,uM())}}class cc{constructor(e,t,n,i,r){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=i,this.removedDocuments=r}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new cc(n,t,uM(),uM(),uM())}}class cd{constructor(e,t,n,i){this.be=e,this.removedTargetIds=t,this.key=n,this.De=i}}class cf{constructor(e,t){this.targetId=e,this.Ce=t}}class cp{constructor(e,t,n=hw.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=i}}class cg{constructor(){this.ve=0,this.Fe=c_(),this.Me=hw.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return 0!==this.ve}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=uM(),t=uM(),n=uM();return this.Fe.forEach((i,r)=>{switch(r){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:n=n.add(i);break;default:lx(38017,{changeType:r})}}),new cc(this.Me,this.xe,e,t,n)}qe(){this.Oe=!1,this.Fe=c_()}Qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,lO(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class cm{constructor(e){this.Ge=e,this.ze=new Map,this.je=uN,this.Je=cy(),this.He=cy(),this.Ye=new hf(lK)}Ze(e){for(let t of e.be)e.De&&e.De.isFoundDocument()?this.Xe(t,e.De):this.et(t,e.key,e.De);for(let t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,t=>{let n=this.nt(t);switch(e.state){case 0:this.rt(t)&&n.Le(e.resumeToken);break;case 1:n.Ke(),n.Ne||n.qe(),n.Le(e.resumeToken);break;case 2:n.Ke(),n.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(n.We(),n.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),n.Le(e.resumeToken));break;default:lx(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach((e,n)=>{this.rt(n)&&t(n)})}st(e){let t=e.targetId,n=e.Ce.count,i=this.ot(t);if(i){let r=i.target;if(ug(r))if(0===n){let e=new l2(r.path);this.et(t,e,h6.newNoDocument(e,hn.min()))}else lO(1===n,20013,{expectedCount:n});else{let i=this._t(t);if(i!==n){let n=this.ut(e),r=n?this.ct(n,e,i):1;0!==r&&(this.it(t),this.Ye=this.Ye.insert(t,2===r?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch"))}}}}ut(e){let t,n,i=e.Ce.unchangedNames;if(!i||!i.bits)return null;let{bits:{bitmap:r="",padding:s=0},hashCount:o=0}=i;try{t=hC(r).toUint8Array()}catch(e){if(e instanceof hv)return lR("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw e}try{n=new cl(t,s,o)}catch(e){return lR(e instanceof ch?"BloomFilter error: ":"Applying bloom filter failed: ",e),null}return 0===n.ge?null:n}ct(e,t,n){return 2*(t.Ce.count!==n-this.Pt(e,t.targetId))}Pt(e,t){let n=this.Ge.getRemoteKeysForTarget(t),i=0;return n.forEach(n=>{let r=this.Ge.ht(),s=`projects/${r.projectId}/databases/${r.database}/documents/${n.path.canonicalString()}`;e.mightContain(s)||(this.et(t,n,null),i++)}),i}Tt(e){let t=new Map;this.ze.forEach((n,i)=>{let r=this.ot(i);if(r){if(n.current&&ug(r.target)){let t=new l2(r.target.path);this.It(t).has(i)||this.Et(i,t)||this.et(i,t,h6.newNoDocument(t,e))}n.Be&&(t.set(i,n.ke()),n.qe())}});let n=uM();this.He.forEach((e,t)=>{let i=!0;t.forEachWhile(e=>{let t=this.ot(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(i=!1,!1)}),i&&(n=n.add(e))}),this.je.forEach((t,n)=>n.setReadTime(e));let i=new cu(e,t,this.Ye,this.je,n);return this.je=uN,this.Je=cy(),this.He=cy(),this.Ye=new hf(lK),i}Xe(e,t){if(!this.rt(e))return;let n=2*!!this.Et(e,t.key);this.nt(e).Qe(t.key,n),this.je=this.je.insert(t.key,t),this.Je=this.Je.insert(t.key,this.It(t.key).add(e)),this.He=this.He.insert(t.key,this.dt(t.key).add(e))}et(e,t,n){if(!this.rt(e))return;let i=this.nt(e);this.Et(e,t)?i.Qe(t,1):i.$e(t),this.He=this.He.insert(t,this.dt(t).delete(e)),this.He=this.He.insert(t,this.dt(t).add(e)),n&&(this.je=this.je.insert(t,n))}removeTarget(e){this.ze.delete(e)}_t(e){let t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let t=this.ze.get(e);return t||(t=new cg,this.ze.set(e,t)),t}dt(e){let t=this.He.get(e);return t||(t=new hm(lK),this.He=this.He.insert(e,t)),t}It(e){let t=this.Je.get(e);return t||(t=new hm(lK),this.Je=this.Je.insert(e,t)),t}rt(e){let t=null!==this.ot(e);return t||lA("WatchChangeAggregator","Detected inactive target",e),t}ot(e){let t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new cg),this.Ge.getRemoteKeysForTarget(e).forEach(t=>{this.et(e,t,null)})}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function cy(){return new hf(l2.comparator)}function c_(){return new hf(l2.comparator)}let cv={asc:"ASCENDING",desc:"DESCENDING"},cw={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},cb={and:"AND",or:"OR"};class cE{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function cT(e,t){return e.useProto3Json||null==t?t:{value:t}}function cC(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function cI(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function cS(e){let t;return lO(!!e,49232),hn.fromTimestamp(new ht((t=hE(e)).seconds,t.nanos))}function ck(e,t){return cA(e,t).canonicalString()}function cA(e,t){let n=new lZ(["projects",e.projectId,"databases",e.database]).child("documents");return void 0===t?n:n.child(t)}function cN(e){let t=lZ.fromString(e);return lO(cU(t),10190,{key:t.toString()}),t}function cR(e,t){return ck(e.databaseId,t.path)}function cP(e,t){let n=cN(t);if(n.get(1)!==e.databaseId.projectId)throw new lM(lL.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new lM(lL.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new l2(cO(n))}function cx(e,t){return ck(e.databaseId,t)}function cD(e){return new lZ(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function cO(e){return lO(e.length>4&&"documents"===e.get(4),29091,{key:e.toString()}),e.popFirst(5)}function cL(e,t,n){return{name:cR(e,t),fields:n.value.mapValue.fields}}function cM(e){return{fieldPath:e.canonicalString()}}function cF(e){return l1.fromServerFormat(e.fieldPath)}function cU(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}class cV{constructor(e,t,n,i,r=hn.min(),s=hn.min(),o=hw.EMPTY_BYTE_STRING,a=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=i,this.snapshotVersion=r,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=o,this.expectedCount=a}withSequenceNumber(e){return new cV(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new cV(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new cV(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new cV(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class cq{constructor(e){this.yt=e}}class cj{constructor(){}Dt(e,t){this.Ct(e,t),t.vt()}Ct(e,t){if("nullValue"in e)this.Ft(t,5);else if("booleanValue"in e)this.Ft(t,10),t.Mt(+!!e.booleanValue);else if("integerValue"in e)this.Ft(t,15),t.Mt(hT(e.integerValue));else if("doubleValue"in e){let n=hT(e.doubleValue);isNaN(n)?this.Ft(t,13):(this.Ft(t,15),hh(n)?t.Mt(0):t.Mt(n))}else if("timestampValue"in e){let n=e.timestampValue;this.Ft(t,20),"string"==typeof n&&(n=hE(n)),t.xt(`${n.seconds||""}`),t.Mt(n.nanos||0)}else if("stringValue"in e)this.Ot(e.stringValue,t),this.Nt(t);else if("bytesValue"in e)this.Ft(t,30),t.Bt(hC(e.bytesValue)),this.Nt(t);else if("referenceValue"in e)this.Lt(e.referenceValue,t);else if("geoPointValue"in e){let n=e.geoPointValue;this.Ft(t,45),t.Mt(n.latitude||0),t.Mt(n.longitude||0)}else"mapValue"in e?h1(e)?this.Ft(t,Number.MAX_SAFE_INTEGER):hZ(e)?this.kt(e.mapValue,t):(this.qt(e.mapValue,t),this.Nt(t)):"arrayValue"in e?(this.Qt(e.arrayValue,t),this.Nt(t)):lx(19022,{$t:e})}Ot(e,t){this.Ft(t,25),this.Ut(e,t)}Ut(e,t){t.xt(e)}qt(e,t){let n=e.fields||{};for(let e of(this.Ft(t,55),Object.keys(n)))this.Ot(e,t),this.Ct(n[e],t)}kt(e,t){let n=e.fields||{};this.Ft(t,53);let i=n[hV].arrayValue?.values?.length||0;this.Ft(t,15),t.Mt(hT(i)),this.Ot(hV,t),this.Ct(n[hV],t)}Qt(e,t){let n=e.values||[];for(let e of(this.Ft(t,50),n))this.Ct(e,t)}Lt(e,t){this.Ft(t,37),l2.fromName(e).path.forEach(e=>{this.Ft(t,60),this.Ut(e,t)})}Ft(e,t){e.Mt(t)}Nt(e){e.Mt(2)}}cj.Kt=new cj;class cB{constructor(){this.Cn=new cz}addToCollectionParentIndex(e,t){return this.Cn.add(t),ho.resolve()}getCollectionParents(e,t){return ho.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return ho.resolve()}deleteFieldIndex(e,t){return ho.resolve()}deleteAllFieldIndexes(e){return ho.resolve()}createTargetIndexes(e,t){return ho.resolve()}getDocumentsMatchingTarget(e,t){return ho.resolve(null)}getIndexType(e,t){return ho.resolve(0)}getFieldIndexes(e,t){return ho.resolve([])}getNextCollectionGroupToUpdate(e){return ho.resolve(null)}getMinOffset(e,t){return ho.resolve(hi.min())}getMinOffsetFromCollectionGroup(e,t){return ho.resolve(hi.min())}updateCollectionGroup(e,t,n){return ho.resolve()}updateIndexEntries(e,t){return ho.resolve()}}class cz{constructor(){this.index={}}add(e){let t=e.lastSegment(),n=e.popLast(),i=this.index[t]||new hm(lZ.comparator),r=!i.has(n);return this.index[t]=i.add(n),r}has(e){let t=e.lastSegment(),n=e.popLast(),i=this.index[t];return i&&i.has(n)}getEntries(e){return(this.index[e]||new hm(lZ.comparator)).toArray()}}new Uint8Array(0);let c$={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class cH{static withCacheSize(e){return new cH(e,cH.DEFAULT_COLLECTION_PERCENTILE,cH.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}}cH.DEFAULT_COLLECTION_PERCENTILE=10,cH.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,cH.DEFAULT=new cH(0x2800000,cH.DEFAULT_COLLECTION_PERCENTILE,cH.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),cH.DISABLED=new cH(-1,0,0);class cW{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new cW(0)}static cr(){return new cW(-1)}}let cK="LruGarbageCollector";function cG([e,t],[n,i]){let r=lK(e,n);return 0===r?lK(t,i):r}class cQ{constructor(e){this.Ir=e,this.buffer=new hm(cG),this.Er=0}dr(){return++this.Er}Ar(e){let t=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(t);else{let e=this.buffer.last();0>cG(t,e)&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class cY{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Rr=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return null!==this.Rr}Vr(e){lA(cK,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){ha(e)?lA(cK,"Ignoring IndexedDB error during garbage collection: ",e):await hs(e)}await this.Vr(3e5)})}}class cX{constructor(e,t){this.mr=e,this.params=t}calculateTargetCount(e,t){return this.mr.gr(e).next(e=>Math.floor(t/100*e))}nthSequenceNumber(e,t){if(0===t)return ho.resolve(hl.ce);let n=new cQ(t);return this.mr.forEachTarget(e,e=>n.Ar(e.sequenceNumber)).next(()=>this.mr.pr(e,e=>n.Ar(e))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.mr.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.mr.removeOrphanedDocuments(e,t)}collect(e,t){return -1===this.params.cacheSizeCollectionThreshold?(lA("LruGarbageCollector","Garbage collection skipped; disabled"),ho.resolve(c$)):this.getCacheSize(e).next(n=>n<this.params.cacheSizeCollectionThreshold?(lA("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),c$):this.yr(e,t))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,t){let n,i,r,s,o,a,l,h=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(t=>(t>this.params.maximumSequenceNumbersToCollect?(lA("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),i=this.params.maximumSequenceNumbersToCollect):i=t,s=Date.now(),this.nthSequenceNumber(e,i))).next(i=>(n=i,o=Date.now(),this.removeTargets(e,n,t))).next(t=>(r=t,a=Date.now(),this.removeOrphanedDocuments(e,n))).next(e=>(l=Date.now(),lk()<=w.DEBUG&&lA("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${s-h}ms
	Determined least recently used ${i} in `+(o-s)+"ms\n"+`	Removed ${r} targets in `+(a-o)+"ms\n"+`	Removed ${e} documents in `+(l-a)+"ms\n"+`Total Duration: ${l-h}ms`),ho.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:r,documentsRemoved:e})))}}class cJ{constructor(){this.changes=new uA(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,h6.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let n=this.changes.get(t);return void 0!==n?ho.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class cZ{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class c0{constructor(e,t,n,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=i}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(n=i,this.remoteDocumentCache.getEntry(e,t))).next(e=>(null!==n&&u1(n.mutation,e,h_.empty(),ht.now()),e))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.getLocalViewOfDocuments(e,t,uM()).next(()=>t))}getLocalViewOfDocuments(e,t,n=uM()){let i=uD();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,n).next(e=>{let t=uP();return e.forEach((e,n)=>{t=t.insert(e,n.overlayedDocument)}),t}))}getOverlayedDocuments(e,t){let n=uD();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,uM()))}populateOverlays(e,t,n){let i=[];return n.forEach(e=>{t.has(e)||i.push(e)}),this.documentOverlayCache.getOverlays(e,i).next(e=>{e.forEach((e,n)=>{t.set(e,n)})})}computeViews(e,t,n,i){let r=uN,s=uD(),o=uD();return t.forEach((e,t)=>{let o=n.get(t.key);i.has(t.key)&&(void 0===o||o.mutation instanceof u3)?r=r.insert(t.key,t):void 0!==o?(s.set(t.key,o.mutation.getFieldMask()),u1(o.mutation,t,o.mutation.getFieldMask(),ht.now())):s.set(t.key,h_.empty())}),this.recalculateAndSaveOverlays(e,r).next(e=>(e.forEach((e,t)=>s.set(e,t)),t.forEach((e,t)=>o.set(e,new cZ(t,s.get(e)??null))),o))}recalculateAndSaveOverlays(e,t){let n=uD(),i=new hf((e,t)=>e-t),r=uM();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(e=>{for(let r of e)r.keys().forEach(e=>{let s=t.get(e);if(null===s)return;let o=n.get(e)||h_.empty();o=r.applyToLocalView(s,o),n.set(e,o);let a=(i.get(r.batchId)||uM()).add(e);i=i.insert(r.batchId,a)})}).next(()=>{let s=[],o=i.getReverseIterator();for(;o.hasNext();){let i=o.getNext(),a=i.key,l=i.value,h=uD();l.forEach(e=>{if(!r.has(e)){let i=u0(t.get(e),n.get(e));null!==i&&h.set(e,i),r=r.add(e)}}),s.push(this.documentOverlayCache.saveOverlays(e,a,h))}return ho.waitFor(s)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.recalculateAndSaveOverlays(e,t))}getDocumentsMatchingQuery(e,t,n,i){return l2.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):u_(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,i):this.getDocumentsMatchingCollectionQuery(e,t,n,i)}getNextDocuments(e,t,n,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,i).next(r=>{let s=i-r.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,i-r.size):ho.resolve(uD()),o=-1,a=r;return s.next(t=>ho.forEach(t,(t,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),r.get(t)?ho.resolve():this.remoteDocumentCache.getEntry(e,t).next(e=>{a=a.insert(t,e)}))).next(()=>this.populateOverlays(e,t,r)).next(()=>this.computeViews(e,a,t,uM())).next(e=>({batchId:o,changes:ux(e)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new l2(t)).next(e=>{let t=uP();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}getDocumentsMatchingCollectionGroupQuery(e,t,n,i){let r=t.collectionGroup,s=uP();return this.indexManager.getCollectionParents(e,r).next(o=>ho.forEach(o,o=>{let a=new um(o.child(r),null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt);return this.getDocumentsMatchingCollectionQuery(e,a,n,i).next(e=>{e.forEach((e,t)=>{s=s.insert(e,t)})})}).next(()=>s))}getDocumentsMatchingCollectionQuery(e,t,n,i){let r;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(s=>(r=s,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,r,i))).next(e=>{r.forEach((t,n)=>{let i=n.getKey();null===e.get(i)&&(e=e.insert(i,h6.newInvalidDocument(i)))});let n=uP();return e.forEach((e,i)=>{let s=r.get(e);void 0!==s&&u1(s.mutation,i,h_.empty(),ht.now()),uS(t,i)&&(n=n.insert(e,i))}),n})}}class c1{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,t){return ho.resolve(this.Lr.get(t))}saveBundleMetadata(e,t){return this.Lr.set(t.id,{id:t.id,version:t.version,createTime:cS(t.createTime)}),ho.resolve()}getNamedQuery(e,t){return ho.resolve(this.kr.get(t))}saveNamedQuery(e,t){var n;let i;return this.kr.set(t.name,{name:t.name,query:(i=function(e){var t,n,i,r;let s,o,a,l,h,u=4===(s=cN(e.parent)).length?lZ.emptyPath():cO(s),c=e.structuredQuery,d=c.from?c.from.length:0,f=null;if(d>0){lO(1===d,65062);let e=c.from[0];e.allDescendants?f=e.collectionId:u=u.child(e.collectionId)}let p=[];c.where&&(p=(o=function e(t){return void 0!==t.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":let t=cF(e.unaryFilter.field);return h9.create(t,"==",{doubleValue:NaN});case"IS_NULL":let n=cF(e.unaryFilter.field);return h9.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let i=cF(e.unaryFilter.field);return h9.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let r=cF(e.unaryFilter.field);return h9.create(r,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return lx(61313);default:return lx(60726)}}(t):void 0!==t.fieldFilter?h9.create(cF(t.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return lx(58110);default:return lx(50506)}}(t.fieldFilter.op),t.fieldFilter.value):void 0!==t.compositeFilter?ue.create(t.compositeFilter.filters.map(t=>e(t)),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return lx(1026)}}(t.compositeFilter.op)):lx(30097,{filter:t})}(c.where))instanceof ue&&un(t=o)&&ut(t)?o.getFilters():[o]);let g=[];c.orderBy&&(g=c.orderBy.map(e=>new h8(cF(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))));let m=null;c.limit&&(m=null==(a="object"==typeof(n=c.limit)?n.value:n)?null:a);let y=null;c.startAt&&(l=!!(i=c.startAt).before,y=new h3(i.values||[],l));let _=null;return c.endAt&&(h=!(r=c.endAt).before,_=new h3(r.values||[],h)),new um(u,f,g,p,m,"F",y,_)}({parent:(n=t.bundledQuery).parent,structuredQuery:n.structuredQuery}),"LAST"===n.limitType?uE(i,i.limit,"L"):i),readTime:cS(t.readTime)}),ho.resolve()}}class c2{constructor(){this.overlays=new hf(l2.comparator),this.qr=new Map}getOverlay(e,t){return ho.resolve(this.overlays.get(t))}getOverlays(e,t){let n=uD();return ho.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((n,i)=>{this.St(e,t,i)}),ho.resolve()}removeOverlaysForBatchId(e,t,n){let i=this.qr.get(n);return void 0!==i&&(i.forEach(e=>this.overlays=this.overlays.remove(e)),this.qr.delete(n)),ho.resolve()}getOverlaysForCollection(e,t,n){let i=uD(),r=t.length+1,s=new l2(t.child("")),o=this.overlays.getIteratorFrom(s);for(;o.hasNext();){let e=o.getNext().value,s=e.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===r&&e.largestBatchId>n&&i.set(e.getKey(),e)}return ho.resolve(i)}getOverlaysForCollectionGroup(e,t,n,i){let r=new hf((e,t)=>e-t),s=this.overlays.getIterator();for(;s.hasNext();){let e=s.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=r.get(e.largestBatchId);null===t&&(t=uD(),r=r.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}let o=uD(),a=r.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach((e,t)=>o.set(e,t)),!(o.size()>=i)););return ho.resolve(o)}St(e,t,n){let i=this.overlays.get(n.key);if(null!==i){let e=this.qr.get(i.largestBatchId).delete(n.key);this.qr.set(i.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new cn(t,n));let r=this.qr.get(t);void 0===r&&(r=uM(),this.qr.set(t,r)),this.qr.set(t,r.add(n.key))}}class c6{constructor(){this.sessionToken=hw.EMPTY_BYTE_STRING}getSessionToken(e){return ho.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,ho.resolve()}}class c3{constructor(){this.Qr=new hm(c5.$r),this.Ur=new hm(c5.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,t){let n=new c5(e,t);this.Qr=this.Qr.add(n),this.Ur=this.Ur.add(n)}Wr(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.Gr(new c5(e,t))}zr(e,t){e.forEach(e=>this.removeReference(e,t))}jr(e){let t=new l2(new lZ([])),n=new c5(t,e),i=new c5(t,e+1),r=[];return this.Ur.forEachInRange([n,i],e=>{this.Gr(e),r.push(e.key)}),r}Jr(){this.Qr.forEach(e=>this.Gr(e))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){let t=new l2(new lZ([])),n=new c5(t,e),i=new c5(t,e+1),r=uM();return this.Ur.forEachInRange([n,i],e=>{r=r.add(e.key)}),r}containsKey(e){let t=new c5(e,0),n=this.Qr.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class c5{constructor(e,t){this.key=e,this.Yr=t}static $r(e,t){return l2.comparator(e.key,t.key)||lK(e.Yr,t.Yr)}static Kr(e,t){return lK(e.Yr,t.Yr)||l2.comparator(e.key,t.key)}}class c4{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.tr=1,this.Zr=new hm(c5.$r)}checkEmpty(e){return ho.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,i){let r=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let s=new ce(r,t,n,i);for(let t of(this.mutationQueue.push(s),i))this.Zr=this.Zr.add(new c5(t.key,r)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return ho.resolve(s)}lookupMutationBatch(e,t){return ho.resolve(this.Xr(t))}getNextMutationBatchAfterBatchId(e,t){let n=this.ei(t+1),i=n<0?0:n;return ho.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return ho.resolve(0===this.mutationQueue.length?-1:this.tr-1)}getAllMutationBatches(e){return ho.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let n=new c5(t,0),i=new c5(t,1/0),r=[];return this.Zr.forEachInRange([n,i],e=>{let t=this.Xr(e.Yr);r.push(t)}),ho.resolve(r)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new hm(lK);return t.forEach(e=>{let t=new c5(e,0),i=new c5(e,1/0);this.Zr.forEachInRange([t,i],e=>{n=n.add(e.Yr)})}),ho.resolve(this.ti(n))}getAllMutationBatchesAffectingQuery(e,t){let n=t.path,i=n.length+1,r=n;l2.isDocumentKey(r)||(r=r.child(""));let s=new c5(new l2(r),0),o=new hm(lK);return this.Zr.forEachWhile(e=>{let t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===i&&(o=o.add(e.Yr)),!0)},s),ho.resolve(this.ti(o))}ti(e){let t=[];return e.forEach(e=>{let n=this.Xr(e);null!==n&&t.push(n)}),t}removeMutationBatch(e,t){lO(0===this.ni(t.batchId,"removed"),55003),this.mutationQueue.shift();let n=this.Zr;return ho.forEach(t.mutations,i=>{let r=new c5(i.key,t.batchId);return n=n.delete(r),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.Zr=n})}ir(e){}containsKey(e,t){let n=new c5(t,0),i=this.Zr.firstAfterOrEqual(n);return ho.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,ho.resolve()}ni(e,t){return this.ei(e)}ei(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Xr(e){let t=this.ei(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class c8{constructor(e){this.ri=e,this.docs=new hf(l2.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let n=t.key,i=this.docs.get(n),r=i?i.size:0,s=this.ri(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:s}),this.size+=s-r,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let n=this.docs.get(t);return ho.resolve(n?n.document.mutableCopy():h6.newInvalidDocument(t))}getEntries(e,t){let n=uN;return t.forEach(e=>{let t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():h6.newInvalidDocument(e))}),ho.resolve(n)}getDocumentsMatchingQuery(e,t,n,i){let r=uN,s=t.path,o=new l2(s.child("__id-9223372036854775808__")),a=this.docs.getIteratorFrom(o);for(;a.hasNext();){let{key:e,value:{document:o}}=a.getNext();if(!s.isPrefixOf(e.path))break;e.path.length>s.length+1||0>=function(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n||0!==(n=l2.comparator(e.documentKey,t.documentKey))?n:lK(e.largestBatchId,t.largestBatchId)}(new hi(o.readTime,o.key,-1),n)||(i.has(o.key)||uS(t,o))&&(r=r.insert(o.key,o.mutableCopy()))}return ho.resolve(r)}getAllFromCollectionGroup(e,t,n,i){lx(9500)}ii(e,t){return ho.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new c7(this)}getSize(e){return ho.resolve(this.size)}}class c7 extends cJ{constructor(e){super(),this.Nr=e}applyChanges(e){let t=[];return this.changes.forEach((n,i)=>{i.isValidDocument()?t.push(this.Nr.addEntry(e,i)):this.Nr.removeEntry(n)}),ho.waitFor(t)}getFromCache(e,t){return this.Nr.getEntry(e,t)}getAllFromCache(e,t){return this.Nr.getEntries(e,t)}}class c9{constructor(e){this.persistence=e,this.si=new uA(e=>uf(e),up),this.lastRemoteSnapshotVersion=hn.min(),this.highestTargetId=0,this.oi=0,this._i=new c3,this.targetCount=0,this.ai=cW.ur()}forEachTarget(e,t){return this.si.forEach((e,n)=>t(n)),ho.resolve()}getLastRemoteSnapshotVersion(e){return ho.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return ho.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),ho.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.oi&&(this.oi=t),ho.resolve()}Pr(e){this.si.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.ai=new cW(t),this.highestTargetId=t),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,t){return this.Pr(t),this.targetCount+=1,ho.resolve()}updateTargetData(e,t){return this.Pr(t),ho.resolve()}removeTargetData(e,t){return this.si.delete(t.target),this._i.jr(t.targetId),this.targetCount-=1,ho.resolve()}removeTargets(e,t,n){let i=0,r=[];return this.si.forEach((s,o)=>{o.sequenceNumber<=t&&null===n.get(o.targetId)&&(this.si.delete(s),r.push(this.removeMatchingKeysForTargetId(e,o.targetId)),i++)}),ho.waitFor(r).next(()=>i)}getTargetCount(e){return ho.resolve(this.targetCount)}getTargetData(e,t){let n=this.si.get(t)||null;return ho.resolve(n)}addMatchingKeys(e,t,n){return this._i.Wr(t,n),ho.resolve()}removeMatchingKeys(e,t,n){this._i.zr(t,n);let i=this.persistence.referenceDelegate,r=[];return i&&t.forEach(t=>{r.push(i.markPotentiallyOrphaned(e,t))}),ho.waitFor(r)}removeMatchingKeysForTargetId(e,t){return this._i.jr(t),ho.resolve()}getMatchingKeysForTargetId(e,t){let n=this._i.Hr(t);return ho.resolve(n)}containsKey(e,t){return ho.resolve(this._i.containsKey(t))}}class de{constructor(e,t){this.ui={},this.overlays={},this.ci=new hl(0),this.li=!1,this.li=!0,this.hi=new c6,this.referenceDelegate=e(this),this.Pi=new c9(this),this.indexManager=new cB,this.remoteDocumentCache=new c8(e=>this.referenceDelegate.Ti(e)),this.serializer=new cq(t),this.Ii=new c1(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new c2,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.ui[e.toKey()];return n||(n=new c4(t,this.referenceDelegate),this.ui[e.toKey()]=n),n}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,t,n){lA("MemoryPersistence","Starting transaction:",e);let i=new dt(this.ci.next());return this.referenceDelegate.Ei(),n(i).next(e=>this.referenceDelegate.di(i).next(()=>e)).toPromise().then(e=>(i.raiseOnCommittedEvent(),e))}Ai(e,t){return ho.or(Object.values(this.ui).map(n=>()=>n.containsKey(e,t)))}}class dt extends hr{constructor(e){super(),this.currentSequenceNumber=e}}class dn{constructor(e){this.persistence=e,this.Ri=new c3,this.Vi=null}static mi(e){return new dn(e)}get fi(){if(this.Vi)return this.Vi;throw lx(60996)}addReference(e,t,n){return this.Ri.addReference(n,t),this.fi.delete(n.toString()),ho.resolve()}removeReference(e,t,n){return this.Ri.removeReference(n,t),this.fi.add(n.toString()),ho.resolve()}markPotentiallyOrphaned(e,t){return this.fi.add(t.toString()),ho.resolve()}removeTarget(e,t){this.Ri.jr(t.targetId).forEach(e=>this.fi.add(e.toString()));let n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.fi.add(e.toString()))}).next(()=>n.removeTargetData(e,t))}Ei(){this.Vi=new Set}di(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return ho.forEach(this.fi,n=>{let i=l2.fromPath(n);return this.gi(e,i).next(e=>{e||t.removeEntry(i,hn.min())})}).next(()=>(this.Vi=null,t.apply(e)))}updateLimboDocument(e,t){return this.gi(e,t).next(e=>{e?this.fi.delete(t.toString()):this.fi.add(t.toString())})}Ti(e){return 0}gi(e,t){return ho.or([()=>ho.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}}class di{constructor(e,t){this.persistence=e,this.pi=new uA(e=>(function(e){let t="";for(let n=0;n<e.length;n++)t.length>0&&(t+="\x01\x01"),t=function(e,t){let n=t,i=e.length;for(let t=0;t<i;t++){let i=e.charAt(t);switch(i){case"\0":n+="\x01\x10";break;case"\x01":n+="\x01\x11";break;default:n+=i}}return n}(e.get(n),t);return t+"\x01\x01"})(e.path),(e,t)=>e.isEqual(t)),this.garbageCollector=new cX(this,t)}static mi(e,t){return new di(e,t)}Ei(){}di(e){return ho.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}gr(e){let t=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}wr(e){let t=0;return this.pr(e,e=>{t++}).next(()=>t)}pr(e,t){return ho.forEach(this.pi,(n,i)=>this.br(e,n,i).next(e=>e?ho.resolve():t(i)))}removeTargets(e,t,n){return this.persistence.getTargetCache().removeTargets(e,t,n)}removeOrphanedDocuments(e,t){let n=0,i=this.persistence.getRemoteDocumentCache(),r=i.newChangeBuffer();return i.ii(e,i=>this.br(e,i,t).next(e=>{e||(n++,r.removeEntry(i,hn.min()))})).next(()=>r.apply(e)).next(()=>n)}markPotentiallyOrphaned(e,t){return this.pi.set(t,e.currentSequenceNumber),ho.resolve()}removeTarget(e,t){let n=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,n)}addReference(e,t,n){return this.pi.set(n,e.currentSequenceNumber),ho.resolve()}removeReference(e,t,n){return this.pi.set(n,e.currentSequenceNumber),ho.resolve()}updateLimboDocument(e,t){return this.pi.set(t,e.currentSequenceNumber),ho.resolve()}Ti(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=function e(t){switch(hq(t)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let n=hR(t);return n?16+e(n):16;case 5:return 2*t.stringValue.length;case 6:return hC(t.bytesValue).approximateByteSize();case 7:return t.referenceValue.length;case 9:return(t.arrayValue.values||[]).reduce((t,n)=>t+e(n),0);case 10:case 11:var i;let r;return i=t.mapValue,r=0,hc(i.fields,(t,n)=>{r+=t.length+e(n)}),r;default:throw lx(13486,{value:t})}}(e.data.value)),t}br(e,t,n){return ho.or([()=>this.persistence.Ai(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{let e=this.pi.get(t);return ho.resolve(void 0!==e&&e>n)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class dr{constructor(e,t,n,i){this.targetId=e,this.fromCache=t,this.Es=n,this.ds=i}static As(e,t){let n=uM(),i=uM();for(let e of t.docChanges)switch(e.type){case 0:n=n.add(e.doc.key);break;case 1:i=i.add(e.doc.key)}return new dr(e,t.fromCache,n,i)}}class ds{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class da{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=function(){let t;return!function(){let t=W()?.forceEnvironment;if("node"===t)return!0;if("browser"===t)return!1;try{return"[object process]"===Object.prototype.toString.call(e.g.process)}catch(e){return!1}}()&&navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")?8:Number((t=er().match(/Android ([\d.]+)/i))?t[1].split(".").slice(0,2).join("."):"-1")>0?6:4}()}initialize(e,t){this.ps=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,n,i){let r={result:null};return this.ys(e,t).next(e=>{r.result=e}).next(()=>{if(!r.result)return this.ws(e,t,i,n).next(e=>{r.result=e})}).next(()=>{if(r.result)return;let n=new ds;return this.Ss(e,t,n).next(i=>{if(r.result=i,this.Vs)return this.bs(e,t,n,i.size)})}).next(()=>r.result)}bs(e,t,n,i){return n.documentReadCount<this.fs?(lk()<=w.DEBUG&&lA("QueryEngine","SDK will not create cache indexes for query:",uI(t),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),ho.resolve()):(lk()<=w.DEBUG&&lA("QueryEngine","Query:",uI(t),"scans",n.documentReadCount,"local documents and returns",i,"documents as results."),n.documentReadCount>this.gs*i?(lk()<=w.DEBUG&&lA("QueryEngine","The SDK decides to create cache indexes for query:",uI(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,uw(t))):ho.resolve())}ys(e,t){if(uy(t))return ho.resolve(null);let n=uw(t);return this.indexManager.getIndexType(e,n).next(i=>0===i?null:(null!==t.limit&&1===i&&(n=uw(t=uE(t,null,"F"))),this.indexManager.getDocumentsMatchingTarget(e,n).next(i=>{let r=uM(...i);return this.ps.getDocuments(e,r).next(i=>this.indexManager.getMinOffset(e,n).next(n=>{let s=this.Ds(t,i);return this.Cs(t,s,r,n.readTime)?this.ys(e,uE(t,null,"F")):this.vs(e,s,t,n)}))})))}ws(e,t,n,i){return uy(t)||i.isEqual(hn.min())?ho.resolve(null):this.ps.getDocuments(e,n).next(r=>{let s,o,a=this.Ds(t,r);return this.Cs(t,a,n,i)?ho.resolve(null):(lk()<=w.DEBUG&&lA("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),uI(t)),this.vs(e,a,t,(s=i.toTimestamp().seconds,o=i.toTimestamp().nanoseconds+1,new hi(hn.fromTimestamp(1e9===o?new ht(s+1,0):new ht(s,o)),l2.empty(),-1))).next(e=>e))})}Ds(e,t){let n=new hm(uk(e));return t.forEach((t,i)=>{uS(e,i)&&(n=n.add(i))}),n}Cs(e,t,n,i){if(null===e.limit)return!1;if(n.size!==t.size)return!0;let r="F"===e.limitType?t.last():t.first();return!!r&&(r.hasPendingWrites||r.version.compareTo(i)>0)}Ss(e,t,n){return lk()<=w.DEBUG&&lA("QueryEngine","Using full collection scan to execute query:",uI(t)),this.ps.getDocumentsMatchingQuery(e,t,hi.min(),n)}vs(e,t,n,i){return this.ps.getDocumentsMatchingQuery(e,n,i).next(e=>(t.forEach(t=>{e=e.insert(t.key,t)}),e))}}let dl="LocalStore";class dh{constructor(e,t,n,i){this.persistence=e,this.Fs=t,this.serializer=i,this.Ms=new hf(lK),this.xs=new uA(e=>uf(e),up),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(n)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new c0(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Ms))}}async function du(e,t){return await e.persistence.runTransaction("Handle user change","readonly",n=>{let i;return e.mutationQueue.getAllMutationBatches(n).next(r=>(i=r,e.Bs(t),e.mutationQueue.getAllMutationBatches(n))).next(t=>{let r=[],s=[],o=uM();for(let e of i)for(let t of(r.push(e.batchId),e.mutations))o=o.add(t.key);for(let e of t)for(let t of(s.push(e.batchId),e.mutations))o=o.add(t.key);return e.localDocuments.getDocuments(n,o).next(e=>({Ls:e,removedBatchIds:r,addedBatchIds:s}))})})}function dc(e){return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Pi.getLastRemoteSnapshotVersion(t))}async function dd(e,t,n){let i=e.Ms.get(t);try{n||await e.persistence.runTransaction("Release target",n?"readwrite":"readwrite-primary",t=>e.persistence.referenceDelegate.removeTarget(t,i))}catch(e){if(!ha(e))throw e;lA(dl,`Failed to update sequence numbers for target ${t}: ${e}`)}e.Ms=e.Ms.remove(t),e.xs.delete(i.target)}function df(e,t,n){let i=hn.min(),r=uM();return e.persistence.runTransaction("Execute query","readwrite",s=>{var o;let a;return(o=uw(t),void 0!==(a=e.xs.get(o))?ho.resolve(e.Ms.get(a)):e.Pi.getTargetData(s,o)).next(t=>{if(t)return i=t.lastLimboFreeSnapshotVersion,e.Pi.getMatchingKeysForTargetId(s,t.targetId).next(e=>{r=e})}).next(()=>e.Fs.getDocumentsMatchingQuery(s,t,n?i:hn.min(),n?r:uM())).next(n=>{var i,s,o;let a;return i=e,s=t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2)),o=n,a=i.Os.get(s)||hn.min(),o.forEach((e,t)=>{t.readTime.compareTo(a)>0&&(a=t.readTime)}),i.Os.set(s,a),{documents:n,Qs:r}})})}class dp{constructor(){this.activeTargetIds=uF}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){return JSON.stringify({activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()})}}class dg{constructor(){this.Mo=new dp,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e,t=!0){return t&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,t,n){this.xo[e]=t}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new dp,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class dm{Oo(e){}shutdown(){}}let dy="ConnectivityMonitor";class d_{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){for(let e of(lA(dy,"Network connectivity changed: AVAILABLE"),this.qo))e(0)}ko(){for(let e of(lA(dy,"Network connectivity changed: UNAVAILABLE"),this.qo))e(1)}static v(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let dv=null;function dw(){return null===dv?dv=0x10000000+Math.round(0x80000000*Math.random()):dv++,"0x"+dv.toString(16)}let db="RestConnection",dE={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class dT{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Uo=t+"://"+e.host,this.Ko=`projects/${n}/databases/${i}`,this.Wo=this.databaseId.database===hD?`project_id=${n}`:`project_id=${n}&database_id=${i}`}Go(e,t,n,i,r){let s=dw(),o=this.zo(e,t.toUriEncodedString());lA(db,`Sending RPC '${e}' ${s}:`,o,n);let a={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(a,i,r);let{host:l}=new URL(o),h=J(l);return this.Jo(e,o,a,n,h).then(t=>(lA(db,`Received RPC '${e}' ${s}: `,t),t),t=>{throw lR(db,`RPC '${e}' ${s} failed with error: `,t,"url: ",o,"request:",n),t})}Ho(e,t,n,i,r,s){return this.Go(e,t,n,i,r)}jo(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+lI,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((t,n)=>e[n]=t),n&&n.headers.forEach((t,n)=>e[n]=t)}zo(e,t){let n=dE[e];return`${this.Uo}/v1/${t}:${n}`}terminate(){}}class dC{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}let dI="WebChannelConnection";class dS extends dT{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,n,i,r){let s=dw();return new Promise((r,o)=>{let a=new C;a.setWithCredentials(!0),a.listenOnce(S.COMPLETE,()=>{try{switch(a.getLastErrorCode()){case k.NO_ERROR:let t=a.getResponseJson();lA(dI,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(t)),r(t);break;case k.TIMEOUT:lA(dI,`RPC '${e}' ${s} timed out`),o(new lM(lL.DEADLINE_EXCEEDED,"Request time out"));break;case k.HTTP_ERROR:let n=a.getStatus();if(lA(dI,`RPC '${e}' ${s} failed with status:`,n,"response text:",a.getResponseText()),n>0){let e=a.getResponseJson();Array.isArray(e)&&(e=e[0]);let t=e?.error;if(t&&t.status&&t.message){let e,n=(e=t.status.toLowerCase().replace(/_/g,"-"),Object.values(lL).indexOf(e)>=0?e:lL.UNKNOWN);o(new lM(n,t.message))}else o(new lM(lL.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new lM(lL.UNAVAILABLE,"Connection failed."));break;default:lx(9055,{l_:e,streamId:s,h_:a.getLastErrorCode(),P_:a.getLastError()})}}finally{lA(dI,`RPC '${e}' ${s} completed.`)}});let l=JSON.stringify(i);lA(dI,`RPC '${e}' ${s} sending request:`,i),a.send(t,"POST",l,n,15)})}T_(e,t,n){let i=dw(),r=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],s=P(),o=R(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},l=this.longPollingOptions.timeoutSeconds;void 0!==l&&(a.longPollingTimeout=Math.round(1e3*l)),this.useFetchStreams&&(a.useFetchStreams=!0),this.jo(a.initMessageHeaders,t,n),a.encodeInitMessageHeaders=!0;let h=r.join("");lA(dI,`Creating RPC '${e}' stream ${i}: ${h}`,a);let u=s.createWebChannel(h,a);this.I_(u);let c=!1,d=!1,f=new dC({Yo:t=>{d?lA(dI,`Not sending because RPC '${e}' stream ${i} is closed:`,t):(c||(lA(dI,`Opening RPC '${e}' stream ${i} transport.`),u.open(),c=!0),lA(dI,`RPC '${e}' stream ${i} sending:`,t),u.send(t))},Zo:()=>u.close()}),p=(e,t,n)=>{e.listen(t,e=>{try{n(e)}catch(e){setTimeout(()=>{throw e},0)}})};return p(u,I.EventType.OPEN,()=>{d||(lA(dI,`RPC '${e}' stream ${i} transport opened.`),f.o_())}),p(u,I.EventType.CLOSE,()=>{d||(d=!0,lA(dI,`RPC '${e}' stream ${i} transport closed`),f.a_(),this.E_(u))}),p(u,I.EventType.ERROR,t=>{d||(d=!0,lR(dI,`RPC '${e}' stream ${i} transport errored. Name:`,t.name,"Message:",t.message),f.a_(new lM(lL.UNAVAILABLE,"The operation could not be completed")))}),p(u,I.EventType.MESSAGE,t=>{if(!d){let n=t.data[0];lO(!!n,16349);let r=n?.error||n[0]?.error;if(r){lA(dI,`RPC '${e}' stream ${i} received error:`,r);let t=r.status,n=function(e){let t=x[e];if(void 0!==t)return cr(t)}(t),s=r.message;void 0===n&&(n=lL.INTERNAL,s="Unknown error status: "+t+" with message "+r.message),d=!0,f.a_(new lM(n,s)),u.close()}else lA(dI,`RPC '${e}' stream ${i} received:`,n),f.u_(n)}}),p(o,N.STAT_EVENT,t=>{t.stat===A.PROXY?lA(dI,`RPC '${e}' stream ${i} detected buffering proxy`):t.stat===A.NOPROXY&&lA(dI,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{f.__()},0),f}terminate(){this.c_.forEach(e=>e.close()),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter(t=>t===e)}}function dk(){return"undefined"!=typeof document?document:null}function dA(e){return new cE(e,!0)}class dN{constructor(e,t,n=1e3,i=1.5,r=6e4){this.Mi=e,this.timerId=t,this.d_=n,this.A_=i,this.R_=r,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();let t=Math.floor(this.V_+this.y_()),n=Math.max(0,Date.now()-this.f_),i=Math.max(0,t-n);i>0&&lA("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.V_} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,i,()=>(this.f_=Date.now(),e())),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){null!==this.m_&&(this.m_.skipDelay(),this.m_=null)}cancel(){null!==this.m_&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}let dR="PersistentStream";class dP{constructor(e,t,n,i,r,s,o,a){this.Mi=e,this.S_=n,this.b_=i,this.connection=r,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new dN(e,t)}x_(){return 1===this.state||5===this.state||this.O_()}O_(){return 2===this.state||3===this.state}start(){this.F_=0,4!==this.state?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&null===this.C_&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,()=>this.k_()))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,4!==e?this.M_.reset():t&&t.code===lL.RESOURCE_EXHAUSTED?(lN(t.toString()),lN("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===lL.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(t)}K_(){}auth(){this.state=1;let e=this.W_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([e,n])=>{this.D_===t&&this.G_(e,n)},t=>{e(()=>{let e=new lM(lL.UNKNOWN,"Fetching auth token failed: "+t.message);return this.z_(e)})})}G_(e,t){let n=this.W_(this.D_);this.stream=this.j_(e,t),this.stream.Xo(()=>{n(()=>this.listener.Xo())}),this.stream.t_(()=>{n(()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.t_()))}),this.stream.r_(e=>{n(()=>this.z_(e))}),this.stream.onMessage(e=>{n(()=>1==++this.F_?this.J_(e):this.onNext(e))})}N_(){this.state=5,this.M_.p_(async()=>{this.state=0,this.start()})}z_(e){return lA(dR,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return t=>{this.Mi.enqueueAndForget(()=>this.D_===e?t():(lA(dR,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class dx extends dP{constructor(e,t,n,i,r,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,i,s),this.serializer=r}j_(e,t){return this.connection.T_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();let t=function(e,t){let n;if("targetChange"in t){var i,r;t.targetChange;let s="NO_CHANGE"===(i=t.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===i?1:"REMOVE"===i?2:"CURRENT"===i?3:"RESET"===i?4:lx(39313,{state:i}),o=t.targetChange.targetIds||[],a=(r=t.targetChange.resumeToken,e.useProto3Json?(lO(void 0===r||"string"==typeof r,58123),hw.fromBase64String(r||"")):(lO(void 0===r||r instanceof ly.Buffer||r instanceof Uint8Array,16193),hw.fromUint8Array(r||new Uint8Array))),l=t.targetChange.cause;n=new cp(s,o,a,l&&new lM(void 0===l.code?lL.UNKNOWN:cr(l.code),l.message||"")||null)}else if("documentChange"in t){t.documentChange;let i=t.documentChange;i.document,i.document.name,i.document.updateTime;let r=cP(e,i.document.name),s=cS(i.document.updateTime),o=i.document.createTime?cS(i.document.createTime):hn.min(),a=new h2({mapValue:{fields:i.document.fields}}),l=h6.newFoundDocument(r,s,o,a);n=new cd(i.targetIds||[],i.removedTargetIds||[],l.key,l)}else if("documentDelete"in t){t.documentDelete;let i=t.documentDelete;i.document;let r=cP(e,i.document),s=i.readTime?cS(i.readTime):hn.min(),o=h6.newNoDocument(r,s);n=new cd([],i.removedTargetIds||[],o.key,o)}else if("documentRemove"in t){t.documentRemove;let i=t.documentRemove;i.document;let r=cP(e,i.document);n=new cd([],i.removedTargetIds||[],r,null)}else{if(!("filter"in t))return lx(11601,{Rt:t});{t.filter;let e=t.filter;e.targetId;let{count:i=0,unchangedNames:r}=e,s=new ci(i,r);n=new cf(e.targetId,s)}}return n}(this.serializer,e),n=function(e){if(!("targetChange"in e))return hn.min();let t=e.targetChange;return t.targetIds&&t.targetIds.length?hn.min():t.readTime?cS(t.readTime):hn.min()}(e);return this.listener.H_(t,n)}Y_(e){let t,n={};n.database=cD(this.serializer),n.addTarget=function(e,t){var n,i;let r,s,o,a,l,h,u,c=t.target;if((r=ug(c)?{documents:{documents:[cx(e,c.path)]}}:{query:(o={structuredQuery:{}},a=c.path,null!==c.collectionGroup?(s=a,o.structuredQuery.from=[{collectionId:c.collectionGroup,allDescendants:!0}]):(s=a.popLast(),o.structuredQuery.from=[{collectionId:a.lastSegment()}]),o.parent=cx(e,s),(l=function(e){if(0!==e.length)return function e(t){var n;let i;return t instanceof h9?function(e){if("=="===e.op){if(hX(e.value))return{unaryFilter:{field:cM(e.field),op:"IS_NAN"}};if(hY(e.value))return{unaryFilter:{field:cM(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(hX(e.value))return{unaryFilter:{field:cM(e.field),op:"IS_NOT_NAN"}};if(hY(e.value))return{unaryFilter:{field:cM(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:cM(e.field),op:cw[e.op],value:e.value}}}(t):t instanceof ue?1===(i=(n=t).getFilters().map(t=>e(t))).length?i[0]:{compositeFilter:{op:cb[n.op],filters:i}}:lx(54877,{filter:t})}(ue.create(e,"and"))}(c.filters))&&(o.structuredQuery.where=l),(h=function(e){if(0!==e.length)return e.map(e=>({field:cM(e.field),direction:cv[e.dir]}))}(c.orderBy))&&(o.structuredQuery.orderBy=h),null!==(u=cT(e,c.limit))&&(o.structuredQuery.limit=u),c.startAt&&(o.structuredQuery.startAt={before:(n=c.startAt).inclusive,values:n.position}),c.endAt&&(o.structuredQuery.endAt={before:!(i=c.endAt).inclusive,values:i.position}),{ft:o,parent:s}).ft}).targetId=t.targetId,t.resumeToken.approximateByteSize()>0){r.resumeToken=cI(e,t.resumeToken);let n=cT(e,t.expectedCount);null!==n&&(r.expectedCount=n)}else if(t.snapshotVersion.compareTo(hn.min())>0){r.readTime=cC(e,t.snapshotVersion.toTimestamp());let n=cT(e,t.expectedCount);null!==n&&(r.expectedCount=n)}return r}(this.serializer,e);let i=(this.serializer,null==(t=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return lx(28987,{purpose:e})}}(e.purpose))?null:{"goog-listen-tags":t});i&&(n.labels=i),this.q_(n)}Z_(e){let t={};t.database=cD(this.serializer),t.removeTarget=e,this.q_(t)}}class dD extends dP{constructor(e,t,n,i,r,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,i,s),this.serializer=r}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}J_(e){return lO(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,lO(!e.writeResults||0===e.writeResults.length,55816),this.listener.ta()}onNext(e){var t,n;lO(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();let i=(t=e.writeResults,n=e.commitTime,t&&t.length>0?(lO(void 0!==n,14353),t.map(e=>{let t;return(t=e.updateTime?cS(e.updateTime):cS(n)).isEqual(hn.min())&&(t=cS(n)),new uY(t,e.transformResults||[])})):[]),r=cS(e.commitTime);return this.listener.na(r,i)}ra(){let e={};e.database=cD(this.serializer),this.q_(e)}ea(e){let t={streamToken:this.lastStreamToken,writes:e.map(e=>(function(e,t){var n,i;let r;if(t instanceof u6)r={update:cL(e,t.key,t.value)};else if(t instanceof u7)r={delete:cR(e,t.key)};else if(t instanceof u3){let n;r={update:cL(e,t.key,t.data),updateMask:(i=t.fieldMask,n=[],i.fields.forEach(e=>n.push(e.canonicalString())),{fieldPaths:n})}}else{if(!(t instanceof u9))return lx(16599,{Vt:t.type});r={verify:cR(e,t.key)}}return t.fieldTransforms.length>0&&(r.updateTransforms=t.fieldTransforms.map(e=>(function(e,t){let n=t.transform;if(n instanceof uB)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof uz)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof uH)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof uK)return{fieldPath:t.field.canonicalString(),increment:n.Ae};throw lx(20930,{transform:t.transform})})(0,e))),t.precondition.isNone||(r.currentDocument=void 0!==(n=t.precondition).updateTime?{updateTime:cC(e,n.updateTime.toTimestamp())}:void 0!==n.exists?{exists:n.exists}:lx(27497)),r})(this.serializer,e))};this.q_(t)}}class dO{}class dL extends dO{constructor(e,t,n,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=i,this.ia=!1}sa(){if(this.ia)throw new lM(lL.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,t,n,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([r,s])=>this.connection.Go(e,cA(t,n),i,r,s)).catch(e=>{throw"FirebaseError"===e.name?(e.code===lL.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new lM(lL.UNKNOWN,e.toString())})}Ho(e,t,n,i,r){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.Ho(e,cA(t,n),i,s,o,r)).catch(e=>{throw"FirebaseError"===e.name?(e.code===lL.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new lM(lL.UNKNOWN,e.toString())})}terminate(){this.ia=!0,this.connection.terminate()}}class dM{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){0===this.oa&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(e){"Online"===this.state?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,"Online"===e&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(lN(t),this.aa=!1):lA("OnlineStateTracker",t)}Pa(){null!==this._a&&(this._a.cancel(),this._a=null)}}let dF="RemoteStore";class dU{constructor(e,t,n,i,r){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=r,this.Aa.Oo(e=>{n.enqueueAndForget(async()=>{dK(this)&&(lA(dF,"Restarting streams for network reachability change."),await async function(e){e.Ea.add(4),await dq(e),e.Ra.set("Unknown"),e.Ea.delete(4),await dV(e)}(this))})}),this.Ra=new dM(n,i)}}async function dV(e){if(dK(e))for(let t of e.da)await t(!0)}async function dq(e){for(let t of e.da)await t(!1)}function dj(e,t){e.Ia.has(t.targetId)||(e.Ia.set(t.targetId,t),dW(e)?dH(e):d9(e).O_()&&dz(e,t))}function dB(e,t){let n=d9(e);e.Ia.delete(t),n.O_()&&d$(e,t),0===e.Ia.size&&(n.O_()?n.L_():dK(e)&&e.Ra.set("Unknown"))}function dz(e,t){if(e.Va.Ue(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(hn.min())>0){let n=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(n)}d9(e).Y_(t)}function d$(e,t){e.Va.Ue(t),d9(e).Z_(t)}function dH(e){e.Va=new cm({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),At:t=>e.Ia.get(t)||null,ht:()=>e.datastore.serializer.databaseId}),d9(e).start(),e.Ra.ua()}function dW(e){return dK(e)&&!d9(e).x_()&&e.Ia.size>0}function dK(e){return 0===e.Ea.size}async function dG(e){e.Ra.set("Online")}async function dQ(e){e.Ia.forEach((t,n)=>{dz(e,t)})}async function dY(e,t){e.Va=void 0,dW(e)?(e.Ra.ha(t),dH(e)):e.Ra.set("Unknown")}async function dX(e,t,n){if(e.Ra.set("Online"),t instanceof cp&&2===t.state&&t.cause)try{await async function(e,t){let n=t.cause;for(let i of t.targetIds)e.Ia.has(i)&&(await e.remoteSyncer.rejectListen(i,n),e.Ia.delete(i),e.Va.removeTarget(i))}(e,t)}catch(n){lA(dF,"Failed to remove targets %s: %s ",t.targetIds.join(","),n),await dJ(e,n)}else if(t instanceof cd?e.Va.Ze(t):t instanceof cf?e.Va.st(t):e.Va.tt(t),!n.isEqual(hn.min()))try{let t,i=await dc(e.localStore);n.compareTo(i)>=0&&await ((t=e.Va.Tt(n)).targetChanges.forEach((t,i)=>{if(t.resumeToken.approximateByteSize()>0){let r=e.Ia.get(i);r&&e.Ia.set(i,r.withResumeToken(t.resumeToken,n))}}),t.targetMismatches.forEach((t,n)=>{let i=e.Ia.get(t);if(!i)return;e.Ia.set(t,i.withResumeToken(hw.EMPTY_BYTE_STRING,i.snapshotVersion)),d$(e,t);let r=new cV(i.target,t,n,i.sequenceNumber);dz(e,r)}),e.remoteSyncer.applyRemoteEvent(t))}catch(t){lA(dF,"Failed to raise snapshot:",t),await dJ(e,t)}}async function dJ(e,t,n){if(!ha(t))throw t;e.Ea.add(1),await dq(e),e.Ra.set("Offline"),n||(n=()=>dc(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{lA(dF,"Retrying IndexedDB access"),await n(),e.Ea.delete(1),await dV(e)})}function dZ(e,t){return t().catch(n=>dJ(e,n,t))}async function d0(e){var t;let n=fe(e),i=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:-1;for(;dK(t=e)&&t.Ta.length<10;)try{let t=await function(e,t){return e.persistence.runTransaction("Get next mutation batch","readonly",n=>(void 0===t&&(t=-1),e.mutationQueue.getNextMutationBatchAfterBatchId(n,t)))}(e.localStore,i);if(null===t){0===e.Ta.length&&n.L_();break}i=t.batchId,function(e,t){e.Ta.push(t);let n=fe(e);n.O_()&&n.X_&&n.ea(t.mutations)}(e,t)}catch(t){await dJ(e,t)}d1(e)&&d2(e)}function d1(e){return dK(e)&&!fe(e).x_()&&e.Ta.length>0}function d2(e){fe(e).start()}async function d6(e){fe(e).ra()}async function d3(e){let t=fe(e);for(let n of e.Ta)t.ea(n.mutations)}async function d5(e,t,n){let i=e.Ta.shift(),r=ct.from(i,t,n);await dZ(e,()=>e.remoteSyncer.applySuccessfulWrite(r)),await d0(e)}async function d4(e,t){t&&fe(e).X_&&await async function(e,t){var n;if(function(e){switch(e){case lL.OK:return lx(64938);case lL.CANCELLED:case lL.UNKNOWN:case lL.DEADLINE_EXCEEDED:case lL.RESOURCE_EXHAUSTED:case lL.INTERNAL:case lL.UNAVAILABLE:case lL.UNAUTHENTICATED:return!1;case lL.INVALID_ARGUMENT:case lL.NOT_FOUND:case lL.ALREADY_EXISTS:case lL.PERMISSION_DENIED:case lL.FAILED_PRECONDITION:case lL.ABORTED:case lL.OUT_OF_RANGE:case lL.UNIMPLEMENTED:case lL.DATA_LOSS:return!0;default:return lx(15467,{code:e})}}(n=t.code)&&n!==lL.ABORTED){let n=e.Ta.shift();fe(e).B_(),await dZ(e,()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t)),await d0(e)}}(e,t),d1(e)&&d2(e)}async function d8(e,t){e.asyncQueue.verifyOperationInProgress(),lA(dF,"RemoteStore received new credentials");let n=dK(e);e.Ea.add(3),await dq(e),n&&e.Ra.set("Unknown"),await e.remoteSyncer.handleCredentialChange(t),e.Ea.delete(3),await dV(e)}async function d7(e,t){t?(e.Ea.delete(2),await dV(e)):t||(e.Ea.add(2),await dq(e),e.Ra.set("Unknown"))}function d9(e){var t,n,i;return e.ma||(t=e.datastore,n=e.asyncQueue,i={Xo:dG.bind(null,e),t_:dQ.bind(null,e),r_:dY.bind(null,e),H_:dX.bind(null,e)},t.sa(),e.ma=new dx(n,t.connection,t.authCredentials,t.appCheckCredentials,t.serializer,i),e.da.push(async t=>{t?(e.ma.B_(),dW(e)?dH(e):e.Ra.set("Unknown")):(await e.ma.stop(),e.Va=void 0)})),e.ma}function fe(e){var t,n,i;return e.fa||(t=e.datastore,n=e.asyncQueue,i={Xo:()=>Promise.resolve(),t_:d6.bind(null,e),r_:d4.bind(null,e),ta:d3.bind(null,e),na:d5.bind(null,e)},t.sa(),e.fa=new dD(n,t.connection,t.authCredentials,t.appCheckCredentials,t.serializer,i),e.da.push(async t=>{t?(e.fa.B_(),await d0(e)):(await e.fa.stop(),e.Ta.length>0&&(lA(dF,`Stopping write stream with ${e.Ta.length} pending writes`),e.Ta=[]))})),e.fa}class ft{constructor(e,t,n,i,r){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=i,this.removalCallback=r,this.deferred=new lF,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,i,r){let s=new ft(e,t,Date.now()+n,i,r);return s.start(n),s}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new lM(lL.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function fn(e,t){if(lN("AsyncQueue",`${t}: ${e}`),ha(e))return new lM(lL.UNAVAILABLE,`${t}: ${e}`);throw e}class fi{static emptySet(e){return new fi(e.comparator)}constructor(e){this.comparator=e?(t,n)=>e(t,n)||l2.comparator(t.key,n.key):(e,t)=>l2.comparator(e.key,t.key),this.keyedMap=uP(),this.sortedSet=new hf(this.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof fi)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){let e=t.getNext().key,i=n.getNext().key;if(!e.isEqual(i))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){let n=new fi;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class fr{constructor(){this.ga=new hf(l2.comparator)}track(e){let t=e.doc.key,n=this.ga.get(t);n?0!==e.type&&3===n.type?this.ga=this.ga.insert(t,e):3===e.type&&1!==n.type?this.ga=this.ga.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.ga=this.ga.remove(t):1===e.type&&2===n.type?this.ga=this.ga.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):lx(63341,{Rt:e,pa:n}):this.ga=this.ga.insert(t,e)}ya(){let e=[];return this.ga.inorderTraversal((t,n)=>{e.push(n)}),e}}class fs{constructor(e,t,n,i,r,s,o,a,l){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=i,this.mutatedKeys=r,this.fromCache=s,this.syncStateChanged=o,this.excludesMetadataChanges=a,this.hasCachedResults=l}static fromInitialDocuments(e,t,n,i,r){let s=[];return t.forEach(e=>{s.push({type:0,doc:e})}),new fs(e,t,fi.emptySet(t),s,n,i,!0,!1,r)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&uT(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==n[e].type||!t[e].doc.isEqual(n[e].doc))return!1;return!0}}class fo{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some(e=>e.Da())}}class fa{constructor(){this.queries=fl(),this.onlineState="Unknown",this.Ca=new Set}terminate(){var e;let t;e=new lM(lL.ABORTED,"Firestore shutting down"),t=this.queries,this.queries=fl(),t.forEach((t,n)=>{for(let t of n.Sa)t.onError(e)})}}function fl(){return new uA(e=>uC(e),uT)}async function fh(e,t){let n=3,i=t.query,r=e.queries.get(i);r?!r.ba()&&t.Da()&&(n=2):(r=new fo,n=+!t.Da());try{switch(n){case 0:r.wa=await e.onListen(i,!0);break;case 1:r.wa=await e.onListen(i,!1);break;case 2:await e.onFirstRemoteStoreListen(i)}}catch(n){let e=fn(n,`Initialization of query '${uI(t.query)}' failed`);return void t.onError(e)}e.queries.set(i,r),r.Sa.push(t),t.va(e.onlineState),r.wa&&t.Fa(r.wa)&&ff(e)}async function fu(e,t){let n=t.query,i=3,r=e.queries.get(n);if(r){let e=r.Sa.indexOf(t);e>=0&&(r.Sa.splice(e,1),0===r.Sa.length?i=+!t.Da():!r.ba()&&t.Da()&&(i=2))}switch(i){case 0:return e.queries.delete(n),e.onUnlisten(n,!0);case 1:return e.queries.delete(n),e.onUnlisten(n,!1);case 2:return e.onLastRemoteStoreUnlisten(n);default:return}}function fc(e,t){let n=!1;for(let i of t){let t=i.query,r=e.queries.get(t);if(r){for(let e of r.Sa)e.Fa(i)&&(n=!0);r.wa=i}}n&&ff(e)}function fd(e,t,n){let i=e.queries.get(t);if(i)for(let e of i.Sa)e.onError(n);e.queries.delete(t)}function ff(e){e.Ca.forEach(e=>{e.next()})}(L=O||(O={})).Ma="default",L.Cache="cache";class fp{constructor(e,t,n){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=n||{}}Fa(e){if(!this.options.includeMetadataChanges){let t=[];for(let n of e.docChanges)3!==n.type&&t.push(n);e=new fs(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){return!(e.fromCache&&this.Da())||(!this.options.qa||"Offline"===t)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Ba(e){if(e.docChanges.length>0)return!0;let t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}ka(e){e=fs.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==O.Cache}}class fg{constructor(e){this.key=e}}class fm{constructor(e){this.key=e}}class fy{constructor(e,t){this.query=e,this.Ya=t,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=uM(),this.mutatedKeys=uM(),this.eu=uk(e),this.tu=new fi(this.eu)}get nu(){return this.Ya}ru(e,t){let n=t?t.iu:new fr,i=t?t.tu:this.tu,r=t?t.mutatedKeys:this.mutatedKeys,s=i,o=!1,a="F"===this.query.limitType&&i.size===this.query.limit?i.last():null,l="L"===this.query.limitType&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((e,t)=>{let h=i.get(e),u=uS(this.query,t)?t:null,c=!!h&&this.mutatedKeys.has(h.key),d=!!u&&(u.hasLocalMutations||this.mutatedKeys.has(u.key)&&u.hasCommittedMutations),f=!1;h&&u?h.data.isEqual(u.data)?c!==d&&(n.track({type:3,doc:u}),f=!0):this.su(h,u)||(n.track({type:2,doc:u}),f=!0,(a&&this.eu(u,a)>0||l&&0>this.eu(u,l))&&(o=!0)):!h&&u?(n.track({type:0,doc:u}),f=!0):h&&!u&&(n.track({type:1,doc:h}),f=!0,(a||l)&&(o=!0)),f&&(u?(s=s.add(u),r=d?r.add(e):r.delete(e)):(s=s.delete(e),r=r.delete(e)))}),null!==this.query.limit)for(;s.size>this.query.limit;){let e="F"===this.query.limitType?s.last():s.first();s=s.delete(e.key),r=r.delete(e.key),n.track({type:1,doc:e})}return{tu:s,iu:n,Cs:o,mutatedKeys:r}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,i){let r=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;let s=e.iu.ya();s.sort((e,t)=>{var n,i;let r;return n=e.type,i=t.type,(r=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return lx(20277,{Rt:e})}})(n)-r(i)||this.eu(e.doc,t.doc)}),this.ou(n),i=i??!1;let o=t&&!i?this._u():[],a=0===this.Xa.size&&this.current&&!i?1:0,l=a!==this.Za;return(this.Za=a,0!==s.length||l)?{snapshot:new fs(this.query,e.tu,r,s,e.mutatedKeys,0===a,l,!1,!!n&&n.resumeToken.approximateByteSize()>0),au:o}:{au:o}}va(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({tu:this.tu,iu:new fr,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach(e=>this.Ya=this.Ya.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this.Ya=this.Ya.delete(e)),this.current=e.current)}_u(){if(!this.current)return[];let e=this.Xa;this.Xa=uM(),this.tu.forEach(e=>{this.uu(e.key)&&(this.Xa=this.Xa.add(e.key))});let t=[];return e.forEach(e=>{this.Xa.has(e)||t.push(new fm(e))}),this.Xa.forEach(n=>{e.has(n)||t.push(new fg(n))}),t}cu(e){this.Ya=e.Qs,this.Xa=uM();let t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return fs.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,0===this.Za,this.hasCachedResults)}}let f_="SyncEngine";class fv{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class fw{constructor(e){this.key=e,this.hu=!1}}class fb{constructor(e,t,n,i,r,s){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=i,this.currentUser=r,this.maxConcurrentLimboResolutions=s,this.Pu={},this.Tu=new uA(e=>uC(e),uT),this.Iu=new Map,this.Eu=new Set,this.du=new hf(l2.comparator),this.Au=new Map,this.Ru=new c3,this.Vu={},this.mu=new Map,this.fu=cW.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return!0===this.gu}}async function fE(e,t,n=!0){let i,r=fz(e),s=r.Tu.get(t);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.lu()):i=await fC(r,t,n,!0),i}async function fT(e,t){let n=fz(e);await fC(n,t,!0,!1)}async function fC(e,t,n,i){var r,s;let o,a=await (r=e.localStore,s=uw(t),r.persistence.runTransaction("Allocate target","readwrite",e=>{let t;return r.Pi.getTargetData(e,s).next(n=>n?(t=n,ho.resolve(t)):r.Pi.allocateTargetId(e).next(n=>(t=new cV(s,n,"TargetPurposeListen",e.currentSequenceNumber),r.Pi.addTargetData(e,t).next(()=>t))))}).then(e=>{let t=r.Ms.get(e.targetId);return(null===t||e.snapshotVersion.compareTo(t.snapshotVersion)>0)&&(r.Ms=r.Ms.insert(e.targetId,e),r.xs.set(s,e.targetId)),e})),l=a.targetId,h=e.sharedClientState.addLocalQueryTarget(l,n);return i&&(o=await fI(e,t,l,"current"===h,a.resumeToken)),e.isPrimaryClient&&n&&dj(e.remoteStore,a),o}async function fI(e,t,n,i,r){e.pu=(t,n,i)=>(async function(e,t,n,i){let r=t.view.ru(n);r.Cs&&(r=await df(e.localStore,t.query,!1).then(({documents:e})=>t.view.ru(e,r)));let s=i&&i.targetChanges.get(t.targetId),o=i&&null!=i.targetMismatches.get(t.targetId),a=t.view.applyChanges(r,e.isPrimaryClient,s,o);return fU(e,t.targetId,a.au),a.snapshot})(e,t,n,i);let s=await df(e.localStore,t,!0),o=new fy(t,s.Qs),a=o.ru(s.documents),l=cc.createSynthesizedTargetChangeForCurrentChange(n,i&&"Offline"!==e.onlineState,r),h=o.applyChanges(a,e.isPrimaryClient,l);fU(e,n,h.au);let u=new fv(t,n,o);return e.Tu.set(t,u),e.Iu.has(n)?e.Iu.get(n).push(t):e.Iu.set(n,[t]),h.snapshot}async function fS(e,t,n){let i=e.Tu.get(t),r=e.Iu.get(i.targetId);r.length>1?(e.Iu.set(i.targetId,r.filter(e=>!uT(e,t))),e.Tu.delete(t)):e.isPrimaryClient?(e.sharedClientState.removeLocalQueryTarget(i.targetId),e.sharedClientState.isActiveQueryTarget(i.targetId)||await dd(e.localStore,i.targetId,!1).then(()=>{e.sharedClientState.clearQueryState(i.targetId),n&&dB(e.remoteStore,i.targetId),fM(e,i.targetId)}).catch(hs)):(fM(e,i.targetId),await dd(e.localStore,i.targetId,!0))}async function fk(e,t){let n=e.Tu.get(t),i=e.Iu.get(n.targetId);e.isPrimaryClient&&1===i.length&&(e.sharedClientState.removeLocalQueryTarget(n.targetId),dB(e.remoteStore,n.targetId))}async function fA(e,t,n){var i,r,s;let o=((i=e).remoteStore.remoteSyncer.applySuccessfulWrite=fx.bind(null,i),i.remoteStore.remoteSyncer.rejectFailedWrite=fD.bind(null,i),i);try{let e,i,a,l,h,u=await (r=o.localStore,a=ht.now(),l=t.reduce((e,t)=>e.add(t.key),uM()),r.persistence.runTransaction("Locally write mutations","readwrite",n=>{let s=uN,o=uM();return r.Ns.getEntries(n,l).next(e=>{(s=e).forEach((e,t)=>{t.isValidDocument()||(o=o.add(e))})}).next(()=>r.localDocuments.getOverlayedDocuments(n,s)).next(i=>{e=i;let s=[];for(let n of t){let t=function(e,t){let n=null;for(let i of e.fieldTransforms){let e=t.data.field(i.field),r=uj(i.transform,e||null);null!=r&&(null===n&&(n=h2.empty()),n.set(i.field,r))}return n||null}(n,e.get(n.key).overlayedDocument);null!=t&&s.push(new u3(n.key,t,function e(t){let n=[];return hc(t.fields,(t,i)=>{let r=new l1([t]);if(hJ(i)){let t=e(i.mapValue).fields;if(0===t.length)n.push(r);else for(let e of t)n.push(r.child(e))}else n.push(r)}),new h_(n)}(t.value.mapValue),uX.exists(!0)))}return r.mutationQueue.addMutationBatch(n,a,s,t)}).next(t=>{i=t;let s=t.applyToLocalDocumentSet(e,o);return r.documentOverlayCache.saveOverlays(n,t.batchId,s)})}).then(()=>({batchId:i.batchId,changes:ux(e)})));o.sharedClientState.addPendingMutation(u.batchId),s=u.batchId,(h=o.Vu[o.currentUser.toKey()])||(h=new hf(lK)),h=h.insert(s,n),o.Vu[o.currentUser.toKey()]=h,await fq(o,u.changes),await d0(o.remoteStore)}catch(t){let e=fn(t,"Failed to persist write");n.reject(e)}}async function fN(e,t){var n;try{let i,r,s=await (n=e.localStore,i=t.snapshotVersion,r=n.Ms,n.persistence.runTransaction("Apply remote event","readwrite-primary",e=>{var s,o,a;let l,h,u=n.Ns.newChangeBuffer({trackRemovals:!0});r=n.Ms;let c=[];t.targetChanges.forEach((s,o)=>{var a;let l=r.get(o);if(!l)return;c.push(n.Pi.removeMatchingKeys(e,s.removedDocuments,o).next(()=>n.Pi.addMatchingKeys(e,s.addedDocuments,o)));let h=l.withSequenceNumber(e.currentSequenceNumber);null!==t.targetMismatches.get(o)?h=h.withResumeToken(hw.EMPTY_BYTE_STRING,hn.min()).withLastLimboFreeSnapshotVersion(hn.min()):s.resumeToken.approximateByteSize()>0&&(h=h.withResumeToken(s.resumeToken,i)),r=r.insert(o,h),a=h,(0===l.resumeToken.approximateByteSize()||a.snapshotVersion.toMicroseconds()-l.snapshotVersion.toMicroseconds()>=3e8||s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size>0)&&c.push(n.Pi.updateTargetData(e,h))});let d=uN,f=uM();if(t.documentUpdates.forEach(i=>{t.resolvedLimboDocuments.has(i)&&c.push(n.persistence.referenceDelegate.updateLimboDocument(e,i))}),c.push((s=e,o=u,a=t.documentUpdates,l=uM(),h=uM(),a.forEach(e=>l=l.add(e)),o.getEntries(s,l).next(e=>{let t=uN;return a.forEach((n,i)=>{let r=e.get(n);i.isFoundDocument()!==r.isFoundDocument()&&(h=h.add(n)),i.isNoDocument()&&i.version.isEqual(hn.min())?(o.removeEntry(n,i.readTime),t=t.insert(n,i)):!r.isValidDocument()||i.version.compareTo(r.version)>0||0===i.version.compareTo(r.version)&&r.hasPendingWrites?(o.addEntry(i),t=t.insert(n,i)):lA(dl,"Ignoring outdated watch update for ",n,". Current version:",r.version," Watch version:",i.version)}),{ks:t,qs:h}})).next(e=>{d=e.ks,f=e.qs})),!i.isEqual(hn.min())){let t=n.Pi.getLastRemoteSnapshotVersion(e).next(t=>n.Pi.setTargetsMetadata(e,e.currentSequenceNumber,i));c.push(t)}return ho.waitFor(c).next(()=>u.apply(e)).next(()=>n.localDocuments.getLocalViewOfDocuments(e,d,f)).next(()=>d)}).then(e=>(n.Ms=r,e)));t.targetChanges.forEach((t,n)=>{let i=e.Au.get(n);i&&(lO(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1,22616),t.addedDocuments.size>0?i.hu=!0:t.modifiedDocuments.size>0?lO(i.hu,14607):t.removedDocuments.size>0&&(lO(i.hu,42227),i.hu=!1))}),await fq(e,s,t)}catch(e){await hs(e)}}function fR(e,t,n){var i;if(e.isPrimaryClient&&0===n||!e.isPrimaryClient&&1===n){let n,r=[];e.Tu.forEach((e,n)=>{let i=n.view.va(t);i.snapshot&&r.push(i.snapshot)}),(i=e.eventManager).onlineState=t,n=!1,i.queries.forEach((e,i)=>{for(let e of i.Sa)e.va(t)&&(n=!0)}),n&&ff(i),r.length&&e.Pu.H_(r),e.onlineState=t,e.isPrimaryClient&&e.sharedClientState.setOnlineState(t)}}async function fP(e,t,n){e.sharedClientState.updateQueryState(t,"rejected",n);let i=e.Au.get(t),r=i&&i.key;if(r){let n=new hf(l2.comparator);n=n.insert(r,h6.newNoDocument(r,hn.min()));let i=uM().add(r),s=new cu(hn.min(),new Map,new hf(lK),n,i);await fN(e,s),e.du=e.du.remove(r),e.Au.delete(t),fV(e)}else await dd(e.localStore,t,!1).then(()=>fM(e,t,n)).catch(hs)}async function fx(e,t){var n;let i=t.batch.batchId;try{let r=await (n=e.localStore,n.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{let i,r,s,o=t.batch.keys(),a=n.Ns.newChangeBuffer({trackRemovals:!0});return(r=(i=t.batch).keys(),s=ho.resolve(),r.forEach(n=>{s=s.next(()=>a.getEntry(e,n)).next(e=>{let r=t.docVersions.get(n);lO(null!==r,48541),0>e.version.compareTo(r)&&(i.applyToRemoteDocument(e,t),e.isValidDocument()&&(e.setReadTime(t.commitVersion),a.addEntry(e)))})}),s.next(()=>n.mutationQueue.removeMutationBatch(e,i))).next(()=>a.apply(e)).next(()=>n.mutationQueue.performConsistencyCheck(e)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(e,o,t.batch.batchId)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=uM();for(let n=0;n<e.mutationResults.length;++n)e.mutationResults[n].transformResults.length>0&&(t=t.add(e.batch.mutations[n].key));return t}(t))).next(()=>n.localDocuments.getDocuments(e,o))}));fL(e,i,null),fO(e,i),e.sharedClientState.updateMutationState(i,"acknowledged"),await fq(e,r)}catch(e){await hs(e)}}async function fD(e,t,n){var i;try{let r=await (i=e.localStore,i.persistence.runTransaction("Reject batch","readwrite-primary",e=>{let n;return i.mutationQueue.lookupMutationBatch(e,t).next(t=>(lO(null!==t,37113),n=t.keys(),i.mutationQueue.removeMutationBatch(e,t))).next(()=>i.mutationQueue.performConsistencyCheck(e)).next(()=>i.documentOverlayCache.removeOverlaysForBatchId(e,n,t)).next(()=>i.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,n)).next(()=>i.localDocuments.getDocuments(e,n))}));fL(e,t,n),fO(e,t),e.sharedClientState.updateMutationState(t,"rejected",n),await fq(e,r)}catch(e){await hs(e)}}function fO(e,t){(e.mu.get(t)||[]).forEach(e=>{e.resolve()}),e.mu.delete(t)}function fL(e,t,n){let i=e.Vu[e.currentUser.toKey()];if(i){let r=i.get(t);r&&(n?r.reject(n):r.resolve(),i=i.remove(t)),e.Vu[e.currentUser.toKey()]=i}}function fM(e,t,n=null){for(let i of(e.sharedClientState.removeLocalQueryTarget(t),e.Iu.get(t)))e.Tu.delete(i),n&&e.Pu.yu(i,n);e.Iu.delete(t),e.isPrimaryClient&&e.Ru.jr(t).forEach(t=>{e.Ru.containsKey(t)||fF(e,t)})}function fF(e,t){e.Eu.delete(t.path.canonicalString());let n=e.du.get(t);null!==n&&(dB(e.remoteStore,n),e.du=e.du.remove(t),e.Au.delete(n),fV(e))}function fU(e,t,n){for(let i of n)i instanceof fg?(e.Ru.addReference(i.key,t),function(e,t){let n=t.key,i=n.path.canonicalString();e.du.get(n)||e.Eu.has(i)||(lA(f_,"New document in limbo: "+n),e.Eu.add(i),fV(e))}(e,i)):i instanceof fm?(lA(f_,"Document no longer in limbo: "+i.key),e.Ru.removeReference(i.key,t),e.Ru.containsKey(i.key)||fF(e,i.key)):lx(19791,{wu:i})}function fV(e){for(;e.Eu.size>0&&e.du.size<e.maxConcurrentLimboResolutions;){let t=e.Eu.values().next().value;e.Eu.delete(t);let n=new l2(lZ.fromString(t)),i=e.fu.next();e.Au.set(i,new fw(n)),e.du=e.du.insert(n,i),dj(e.remoteStore,new cV(uw(new um(n.path)),i,"TargetPurposeLimboResolution",hl.ce))}}async function fq(e,t,n){let i=[],r=[],s=[];e.Tu.isEmpty()||(e.Tu.forEach((o,a)=>{s.push(e.pu(a,t,n).then(t=>{if((t||n)&&e.isPrimaryClient){let i=t?!t.fromCache:n?.targetChanges.get(a.targetId)?.current;e.sharedClientState.updateQueryState(a.targetId,i?"current":"not-current")}if(t){i.push(t);let e=dr.As(a.targetId,t);r.push(e)}}))}),await Promise.all(s),e.Pu.H_(i),await async function(e,t){try{await e.persistence.runTransaction("notifyLocalViewChanges","readwrite",n=>ho.forEach(t,t=>ho.forEach(t.Es,i=>e.persistence.referenceDelegate.addReference(n,t.targetId,i)).next(()=>ho.forEach(t.ds,i=>e.persistence.referenceDelegate.removeReference(n,t.targetId,i)))))}catch(e){if(!ha(e))throw e;lA(dl,"Failed to update sequence numbers: "+e)}for(let n of t){let t=n.targetId;if(!n.fromCache){let n=e.Ms.get(t),i=n.snapshotVersion,r=n.withLastLimboFreeSnapshotVersion(i);e.Ms=e.Ms.insert(t,r)}}}(e.localStore,r))}async function fj(e,t){if(!e.currentUser.isEqual(t)){lA(f_,"User change. New user:",t.toKey());let n=await du(e.localStore,t);e.currentUser=t,e.mu.forEach(e=>{e.forEach(e=>{e.reject(new lM(lL.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),e.mu.clear(),e.sharedClientState.handleUserChange(t,n.removedBatchIds,n.addedBatchIds),await fq(e,n.Ls)}}function fB(e,t){let n=e.Au.get(t);if(n&&n.hu)return uM().add(n.key);{let n=uM(),i=e.Iu.get(t);if(!i)return n;for(let t of i){let i=e.Tu.get(t);n=n.unionWith(i.view.nu)}return n}}function fz(e){return e.remoteStore.remoteSyncer.applyRemoteEvent=fN.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=fB.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=fP.bind(null,e),e.Pu.H_=fc.bind(null,e.eventManager),e.Pu.yu=fd.bind(null,e.eventManager),e}class f${constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=dA(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){var t,n;return t=this.persistence,n=new da,new dh(t,n,e.initialUser,this.serializer)}Cu(e){return new de(dn.mi,this.serializer)}Du(e){return new dg}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}f$.provider={build:()=>new f$};class fH extends f${constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){return lO(this.persistence.referenceDelegate instanceof di,46915),new cY(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}Cu(e){let t=void 0!==this.cacheSizeBytes?cH.withCacheSize(this.cacheSizeBytes):cH.DEFAULT;return new de(e=>di.mi(e,t),this.serializer)}}class fW{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>fR(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=fj.bind(null,this.syncEngine),await d7(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new fa}createDatastore(e){var t;let n=dA(e.databaseInfo.databaseId),i=new dS(e.databaseInfo);return t=e.authCredentials,new dL(t,e.appCheckCredentials,i,n)}createRemoteStore(e){var t,n;return t=this.localStore,n=this.datastore,new dU(t,n,e.asyncQueue,e=>fR(this.syncEngine,e,0),d_.v()?new d_:new dm)}createSyncEngine(e,t){var n,i,r,s,o,a;let l;return n=this.localStore,i=this.remoteStore,r=this.eventManager,s=this.sharedClientState,o=e.initialUser,a=e.maxConcurrentLimboResolutions,l=new fb(n,i,r,s,o,a),t&&(l.gu=!0),l}async terminate(){await async function(e){lA(dF,"RemoteStore shutting down."),e.Ea.add(5),await dq(e),e.Aa.shutdown(),e.Ra.set("Unknown")}(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}fW.provider={build:()=>new fW};class fK{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):lN("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout(()=>{this.muted||e(t)},0)}}let fG="FirestoreClient";class fQ{constructor(e,t,n,i,r){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=i,this.user=lC.UNAUTHENTICATED,this.clientId=lW.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=r,this.authCredentials.start(n,async e=>{lA(fG,"Received user=",e.uid),await this.authCredentialListener(e),this.user=e}),this.appCheckCredentials.start(n,e=>(lA(fG,"Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new lF;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(n){let t=fn(n,"Failed to shutdown persistence");e.reject(t)}}),e.promise}}async function fY(e,t){e.asyncQueue.verifyOperationInProgress(),lA(fG,"Initializing OfflineComponentProvider");let n=e.configuration;await t.initialize(n);let i=n.initialUser;e.setCredentialChangeListener(async e=>{i.isEqual(e)||(await du(t.localStore,e),i=e)}),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e._offlineComponents=t}async function fX(e,t){e.asyncQueue.verifyOperationInProgress();let n=await fJ(e);lA(fG,"Initializing OnlineComponentProvider"),await t.initialize(n,e.configuration),e.setCredentialChangeListener(e=>d8(t.remoteStore,e)),e.setAppCheckTokenChangeListener((e,n)=>d8(t.remoteStore,n)),e._onlineComponents=t}async function fJ(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){lA(fG,"Using user provided OfflineComponentProvider");try{await fY(e,e._uninitializedComponentsProvider._offline)}catch(t){if(!("FirebaseError"===t.name?t.code===lL.FAILED_PRECONDITION||t.code===lL.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code))throw t;lR("Error using user provided cache. Falling back to memory cache: "+t),await fY(e,new f$)}}else lA(fG,"Using default OfflineComponentProvider"),await fY(e,new fH(void 0));return e._offlineComponents}async function fZ(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(lA(fG,"Using user provided OnlineComponentProvider"),await fX(e,e._uninitializedComponentsProvider._online)):(lA(fG,"Using default OnlineComponentProvider"),await fX(e,new fW))),e._onlineComponents}async function f0(e){let t=await fZ(e),n=t.eventManager;return n.onListen=fE.bind(null,t.syncEngine),n.onUnlisten=fS.bind(null,t.syncEngine),n.onFirstRemoteStoreListen=fT.bind(null,t.syncEngine),n.onLastRemoteStoreUnlisten=fk.bind(null,t.syncEngine),n}function f1(e){let t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}let f2=new Map,f6="firestore.googleapis.com";class f3{constructor(e){if(void 0===e.host){if(void 0!==e.ssl)throw new lM(lL.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=f6,this.ssl=!0}else this.host=e.host,this.ssl=e.ssl??!0;if(this.isUsingEmulator=void 0!==e.emulatorOptions,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=0x2800000;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new lM(lL.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}(function(e,t,n,i){if(!0===t&&!0===i)throw new lM(lL.INVALID_ARGUMENT,`${e} and ${n} cannot be used together.`)})("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=f1(e.experimentalLongPollingOptions??{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new lM(lL.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<5)throw new lM(lL.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is 5)`);if(e.timeoutSeconds>30)throw new lM(lL.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){var t,n;return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(t=this.experimentalLongPollingOptions,n=e.experimentalLongPollingOptions,t.timeoutSeconds===n.timeoutSeconds)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class f5{constructor(e,t,n,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new f3({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new lM(lL.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new lM(lL.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new f3(e),this._emulatorOptions=e.emulatorOptions||{},void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new lV;switch(e.type){case"firstParty":return new lz(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new lM(lL.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){let e;return(e=f2.get(this))&&(lA("ComponentProvider","Removing Datastore"),f2.delete(this),e.terminate()),Promise.resolve()}}class f4{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new f4(this.firestore,e,this._query)}}class f8{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new f7(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new f8(this.firestore,e,this._key)}toJSON(){return{type:f8._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,n){if(he(t,f8._jsonSchema))return new f8(e,n||null,new l2(lZ.fromString(t.referencePath)))}}f8._jsonSchemaVersion="firestore/documentReference/1.0",f8._jsonSchema={type:l9("string",f8._jsonSchemaVersion),referencePath:l9("string")};class f7 extends f4{constructor(e,t,n){super(e,t,new um(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new f8(this.firestore,null,new l2(e))}withConverter(e){return new f7(this.firestore,e,this._path)}}function f9(e,t,...n){if(e=ex(e),1==arguments.length&&(t=lW.newId()),l6("doc","path",t),e instanceof f5){let i=lZ.fromString(t,...n);return l3(i),new f8(e,null,new l2(i))}{if(!(e instanceof f8||e instanceof f7))throw new lM(lL.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let i=e._path.child(lZ.fromString(t,...n));return l3(i),new f8(e.firestore,e instanceof f7?e.converter:null,new l2(i))}}let pe="AsyncQueue";class pt{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new dN(this,"async_queue_retry"),this._c=()=>{let e=dk();e&&lA(pe,"Visibility state changed to "+e.visibilityState),this.M_.w_()},this.ac=e;const t=dk();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;let t=dk();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise(()=>{});let t=new lF;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Xu.push(e),this.lc()))}async lc(){if(0!==this.Xu.length){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!ha(e))throw e;lA(pe,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_(()=>this.lc())}}cc(e){let t=this.ac.then(()=>(this.rc=!0,e().catch(e=>{throw this.nc=e,this.rc=!1,lN("INTERNAL UNHANDLED ERROR: ",pn(e)),e}).then(e=>(this.rc=!1,e))));return this.ac=t,t}enqueueAfterDelay(e,t,n){this.uc(),this.oc.indexOf(e)>-1&&(t=0);let i=ft.createAndSchedule(this,e,t,n,e=>this.hc(e));return this.tc.push(i),i}uc(){this.nc&&lx(47125,{Pc:pn(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(let t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then(()=>{for(let t of(this.tc.sort((e,t)=>e.targetTimeMs-t.targetTimeMs),this.tc))if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.Tc()})}dc(e){this.oc.push(e)}hc(e){let t=this.tc.indexOf(e);this.tc.splice(t,1)}}function pn(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}function pi(e){if("object"!=typeof e||null===e)return!1;for(let t of["next","error","complete"])if(t in e&&"function"==typeof e[t])return!0;return!1}class pr extends f5{constructor(e,t,n,i){super(e,t,n,i),this.type="firestore",this._queue=new pt,this._persistenceKey=i?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new pt(e),this._firestoreClient=void 0,await e}}}function ps(e){if(e._terminated)throw new lM(lL.FAILED_PRECONDITION,"The client has already been terminated.");return e._firestoreClient||function(e){var t,n,i;let r,s=e._freezeSettings(),o=(t=e._databaseId,n=e._app?.options.appId||"",new hx(t,n,e._persistenceKey,s.host,s.ssl,s.experimentalForceLongPolling,s.experimentalAutoDetectLongPolling,f1(s.experimentalLongPollingOptions),s.useFetchStreams,s.isUsingEmulator));e._componentsProvider||s.localCache?._offlineComponentProvider&&s.localCache?._onlineComponentProvider&&(e._componentsProvider={_offline:s.localCache._offlineComponentProvider,_online:s.localCache._onlineComponentProvider}),e._firestoreClient=new fQ(e._authCredentials,e._appCheckCredentials,e._queue,o,e._componentsProvider&&(i=e._componentsProvider,r=i?._online.build(),{_offline:i?._offline.build(r),_online:r}))}(e),e._firestoreClient}class po{constructor(e){this._byteString=e}static fromBase64String(e){try{return new po(hw.fromBase64String(e))}catch(e){throw new lM(lL.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new po(hw.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:po._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(he(e,po._jsonSchema))return po.fromBase64String(e.bytes)}}po._jsonSchemaVersion="firestore/bytes/1.0",po._jsonSchema={type:l9("string",po._jsonSchemaVersion),bytes:l9("string")};class pa{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new lM(lL.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new l1(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class pl{constructor(e){this._methodName=e}}class ph{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new lM(lL.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new lM(lL.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return lK(this._lat,e._lat)||lK(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:ph._jsonSchemaVersion}}static fromJSON(e){if(he(e,ph._jsonSchema))return new ph(e.latitude,e.longitude)}}ph._jsonSchemaVersion="firestore/geoPoint/1.0",ph._jsonSchema={type:l9("string",ph._jsonSchemaVersion),latitude:l9("number"),longitude:l9("number")};class pu{constructor(e){this._values=(e||[]).map(e=>e)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}(this._values,e._values)}toJSON(){return{type:pu._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(he(e,pu._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(e=>"number"==typeof e))return new pu(e.vectorValues);throw new lM(lL.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}pu._jsonSchemaVersion="firestore/vectorValue/1.0",pu._jsonSchema={type:l9("string",pu._jsonSchemaVersion),vectorValues:l9("object")};let pc=/^__.*__$/;class pd{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new u3(e,this.data,this.fieldMask,t,this.fieldTransforms):new u6(e,this.data,t,this.fieldTransforms)}}class pf{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new u3(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function pp(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw lx(40011,{Ac:e})}}class pg{constructor(e,t,n,i,r,s){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=i,void 0===r&&this.Rc(),this.fieldTransforms=r||[],this.fieldMask=s||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new pg({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){let t=this.path?.child(e),n=this.Vc({path:t,fc:!1});return n.gc(e),n}yc(e){let t=this.path?.child(e),n=this.Vc({path:t,fc:!1});return n.Rc(),n}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return pS(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(0===e.length)throw this.Sc("Document fields must not be empty");if(pp(this.Ac)&&pc.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class pm{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||dA(e)}Cc(e,t,n,i=!1){return new pg({Ac:e,methodName:t,Dc:n,path:l1.emptyPath(),fc:!1,bc:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function py(e){let t=e._freezeSettings(),n=dA(e._databaseId);return new pm(e._databaseId,!!t.ignoreUndefinedProperties,n)}class p_ extends pl{_toFieldTransform(e){if(2!==e.Ac)throw 1===e.Ac?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof p_}}function pv(e,t){if(pb(e=ex(e)))return pE("Unsupported field value:",t,e),pw(e,t);if(e instanceof pl)return function(e,t){if(!pp(t.Ac))throw t.Sc(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.Sc(`${e._methodName}() is not currently supported inside arrays`);let n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.fc&&4!==t.Ac)throw t.Sc("Nested arrays are not supported");let n=[],i=0;for(let r of e){let e=pv(r,t.wc(i));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),i++}return{arrayValue:{values:n}}}return function(e,t){var n,i,r;if(null===(e=ex(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return n=t.serializer,"number"==typeof(r=i=e)&&Number.isInteger(r)&&!hh(r)&&r<=Number.MAX_SAFE_INTEGER&&r>=Number.MIN_SAFE_INTEGER?uV(i):uU(n,i);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){let n=ht.fromDate(e);return{timestampValue:cC(t.serializer,n)}}if(e instanceof ht){let n=new ht(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:cC(t.serializer,n)}}if(e instanceof ph)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof po)return{bytesValue:cI(t.serializer,e._byteString)};if(e instanceof f8){let n=t.databaseId,i=e.firestore._databaseId;if(!i.isEqual(n))throw t.Sc(`Document reference is for database ${i.projectId}/${i.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:ck(e.firestore._databaseId||t.databaseId,e._key.path)}}if(e instanceof pu)return{mapValue:{fields:{[hL]:{stringValue:hU},[hV]:{arrayValue:{values:e.toArray().map(e=>{if("number"!=typeof e)throw t.Sc("VectorValues must only contain numeric values.");return uU(t.serializer,e)})}}}}};throw t.Sc(`Unsupported field value: ${l8(e)}`)}(e,t)}function pw(e,t){let n={};return hd(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):hc(e,(e,i)=>{let r=pv(i,t.mc(e));null!=r&&(n[e]=r)}),{mapValue:{fields:n}}}function pb(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof ht||e instanceof ph||e instanceof po||e instanceof f8||e instanceof pl||e instanceof pu)}function pE(e,t,n){if(!pb(n)||!l4(n)){let i=l8(n);throw"an object"===i?t.Sc(e+" a custom object"):t.Sc(e+" "+i)}}function pT(e,t,n){if((t=ex(t))instanceof pa)return t._internalPath;if("string"==typeof t)return pI(e,t);throw pS("Field path arguments must be of type string or ",e,!1,void 0,n)}let pC=RegExp("[~\\*/\\[\\]]");function pI(e,t,n){if(t.search(pC)>=0)throw pS(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,n);try{return new pa(...t.split("."))._internalPath}catch(i){throw pS(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,n)}}function pS(e,t,n,i,r){let s=i&&!i.isEmpty(),o=void 0!==r,a=`Function ${t}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(s||o)&&(l+=" (found",s&&(l+=` in field ${i}`),o&&(l+=` in document ${r}`),l+=")"),new lM(lL.INVALID_ARGUMENT,a+e+l)}function pk(e,t){return e.some(e=>e.isEqual(t))}class pA{constructor(e,t,n,i,r){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=i,this._converter=r}get id(){return this._key.path.lastSegment()}get ref(){return new f8(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){let e=new pN(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){let t=this._document.data.field(pR("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class pN extends pA{data(){return super.data()}}function pR(e,t){return"string"==typeof t?pI(e,t):t instanceof pa?t._internalPath:t._delegate._internalPath}class pP{}class px extends pP{}class pD extends px{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new pD(e,t,n)}_apply(e){let t=this._parse(e);return pV(e._query,t),new f4(e.firestore,e.converter,ub(e._query,t))}_parse(e){let t=py(e.firestore);return function(e,t,n,i,r,s,o){let a;if(r.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new lM(lL.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if("in"===s||"not-in"===s){pU(o,s);let t=[];for(let n of o)t.push(pF(i,e,n));a={arrayValue:{values:t}}}else a=pF(i,e,o)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||pU(o,s),a=function(e,t,n,i=!1){return pv(n,e.Cc(i?4:3,t))}(n,t,o,"in"===s||"not-in"===s);return h9.create(r,s,a)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}class pO extends pP{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new pO(e,t)}_parse(e){let t=this._queryConstraints.map(t=>t._parse(e)).filter(e=>e.getFilters().length>0);return 1===t.length?t[0]:ue.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return 0===t.getFilters().length?e:(function(e,t){let n=e;for(let e of t.getFlattenedFilters())pV(n,e),n=ub(n,e)}(e._query,t),new f4(e.firestore,e.converter,ub(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class pL extends px{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new pL(e,t)}_apply(e){var t;let n,i=function(e,t,n){if(null!==e.startAt)throw new lM(lL.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new lM(lL.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new h8(t,n)}(e._query,this._field,this._direction);return new f4(e.firestore,e.converter,(t=e._query,n=t.explicitOrderBy.concat([i]),new um(t.path,t.collectionGroup,n,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)))}}class pM extends px{constructor(e,t,n){super(),this.type=e,this._limit=t,this._limitType=n}static _create(e,t,n){return new pM(e,t,n)}_apply(e){return new f4(e.firestore,e.converter,uE(e._query,this._limit,this._limitType))}}function pF(e,t,n){if("string"==typeof(n=ex(n))){if(""===n)throw new lM(lL.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!u_(t)&&-1!==n.indexOf("/"))throw new lM(lL.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);let i=t.path.child(lZ.fromString(n));if(!l2.isDocumentKey(i))throw new lM(lL.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${i}' is not because it has an odd number of segments (${i.length}).`);return hK(e,new l2(i))}if(n instanceof f8)return hK(e,n._key);throw new lM(lL.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${l8(n)}.`)}function pU(e,t){if(!Array.isArray(e)||0===e.length)throw new lM(lL.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function pV(e,t){let n=function(e,t){for(let n of e)for(let e of n.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}(e.filters,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==n)throw n===t.op?new lM(lL.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new lM(lL.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${n.toString()}' filters.`)}class pq{convertValue(e,t="none"){switch(hq(e)){case 0:return null;case 1:return e.booleanValue;case 2:return hT(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(hC(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw lx(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let n={};return hc(e,(e,i)=>{n[e]=this.convertValue(i,t)}),n}convertVectorValue(e){return new pu(e.fields?.[hV].arrayValue?.values?.map(e=>hT(e.doubleValue)))}convertGeoPoint(e){return new ph(hT(e.latitude),hT(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":let n=hR(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(hP(e));default:return null}}convertTimestamp(e){let t=hE(e);return new ht(t.seconds,t.nanos)}convertDocumentKey(e,t){let n=lZ.fromString(e);lO(cU(n),9688,{name:e});let i=new hO(n.get(1),n.get(3)),r=new l2(n.popFirst(5));return i.isEqual(t)||lN(`Document ${r} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),r}}class pj{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class pB extends pA{constructor(e,t,n,i,r,s){super(e,t,n,i,s),this._firestore=e,this._firestoreImpl=e,this.metadata=r}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new pz(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let n=this._document.data.field(pR("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new lM(lL.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e=this._document,t={};return t.type=pB._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),e&&e.isValidDocument()&&e.isFoundDocument()&&(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),this._firestore,this.ref.path,t.bundle="NOT SUPPORTED"),t}}pB._jsonSchemaVersion="firestore/documentSnapshot/1.0",pB._jsonSchema={type:l9("string",pB._jsonSchemaVersion),bundleSource:l9("string","DocumentSnapshot"),bundleName:l9("string"),bundle:l9("string")};class pz extends pB{data(e={}){return super.data(e)}}class p${constructor(e,t,n,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new pj(i.hasPendingWrites,i.fromCache),this.query=n}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new pz(this._firestore,this._userDataWriter,n.key,n,new pj(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new lM(lL.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map(n=>{let i=new pz(e._firestore,e._userDataWriter,n.doc.key,n.doc,new pj(e._snapshot.mutatedKeys.has(n.doc.key),e._snapshot.fromCache),e.query.converter);return n.doc,{type:"added",doc:i,oldIndex:-1,newIndex:t++}})}{let n=e._snapshot.oldDocs;return e._snapshot.docChanges.filter(e=>t||3!==e.type).map(t=>{let i=new pz(e._firestore,e._userDataWriter,t.doc.key,t.doc,new pj(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter),r=-1,s=-1;return 0!==t.type&&(r=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),1!==t.type&&(s=(n=n.add(t.doc)).indexOf(t.doc.key)),{type:function(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return lx(61501,{type:e})}}(t.type),doc:i,oldIndex:r,newIndex:s}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new lM(lL.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e={};e.type=p$._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=lW.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;let t=[],n=[],i=[];return this.docs.forEach(e=>{null!==e._document&&(t.push(e._document),n.push(this._userDataWriter.convertObjectMap(e._document.data.value.mapValue.fields,"previous")),i.push(e.ref.path))}),this._firestore,this.query._query,e.bundleName,e.bundle="NOT SUPPORTED",e}}p$._jsonSchemaVersion="firestore/querySnapshot/1.0",p$._jsonSchema={type:l9("string",p$._jsonSchemaVersion),bundleSource:l9("string","QuerySnapshot"),bundleName:l9("string"),bundle:l9("string")};class pH extends pq{constructor(e){super(),this.firestore=e}convertBytes(e){return new po(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new f8(this.firestore,null,t)}}function pW(e,t){var n;let i;return n=ps(e),i=new lF,n.asyncQueue.enqueueAndForget(async()=>fA(await fZ(n).then(e=>e.syncEngine),t,i)),i.promise}new WeakMap,function(e=!0){lI=tf,tn(new eD("firestore",(t,{instanceIdentifier:n,options:i})=>{let r=t.getProvider("app").getImmediate(),s=new pr(new lj(t.getProvider("auth-internal")),new lH(r,t.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new lM(lL.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new hO(e.options.projectId,t)}(r,n),r);return i={useFetchStreams:e,...i},s._setSettings(i),s},"PUBLIC").setMultipleInstances(!0)),tv(lE,lT,void 0),tv(lE,lT,"esm2020")}();let pK={apiKey:"AIzaSyAUPtroOvn4YU0bKh9NiloHKbCtraSINVk",authDomain:"desetkasi.firebaseapp.com",databaseURL:"https://desetkasi-default-rtdb.europe-west1.firebasedatabase.app",projectId:"desetkasi",storageBucket:"desetkasi.firebasestorage.app",messagingSenderId:"791972947027",appId:"1:791972947027:web:813ff0905b51a7a85952a6"};console.log("Firebase Config:",{apiKey:pK.apiKey?"SET":"MISSING",databaseURL:pK.databaseURL||"MISSING",projectId:pK.projectId||"MISSING"});let pG=0===ty().length?tp(pK):ty()[0];!function(e=tm()){let t=ti(e,"auth");if(t.isInitialized())return t.getImmediate();let n=function(e,t){let n=ti(e,"auth");if(n.isInitialized()){let e=n.getImmediate();if(eb(n.getOptions(),t??{}))return e;tM(e,"already-initialized")}return n.initialize({options:t})}(e,{popupRedirectResolver:ru,persistence:[iF,iw,ib]}),i=Y("authTokenSyncURL");if(i&&"boolean"==typeof isSecureContext&&isSecureContext){let e=new URL(i,location.origin);if(location.origin===e.origin){let t,i=(t=e.toString(),async e=>{let n=e&&await e.getIdTokenResult(),i=n&&(new Date().getTime()-Date.parse(n.issuedAtTime))/1e3;if(i&&i>rp)return;let r=n?.token;rg!==r&&(rg=r,await fetch(t,{method:r?"POST":"DELETE",headers:r?{Authorization:`Bearer ${r}`}:{}}))});ex(n).beforeAuthStateChanged(i,()=>i(n.currentUser)),ex(n).onIdTokenChanged(e=>i(e),void 0,void 0)}}let r=K("auth");r&&function(e,t,n){let i=ex(e);tj(/^https?:\/\//.test(t),i,"invalid-emulator-scheme");let r=nH(t),{host:s,port:o}=function(e){let t=nH(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};let i=n[2].split("@").pop()||"",r=/^(\[[^\]]+\])(:|$)/.exec(i);if(r){let e=r[1];return{host:e,port:nW(i.substr(e.length+1))}}{let[e,t]=i.split(":");return{host:e,port:nW(t)}}}(t),a=null===o?"":`:${o}`,l={url:`${r}//${s}${a}/`},h=Object.freeze({host:s,port:o,protocol:r.replace(":",""),options:Object.freeze({disableWarnings:!1})});if(!i._canInitEmulator){tj(i.config.emulator&&i.emulatorConfig,i,"emulator-config-failed"),tj(eb(l,i.config.emulator)&&eb(h,i.emulatorConfig),i,"emulator-config-failed");return}i.config.emulator=l,i.emulatorConfig=h,i.settings.appVerificationDisabledForTesting=!0,J(s)?(Z(`${r}//${s}${a}`),ei("Auth",!0)):function(){function e(){let e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}(n,`http://${r}`)}(pG);let pQ=function(e=tm(),t){let n=ti(e,"database").getImmediate({identifier:void 0});if(!n._instanceStarted){let e=G("database");e&&function(e,t,n,i={}){var r;let s,o,a;(e=ex(e))._checkNotDeleted("useEmulator");let l=`${t}:${n}`,h=e._repoInternal;if(e._instanceStarted){if(l===e._repoInternal.repoInfo_.host&&eb(i,h.repoInfo_.emulatorOptions))return;rO("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}h.repoInfo_.nodeAdmin?(i.mockUserToken&&rO('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),s=new r0(r0.OWNER)):i.mockUserToken&&(s=new r0("string"==typeof i.mockUserToken?i.mockUserToken:ee(i.mockUserToken,e.app.options.projectId))),J(t)&&(Z(t),ei("Database",!0)),r=s,o=l.lastIndexOf(":"),a=J(l.substring(0,o)),h.repoInfo_=new r3(l,a,h.repoInfo_.namespace,h.repoInfo_.webSocketOnly,h.repoInfo_.nodeAdmin,h.repoInfo_.persistenceKey,h.repoInfo_.includeNamespaceInQueryParams,!0,i),r&&(h.authTokenProvider_=r)}(n,...e)}return n}(pG),pY=function(e,t){let n=ti("object"==typeof e?e:tm(),"firestore").getImmediate({identifier:"string"==typeof e?e:hD});if(!n._initialized){let e=G("firestore");e&&function(e,t,n,i={}){e=l7(e,f5);let r=J(t),s=e._getSettings(),o={...s,emulatorOptions:e._getEmulatorOptions()},a=`${t}:${n}`;r&&(Z(`https://${a}`),ei("Firestore",!0)),s.host!==f6&&s.host!==a&&lR("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");let l={...s,host:a,ssl:r,emulatorOptions:i};if(!eb(l,o)&&(e._setSettings(l),i.mockUserToken)){let t,n;if("string"==typeof i.mockUserToken)t=i.mockUserToken,n=lC.MOCK_USER;else{t=ee(i.mockUserToken,e._app?.options.projectId);let r=i.mockUserToken.sub||i.mockUserToken.user_id;if(!r)throw new lM(lL.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new lC(r)}e._authCredentials=new lq(new lU(t,n))}}(n,...e)}return n}(pG);console.log("Firebase initialized, database:",pQ?"OK":"FAILED"),console.log("Firestore initialized:",pY?"OK":"FAILED");let pX=e=>`erp/${e}`,pJ="erp_",pZ=async(e,t)=>{var n;let i,r,s,o=(aV("push",(n=ex(n=lh(pQ,pX(e))))._path),aD("push",void 0,n._path,!0),r=ln(aK(n._repo)),s=lu(n,r),s.then=(i=Promise.resolve(lu(n,r))).then.bind(i),s.catch=i.then.bind(i,void 0),s);return await lc(o,t),o.key},p0=async(e,t)=>{var n;let i,r=pX(e);await (aM("update",t,(n=lh(pQ,r))._path,!1),i=new X,!function(e,t,n,i){a0(e,"update",{path:t.toString(),value:n});let r=!0,s=aG(e),o={};if(rW(n,(n,i)=>{r=!1,o[n]=av(sv(t,n),sY(i),e.serverSyncTree_,s)}),r)rP("update() called with empty data.  Don't do anything."),a1(e,i,"ok",void 0);else{var a,l;let r,s=aJ(e),h=(a=e.serverSyncTree_,l=a.pendingWriteTree_,F(s>l.lastWriteId,"Stacking an older merge on top of newer ones"),l.allWrites.push({path:t,children:o,writeId:s,visible:!0}),l.visibleWrites=oT(l.visibleWrites,t,o),l.lastWriteId=s,r=ow.fromObject(o),ao(a,new oc(os(),t,r)));aB(e.eventQueue_,h),e.server_.merge(t.toString(),n,(n,r)=>{let o="ok"===n;o||rL("update at "+t+" failed: "+n);let a=at(e.serverSyncTree_,s,!o),l=a.length>0?a6(e,t):t;a$(e.eventQueue_,l,a),a1(e,i,n,r)}),rW(n,n=>{let i=a8(e,sv(t,n));a6(e,i)}),a$(e.eventQueue_,t,[])}}(n._repo,n._path,t,i.wrapCallback(()=>{})),i.promise)},p1=async e=>{var t;let n=pX(e);await (aV("remove",(t=lh(pQ,n))._path),lc(t,null))},p2=e=>{if(e.startsWith(pJ))return e;let t=e.replace(/([A-Z])/g,"_$1").toLowerCase();return`${pJ}${t}`},p6=e=>{let t=p2(e);return console.log("Getting Firestore collection:",t),function(e,t,...n){if(e=ex(e),l6("collection","path",t),e instanceof f5){let i=lZ.fromString(t,...n);return l5(i),new f7(e,null,i)}{if(!(e instanceof f8||e instanceof f7))throw new lM(lL.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let i=e._path.child(lZ.fromString(t,...n));return l5(i),new f7(e.firestore,null,i)}}(pY,t)},p3=async(e,t)=>{var n,i;let r,s,o,a=p6(e);return(await (n={...t,createdAt:ht.now(),updatedAt:ht.now()},r=l7(a.firestore,pr),s=f9(a),i=a.converter,o=i?i.toFirestore(n):n,pW(r,[(function(e,t,n,i,r,s={}){let o,a,l=e.Cc(s.merge||s.mergeFields?2:0,t,n,r);pE("Data must be an object, but it was:",l,i);let h=pw(i,l);if(s.merge)o=new h_(l.fieldMask),a=l.fieldTransforms;else if(s.mergeFields){let e=[];for(let i of s.mergeFields){let r=pT(t,i,n);if(!l.contains(r))throw new lM(lL.INVALID_ARGUMENT,`Field '${r}' is specified in your field mask but missing from your input data.`);pk(e,r)||e.push(r)}o=new h_(e),a=l.fieldTransforms.filter(e=>o.covers(e.field))}else o=null,a=l.fieldTransforms;return new pd(new h2(h),o,a)})(py(a.firestore),"addDoc",s._key,o,null!==a.converter,{}).toMutation(s._key,uX.exists(!1))]).then(()=>s))).id},p5=async(e,t,n)=>{let i=f9(pY,p2(e),t);await function(e,t,n,...i){var r,s,o;let a,l,h;e=l7(e,f8);let u=l7(e.firestore,pr),c=py(u);return pW(u,[("string"==typeof(t=ex(t))||t instanceof pa?function(e,t,n,i,r,s){let o=e.Cc(1,t,n),a=[pT(t,i,n)],l=[r];if(s.length%2!=0)throw new lM(lL.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let e=0;e<s.length;e+=2)a.push(pT(t,s[e])),l.push(s[e+1]);let h=[],u=h2.empty();for(let e=a.length-1;e>=0;--e)if(!pk(h,a[e])){let t=a[e],n=l[e];n=ex(n);let i=o.yc(t);if(n instanceof p_)h.push(t);else{let e=pv(n,i);null!=e&&(h.push(t),u.set(t,e))}}return new pf(u,new h_(h),o.fieldTransforms)}(c,"updateDoc",e._key,t,void 0,i):(r="updateDoc",s=e._key,o=t,pE("Data must be an object, but it was:",a=c.Cc(1,r,s),o),l=[],h=h2.empty(),hc(o,(e,t)=>{let n=pI(r,e,s);t=ex(t);let i=a.yc(n);if(t instanceof p_)l.push(n);else{let e=pv(t,i);null!=e&&(l.push(n),h.set(n,e))}}),new pf(h,new h_(l),a.fieldTransforms))).toMutation(e._key,uX.exists(!0))])}(i,{...n,updatedAt:ht.now()})},p4=async(e,t)=>{let n=f9(pY,p2(e),t);await pW(l7(n.firestore,pr),[new u7(n._key,uX.none())])};e.s(["addFirestoreData",0,p3,"deleteFirestoreData",0,p4,"pushData",0,pZ,"removeData",0,p1,"subscribeToData",0,(e,t)=>{let n=pX(e);return console.log("Subscribing to RTDB:",n),lp(lh(pQ,n),e=>{console.log(`RTDB data received for ${n}:`,e.exists()?"has data":"empty"),t(e.exists()?e.val():null)},e=>{console.error(`RTDB error for ${n}:`,e),t(null)})},"subscribeToFirestore",0,(e,t,n)=>{var i,r,s,o;let a,l=p6(e),h=l,u=[];return n?.whereField&&n?.whereOp&&n?.whereValue!==void 0&&u.push((i=n.whereField,r=n.whereOp,s=n.whereValue,a=pR("where",i),pD._create(a,r,s))),n?.orderByField&&u.push(function(e,t="asc"){let n=pR("orderBy",e);return pL._create(n,t)}(n.orderByField,n.orderDirection||"desc")),n?.limitCount&&u.push((function(e,t){if(t<=0)throw new lM(lL.INVALID_ARGUMENT,`Function ${e}() requires a positive number, but it was: ${t}.`)}("limit",o=n.limitCount),pM._create("limit",o,"F"))),u.length>0&&(h=function(e,t,...n){let i=[];for(let r of(t instanceof pP&&i.push(t),function(e){let t=e.filter(e=>e instanceof pO).length,n=e.filter(e=>e instanceof pD).length;if(t>1||t>0&&n>0)throw new lM(lL.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(i=i.concat(n)),i))e=r._apply(e);return e}(l,...u)),console.log("Subscribing to Firestore collection:",e),function(e,...t){var n;let i,r,s,o,a;e=ex(e);let l={includeMetadataChanges:!1,source:"default"},h=0;"object"!=typeof t[0]||pi(t[h])||(l=t[h++]);let u={includeMetadataChanges:l.includeMetadataChanges,source:l.source};if(pi(t[h])){let e=t[h];t[h]=e.next?.bind(e),t[h+1]=e.error?.bind(e),t[h+2]=e.complete?.bind(e)}if(e instanceof f8)r=l7(e.firestore,pr),s=new um(e._key.path),i={next:n=>{var i,s,o;let a,l;t[h]&&t[h]((i=r,s=e,a=(o=n).docs.get(s._key),l=new pH(i),new pB(i,l,s._key,a,new pj(o.hasPendingWrites,o.fromCache),s.converter)))},error:t[h+1],complete:t[h+2]};else{let n=l7(e,f4);r=l7(n.firestore,pr),s=n._query;let o=new pH(r);i={next:e=>{t[h]&&t[h](new p$(r,o,n,e))},error:t[h+1],complete:t[h+2]},function(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new lM(lL.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}(e._query)}return n=ps(r),a=new fp(s,o=new fK(i),u),n.asyncQueue.enqueueAndForget(async()=>fh(await f0(n),a)),()=>{o.Nu(),n.asyncQueue.enqueueAndForget(async()=>fu(await f0(n),a))}}(h,n=>{let i=n.docs.map(e=>({id:e.id,_id:e.id,...e.data()}));console.log(`Firestore data received for ${e}:`,i.length,"documents"),t(i)},n=>{console.error(`Firestore error for ${e}:`,n),t([])})},"subscribeToRTDB",0,(e,t)=>{let n=pX(e);return console.log("Subscribing to RTDB (array):",n),lp(lh(pQ,n),e=>{if(!e.exists()){console.log(`RTDB empty for ${n}`),t([]);return}let i=e.val(),r=[];i&&"object"==typeof i&&!Array.isArray(i)?r=Object.entries(i).map(([e,t])=>({id:e,_id:e,...t})):Array.isArray(i)&&(r=i.map((e,t)=>({id:e?.id||t.toString(),...e}))),console.log(`RTDB data received for ${n}:`,r.length,"items"),t(r)},e=>{console.error(`RTDB error for ${n}:`,e),t([])})},"updateData",0,p0,"updateFirestoreData",0,p5],69457)}]);